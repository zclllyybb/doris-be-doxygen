<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ppl_util: /Users/dabowang/be_all/olap/lru_cache.h 源文件</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ppl_util
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_8eac97cde2fee0634bdd38dda0a21780.html">be_all</a></li><li class="navelem"><a class="el" href="../../dir_fd13cd9924173dabc19edd1b98708655.html">olap</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">lru_cache.h</div></div>
</div><!--header-->
<div class="contents">
<a href="../../dd/dc0/lru__cache_8h.html">浏览该文件的文档.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright (c) 2011 The LevelDB Authors. All rights reserved.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// found in the LICENSE file. See the AUTHORS file for names of contributors.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;gtest/gtest_prod.h&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;rapidjson/document.h&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="../../db/d47/olap_2olap__common_8h.html">olap/olap_common.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="../../d0/d43/mem__tracker_8h.html">runtime/memory/mem_tracker.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="../../dc/dd1/thread__context_8h.html">runtime/thread_context.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="../../df/d34/metrics_8h.html">util/metrics.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="../../d0/d48/slice_8h.html">util/slice.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d6/d94/namespacedoris.html">doris</a> {</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="../../dd/dc0/lru__cache_8h.html#a4a6b9cdb26cf5ee2aa5877a5b3326170">   25</a></span><span class="preprocessor">#define OLAP_CACHE_STRING_TO_BUF(cur, str, r_len)                  \</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">    do {                                                           \</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">        if (r_len &gt; str.size()) {                                  \</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">            memcpy(cur, str.c_str(), str.size());                  \</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">            r_len -= str.size();                                   \</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">            cur += str.size();                                     \</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">        } else {                                                   \</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">            LOG(WARNING) &lt;&lt; &quot;construct cache key buf not enough.&quot;</span>; \</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>            return CacheKey(nullptr, 0);                           \</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        }                                                          \</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    } while (0)</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno"><a class="line" href="../../dd/dc0/lru__cache_8h.html#a1437f25273e0d46588682d05c10671b5">   37</a></span><span class="preprocessor">#define OLAP_CACHE_NUMERIC_TO_BUF(cur, numeric, r_len)             \</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">    do {                                                           \</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">        if (r_len &gt; sizeof(numeric)) {                             \</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">            memcpy(cur, &amp;numeric, sizeof(numeric));                \</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">            r_len -= sizeof(numeric);                              \</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">            cur += sizeof(numeric);                                \</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">        } else {                                                   \</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">            LOG(WARNING) &lt;&lt; &quot;construct cache key buf not enough.&quot;</span>; \</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>            return CacheKey(nullptr, 0);                           \</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        }                                                          \</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    } while (0)</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keyword">class </span>Cache;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keyword">class </span>CacheKey;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">   52</a></span><span class="keyword">enum</span> <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> {</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a4aa71180778b711338785695df5d7c52">   53</a></span>    <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a4aa71180778b711338785695df5d7c52">SIZE</a>,  <span class="comment">// The capacity of cache is based on the size of cache entry.</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a12a90dfe20486bbe3e075afcd19ef2d0">NUMBER</a> <span class="comment">// The capacity of cache is based on the number of cache entry.</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a12a90dfe20486bbe3e075afcd19ef2d0">   55</a></span>};</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="comment">// Create a new cache with a specified name and capacity.</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="comment">// This implementation of Cache uses a least-recently-used eviction policy.</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="keyword">extern</span> Cache* <a class="code hl_function" href="../../d6/d94/namespacedoris.html#a62b6fa8336b62746fe12620c18b8742b">new_lru_cache</a>(<span class="keyword">const</span> std::string&amp; <a class="code hl_variable" href="../../d6/d94/namespacedoris.html#a8ccf841cb59e451791bcb2e1ac4f1edc">name</a>, <span class="keywordtype">size_t</span> capacity,</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>                            <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> type = <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a4aa71180778b711338785695df5d7c52">LRUCacheType::SIZE</a>, uint32_t num_shards = 16);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html">   62</a></span><span class="keyword">class </span><a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a> {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#aa4a7e0903b99b59bbc6826c07d8d7f9d">   64</a></span>    <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa4a7e0903b99b59bbc6826c07d8d7f9d">CacheKey</a>() : <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>(nullptr), <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>(0) {}</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// Create a slice that refers to d[0,n-1].</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a14b0940b1452e01555790d2d841653bf">   66</a></span>    <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a14b0940b1452e01555790d2d841653bf">CacheKey</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* d, <span class="keywordtype">size_t</span> n) : <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>(d), <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>(n) {}</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment">// Create a slice that refers to the contents of &quot;s&quot;</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ab9f7dbfd58df6ce1c949fda9463b1c10">   69</a></span>    <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ab9f7dbfd58df6ce1c949fda9463b1c10">CacheKey</a>(<span class="keyword">const</span> std::string&amp; s) : <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>(s.<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">data</a>()), <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>(s.<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>()) {}</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// Create a slice that refers to s[0,strlen(s)-1]</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ace6b096facbd1856ea784f971c93e1fa">   72</a></span>    <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ace6b096facbd1856ea784f971c93e1fa">CacheKey</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* s) : <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>(s), <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>(strlen(s)) {}</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a578a6e4ae76c2fde425b27b2c7ea686f">   74</a></span>    <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a578a6e4ae76c2fde425b27b2c7ea686f">~CacheKey</a>() {}</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// Return a pointer to the beginning of the referenced data</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">   77</a></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">data</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>; }</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">// Return the length (in bytes) of the referenced data</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">   80</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>; }</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">// Return true if the length of the referenced data is zero</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a644718bb2fb240de962dc3c9a1fdf0dc">   83</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a644718bb2fb240de962dc3c9a1fdf0dc">empty</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> == 0; }</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// Return the ith byte in the referenced data.</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// REQUIRES: n &lt; size()</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ac1a0dc45505ee062a1d5527af7981ac5">   87</a></span>    <span class="keywordtype">char</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ac1a0dc45505ee062a1d5527af7981ac5">operator[]</a>(<span class="keywordtype">size_t</span> n)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        assert(n &lt; <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>());</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>[n];</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    }</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="comment">// Change this slice to refer to an empty array</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ac8bb3912a3ce86b15842e79d0b421204">   93</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>() {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> = 0;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    }</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// Drop the first &quot;n&quot; bytes from this slice.</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ad51651afef0ae59bf122b1cd9df2facb">   99</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ad51651afef0ae59bf122b1cd9df2facb">remove_prefix</a>(<span class="keywordtype">size_t</span> n) {</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        assert(n &lt;= <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>());</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a> += n;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> -= n;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    }</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span> </div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="comment">// Return a string that contains the copy of the referenced data.</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#aac993ecccd3d88aafefb6b8e3caa1dee">  106</a></span>    std::string <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aac993ecccd3d88aafefb6b8e3caa1dee">to_string</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> std::string(<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>, <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>); }</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a4eeac1fd5b41a16678f29b6b2a6a150b">  108</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a4eeac1fd5b41a16678f29b6b2a6a150b">operator==</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; other)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        <span class="keywordflow">return</span> ((<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>() == other.<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>()) &amp;&amp; (memcmp(<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">data</a>(), other.<a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">data</a>(), <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">size</a>()) == 0));</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    }</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ad08a86a2badc47e3e453b48dfe0a1bc8">  112</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#ad08a86a2badc47e3e453b48dfe0a1bc8">operator!=</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; other)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !(*<span class="keyword">this</span> == other); }</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a9fb838ac7eb3bab194528e9eb371644d">  114</a></span>    <span class="keywordtype">int</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a9fb838ac7eb3bab194528e9eb371644d">compare</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; b)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> min_len = (<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> &lt; b.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>) ? <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> : b.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>;</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        <span class="keywordtype">int</span> r = memcmp(<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>, b.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>, min_len);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <span class="keywordflow">if</span> (r == 0) {</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> &lt; b.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>) {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                r = -1;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> &gt; b.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>) {</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                r = +1;</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>            }</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        }</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="keywordflow">return</span> r;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    uint32_t <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#acb03dc3faa34ae8e7b0497de5e3048c9">hash</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">data</a>, <span class="keywordtype">size_t</span> n, uint32_t seed) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">// Return true if &quot;x&quot; is a prefix of &quot;*this&quot;</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a087a995480b6a64b1e9064b2f6ab8a2f">  130</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a087a995480b6a64b1e9064b2f6ab8a2f">starts_with</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; x)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="keywordflow">return</span> ((<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a> &gt;= x.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>) &amp;&amp; (memcmp(<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>, x.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>, x.<a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>) == 0));</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a63dca305a312a7974239d8f59338d4c3">  135</a></span>    uint32_t <a class="code hl_function" href="../../da/d3a/classdoris_1_1_cache_key.html#a63dca305a312a7974239d8f59338d4c3">_decode_fixed32</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ptr)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>        <span class="comment">// Load the raw bytes</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        uint32_t result;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <a class="code hl_function" href="../../d9/d1e/memcpy__aarch64_8cpp.html#a156c5821f16ed93be8c7d315303f7b2a">memcpy</a>(&amp;result, ptr, <span class="keyword">sizeof</span>(result)); <span class="comment">// gcc optimizes this to a plain load</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">  142</a></span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">_data</a>;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno"><a class="line" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">  143</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">_size</a>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>};</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">// The entry with smaller CachePriority will evict firstly</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">  147</a></span><span class="keyword">enum class</span> <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">CachePriority</a> { <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051">NORMAL</a> = 0, <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba339b2f19a3f2821963c7d2b0ca441bd2">DURABLE</a> = 1 };</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">  149</a></span><span class="keyword">using </span><a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">CacheValuePredicate</a> = std::function&lt;bool(<span class="keyword">const</span> <span class="keywordtype">void</span>*)&gt;;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span><span class="comment">// CacheValueTimeExtractor can extract timestamp</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">// in cache value through the specified function,</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">// such as last_visit_time in InvertedIndexSearcherCache::CacheValue</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">  153</a></span><span class="keyword">using </span><a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">CacheValueTimeExtractor</a> = std::function&lt;int64_t(<span class="keyword">const</span> <span class="keywordtype">void</span>*)&gt;;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html">  155</a></span><span class="keyword">class </span><a class="code hl_class" href="../../de/d06/classdoris_1_1_cache.html">Cache</a> {</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#ae1e6297c25b58d8c5a0f7dad45487c08">  157</a></span>    <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#ae1e6297c25b58d8c5a0f7dad45487c08">Cache</a>() {}</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// Destroys all existing entries by calling the &quot;deleter&quot;</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// function that was passed to the constructor.</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="keyword">virtual</span> <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a899b8bf120ecc87b59e142f00b2987b0">~Cache</a>();</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span> </div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="comment">// Opaque handle to an entry stored in the cache.</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">  164</a></span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a> {};</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="comment">// Insert a mapping from key-&gt;value into the cache and assign it</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">// the specified charge against the total cache capacity.</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// Returns a handle that corresponds to the mapping.  The caller</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">// must call this-&gt;release(handle) when the returned mapping is no</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">// longer needed.</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="comment">// When the inserted entry is no longer needed, the key and</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">// value will be passed to &quot;deleter&quot;.</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#aed6e7c03d7d603f21a363033c32bd48a">  175</a></span>    <span class="keyword">virtual</span> <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#aed6e7c03d7d603f21a363033c32bd48a">insert</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>, <span class="keywordtype">size_t</span> charge,</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                           <span class="keywordtype">void</span> (*deleter)(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>),</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                           <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">CachePriority</a> priority = <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051">CachePriority::NORMAL</a>) = 0;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment">// If the cache has no mapping for &quot;key&quot;, returns nullptr.</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="comment">// Else return a handle that corresponds to the mapping.  The caller</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="comment">// must call this-&gt;release(handle) when the returned mapping is no</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="comment">// longer needed.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a50df2ff2b2b5e0be5477fc67df51a825">  184</a></span>    <span class="keyword">virtual</span> <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a50df2ff2b2b5e0be5477fc67df51a825">lookup</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key) = 0;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="comment">// Release a mapping returned by a previous Lookup().</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="comment">// REQUIRES: handle must not have been released yet.</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <span class="comment">// REQUIRES: handle must have been returned by a method on *this.</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a99ff5ff87dc624c6460076b6e6879011">  189</a></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a99ff5ff87dc624c6460076b6e6879011">release</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) = 0;</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// Return the value encapsulated in a handle returned by a</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">// successful lookup().</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// REQUIRES: handle must not have been released yet.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="comment">// REQUIRES: handle must have been returned by a method on *this.</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a138742ce948f24dedce1aea076df01e9">  195</a></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span>* <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a138742ce948f24dedce1aea076df01e9">value</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) = 0;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">// Return the value in Slice format encapsulated in the given handle</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">// returned by a successful lookup()</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a1cedcec2a6e02e4762cca7a71d23c080">  199</a></span>    <span class="keyword">virtual</span> <a class="code hl_struct" href="../../d7/da2/structdoris_1_1_slice.html">Slice</a> <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a1cedcec2a6e02e4762cca7a71d23c080">value_slice</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) = 0;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="comment">// If the cache contains entry for key, erase it.  Note that the</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="comment">// underlying entry will be kept around until all existing handles</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="comment">// to it have been released.</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#aaa6381a74fbfe5daf3414e4f5940204c">  204</a></span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#aaa6381a74fbfe5daf3414e4f5940204c">erase</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key) = 0;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="comment">// Return a new numeric id.  May be used by multiple clients who are</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="comment">// sharing the same cache to partition the key space.  Typically the</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="comment">// client will allocate a new id at startup and prepend the id to</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// its cache keys.</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a5a60ccc065aaa79ab87ad65196cc854c">  210</a></span>    <span class="keyword">virtual</span> uint64_t <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a5a60ccc065aaa79ab87ad65196cc854c">new_id</a>() = 0;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span> </div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="comment">// Remove all cache entries that are not actively in use.  Memory-constrained</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="comment">// applications may wish to call this method to reduce memory usage.</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="comment">// Default implementation of Prune() does nothing.  Subclasses are strongly</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="comment">// encouraged to override the default implementation.  A future release of</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="comment">// leveldb may change prune() to a pure abstract method.</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="comment">// return num of entries being pruned.</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#aa9c75c59d5c687eda6a7c2a9358aebf1">  218</a></span>    <span class="keyword">virtual</span> int64_t <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#aa9c75c59d5c687eda6a7c2a9358aebf1">prune</a>() { <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span> </div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="comment">// Same as prune(), but the entry will only be pruned if the predicate matched.</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="comment">// NOTICE: the predicate should be simple enough, or the prune_if() function</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="comment">// may hold lock for a long time to execute predicate.</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#afd391f887d4fb858a90249c3499aa868">  223</a></span>    <span class="keyword">virtual</span> int64_t <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#afd391f887d4fb858a90249c3499aa868">prune_if</a>(<a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">CacheValuePredicate</a> pred) { <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a71cd3003c3860c26c42ffc18f7a41bdb">  225</a></span>    <span class="keyword">virtual</span> int64_t <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a71cd3003c3860c26c42ffc18f7a41bdb">mem_consumption</a>() = 0;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno"><a class="line" href="../../de/d06/classdoris_1_1_cache.html#a418ce063b275e4bd5ff4021054f2f29f">  228</a></span>    <a class="code hl_function" href="../../de/d06/classdoris_1_1_cache.html#a418ce063b275e4bd5ff4021054f2f29f">DISALLOW_COPY_AND_ASSIGN</a>(<a class="code hl_class" href="../../de/d06/classdoris_1_1_cache.html">Cache</a>);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>};</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="comment">// An entry is a variable length heap-allocated structure.  Entries</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">// are kept in a circular doubly linked list ordered by access time.</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html">  233</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a> {</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a0f61d63b009d0880a89c843bd50d8d76">  234</a></span>    <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#a0f61d63b009d0880a89c843bd50d8d76">value</a>;</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#aa39a459a24b53018664cb2d2ee86a0fb">  235</a></span>    void (*deleter)(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp;, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>);</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a537c3b39a177d2f89a23c36cdb9bfc5c">  236</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* next_hash = <span class="keyword">nullptr</span>; <span class="comment">// next entry in hash table</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a5211876d3837bbfa503cb931cb9cecbe">  237</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* <a class="code hl_variable" href="../../db/da8/threadlocal_8cc.html#a6ce3ddf2a70a9a8f5f94ce52c188ec6c">next</a> = <span class="keyword">nullptr</span>;      <span class="comment">// next entry in lru list</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#aabbd2f01bb8ec4a7a0128bce5f8cdb1b">  238</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* prev = <span class="keyword">nullptr</span>;      <span class="comment">// previous entry in lru list</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a7476acc4f60747f9d9032e9cbdf5eb79">  239</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#a7476acc4f60747f9d9032e9cbdf5eb79">charge</a>;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#ab8d33547e1ef26613cc6d92a7909d99a">  240</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#ab8d33547e1ef26613cc6d92a7909d99a">key_length</a>;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#afca1a070ccd72ea11e4b6f83db3b6f46">  241</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#afca1a070ccd72ea11e4b6f83db3b6f46">total_size</a>; <span class="comment">// including key length</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#ab825942178dab8e3721650a48b1e0d24">  242</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#ab825942178dab8e3721650a48b1e0d24">in_cache</a>;     <span class="comment">// Whether entry is in the cache.</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a630e1e65f274486cd91266b349e043fa">  243</a></span>    uint32_t <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#a630e1e65f274486cd91266b349e043fa">refs</a>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a11ecb029164e055f28f4123ce3748862">  244</a></span>    uint32_t <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#a11ecb029164e055f28f4123ce3748862">hash</a>; <span class="comment">// Hash of key(); used for fast sharding and comparisons</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#aabdfe2d48ab5faaaf1ed55547550693c">  245</a></span>    <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">CachePriority</a> priority = CachePriority::NORMAL;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#ae15e693c5ac7718244fce39aed1f4eea">  246</a></span>    <a class="code hl_class" href="../../de/d1e/classdoris_1_1_mem_tracker_limiter.html">MemTrackerLimiter</a>* <a class="code hl_variable" href="../../dd/d4b/struct_l_r_u_handle.html#ae15e693c5ac7718244fce39aed1f4eea">mem_tracker</a>;</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#ad7b582862f8a4e707af8207a34280e2d">  247</a></span>    <span class="keywordtype">char</span> key_data[1]; <span class="comment">// Beginning of key</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#a826edb8aab27a1cf60242cbac02d926e">  249</a></span>    <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a> <a class="code hl_function" href="../../dd/d4b/struct_l_r_u_handle.html#a826edb8aab27a1cf60242cbac02d926e">key</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <span class="comment">// For cheaper lookups, we allow a temporary Handle object</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <span class="comment">// to store a pointer to a key in &quot;value&quot;.</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../db/da8/threadlocal_8cc.html#a6ce3ddf2a70a9a8f5f94ce52c188ec6c">next</a> == <span class="keyword">this</span>) {</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>            <span class="keywordflow">return</span> *(<span class="keyword">reinterpret_cast&lt;</span><a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>));</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>            <span class="keywordflow">return</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>(key_data, key_length);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        }</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    }</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno"><a class="line" href="../../dd/d4b/struct_l_r_u_handle.html#aafde19f7d36ca163a143579c1b125b6d">  259</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../dd/d4b/struct_l_r_u_handle.html#aafde19f7d36ca163a143579c1b125b6d">free</a>() {</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        (*deleter)(key(), <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>        <a class="code hl_define" href="../../dc/dd1/thread__context_8h.html#abf5729fd5a398c306a98854a0490035d">THREAD_MEM_TRACKER_TRANSFER_FROM</a>(total_size, mem_tracker);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        <a class="code hl_function" href="../../d4/dc8/jemalloc__hook_8cpp.html#a3c12ec6b8e8368e804827d604b2979d7">::free</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    }</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>} <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span><span class="comment">// We provide our own simple hash tablet since it removes a whole bunch</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span><span class="comment">// of porting hacks and is also faster than some of the built-in hash</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="comment">// tablet implementations in some of the compiler/runtime combinations</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="comment">// we have tested.  E.g., readrandom speeds up by ~5% over the g++</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="comment">// 4.4.3&#39;s builtin hashtable.</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html">  273</a></span><span class="keyword">class </span><a class="code hl_class" href="../../d6/d48/classdoris_1_1_handle_table.html">HandleTable</a> {</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html#a9f08502dd3b9affd265f27bba6480695">  275</a></span>    <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a9f08502dd3b9affd265f27bba6480695">HandleTable</a>() : <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#a018617c847f6bf1cb1081457cc2f4579">_length</a>(0), <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#a7caba48afc0980603b55384bcfc7ada0">_elems</a>(0), <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#abb8893296a7feb99893206cdcaf81d91">_list</a>(nullptr) { <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a6f81b25d30c39cf0e5f262f4e63027a3">_resize</a>(); }</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#acd2843e2822a2ee8ab68a79b634ef2c5">~HandleTable</a>();</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a3dc6aa7084b9543ef896a747d37f849a">lookup</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a41858091acbd5f213d5a4d656a466fd1">insert</a>(<a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* h);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="comment">// Remove element from hash table by &quot;key&quot; and &quot;hash&quot;.</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a471476600b28d5304187efe625632653">remove</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash);</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="comment">// Remove element from hash table by &quot;h&quot;, it would be faster</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="comment">// than the function above.</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// Return whether h is found and removed.</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a471476600b28d5304187efe625632653">remove</a>(<span class="keyword">const</span> <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* h);</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html#a14c5fe738b8b3b320eee6a93c9d7d9b4">  292</a></span>    <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a14c5fe738b8b3b320eee6a93c9d7d9b4">FRIEND_TEST</a>(CacheTest, HandleTableTest);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment">// The tablet consists of an array of buckets where each bucket is</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="comment">// a linked list of cache entries that hash into the bucket.</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html#a018617c847f6bf1cb1081457cc2f4579">  296</a></span>    uint32_t <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#a018617c847f6bf1cb1081457cc2f4579">_length</a>;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html#a7caba48afc0980603b55384bcfc7ada0">  297</a></span>    uint32_t <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#a7caba48afc0980603b55384bcfc7ada0">_elems</a>;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="../../d6/d48/classdoris_1_1_handle_table.html#abb8893296a7feb99893206cdcaf81d91">  298</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>** <a class="code hl_variable" href="../../d6/d48/classdoris_1_1_handle_table.html#abb8893296a7feb99893206cdcaf81d91">_list</a>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <span class="comment">// Return a pointer to slot that points to a cache entry that</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="comment">// matches key/hash.  If there is no such cache entry, return a</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="comment">// pointer to the trailing slot in the corresponding linked list.</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>** <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a3d3bcf00098d6ab356b201741668160b">_find_pointer</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash);</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d6/d48/classdoris_1_1_handle_table.html#a6f81b25d30c39cf0e5f262f4e63027a3">_resize</a>();</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>};</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="comment">// pair first is timestatmp, put &lt;timestatmp, LRUHandle*&gt; into asc priority_queue,</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span><span class="comment">// when need to free space, can first evict the top of the LRUHandleHeap,</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="comment">// because the top element&#39;s timestamp is the oldest.</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span><span class="keyword">typedef</span> std::priority_queue&lt;std::pair&lt;int64_t, LRUHandle*&gt;,</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                            std::vector&lt;std::pair&lt;int64_t, LRUHandle*&gt;&gt;,</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                            std::greater&lt;std::pair&lt;int64_t, LRUHandle*&gt;&gt;&gt;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="../../d6/d94/namespacedoris.html#a8374741f5eb3f952296a65c7c7a7b8a9">  314</a></span>        <a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a8374741f5eb3f952296a65c7c7a7b8a9">LRUHandleHeap</a>;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">// A single shard of sharded cache.</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html">  317</a></span><span class="keyword">class </span><a class="code hl_class" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html">LRUCache</a> {</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <a class="code hl_class" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html">LRUCache</a>(<a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> type);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aa08b45eec5b206669cd41058a6b02b65">~LRUCache</a>();</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="comment">// Separate from constructor so caller can easily make an array of LRUCache</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ad6cb1246ba4c730fb94ae77e2b2f2d59">  323</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ad6cb1246ba4c730fb94ae77e2b2f2d59">set_capacity</a>(<span class="keywordtype">size_t</span> capacity) { <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1ab19118d95ead89c86cc27bd950d34a">_capacity</a> = capacity; }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="comment">// Like Cache methods, but with an extra &quot;hash&quot; parameter.</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Cache::Handle</a>* <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af13db549df10203d11bc8168862a2485">insert</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>, <span class="keywordtype">size_t</span> charge,</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                          <span class="keywordtype">void</span> (*deleter)(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>),</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>                          <a class="code hl_class" href="../../de/d1e/classdoris_1_1_mem_tracker_limiter.html">MemTrackerLimiter</a>* tracker,</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                          <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">CachePriority</a> priority = <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051">CachePriority::NORMAL</a>);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Cache::Handle</a>* <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a0e06471a798162dfda1e0c3c98dcc5ab">lookup</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a259c3a850640c2c3cf0c29ab1cc54f52">release</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Cache::Handle</a>* handle);</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a42a352841da0c65c3b1459045eaf0c2c">erase</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, uint32_t hash);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    int64_t <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a3ebb147a273559e367282cef58c02197">prune</a>();</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    int64_t <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a5095dda236f9e861dfb7044d9acc5461">prune_if</a>(<a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">CacheValuePredicate</a> pred);</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ae63af9972c6ee91a42de00461aec77f6">set_cache_value_time_extractor</a>(<a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">CacheValueTimeExtractor</a> cache_value_time_extractor);</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a136b8a5d795240aa7e290f2c25d7d00c">set_cache_value_check_timestamp</a>(<span class="keywordtype">bool</span> cache_value_check_timestamp);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ac500d83f2fd467be8f2bc196c9ef6c5d">  339</a></span>    uint64_t <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ac500d83f2fd467be8f2bc196c9ef6c5d">get_lookup_count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1d80a0ffc54e419c5c5e396f42d69f24">_lookup_count</a>; }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a7ff52d98278b397a1aa13de2bd512095">  340</a></span>    uint64_t <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a7ff52d98278b397a1aa13de2bd512095">get_hit_count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af60a5a01c443058492622b43b2d14b9c">_hit_count</a>; }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af2d6c4ea9191f5518219f38e6453681d">  341</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af2d6c4ea9191f5518219f38e6453681d">get_usage</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aceedfcf96477262254916c0e27949f29">_usage</a>; }</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a96b58d340696a8a71e2344b45ba8ebc0">  342</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a96b58d340696a8a71e2344b45ba8ebc0">get_capacity</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1ab19118d95ead89c86cc27bd950d34a">_capacity</a>; }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a556607c1165a96590ea0ec2db9f1790c">_lru_remove</a>(<a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* e);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a258e62e0d8f1396a1fa54a2eb5b36fe1">_lru_append</a>(<a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* list, <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* e);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a4d60849dd14fa488336eb61472d48e8d">_unref</a>(<a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* e);</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a21bbccb9dc80b9c32cc6af816e5d4c05">_evict_from_lru</a>(<span class="keywordtype">size_t</span> total_size, <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>** to_remove_head);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aa6772fdd26c8f37f02e17c2827170a68">_evict_from_lru_with_time</a>(<span class="keywordtype">size_t</span> total_size, <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>** to_remove_head);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a79139423a2f7dcb66587788b46a8d924">_evict_one_entry</a>(<a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a>* e);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1b7e1cf155c0f33d03062d6d2d1621c8">  353</a></span>    <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1b7e1cf155c0f33d03062d6d2d1621c8">_type</a>;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="comment">// Initialized before use.</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1ab19118d95ead89c86cc27bd950d34a">  356</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1ab19118d95ead89c86cc27bd950d34a">_capacity</a> = 0;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="comment">// _mutex protects the following state.</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a3f0b4c278cb19f9c2b2dbdb065f51e14">  359</a></span>    std::mutex <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a3f0b4c278cb19f9c2b2dbdb065f51e14">_mutex</a>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aceedfcf96477262254916c0e27949f29">  360</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aceedfcf96477262254916c0e27949f29">_usage</a> = 0;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="comment">// Dummy head of LRU list.</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="comment">// Entries have refs==1 and in_cache==true.</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="comment">// _lru_normal.prev is newest entry, _lru_normal.next is oldest entry.</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#afbe69ec717e7e26a2e3602a3540e3ded">  365</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#afbe69ec717e7e26a2e3602a3540e3ded">_lru_normal</a>;</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// _lru_durable.prev is newest entry, _lru_durable.next is oldest entry.</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a77535f46390b52a692945bd309c2b172">  367</a></span>    <a class="code hl_struct" href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a77535f46390b52a692945bd309c2b172">_lru_durable</a>;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9393a53f9e60e886da6349453552c7f6">  369</a></span>    <a class="code hl_class" href="../../d6/d48/classdoris_1_1_handle_table.html">HandleTable</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9393a53f9e60e886da6349453552c7f6">_table</a>;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1d80a0ffc54e419c5c5e396f42d69f24">  371</a></span>    uint64_t <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1d80a0ffc54e419c5c5e396f42d69f24">_lookup_count</a> = 0; <span class="comment">// cache查找总次数</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af60a5a01c443058492622b43b2d14b9c">  372</a></span>    uint64_t <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af60a5a01c443058492622b43b2d14b9c">_hit_count</a> = 0;    <span class="comment">// 命中cache的总次数</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a8cbb272d8f57f54997cea772b4ab865d">  374</a></span>    <a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">CacheValueTimeExtractor</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a8cbb272d8f57f54997cea772b4ab865d">_cache_value_time_extractor</a>;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a0dc7a71d90240fd9d52f2fed567fddea">  375</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a0dc7a71d90240fd9d52f2fed567fddea">_cache_value_check_timestamp</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9189205e63329dfc6a015e69dd6dd5d1">  376</a></span>    <a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a8374741f5eb3f952296a65c7c7a7b8a9">LRUHandleHeap</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9189205e63329dfc6a015e69dd6dd5d1">_sorted_normal_entries_with_timestamp</a>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno"><a class="line" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a05bd9fda44c4d85fa5681c32ee38acd0">  377</a></span>    <a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a8374741f5eb3f952296a65c7c7a7b8a9">LRUHandleHeap</a> <a class="code hl_variable" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a05bd9fda44c4d85fa5681c32ee38acd0">_sorted_durable_entries_with_timestamp</a>;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>};</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html">  380</a></span><span class="keyword">class </span><a class="code hl_class" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html">ShardedLRUCache</a> : <span class="keyword">public</span> <a class="code hl_class" href="../../de/d06/classdoris_1_1_cache.html">Cache</a> {</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="keyword">explicit</span> <a class="code hl_class" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html">ShardedLRUCache</a>(<span class="keyword">const</span> std::string&amp; <a class="code hl_variable" href="../../d6/d94/namespacedoris.html#a8ccf841cb59e451791bcb2e1ac4f1edc">name</a>, <span class="keywordtype">size_t</span> total_capacity, <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> type,</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                             uint32_t num_shards);</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keyword">explicit</span> <a class="code hl_class" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html">ShardedLRUCache</a>(<span class="keyword">const</span> std::string&amp; <a class="code hl_variable" href="../../d6/d94/namespacedoris.html#a8ccf841cb59e451791bcb2e1ac4f1edc">name</a>, <span class="keywordtype">size_t</span> total_capacity, <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">LRUCacheType</a> type,</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                             uint32_t num_shards,</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                             <a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">CacheValueTimeExtractor</a> cache_value_time_extractor,</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                             <span class="keywordtype">bool</span> cache_value_check_timestamp);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="comment">// TODO(fdy): 析构时清除所有cache元素</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keyword">virtual</span> <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af04856a246544eb7710f23678bf227ea">~ShardedLRUCache</a>();</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keyword">virtual</span> <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a4a0d0e149c592b87845cb6b1f2353cd6">insert</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>, <span class="keywordtype">size_t</span> charge,</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                           <span class="keywordtype">void</span> (*deleter)(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key, <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>),</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                           <a class="code hl_enumeration" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">CachePriority</a> priority = <a class="code hl_enumvalue" href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051">CachePriority::NORMAL</a>) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keyword">virtual</span> <a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a94752127d1ce829f38600b0220d5c013">lookup</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a1a6a4d13cd8d63519987dd19991cde04">release</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ae8127331996978306563941f911bba30">erase</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; key) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keyword">virtual</span> <span class="keywordtype">void</span>* <a class="code hl_variable" href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <a class="code hl_struct" href="../../d7/da2/structdoris_1_1_slice.html">Slice</a> <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#acb9cad3a8ce80e51ef85b18626817fd8">value_slice</a>(<a class="code hl_struct" href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">Handle</a>* handle) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <span class="keyword">virtual</span> uint64_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ae61403bbe774818b3487c68ccf272471">new_id</a>() <span class="keyword">override</span>;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="keyword">virtual</span> int64_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a36ca8b19b2044533d834ff1548265bc9">prune</a>() <span class="keyword">override</span>;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="keyword">virtual</span> int64_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a9cac95e07017160735b43b9dc4040abc">prune_if</a>(<a class="code hl_typedef" href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">CacheValuePredicate</a> pred) <span class="keyword">override</span>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    int64_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af87811179c7d7720dae855bbb0cfecec">mem_consumption</a>() <span class="keyword">override</span>;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac9889851a976cb754095da2b2a288e7b">update_cache_metrics</a>() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keyword">static</span> uint32_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af3d762887628213f220f6dc278edfc2d">_hash_slice</a>(<span class="keyword">const</span> <a class="code hl_class" href="../../da/d3a/classdoris_1_1_cache_key.html">CacheKey</a>&amp; s);</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a738246028ff8bf3b6e7de66b618b5301">  408</a></span>    uint32_t <a class="code hl_function" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a738246028ff8bf3b6e7de66b618b5301">_shard</a>(uint32_t hash) {</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aa1c7312e10520981793be2d6e84ac96f">_num_shard_bits</a> &gt; 0 ? (hash &gt;&gt; (32 - <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aa1c7312e10520981793be2d6e84ac96f">_num_shard_bits</a>)) : 0;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    }</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aaf2ed934b37cbbd236fdd1b01a5f5005">  412</a></span>    std::string <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aaf2ed934b37cbbd236fdd1b01a5f5005">_name</a>;</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aa1c7312e10520981793be2d6e84ac96f">  413</a></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aa1c7312e10520981793be2d6e84ac96f">_num_shard_bits</a>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac5f32197c7bbecfe34cd5776e61b3d1c">  414</a></span>    <span class="keyword">const</span> uint32_t <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac5f32197c7bbecfe34cd5776e61b3d1c">_num_shards</a>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac97db6cb5ca411045b825ad572e6fad0">  415</a></span>    <a class="code hl_class" href="../../d0/d46/classdoris_1_1_l_r_u_cache.html">LRUCache</a>** <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac97db6cb5ca411045b825ad572e6fad0">_shards</a>;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a113e17ce1cec10eac827837af24cd008">  416</a></span>    std::atomic&lt;uint64_t&gt; <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a113e17ce1cec10eac827837af24cd008">_last_id</a>;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a31d4888710271b589237f5995336ebd5">  418</a></span>    std::unique_ptr&lt;MemTrackerLimiter&gt; <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a31d4888710271b589237f5995336ebd5">_mem_tracker</a>;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af45816ac82b41b7a8f35fc06da19e2cc">  419</a></span>    std::shared_ptr&lt;MetricEntity&gt; <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af45816ac82b41b7a8f35fc06da19e2cc">_entity</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a858e81330d485a888390797f8ce879f7">  420</a></span>    <a class="code hl_class" href="../../d5/d93/classdoris_1_1_atomic_gauge.html">IntGauge</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a858e81330d485a888390797f8ce879f7">cache_capacity</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac06005a84adda21d51a6b5a551644cac">  421</a></span>    <a class="code hl_class" href="../../d5/d93/classdoris_1_1_atomic_gauge.html">IntGauge</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac06005a84adda21d51a6b5a551644cac">cache_usage</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a579d365a9cd21bc9d64c38a8da9c0d53">  422</a></span>    <a class="code hl_class" href="../../d0/d65/classdoris_1_1_lock_gauge.html">DoubleGauge</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a579d365a9cd21bc9d64c38a8da9c0d53">cache_usage_ratio</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8167778bbabc27b03f26cfe3cad9a5d5">  423</a></span>    <a class="code hl_class" href="../../d8/d60/classdoris_1_1_atomic_counter.html">IntAtomicCounter</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8167778bbabc27b03f26cfe3cad9a5d5">cache_lookup_count</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a88ef09e52a0f34a4f491edda807cc1d4">  424</a></span>    <a class="code hl_class" href="../../d8/d60/classdoris_1_1_atomic_counter.html">IntAtomicCounter</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a88ef09e52a0f34a4f491edda807cc1d4">cache_hit_count</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno"><a class="line" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8f802c8c4875e08388792645118db5e0">  425</a></span>    <a class="code hl_class" href="../../d0/d65/classdoris_1_1_lock_gauge.html">DoubleGauge</a>* <a class="code hl_variable" href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8f802c8c4875e08388792645118db5e0">cache_hit_ratio</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>};</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>} <span class="comment">// namespace doris</span></div>
<div class="ttc" id="aclassdoris_1_1_atomic_counter_html"><div class="ttname"><a href="../../d8/d60/classdoris_1_1_atomic_counter.html">doris::AtomicCounter</a></div><div class="ttdef"><b>Definition:</b> metrics.h:210</div></div>
<div class="ttc" id="aclassdoris_1_1_atomic_gauge_html"><div class="ttname"><a href="../../d5/d93/classdoris_1_1_atomic_gauge.html">doris::AtomicGauge</a></div><div class="ttdef"><b>Definition:</b> metrics.h:217</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html">doris::Cache</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:155</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a138742ce948f24dedce1aea076df01e9"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a138742ce948f24dedce1aea076df01e9">doris::Cache::value</a></div><div class="ttdeci">virtual void * value(Handle *handle)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a1cedcec2a6e02e4762cca7a71d23c080"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a1cedcec2a6e02e4762cca7a71d23c080">doris::Cache::value_slice</a></div><div class="ttdeci">virtual Slice value_slice(Handle *handle)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a418ce063b275e4bd5ff4021054f2f29f"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a418ce063b275e4bd5ff4021054f2f29f">doris::Cache::DISALLOW_COPY_AND_ASSIGN</a></div><div class="ttdeci">DISALLOW_COPY_AND_ASSIGN(Cache)</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a50df2ff2b2b5e0be5477fc67df51a825"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a50df2ff2b2b5e0be5477fc67df51a825">doris::Cache::lookup</a></div><div class="ttdeci">virtual Handle * lookup(const CacheKey &amp;key)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a5a60ccc065aaa79ab87ad65196cc854c"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a5a60ccc065aaa79ab87ad65196cc854c">doris::Cache::new_id</a></div><div class="ttdeci">virtual uint64_t new_id()=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a71cd3003c3860c26c42ffc18f7a41bdb"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a71cd3003c3860c26c42ffc18f7a41bdb">doris::Cache::mem_consumption</a></div><div class="ttdeci">virtual int64_t mem_consumption()=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a899b8bf120ecc87b59e142f00b2987b0"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a899b8bf120ecc87b59e142f00b2987b0">doris::Cache::~Cache</a></div><div class="ttdeci">virtual ~Cache()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:72</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_a99ff5ff87dc624c6460076b6e6879011"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#a99ff5ff87dc624c6460076b6e6879011">doris::Cache::release</a></div><div class="ttdeci">virtual void release(Handle *handle)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_aa9c75c59d5c687eda6a7c2a9358aebf1"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#aa9c75c59d5c687eda6a7c2a9358aebf1">doris::Cache::prune</a></div><div class="ttdeci">virtual int64_t prune()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:218</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_aaa6381a74fbfe5daf3414e4f5940204c"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#aaa6381a74fbfe5daf3414e4f5940204c">doris::Cache::erase</a></div><div class="ttdeci">virtual void erase(const CacheKey &amp;key)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_ae1e6297c25b58d8c5a0f7dad45487c08"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#ae1e6297c25b58d8c5a0f7dad45487c08">doris::Cache::Cache</a></div><div class="ttdeci">Cache()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:157</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_aed6e7c03d7d603f21a363033c32bd48a"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#aed6e7c03d7d603f21a363033c32bd48a">doris::Cache::insert</a></div><div class="ttdeci">virtual Handle * insert(const CacheKey &amp;key, void *value, size_t charge, void(*deleter)(const CacheKey &amp;key, void *value), CachePriority priority=CachePriority::NORMAL)=0</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_html_afd391f887d4fb858a90249c3499aa868"><div class="ttname"><a href="../../de/d06/classdoris_1_1_cache.html#afd391f887d4fb858a90249c3499aa868">doris::Cache::prune_if</a></div><div class="ttdeci">virtual int64_t prune_if(CacheValuePredicate pred)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:223</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html">doris::CacheKey</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:62</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a087a995480b6a64b1e9064b2f6ab8a2f"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a087a995480b6a64b1e9064b2f6ab8a2f">doris::CacheKey::starts_with</a></div><div class="ttdeci">bool starts_with(const CacheKey &amp;x) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:130</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a14b0940b1452e01555790d2d841653bf"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a14b0940b1452e01555790d2d841653bf">doris::CacheKey::CacheKey</a></div><div class="ttdeci">CacheKey(const char *d, size_t n)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:66</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a259cb5a711406a8c3e5d937eb9350cca"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a259cb5a711406a8c3e5d937eb9350cca">doris::CacheKey::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:80</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a3cce90d52cb7e47b6c17d3a0e1c94842"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a3cce90d52cb7e47b6c17d3a0e1c94842">doris::CacheKey::_size</a></div><div class="ttdeci">size_t _size</div><div class="ttdef"><b>Definition:</b> lru_cache.h:143</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a4eeac1fd5b41a16678f29b6b2a6a150b"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a4eeac1fd5b41a16678f29b6b2a6a150b">doris::CacheKey::operator==</a></div><div class="ttdeci">bool operator==(const CacheKey &amp;other) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:108</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a578a6e4ae76c2fde425b27b2c7ea686f"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a578a6e4ae76c2fde425b27b2c7ea686f">doris::CacheKey::~CacheKey</a></div><div class="ttdeci">~CacheKey()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:74</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a63dca305a312a7974239d8f59338d4c3"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a63dca305a312a7974239d8f59338d4c3">doris::CacheKey::_decode_fixed32</a></div><div class="ttdeci">uint32_t _decode_fixed32(const char *ptr) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:135</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a644718bb2fb240de962dc3c9a1fdf0dc"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a644718bb2fb240de962dc3c9a1fdf0dc">doris::CacheKey::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:83</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_a9fb838ac7eb3bab194528e9eb371644d"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#a9fb838ac7eb3bab194528e9eb371644d">doris::CacheKey::compare</a></div><div class="ttdeci">int compare(const CacheKey &amp;b) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:114</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_aa3affb1becdd976aba1036a161a3134d"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#aa3affb1becdd976aba1036a161a3134d">doris::CacheKey::data</a></div><div class="ttdeci">const char * data() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:77</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_aa4a7e0903b99b59bbc6826c07d8d7f9d"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#aa4a7e0903b99b59bbc6826c07d8d7f9d">doris::CacheKey::CacheKey</a></div><div class="ttdeci">CacheKey()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:64</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_aac993ecccd3d88aafefb6b8e3caa1dee"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#aac993ecccd3d88aafefb6b8e3caa1dee">doris::CacheKey::to_string</a></div><div class="ttdeci">std::string to_string() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:106</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ab9f7dbfd58df6ce1c949fda9463b1c10"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ab9f7dbfd58df6ce1c949fda9463b1c10">doris::CacheKey::CacheKey</a></div><div class="ttdeci">CacheKey(const std::string &amp;s)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:69</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ac1a0dc45505ee062a1d5527af7981ac5"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ac1a0dc45505ee062a1d5527af7981ac5">doris::CacheKey::operator[]</a></div><div class="ttdeci">char operator[](size_t n) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:87</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ac8bb3912a3ce86b15842e79d0b421204"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ac8bb3912a3ce86b15842e79d0b421204">doris::CacheKey::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:93</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_acb03dc3faa34ae8e7b0497de5e3048c9"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#acb03dc3faa34ae8e7b0497de5e3048c9">doris::CacheKey::hash</a></div><div class="ttdeci">uint32_t hash(const char *data, size_t n, uint32_t seed) const</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:33</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ace6b096facbd1856ea784f971c93e1fa"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ace6b096facbd1856ea784f971c93e1fa">doris::CacheKey::CacheKey</a></div><div class="ttdeci">CacheKey(const char *s)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:72</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ad08a86a2badc47e3e453b48dfe0a1bc8"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ad08a86a2badc47e3e453b48dfe0a1bc8">doris::CacheKey::operator!=</a></div><div class="ttdeci">bool operator!=(const CacheKey &amp;other) const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:112</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ad51651afef0ae59bf122b1cd9df2facb"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ad51651afef0ae59bf122b1cd9df2facb">doris::CacheKey::remove_prefix</a></div><div class="ttdeci">void remove_prefix(size_t n)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:99</div></div>
<div class="ttc" id="aclassdoris_1_1_cache_key_html_ae672a880bbf1fa586869f1c837bd013a"><div class="ttname"><a href="../../da/d3a/classdoris_1_1_cache_key.html#ae672a880bbf1fa586869f1c837bd013a">doris::CacheKey::_data</a></div><div class="ttdeci">const char * _data</div><div class="ttdef"><b>Definition:</b> lru_cache.h:142</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html">doris::HandleTable</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:273</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a018617c847f6bf1cb1081457cc2f4579"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a018617c847f6bf1cb1081457cc2f4579">doris::HandleTable::_length</a></div><div class="ttdeci">uint32_t _length</div><div class="ttdef"><b>Definition:</b> lru_cache.h:296</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a14c5fe738b8b3b320eee6a93c9d7d9b4"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a14c5fe738b8b3b320eee6a93c9d7d9b4">doris::HandleTable::FRIEND_TEST</a></div><div class="ttdeci">FRIEND_TEST(CacheTest, HandleTableTest)</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a3d3bcf00098d6ab356b201741668160b"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a3d3bcf00098d6ab356b201741668160b">doris::HandleTable::_find_pointer</a></div><div class="ttdeci">LRUHandle ** _find_pointer(const CacheKey &amp;key, uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:128</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a3dc6aa7084b9543ef896a747d37f849a"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a3dc6aa7084b9543ef896a747d37f849a">doris::HandleTable::lookup</a></div><div class="ttdeci">LRUHandle * lookup(const CacheKey &amp;key, uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:79</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a41858091acbd5f213d5a4d656a466fd1"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a41858091acbd5f213d5a4d656a466fd1">doris::HandleTable::insert</a></div><div class="ttdeci">LRUHandle * insert(LRUHandle *h)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:83</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a471476600b28d5304187efe625632653"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a471476600b28d5304187efe625632653">doris::HandleTable::remove</a></div><div class="ttdeci">LRUHandle * remove(const CacheKey &amp;key, uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:101</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a6f81b25d30c39cf0e5f262f4e63027a3"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a6f81b25d30c39cf0e5f262f4e63027a3">doris::HandleTable::_resize</a></div><div class="ttdeci">void _resize()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:137</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a7caba48afc0980603b55384bcfc7ada0"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a7caba48afc0980603b55384bcfc7ada0">doris::HandleTable::_elems</a></div><div class="ttdeci">uint32_t _elems</div><div class="ttdef"><b>Definition:</b> lru_cache.h:297</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_a9f08502dd3b9affd265f27bba6480695"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#a9f08502dd3b9affd265f27bba6480695">doris::HandleTable::HandleTable</a></div><div class="ttdeci">HandleTable()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:275</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_abb8893296a7feb99893206cdcaf81d91"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#abb8893296a7feb99893206cdcaf81d91">doris::HandleTable::_list</a></div><div class="ttdeci">LRUHandle ** _list</div><div class="ttdef"><b>Definition:</b> lru_cache.h:298</div></div>
<div class="ttc" id="aclassdoris_1_1_handle_table_html_acd2843e2822a2ee8ab68a79b634ef2c5"><div class="ttname"><a href="../../d6/d48/classdoris_1_1_handle_table.html#acd2843e2822a2ee8ab68a79b634ef2c5">doris::HandleTable::~HandleTable</a></div><div class="ttdeci">~HandleTable()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:74</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html">doris::LRUCache</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:317</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a05bd9fda44c4d85fa5681c32ee38acd0"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a05bd9fda44c4d85fa5681c32ee38acd0">doris::LRUCache::_sorted_durable_entries_with_timestamp</a></div><div class="ttdeci">LRUHandleHeap _sorted_durable_entries_with_timestamp</div><div class="ttdef"><b>Definition:</b> lru_cache.h:377</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a0dc7a71d90240fd9d52f2fed567fddea"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a0dc7a71d90240fd9d52f2fed567fddea">doris::LRUCache::_cache_value_check_timestamp</a></div><div class="ttdeci">bool _cache_value_check_timestamp</div><div class="ttdef"><b>Definition:</b> lru_cache.h:375</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a0e06471a798162dfda1e0c3c98dcc5ab"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a0e06471a798162dfda1e0c3c98dcc5ab">doris::LRUCache::lookup</a></div><div class="ttdeci">Cache::Handle * lookup(const CacheKey &amp;key, uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:198</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a136b8a5d795240aa7e290f2c25d7d00c"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a136b8a5d795240aa7e290f2c25d7d00c">doris::LRUCache::set_cache_value_check_timestamp</a></div><div class="ttdeci">void set_cache_value_check_timestamp(bool cache_value_check_timestamp)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:492</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a1ab19118d95ead89c86cc27bd950d34a"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1ab19118d95ead89c86cc27bd950d34a">doris::LRUCache::_capacity</a></div><div class="ttdeci">size_t _capacity</div><div class="ttdef"><b>Definition:</b> lru_cache.h:356</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a1b7e1cf155c0f33d03062d6d2d1621c8"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1b7e1cf155c0f33d03062d6d2d1621c8">doris::LRUCache::_type</a></div><div class="ttdeci">LRUCacheType _type</div><div class="ttdef"><b>Definition:</b> lru_cache.h:353</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a1d80a0ffc54e419c5c5e396f42d69f24"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a1d80a0ffc54e419c5c5e396f42d69f24">doris::LRUCache::_lookup_count</a></div><div class="ttdeci">uint64_t _lookup_count</div><div class="ttdef"><b>Definition:</b> lru_cache.h:371</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a21bbccb9dc80b9c32cc6af816e5d4c05"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a21bbccb9dc80b9c32cc6af816e5d4c05">doris::LRUCache::_evict_from_lru</a></div><div class="ttdeci">void _evict_from_lru(size_t total_size, LRUHandle **to_remove_head)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:310</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a258e62e0d8f1396a1fa54a2eb5b36fe1"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a258e62e0d8f1396a1fa54a2eb5b36fe1">doris::LRUCache::_lru_append</a></div><div class="ttdeci">void _lru_append(LRUHandle *list, LRUHandle *e)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:190</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a259c3a850640c2c3cf0c29ab1cc54f52"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a259c3a850640c2c3cf0c29ab1cc54f52">doris::LRUCache::release</a></div><div class="ttdeci">void release(Cache::Handle *handle)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:215</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a3ebb147a273559e367282cef58c02197"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a3ebb147a273559e367282cef58c02197">doris::LRUCache::prune</a></div><div class="ttdeci">int64_t prune()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:425</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a3f0b4c278cb19f9c2b2dbdb065f51e14"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a3f0b4c278cb19f9c2b2dbdb065f51e14">doris::LRUCache::_mutex</a></div><div class="ttdeci">std::mutex _mutex</div><div class="ttdef"><b>Definition:</b> lru_cache.h:359</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a42a352841da0c65c3b1459045eaf0c2c"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a42a352841da0c65c3b1459045eaf0c2c">doris::LRUCache::erase</a></div><div class="ttdeci">void erase(const CacheKey &amp;key, uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:401</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a4d60849dd14fa488336eb61472d48e8d"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a4d60849dd14fa488336eb61472d48e8d">doris::LRUCache::_unref</a></div><div class="ttdeci">bool _unref(LRUHandle *e)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:178</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a5095dda236f9e861dfb7044d9acc5461"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a5095dda236f9e861dfb7044d9acc5461">doris::LRUCache::prune_if</a></div><div class="ttdeci">int64_t prune_if(CacheValuePredicate pred)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:452</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a556607c1165a96590ea0ec2db9f1790c"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a556607c1165a96590ea0ec2db9f1790c">doris::LRUCache::_lru_remove</a></div><div class="ttdeci">void _lru_remove(LRUHandle *e)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:184</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a77535f46390b52a692945bd309c2b172"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a77535f46390b52a692945bd309c2b172">doris::LRUCache::_lru_durable</a></div><div class="ttdeci">LRUHandle _lru_durable</div><div class="ttdef"><b>Definition:</b> lru_cache.h:367</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a79139423a2f7dcb66587788b46a8d924"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a79139423a2f7dcb66587788b46a8d924">doris::LRUCache::_evict_one_entry</a></div><div class="ttdeci">void _evict_one_entry(LRUHandle *e)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:329</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a7ff52d98278b397a1aa13de2bd512095"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a7ff52d98278b397a1aa13de2bd512095">doris::LRUCache::get_hit_count</a></div><div class="ttdeci">uint64_t get_hit_count() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:340</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a8cbb272d8f57f54997cea772b4ab865d"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a8cbb272d8f57f54997cea772b4ab865d">doris::LRUCache::_cache_value_time_extractor</a></div><div class="ttdeci">CacheValueTimeExtractor _cache_value_time_extractor</div><div class="ttdef"><b>Definition:</b> lru_cache.h:374</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a9189205e63329dfc6a015e69dd6dd5d1"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9189205e63329dfc6a015e69dd6dd5d1">doris::LRUCache::_sorted_normal_entries_with_timestamp</a></div><div class="ttdeci">LRUHandleHeap _sorted_normal_entries_with_timestamp</div><div class="ttdef"><b>Definition:</b> lru_cache.h:376</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a9393a53f9e60e886da6349453552c7f6"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a9393a53f9e60e886da6349453552c7f6">doris::LRUCache::_table</a></div><div class="ttdeci">HandleTable _table</div><div class="ttdef"><b>Definition:</b> lru_cache.h:369</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_a96b58d340696a8a71e2344b45ba8ebc0"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#a96b58d340696a8a71e2344b45ba8ebc0">doris::LRUCache::get_capacity</a></div><div class="ttdeci">size_t get_capacity() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:342</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_aa08b45eec5b206669cd41058a6b02b65"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aa08b45eec5b206669cd41058a6b02b65">doris::LRUCache::~LRUCache</a></div><div class="ttdeci">~LRUCache()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:174</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_aa6772fdd26c8f37f02e17c2827170a68"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aa6772fdd26c8f37f02e17c2827170a68">doris::LRUCache::_evict_from_lru_with_time</a></div><div class="ttdeci">void _evict_from_lru_with_time(size_t total_size, LRUHandle **to_remove_head)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:270</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_ac500d83f2fd467be8f2bc196c9ef6c5d"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ac500d83f2fd467be8f2bc196c9ef6c5d">doris::LRUCache::get_lookup_count</a></div><div class="ttdeci">uint64_t get_lookup_count() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:339</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_aceedfcf96477262254916c0e27949f29"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#aceedfcf96477262254916c0e27949f29">doris::LRUCache::_usage</a></div><div class="ttdeci">size_t _usage</div><div class="ttdef"><b>Definition:</b> lru_cache.h:360</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_ad6cb1246ba4c730fb94ae77e2b2f2d59"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ad6cb1246ba4c730fb94ae77e2b2f2d59">doris::LRUCache::set_capacity</a></div><div class="ttdeci">void set_capacity(size_t capacity)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:323</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_ae63af9972c6ee91a42de00461aec77f6"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#ae63af9972c6ee91a42de00461aec77f6">doris::LRUCache::set_cache_value_time_extractor</a></div><div class="ttdeci">void set_cache_value_time_extractor(CacheValueTimeExtractor cache_value_time_extractor)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:488</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_af13db549df10203d11bc8168862a2485"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af13db549df10203d11bc8168862a2485">doris::LRUCache::insert</a></div><div class="ttdeci">Cache::Handle * insert(const CacheKey &amp;key, uint32_t hash, void *value, size_t charge, void(*deleter)(const CacheKey &amp;key, void *value), MemTrackerLimiter *tracker, CachePriority priority=CachePriority::NORMAL)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:340</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_af2d6c4ea9191f5518219f38e6453681d"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af2d6c4ea9191f5518219f38e6453681d">doris::LRUCache::get_usage</a></div><div class="ttdeci">size_t get_usage() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:341</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_af60a5a01c443058492622b43b2d14b9c"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#af60a5a01c443058492622b43b2d14b9c">doris::LRUCache::_hit_count</a></div><div class="ttdeci">uint64_t _hit_count</div><div class="ttdef"><b>Definition:</b> lru_cache.h:372</div></div>
<div class="ttc" id="aclassdoris_1_1_l_r_u_cache_html_afbe69ec717e7e26a2e3602a3540e3ded"><div class="ttname"><a href="../../d0/d46/classdoris_1_1_l_r_u_cache.html#afbe69ec717e7e26a2e3602a3540e3ded">doris::LRUCache::_lru_normal</a></div><div class="ttdeci">LRUHandle _lru_normal</div><div class="ttdef"><b>Definition:</b> lru_cache.h:365</div></div>
<div class="ttc" id="aclassdoris_1_1_lock_gauge_html"><div class="ttname"><a href="../../d0/d65/classdoris_1_1_lock_gauge.html">doris::LockGauge</a></div><div class="ttdef"><b>Definition:</b> metrics.h:232</div></div>
<div class="ttc" id="aclassdoris_1_1_mem_tracker_limiter_html"><div class="ttname"><a href="../../de/d1e/classdoris_1_1_mem_tracker_limiter.html">doris::MemTrackerLimiter</a></div><div class="ttdef"><b>Definition:</b> mem_tracker_limiter.h:40</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html">doris::ShardedLRUCache</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:380</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a113e17ce1cec10eac827837af24cd008"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a113e17ce1cec10eac827837af24cd008">doris::ShardedLRUCache::_last_id</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; _last_id</div><div class="ttdef"><b>Definition:</b> lru_cache.h:416</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a1a6a4d13cd8d63519987dd19991cde04"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a1a6a4d13cd8d63519987dd19991cde04">doris::ShardedLRUCache::release</a></div><div class="ttdeci">virtual void release(Handle *handle) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:566</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a31d4888710271b589237f5995336ebd5"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a31d4888710271b589237f5995336ebd5">doris::ShardedLRUCache::_mem_tracker</a></div><div class="ttdeci">std::unique_ptr&lt; MemTrackerLimiter &gt; _mem_tracker</div><div class="ttdef"><b>Definition:</b> lru_cache.h:418</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a36ca8b19b2044533d834ff1548265bc9"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a36ca8b19b2044533d834ff1548265bc9">doris::ShardedLRUCache::prune</a></div><div class="ttdeci">virtual int64_t prune() override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:589</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a4a0d0e149c592b87845cb6b1f2353cd6"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a4a0d0e149c592b87845cb6b1f2353cd6">doris::ShardedLRUCache::insert</a></div><div class="ttdeci">virtual Handle * insert(const CacheKey &amp;key, void *value, size_t charge, void(*deleter)(const CacheKey &amp;key, void *value), CachePriority priority=CachePriority::NORMAL) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:553</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a579d365a9cd21bc9d64c38a8da9c0d53"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a579d365a9cd21bc9d64c38a8da9c0d53">doris::ShardedLRUCache::cache_usage_ratio</a></div><div class="ttdeci">DoubleGauge * cache_usage_ratio</div><div class="ttdef"><b>Definition:</b> lru_cache.h:422</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a738246028ff8bf3b6e7de66b618b5301"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a738246028ff8bf3b6e7de66b618b5301">doris::ShardedLRUCache::_shard</a></div><div class="ttdeci">uint32_t _shard(uint32_t hash)</div><div class="ttdef"><b>Definition:</b> lru_cache.h:408</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a8167778bbabc27b03f26cfe3cad9a5d5"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8167778bbabc27b03f26cfe3cad9a5d5">doris::ShardedLRUCache::cache_lookup_count</a></div><div class="ttdeci">IntAtomicCounter * cache_lookup_count</div><div class="ttdef"><b>Definition:</b> lru_cache.h:423</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a858e81330d485a888390797f8ce879f7"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a858e81330d485a888390797f8ce879f7">doris::ShardedLRUCache::cache_capacity</a></div><div class="ttdeci">IntGauge * cache_capacity</div><div class="ttdef"><b>Definition:</b> lru_cache.h:420</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a88ef09e52a0f34a4f491edda807cc1d4"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a88ef09e52a0f34a4f491edda807cc1d4">doris::ShardedLRUCache::cache_hit_count</a></div><div class="ttdeci">IntAtomicCounter * cache_hit_count</div><div class="ttdef"><b>Definition:</b> lru_cache.h:424</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a8f802c8c4875e08388792645118db5e0"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a8f802c8c4875e08388792645118db5e0">doris::ShardedLRUCache::cache_hit_ratio</a></div><div class="ttdeci">DoubleGauge * cache_hit_ratio</div><div class="ttdef"><b>Definition:</b> lru_cache.h:425</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a94752127d1ce829f38600b0220d5c013"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a94752127d1ce829f38600b0220d5c013">doris::ShardedLRUCache::lookup</a></div><div class="ttdeci">virtual Handle * lookup(const CacheKey &amp;key) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:561</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_a9cac95e07017160735b43b9dc4040abc"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#a9cac95e07017160735b43b9dc4040abc">doris::ShardedLRUCache::prune_if</a></div><div class="ttdeci">virtual int64_t prune_if(CacheValuePredicate pred) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:597</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_aa1c7312e10520981793be2d6e84ac96f"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aa1c7312e10520981793be2d6e84ac96f">doris::ShardedLRUCache::_num_shard_bits</a></div><div class="ttdeci">const int _num_shard_bits</div><div class="ttdef"><b>Definition:</b> lru_cache.h:413</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_aaf2ed934b37cbbd236fdd1b01a5f5005"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#aaf2ed934b37cbbd236fdd1b01a5f5005">doris::ShardedLRUCache::_name</a></div><div class="ttdeci">std::string _name</div><div class="ttdef"><b>Definition:</b> lru_cache.h:412</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ac06005a84adda21d51a6b5a551644cac"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac06005a84adda21d51a6b5a551644cac">doris::ShardedLRUCache::cache_usage</a></div><div class="ttdeci">IntGauge * cache_usage</div><div class="ttdef"><b>Definition:</b> lru_cache.h:421</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ac5f32197c7bbecfe34cd5776e61b3d1c"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac5f32197c7bbecfe34cd5776e61b3d1c">doris::ShardedLRUCache::_num_shards</a></div><div class="ttdeci">const uint32_t _num_shards</div><div class="ttdef"><b>Definition:</b> lru_cache.h:414</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ac97db6cb5ca411045b825ad572e6fad0"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac97db6cb5ca411045b825ad572e6fad0">doris::ShardedLRUCache::_shards</a></div><div class="ttdeci">LRUCache ** _shards</div><div class="ttdef"><b>Definition:</b> lru_cache.h:415</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ac9889851a976cb754095da2b2a288e7b"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ac9889851a976cb754095da2b2a288e7b">doris::ShardedLRUCache::update_cache_metrics</a></div><div class="ttdeci">void update_cache_metrics() const</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:609</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_acb9cad3a8ce80e51ef85b18626817fd8"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#acb9cad3a8ce80e51ef85b18626817fd8">doris::ShardedLRUCache::value_slice</a></div><div class="ttdeci">Slice value_slice(Handle *handle) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:580</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ae61403bbe774818b3487c68ccf272471"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ae61403bbe774818b3487c68ccf272471">doris::ShardedLRUCache::new_id</a></div><div class="ttdeci">virtual uint64_t new_id() override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:585</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_ae8127331996978306563941f911bba30"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#ae8127331996978306563941f911bba30">doris::ShardedLRUCache::erase</a></div><div class="ttdeci">virtual void erase(const CacheKey &amp;key) override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:571</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_af04856a246544eb7710f23678bf227ea"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af04856a246544eb7710f23678bf227ea">doris::ShardedLRUCache::~ShardedLRUCache</a></div><div class="ttdeci">virtual ~ShardedLRUCache()</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:542</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_af3d762887628213f220f6dc278edfc2d"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af3d762887628213f220f6dc278edfc2d">doris::ShardedLRUCache::_hash_slice</a></div><div class="ttdeci">static uint32_t _hash_slice(const CacheKey &amp;s)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:496</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_af45816ac82b41b7a8f35fc06da19e2cc"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af45816ac82b41b7a8f35fc06da19e2cc">doris::ShardedLRUCache::_entity</a></div><div class="ttdeci">std::shared_ptr&lt; MetricEntity &gt; _entity</div><div class="ttdef"><b>Definition:</b> lru_cache.h:419</div></div>
<div class="ttc" id="aclassdoris_1_1_sharded_l_r_u_cache_html_af87811179c7d7720dae855bbb0cfecec"><div class="ttname"><a href="../../d0/d56/classdoris_1_1_sharded_l_r_u_cache.html#af87811179c7d7720dae855bbb0cfecec">doris::ShardedLRUCache::mem_consumption</a></div><div class="ttdeci">int64_t mem_consumption() override</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:605</div></div>
<div class="ttc" id="ajemalloc__hook_8cpp_html_a3c12ec6b8e8368e804827d604b2979d7"><div class="ttname"><a href="../../d4/dc8/jemalloc__hook_8cpp.html#a3c12ec6b8e8368e804827d604b2979d7">free</a></div><div class="ttdeci">void free(void *p) __THROW ALIAS(doris_free)</div></div>
<div class="ttc" id="amem__tracker_8h_html"><div class="ttname"><a href="../../d0/d43/mem__tracker_8h.html">mem_tracker.h</a></div></div>
<div class="ttc" id="amemcpy__aarch64_8cpp_html_a156c5821f16ed93be8c7d315303f7b2a"><div class="ttname"><a href="../../d9/d1e/memcpy__aarch64_8cpp.html#a156c5821f16ed93be8c7d315303f7b2a">memcpy</a></div><div class="ttdeci">void * memcpy(void *__restrict dst, const void *__restrict src, size_t size)</div><div class="ttdef"><b>Definition:</b> memcpy_aarch64.cpp:237</div></div>
<div class="ttc" id="ametrics_8h_html"><div class="ttname"><a href="../../df/d34/metrics_8h.html">metrics.h</a></div></div>
<div class="ttc" id="anamespacedoris_html"><div class="ttname"><a href="../../d6/d94/namespacedoris.html">doris</a></div><div class="ttdoc">Utilities for collecting timings.</div><div class="ttdef"><b>Definition:</b> agent_server.cpp:36</div></div>
<div class="ttc" id="anamespacedoris_html_a62b6fa8336b62746fe12620c18b8742b"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a62b6fa8336b62746fe12620c18b8742b">doris::new_lru_cache</a></div><div class="ttdeci">Cache * new_lru_cache(const std::string &amp;name, size_t capacity, LRUCacheType type, uint32_t num_shards)</div><div class="ttdef"><b>Definition:</b> lru_cache.cpp:630</div></div>
<div class="ttc" id="anamespacedoris_html_a727f9da52f88c99a0cefb11aaae0f126"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a727f9da52f88c99a0cefb11aaae0f126">doris::CacheValueTimeExtractor</a></div><div class="ttdeci">std::function&lt; int64_t(const void *)&gt; CacheValueTimeExtractor</div><div class="ttdef"><b>Definition:</b> lru_cache.h:153</div></div>
<div class="ttc" id="anamespacedoris_html_a8374741f5eb3f952296a65c7c7a7b8a9"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a8374741f5eb3f952296a65c7c7a7b8a9">doris::LRUHandleHeap</a></div><div class="ttdeci">std::priority_queue&lt; std::pair&lt; int64_t, LRUHandle * &gt;, std::vector&lt; std::pair&lt; int64_t, LRUHandle * &gt; &gt;, std::greater&lt; std::pair&lt; int64_t, LRUHandle * &gt; &gt; &gt; LRUHandleHeap</div><div class="ttdef"><b>Definition:</b> lru_cache.h:314</div></div>
<div class="ttc" id="anamespacedoris_html_a8ccf841cb59e451791bcb2e1ac4f1edc"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a8ccf841cb59e451791bcb2e1ac4f1edc">doris::name</a></div><div class="ttdeci">string name</div><div class="ttdef"><b>Definition:</b> cpu_info.cpp:106</div></div>
<div class="ttc" id="anamespacedoris_html_a95cb627707aff70ffb60b6e50a436237"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a95cb627707aff70ffb60b6e50a436237">doris::CacheValuePredicate</a></div><div class="ttdeci">std::function&lt; bool(const void *)&gt; CacheValuePredicate</div><div class="ttdef"><b>Definition:</b> lru_cache.h:149</div></div>
<div class="ttc" id="anamespacedoris_html_a97c7f452860b02163e386723e586c954"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954">doris::LRUCacheType</a></div><div class="ttdeci">LRUCacheType</div><div class="ttdef"><b>Definition:</b> lru_cache.h:52</div></div>
<div class="ttc" id="anamespacedoris_html_a97c7f452860b02163e386723e586c954a12a90dfe20486bbe3e075afcd19ef2d0"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a12a90dfe20486bbe3e075afcd19ef2d0">doris::NUMBER</a></div><div class="ttdeci">@ NUMBER</div><div class="ttdef"><b>Definition:</b> lru_cache.h:54</div></div>
<div class="ttc" id="anamespacedoris_html_a97c7f452860b02163e386723e586c954a4aa71180778b711338785695df5d7c52"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#a97c7f452860b02163e386723e586c954a4aa71180778b711338785695df5d7c52">doris::SIZE</a></div><div class="ttdeci">@ SIZE</div><div class="ttdef"><b>Definition:</b> lru_cache.h:53</div></div>
<div class="ttc" id="anamespacedoris_html_afb029ea18bce8f55247344803ffe372b"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372b">doris::CachePriority</a></div><div class="ttdeci">CachePriority</div><div class="ttdef"><b>Definition:</b> lru_cache.h:147</div></div>
<div class="ttc" id="anamespacedoris_html_afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba1e23852820b9154316c7c06e2b7ba051">doris::CachePriority::NORMAL</a></div><div class="ttdeci">@ NORMAL</div></div>
<div class="ttc" id="anamespacedoris_html_afb029ea18bce8f55247344803ffe372ba339b2f19a3f2821963c7d2b0ca441bd2"><div class="ttname"><a href="../../d6/d94/namespacedoris.html#afb029ea18bce8f55247344803ffe372ba339b2f19a3f2821963c7d2b0ca441bd2">doris::CachePriority::DURABLE</a></div><div class="ttdeci">@ DURABLE</div></div>
<div class="ttc" id="aolap_2olap__common_8h_html"><div class="ttname"><a href="../../db/d47/olap_2olap__common_8h.html">olap_common.h</a></div></div>
<div class="ttc" id="aslice_8h_html"><div class="ttname"><a href="../../d0/d48/slice_8h.html">slice.h</a></div></div>
<div class="ttc" id="astruct_l_r_u_handle_html"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html">LRUHandle</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:233</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_a0f61d63b009d0880a89c843bd50d8d76"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#a0f61d63b009d0880a89c843bd50d8d76">LRUHandle::value</a></div><div class="ttdeci">void * value</div><div class="ttdef"><b>Definition:</b> lru_cache.h:234</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_a11ecb029164e055f28f4123ce3748862"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#a11ecb029164e055f28f4123ce3748862">LRUHandle::hash</a></div><div class="ttdeci">uint32_t hash</div><div class="ttdef"><b>Definition:</b> lru_cache.h:244</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_a630e1e65f274486cd91266b349e043fa"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#a630e1e65f274486cd91266b349e043fa">LRUHandle::refs</a></div><div class="ttdeci">uint32_t refs</div><div class="ttdef"><b>Definition:</b> lru_cache.h:243</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_a7476acc4f60747f9d9032e9cbdf5eb79"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#a7476acc4f60747f9d9032e9cbdf5eb79">LRUHandle::charge</a></div><div class="ttdeci">size_t charge</div><div class="ttdef"><b>Definition:</b> lru_cache.h:239</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_a826edb8aab27a1cf60242cbac02d926e"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#a826edb8aab27a1cf60242cbac02d926e">LRUHandle::key</a></div><div class="ttdeci">CacheKey key() const</div><div class="ttdef"><b>Definition:</b> lru_cache.h:249</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_aafde19f7d36ca163a143579c1b125b6d"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#aafde19f7d36ca163a143579c1b125b6d">LRUHandle::free</a></div><div class="ttdeci">void free()</div><div class="ttdef"><b>Definition:</b> lru_cache.h:259</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_ab825942178dab8e3721650a48b1e0d24"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#ab825942178dab8e3721650a48b1e0d24">LRUHandle::in_cache</a></div><div class="ttdeci">bool in_cache</div><div class="ttdef"><b>Definition:</b> lru_cache.h:242</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_ab8d33547e1ef26613cc6d92a7909d99a"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#ab8d33547e1ef26613cc6d92a7909d99a">LRUHandle::key_length</a></div><div class="ttdeci">size_t key_length</div><div class="ttdef"><b>Definition:</b> lru_cache.h:240</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_ae15e693c5ac7718244fce39aed1f4eea"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#ae15e693c5ac7718244fce39aed1f4eea">LRUHandle::mem_tracker</a></div><div class="ttdeci">MemTrackerLimiter * mem_tracker</div><div class="ttdef"><b>Definition:</b> lru_cache.h:246</div></div>
<div class="ttc" id="astruct_l_r_u_handle_html_afca1a070ccd72ea11e4b6f83db3b6f46"><div class="ttname"><a href="../../dd/d4b/struct_l_r_u_handle.html#afca1a070ccd72ea11e4b6f83db3b6f46">LRUHandle::total_size</a></div><div class="ttdeci">size_t total_size</div><div class="ttdef"><b>Definition:</b> lru_cache.h:241</div></div>
<div class="ttc" id="astructdoris_1_1_cache_1_1_handle_html"><div class="ttname"><a href="../../d7/d8b/structdoris_1_1_cache_1_1_handle.html">doris::Cache::Handle</a></div><div class="ttdef"><b>Definition:</b> lru_cache.h:164</div></div>
<div class="ttc" id="astructdoris_1_1_slice_html"><div class="ttname"><a href="../../d7/da2/structdoris_1_1_slice.html">doris::Slice</a></div><div class="ttdoc">A wrapper around externally allocated data.</div><div class="ttdef"><b>Definition:</b> slice.h:45</div></div>
<div class="ttc" id="athread__context_8h_html"><div class="ttname"><a href="../../dc/dd1/thread__context_8h.html">thread_context.h</a></div></div>
<div class="ttc" id="athread__context_8h_html_abf5729fd5a398c306a98854a0490035d"><div class="ttname"><a href="../../dc/dd1/thread__context_8h.html#abf5729fd5a398c306a98854a0490035d">THREAD_MEM_TRACKER_TRANSFER_FROM</a></div><div class="ttdeci">#define THREAD_MEM_TRACKER_TRANSFER_FROM(size, tracker)</div><div class="ttdef"><b>Definition:</b> thread_context.h:392</div></div>
<div class="ttc" id="athreadlocal_8cc_html_a6ce3ddf2a70a9a8f5f94ce52c188ec6c"><div class="ttname"><a href="../../db/da8/threadlocal_8cc.html#a6ce3ddf2a70a9a8f5f94ce52c188ec6c">next</a></div><div class="ttdeci">PerThreadDestructorList * next</div><div class="ttdef"><b>Definition:</b> threadlocal.cc:41</div></div>
<div class="ttc" id="autil_2types_8h_html_adae7202c63102b0934c3ac5be41b0dae"><div class="ttname"><a href="../../df/dd9/util_2types_8h.html#adae7202c63102b0934c3ac5be41b0dae">value</a></div><div class="ttdeci">__int128 value</div><div class="ttdef"><b>Definition:</b> types.h:10</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
