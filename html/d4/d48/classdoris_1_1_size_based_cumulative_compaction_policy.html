<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ppl_util: SizeBasedCumulativeCompactionPolicy类 参考</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ppl_util
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d6/d94/namespacedoris.html">doris</a></li><li class="navelem"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public 成员函数</a> &#124;
<a href="#pri-methods">Private 成员函数</a> &#124;
<a href="#pri-attribs">Private 属性</a> &#124;
<a href="../../d7/d02/classdoris_1_1_size_based_cumulative_compaction_policy-members.html">所有成员列表</a>  </div>
  <div class="headertitle"><div class="title">SizeBasedCumulativeCompactionPolicy类 参考<span class="mlabels"><span class="mlabel">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../df/d38/cumulative__compaction__policy_8h_source.html">cumulative_compaction_policy.h</a>&gt;</code></p>
<div class="dynheader">
类 SizeBasedCumulativeCompactionPolicy 继承关系图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d9/d15/classdoris_1_1_size_based_cumulative_compaction_policy__inherit__graph.svg" width="232" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="../../graph_legend.html">图例</a>]</span></center></div>
<div class="dynheader">
SizeBasedCumulativeCompactionPolicy 的协作图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d8/d3e/classdoris_1_1_size_based_cumulative_compaction_policy__coll__graph.svg" width="232" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="../../graph_legend.html">图例</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public 成员函数</h2></td></tr>
<tr class="memitem:a6f6c803a1211b4f6387029daef0e8bcd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a6f6c803a1211b4f6387029daef0e8bcd">SizeBasedCumulativeCompactionPolicy</a> (int64_t promotion_size=config::compaction_promotion_size_mbytes *1024 *1024, double promotion_ratio=config::compaction_promotion_ratio, int64_t promotion_min_size=config::compaction_promotion_min_size_mbytes *1024 *1024, int64_t compaction_min_size=config::compaction_min_size_mbytes *1024 *1024)</td></tr>
<tr class="separator:a6f6c803a1211b4f6387029daef0e8bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2316d02f3da6baee8eb8e235931beec"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#ae2316d02f3da6baee8eb8e235931beec">~SizeBasedCumulativeCompactionPolicy</a> ()</td></tr>
<tr class="memdesc:ae2316d02f3da6baee8eb8e235931beec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor function of <a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a>.  <br /></td></tr>
<tr class="separator:ae2316d02f3da6baee8eb8e235931beec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa53788b20b707f9b68b93881c9a4a919"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#aa53788b20b707f9b68b93881c9a4a919">calculate_cumulative_point</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a> &gt; &amp;all_rowsets, int64_t current_cumulative_point, int64_t *cumulative_point) override</td></tr>
<tr class="separator:aa53788b20b707f9b68b93881c9a4a919"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3220157fa77fd36edaea621cd1177956"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a3220157fa77fd36edaea621cd1177956">pick_input_rowsets</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; &amp;candidate_rowsets, const int64_t max_compaction_score, const int64_t min_compaction_score, std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; *input_rowsets, <a class="el" href="../../dc/d96/structdoris_1_1_version.html">Version</a> *last_delete_version, size_t *compaction_score) override</td></tr>
<tr class="separator:a3220157fa77fd36edaea621cd1177956"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3523f47e95cab903b180e4fb310bd320"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a3523f47e95cab903b180e4fb310bd320">update_cumulative_point</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; &amp;input_rowsets, <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> _output_rowset, <a class="el" href="../../dc/d96/structdoris_1_1_version.html">Version</a> &amp;last_delete_version) override</td></tr>
<tr class="separator:a3523f47e95cab903b180e4fb310bd320"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6d4253d195d6ae3b7b06e8b4b9452ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#ab6d4253d195d6ae3b7b06e8b4b9452ea">calc_cumulative_compaction_score</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, <a class="el" href="../../d6/d94/namespacedoris.html#ac47d7da70b998d59c383d54b81dae3ee">TabletState</a> state, const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a> &gt; &amp;all_rowsets, int64_t current_cumulative_point, uint32_t *score) override</td></tr>
<tr class="separator:ab6d4253d195d6ae3b7b06e8b4b9452ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf14a745a4908c83f69c87965fe8eb7e"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#abf14a745a4908c83f69c87965fe8eb7e">name</a> () override</td></tr>
<tr class="memdesc:abf14a745a4908c83f69c87965fe8eb7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fetch cumulative policy name  <br /></td></tr>
<tr class="separator:abf14a745a4908c83f69c87965fe8eb7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private 成员函数</h2></td></tr>
<tr class="memitem:a13f26d8beea5f4b9ad6f6e0b717c23f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a13f26d8beea5f4b9ad6f6e0b717c23f9">_calc_promotion_size</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, <a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a> base_rowset_meta, int64_t *promotion_size)</td></tr>
<tr class="memdesc:a13f26d8beea5f4b9ad6f6e0b717c23f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculate promotion size using current base rowset meta size and promotion configs  <br /></td></tr>
<tr class="separator:a13f26d8beea5f4b9ad6f6e0b717c23f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4610bc7853aaa33fa9ab3439ec326e6e"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a4610bc7853aaa33fa9ab3439ec326e6e">_level_size</a> (const int64_t size)</td></tr>
<tr class="separator:a4610bc7853aaa33fa9ab3439ec326e6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57986a72871b3ea169aafa70a7fdb459"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#a57986a72871b3ea169aafa70a7fdb459">_refresh_tablet_promotion_size</a> (<a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *tablet, int64_t promotion_size)</td></tr>
<tr class="memdesc:a57986a72871b3ea169aafa70a7fdb459"><td class="mdescLeft">&#160;</td><td class="mdescRight">when policy calculate cumulative_compaction_score, update promotion size at the same time  <br /></td></tr>
<tr class="separator:a57986a72871b3ea169aafa70a7fdb459"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private 属性</h2></td></tr>
<tr class="memitem:ab0aacd7b3f4b233215d59c92d24bb52b"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#ab0aacd7b3f4b233215d59c92d24bb52b">_promotion_size</a></td></tr>
<tr class="memdesc:ab0aacd7b3f4b233215d59c92d24bb52b"><td class="mdescLeft">&#160;</td><td class="mdescRight">cumulative compaction promotion size, unit is byte.  <br /></td></tr>
<tr class="separator:ab0aacd7b3f4b233215d59c92d24bb52b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5d22fd7be985b18c3e1abbe3a502ad2"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#ad5d22fd7be985b18c3e1abbe3a502ad2">_promotion_ratio</a></td></tr>
<tr class="memdesc:ad5d22fd7be985b18c3e1abbe3a502ad2"><td class="mdescLeft">&#160;</td><td class="mdescRight">cumulative compaction promotion ratio of base rowset total disk size.  <br /></td></tr>
<tr class="separator:ad5d22fd7be985b18c3e1abbe3a502ad2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac54e5ebc2e76be70b774e5b70585a7d5"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#ac54e5ebc2e76be70b774e5b70585a7d5">_promotion_min_size</a></td></tr>
<tr class="memdesc:ac54e5ebc2e76be70b774e5b70585a7d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">cumulative compaction promotion min size, unit is byte.  <br /></td></tr>
<tr class="separator:ac54e5ebc2e76be70b774e5b70585a7d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaae2927346b7da3ba952be8d3a5aece7"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html#aaae2927346b7da3ba952be8d3a5aece7">_compaction_min_size</a></td></tr>
<tr class="memdesc:aaae2927346b7da3ba952be8d3a5aece7"><td class="mdescLeft">&#160;</td><td class="mdescRight">lower bound size to do compaction compaction.  <br /></td></tr>
<tr class="separator:aaae2927346b7da3ba952be8d3a5aece7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<div class="textblock"><p>SizeBased cumulative compaction policy implementation. SizeBased policy which derives <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html">CumulativeCompactionPolicy</a> is a optimized version of num based cumulative compaction policy. This policy also uses linear structure to compact rowsets. The cumulative rowsets can do compaction when they are in same level size. And when output rowset exceeds the promotion radio of base size or min promotion size, it will do base compaction. This policy is targeting the use cases requiring lower write amplification, trading off read amplification and space amplification. </p>
</div><h2 class="groupheader">构造及析构函数说明</h2>
<a id="a6f6c803a1211b4f6387029daef0e8bcd" name="a6f6c803a1211b4f6387029daef0e8bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f6c803a1211b4f6387029daef0e8bcd">&#9670;&#160;</a></span>SizeBasedCumulativeCompactionPolicy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a> </td>
          <td>(</td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>promotion_size</em> = <code>config::compaction_promotion_size_mbytes&#160;*&#160;1024&#160;*&#160;1024</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>promotion_ratio</em> = <code>config::compaction_promotion_ratio</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>promotion_min_size</em> = <code>config::compaction_promotion_min_size_mbytes&#160;*&#160;1024&#160;*&#160;1024</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>compaction_min_size</em> = <code>config::compaction_min_size_mbytes&#160;*&#160;1024&#160;*&#160;1024</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor function of <a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a>, it needs tablet pointer to access tablet method. param tablet, the shared pointer of tablet </p>

</div>
</div>
<a id="ae2316d02f3da6baee8eb8e235931beec" name="ae2316d02f3da6baee8eb8e235931beec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2316d02f3da6baee8eb8e235931beec">&#9670;&#160;</a></span>~SizeBasedCumulativeCompactionPolicy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">~<a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor function of <a class="el" href="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy.html">SizeBasedCumulativeCompactionPolicy</a>. </p>

</div>
</div>
<h2 class="groupheader">成员函数说明</h2>
<a id="aa53788b20b707f9b68b93881c9a4a919" name="aa53788b20b707f9b68b93881c9a4a919"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa53788b20b707f9b68b93881c9a4a919">&#9670;&#160;</a></span>calculate_cumulative_point()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_cumulative_point </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>all_rowsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>current_cumulative_point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&#160;</td>
          <td class="paramname"><em>cumulative_point</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>SizeBased cumulative compaction policy implements calculate cumulative point function. When the first time the tablet does compact, this calculation is executed. Its main policy is to find first rowset which does not satisfied the promotion conditions. </p>

<p>实现了 <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html#adee345202204a9e65fb2340ca0d6db7f">CumulativeCompactionPolicy</a>.</p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_aa53788b20b707f9b68b93881c9a4a919_cgraph.svg" width="100%" height="429"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a3220157fa77fd36edaea621cd1177956" name="a3220157fa77fd36edaea621cd1177956"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3220157fa77fd36edaea621cd1177956">&#9670;&#160;</a></span>pick_input_rowsets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int pick_input_rowsets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>candidate_rowsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>max_compaction_score</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>min_compaction_score</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; *&#160;</td>
          <td class="paramname"><em>input_rowsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d96/structdoris_1_1_version.html">Version</a> *&#160;</td>
          <td class="paramname"><em>last_delete_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>compaction_score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>SizeBased cumulative compaction policy implements pick input rowsets function. Its main policy is picking rowsets from candidate rowsets by comparing accumulative compaction_score, max_cumulative_compaction_num_singleton_deltas or checking whether there is delete version rowset, and choose those rowset in the same level to do cumulative compaction. </p>

<p>实现了 <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html#abe0974c008cdf58ba27952cdeff3f430">CumulativeCompactionPolicy</a>.</p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a3220157fa77fd36edaea621cd1177956_cgraph.svg" width="358" height="166"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a3523f47e95cab903b180e4fb310bd320" name="a3523f47e95cab903b180e4fb310bd320"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3523f47e95cab903b180e4fb310bd320">&#9670;&#160;</a></span>update_cumulative_point()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void update_cumulative_point </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>input_rowsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d94/namespacedoris.html#a45a11d2c52e9b86e26ff0bb6d9c667d2">RowsetSharedPtr</a>&#160;</td>
          <td class="paramname"><em>_output_rowset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dc/d96/structdoris_1_1_version.html">Version</a> &amp;&#160;</td>
          <td class="paramname"><em>last_delete_version</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>SizeBased cumulative compaction policy implements update cumulative point function. Its main policy is judging the output rowset size whether satisfied the promotion size. If it satisfied, this policy will update the cumulative point. </p>

<p>实现了 <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html#a4b34b6f469138cd6cb7209e5beae4ebb">CumulativeCompactionPolicy</a>.</p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a3523f47e95cab903b180e4fb310bd320_cgraph.svg" width="390" height="179"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab6d4253d195d6ae3b7b06e8b4b9452ea" name="ab6d4253d195d6ae3b7b06e8b4b9452ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6d4253d195d6ae3b7b06e8b4b9452ea">&#9670;&#160;</a></span>calc_cumulative_compaction_score()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calc_cumulative_compaction_score </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d94/namespacedoris.html#ac47d7da70b998d59c383d54b81dae3ee">TabletState</a>&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>all_rowsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>current_cumulative_point</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>score</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Num based cumulative compaction policy implements calc cumulative compaction score function. Its main policy is calculating the accumulative compaction score after current cumulative_point in tablet. </p>

<p>实现了 <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html#acce9ec6afad5d096bceb962dd8e9d808">CumulativeCompactionPolicy</a>.</p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_ab6d4253d195d6ae3b7b06e8b4b9452ea_cgraph.svg" width="100%" height="418"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="abf14a745a4908c83f69c87965fe8eb7e" name="abf14a745a4908c83f69c87965fe8eb7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf14a745a4908c83f69c87965fe8eb7e">&#9670;&#160;</a></span>name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fetch cumulative policy name </p>

<p>实现了 <a class="el" href="../../d6/da2/classdoris_1_1_cumulative_compaction_policy.html#a338331e32e424c27f3f50d6435b0c7da">CumulativeCompactionPolicy</a>.</p>

</div>
</div>
<a id="a13f26d8beea5f4b9ad6f6e0b717c23f9" name="a13f26d8beea5f4b9ad6f6e0b717c23f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13f26d8beea5f4b9ad6f6e0b717c23f9">&#9670;&#160;</a></span>_calc_promotion_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void _calc_promotion_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d94/namespacedoris.html#a8e1aa733e7ffe7bd29887ebdf7c1303d">RowsetMetaSharedPtr</a>&#160;</td>
          <td class="paramname"><em>base_rowset_meta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&#160;</td>
          <td class="paramname"><em>promotion_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>calculate promotion size using current base rowset meta size and promotion configs </p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a13f26d8beea5f4b9ad6f6e0b717c23f9_cgraph.svg" width="644" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a13f26d8beea5f4b9ad6f6e0b717c23f9_icgraph.svg" width="398" height="115"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4610bc7853aaa33fa9ab3439ec326e6e" name="a4610bc7853aaa33fa9ab3439ec326e6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4610bc7853aaa33fa9ab3439ec326e6e">&#9670;&#160;</a></span>_level_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t _level_size </td>
          <td>(</td>
          <td class="paramtype">const int64_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>calculate the disk size belong to which level, the level is divide by power of 2 between compaction_promotion_size_mbytes and 1KB </p>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a4610bc7853aaa33fa9ab3439ec326e6e_icgraph.svg" width="336" height="102"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a57986a72871b3ea169aafa70a7fdb459" name="a57986a72871b3ea169aafa70a7fdb459"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57986a72871b3ea169aafa70a7fdb459">&#9670;&#160;</a></span>_refresh_tablet_promotion_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void _refresh_tablet_promotion_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/dbc/classdoris_1_1_tablet.html">Tablet</a> *&#160;</td>
          <td class="paramname"><em>tablet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>promotion_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>when policy calculate cumulative_compaction_score, update promotion size at the same time </p>
<div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a57986a72871b3ea169aafa70a7fdb459_cgraph.svg" width="448" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d4/d48/classdoris_1_1_size_based_cumulative_compaction_policy_a57986a72871b3ea169aafa70a7fdb459_icgraph.svg" width="648" height="115"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">类成员变量说明</h2>
<a id="ab0aacd7b3f4b233215d59c92d24bb52b" name="ab0aacd7b3f4b233215d59c92d24bb52b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0aacd7b3f4b233215d59c92d24bb52b">&#9670;&#160;</a></span>_promotion_size</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t _promotion_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>cumulative compaction promotion size, unit is byte. </p>

</div>
</div>
<a id="ad5d22fd7be985b18c3e1abbe3a502ad2" name="ad5d22fd7be985b18c3e1abbe3a502ad2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5d22fd7be985b18c3e1abbe3a502ad2">&#9670;&#160;</a></span>_promotion_ratio</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double _promotion_ratio</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>cumulative compaction promotion ratio of base rowset total disk size. </p>

</div>
</div>
<a id="ac54e5ebc2e76be70b774e5b70585a7d5" name="ac54e5ebc2e76be70b774e5b70585a7d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac54e5ebc2e76be70b774e5b70585a7d5">&#9670;&#160;</a></span>_promotion_min_size</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t _promotion_min_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>cumulative compaction promotion min size, unit is byte. </p>

</div>
</div>
<a id="aaae2927346b7da3ba952be8d3a5aece7" name="aaae2927346b7da3ba952be8d3a5aece7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaae2927346b7da3ba952be8d3a5aece7">&#9670;&#160;</a></span>_compaction_min_size</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t _compaction_min_size</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>lower bound size to do compaction compaction. </p>

</div>
</div>
<hr/>该类的文档由以下文件生成:<ul>
<li>/Users/dabowang/be_all/olap/<a class="el" href="../../df/d38/cumulative__compaction__policy_8h_source.html">cumulative_compaction_policy.h</a></li>
<li>/Users/dabowang/be_all/olap/<a class="el" href="../../dc/d29/cumulative__compaction__policy_8cpp.html">cumulative_compaction_policy.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
