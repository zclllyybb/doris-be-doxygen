\hypertarget{stream__load__context_8h_source}{}\doxysection{stream\+\_\+load\+\_\+context.\+h}
\label{stream__load__context_8h_source}\index{/Users/dabowang/doris/be/src/runtime/stream\_load/stream\_load\_context.h@{/Users/dabowang/doris/be/src/runtime/stream\_load/stream\_load\_context.h}}
\mbox{\hyperlink{stream__load__context_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <rapidjson/prettywriter.h>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <future>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{logging_8h}{common/logging.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_2utils_8h}{common/utils.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/BackendService\_types.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/FrontendService\_types.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{stream__load__pipe_8h}{io/fs/stream\_load\_pipe.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{exec__env_8h}{runtime/exec\_env.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{message__body__sink_8h}{runtime/message\_body\_sink.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{new__load__stream__mgr_8h}{runtime/stream\_load/new\_load\_stream\_mgr.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{stream__load__executor_8h}{runtime/stream\_load/stream\_load\_executor.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{backend__options_8h}{service/backend\_options.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__util_8h}{util/string\_util.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{time_8h}{util/time.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uid__util_8h}{util/uid\_util.h}}"{}}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{comment}{//\ kafka\ related\ info}}
\DoxyCodeLine{00043\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_kafka_load_info}{KafkaLoadInfo}}\ \{}
\DoxyCodeLine{00044\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a2e85a0bf808ee9cecc9bee5015cdb9d3}{KafkaLoadInfo}}(\textcolor{keyword}{const}\ TKafkaLoadInfo\&\ t\_info)}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a55267172f8c107370def2562e984b834}{brokers}}(t\_info.\mbox{\hyperlink{classdoris_1_1_kafka_load_info_a55267172f8c107370def2562e984b834}{brokers}}),}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a64dd38cc7ef3b7327905c1ff918f2c52}{topic}}(t\_info.\mbox{\hyperlink{classdoris_1_1_kafka_load_info_a64dd38cc7ef3b7327905c1ff918f2c52}{topic}}),}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a815f7c34a2933b2af849bbc9c31b3e45}{begin\_offset}}(t\_info.partition\_begin\_offset),}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a715b8e26a106eb0b0172a2c7d9835403}{properties}}(t\_info.\mbox{\hyperlink{classdoris_1_1_kafka_load_info_a715b8e26a106eb0b0172a2c7d9835403}{properties}})\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ offset(begin\_offset)\ sent\ from\ FE\ is\ the\ starting\ offset,}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ the\ offset(cmt\_offset)\ reported\ by\ BE\ to\ FE\ is\ the\ consumed\ offset,}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ we\ need\ to\ minus\ 1\ here.}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ p\ :\ t\_info.partition\_begin\_offset)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_aedb26999c90b8df80c781ef834bc46d8}{cmt\_offset}}[p.first]\ =\ p.second\ -\/\ 1;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_ac32ae0a5328c6612261ec59de33d922e}{reset\_offset}}()\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ reset\ the\ commit\ offset}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ p\ :\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a815f7c34a2933b2af849bbc9c31b3e45}{begin\_offset}})\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_aedb26999c90b8df80c781ef834bc46d8}{cmt\_offset}}[p.first]\ =\ p.second\ -\/\ 1;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00066\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a55267172f8c107370def2562e984b834}{brokers}};}
\DoxyCodeLine{00067\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a64dd38cc7ef3b7327905c1ff918f2c52}{topic}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ the\ following\ members\ control\ the\ max\ progress\ of\ a\ consuming}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ process.\ if\ any\ of\ them\ reach,\ the\ consuming\ will\ finish.}}
\DoxyCodeLine{00071\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a471452cd4636be8df07789b08318ca22}{max\_interval\_s}}\ =\ 5;}
\DoxyCodeLine{00072\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a6224a2ce63dade3eca764ae9caafa99c}{max\_batch\_rows}}\ =\ 1024;}
\DoxyCodeLine{00073\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_aa304bcbd8fe384b630717c405e7ab0c7}{max\_batch\_size}}\ =\ 100\ *\ 1024\ *\ 1024;\ \textcolor{comment}{//\ 100MB}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ partition\ -\/>\ begin\ offset,\ inclusive.}}
\DoxyCodeLine{00076\ \ \ \ \ std::map<int32\_t,\ int64\_t>\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a815f7c34a2933b2af849bbc9c31b3e45}{begin\_offset}};}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ partition\ -\/>\ commit\ offset,\ inclusive.}}
\DoxyCodeLine{00078\ \ \ \ \ std::map<int32\_t,\ int64\_t>\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_aedb26999c90b8df80c781ef834bc46d8}{cmt\_offset}};}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//custom\ kafka\ property\ key\ -\/>\ value}}
\DoxyCodeLine{00080\ \ \ \ \ std::map<std::string,\ std::string>\ \mbox{\hyperlink{classdoris_1_1_kafka_load_info_a715b8e26a106eb0b0172a2c7d9835403}{properties}};}
\DoxyCodeLine{00081\ \};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_message_body_sink}{MessageBodySink}};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_stream_load_context}{StreamLoadContext}}\ \{}
\DoxyCodeLine{00086\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a96cde1470dd7e96620fd64dd8b05d086}{StreamLoadContext}}(\mbox{\hyperlink{classdoris_1_1_exec_env}{ExecEnv}}*\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a7e0d0163a03ace13113f67bc696d5194}{exec\_env}})\ :\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a2c1804289b8301d201107fc05615ffe9}{id}}(\mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}::gen\_uid()),\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a1597f639b99219fa0b93e8ca8c9e5f3a}{\_exec\_env}}(\mbox{\hyperlink{classdoris_1_1_stream_load_context_a7e0d0163a03ace13113f67bc696d5194}{exec\_env}})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a20b4f7fd2910d33e5d69092f23ccf20d}{start\_millis}}\ =\ \mbox{\hyperlink{namespacedoris_a8c873b61acc89dfc24f33b7bc4757242}{UnixMillis}}();}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a4046bbfff9157931ec0a69b4f839804d}{\string~StreamLoadContext}}()\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_stream_load_context_a33824c63748d763c30f8563efae5149f}{need\_rollback}})\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a1597f639b99219fa0b93e8ca8c9e5f3a}{\_exec\_env}}-\/>\mbox{\hyperlink{classdoris_1_1_exec_env_ab7dc71e7b9f839a98669730486c69a1f}{stream\_load\_executor}}()-\/>\mbox{\hyperlink{classdoris_1_1_stream_load_executor_aee0d5b6ed8c72f413cdacf90e504b99b}{rollback\_txn}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a33824c63748d763c30f8563efae5149f}{need\_rollback}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ad9d59b2ac4316ed6b5496ff9d57d3eff}{to\_json}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ae2b7f711c6ce9dc1878eeec09c1d5fde}{prepare\_stream\_load\_record}}(\textcolor{keyword}{const}\ std::string\&\ stream\_load\_record);}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a761349f5e184a0e943f935ffd6a026bc}{parse\_stream\_load\_record}}(\textcolor{keyword}{const}\ std::string\&\ stream\_load\_record,}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TStreamLoadRecord\&\ stream\_load\_item);}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ the\ old\ mini\ load\ result\ format\ is\ not\ same\ as\ stream\ load.}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ add\ this\ function\ for\ compatible\ with\ old\ mini\ load\ result\ format.}}
\DoxyCodeLine{00106\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a257257d83d0f04225aa70965a3d1bbda}{to\_json\_for\_mini\_load}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ return\ the\ brief\ info\ of\ this\ context.}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ also\ print\ the\ load\ source\ info\ if\ detail\ is\ set\ to\ true}}
\DoxyCodeLine{00110\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ac82f12528226ec19757c342d62908c3a}{brief}}(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacedetail}{detail}}\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ load\ type,\ eg:\ ROUTINE\ LOAD/MANUAL\ LOAD}}
\DoxyCodeLine{00114\ \ \ \ \ TLoadType::type\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aef3869d9467c0f1c55f7db3a699535b1}{load\_type}};}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ load\ data\ source:\ eg:\ KAFKA/RAW}}
\DoxyCodeLine{00116\ \ \ \ \ TLoadSourceType::type\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a21ecfacb1aeb391a8799fc3d1eb0ddce}{load\_src\_type}};}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ the\ job\ this\ stream\ load\ task\ belongs\ to,}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ set\ to\ -\/1\ if\ there\ is\ no\ job}}
\DoxyCodeLine{00120\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a37c0ec2f32f16b5ac9908e3aa74911b1}{job\_id}}\ =\ -\/1;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ id\ for\ each\ load}}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a2c1804289b8301d201107fc05615ffe9}{id}};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ae9f9a1e64d49232d95d5b0838b33fa3e}{db}};}
\DoxyCodeLine{00126\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a9042263ef833cd23b92e476bfb21d150}{db\_id}}\ =\ -\/1;}
\DoxyCodeLine{00127\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ac9113d3355ee7eb008b67dd53eb9f62c}{table}};}
\DoxyCodeLine{00128\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a1dd28f5ea7b5b0780013e960944ddaa0}{label}};}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{comment}{//\ optional}}
\DoxyCodeLine{00130\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a79bcbcac2083871413f4935fcc659235}{sub\_label}};}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_abb743260687052a35e8057f1b6277cf6}{max\_filter\_ratio}}\ =\ 0.0;}
\DoxyCodeLine{00132\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ac00d18ffecf2d881f51da2a210be259e}{timeout\_second}}\ =\ -\/1;}
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_auth_info}{AuthInfo}}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a12072dd05038320d5bcc8a0fba301397}{auth}};}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a6da07048519c5238720273aab014e290}{two\_phase\_commit}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00135\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aa52aff465637582244faac758250e0bf}{load\_comment}};}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ the\ following\ members\ control\ the\ max\ progress\ of\ a\ consuming}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ process.\ if\ any\ of\ them\ reach,\ the\ consuming\ will\ finish.}}
\DoxyCodeLine{00139\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a471452cd4636be8df07789b08318ca22}{max\_interval\_s}}\ =\ 5;}
\DoxyCodeLine{00140\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a6224a2ce63dade3eca764ae9caafa99c}{max\_batch\_rows}}\ =\ 100000;}
\DoxyCodeLine{00141\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aa304bcbd8fe384b630717c405e7ab0c7}{max\_batch\_size}}\ =\ 100\ *\ 1024\ *\ 1024;\ \textcolor{comment}{//\ 100MB}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ for\ parse\ json-\/data}}
\DoxyCodeLine{00144\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aec81118b63fa15096fd7cd2f0140e77d}{data\_format}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00145\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a3a8909b3193d18a6e51e663fc9e700da}{jsonpath\_file}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00146\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ada8aff2927b3a89da5f55da3cf67c3ac}{jsonpath}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ only\ used\ to\ check\ if\ we\ receive\ whole\ body}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a9f942a775e3bccd4d0e886605af1346c}{body\_bytes}}\ =\ 0;}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ad2bea8082da79b0535ebf93498930203}{receive\_bytes}}\ =\ 0;}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a43b5f514db6b617ce9442499f358f000}{txn\_id}}\ =\ -\/1;}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ac2933b8e6ca04a9360d88373fe8c1536}{txn\_operation}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a33824c63748d763c30f8563efae5149f}{need\_rollback}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ when\ use\_streaming\ is\ true,\ we\ use\ stream\_pipe\ to\ send\ source\ data,}}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{//\ otherwise\ we\ save\ source\ data\ to\ file\ first,\ then\ process\ it.}}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ad54bdd5f551b5fb612ca74e79875a00e}{use\_streaming}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00160\ \ \ \ \ TFileFormatType::type\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_afb27b19ce875d8abb2c99156e6544254}{format}}\ =\ TFileFormatType::FORMAT\_CSV\_PLAIN;}
\DoxyCodeLine{00161\ \ \ \ \ TFileCompressType::type\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a36f7fcafbbbf21bd67e7559d09334696}{compress\_type}}\ =\ TFileCompressType::UNKNOWN;}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ std::shared\_ptr<MessageBodySink>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a9ac44450d7901892d984cd369e98e16a}{body\_sink}};}
\DoxyCodeLine{00164\ \ \ \ \ std::shared\_ptr<io::StreamLoadPipe>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a616a43584b9486cdfedc01f6ffb034fa}{pipe}};}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ TStreamLoadPutResult\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_afae016c0699165d1ee5aa33c617eb5d2}{put\_result}};}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ std::vector<TTabletCommitInfo>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a21acae18f92b0d82ec7ead0428fe8406}{commit\_infos}};}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ std::promise<Status>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a3ec7a5425066a3f12ca867ceb9ed08f9}{promise}};}
\DoxyCodeLine{00171\ \ \ \ \ std::future<Status>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a12b85d187523de32ae89be0da4933ff8}{future}}\ =\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a3ec7a5425066a3f12ca867ceb9ed08f9}{promise}}.get\_future();}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ae29aa2d4ae440022daaed1107eb306b3}{status}};}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a614ba0a55226ca35ff87785c151a05f3}{number\_total\_rows}}\ =\ 0;}
\DoxyCodeLine{00176\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aff0d5ae0f5a7d02c0037d13b52701e91}{number\_loaded\_rows}}\ =\ 0;}
\DoxyCodeLine{00177\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ab2ce7f9029e2e50c6062727ad693eb61}{number\_filtered\_rows}}\ =\ 0;}
\DoxyCodeLine{00178\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a94bafa3162717c675a2dbfa9cf71ffe1}{number\_unselected\_rows}}\ =\ 0;}
\DoxyCodeLine{00179\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a2536cff17030438f9d2b767ad40e0ec6}{loaded\_bytes}}\ =\ 0;}
\DoxyCodeLine{00180\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a20b4f7fd2910d33e5d69092f23ccf20d}{start\_millis}}\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_af54dcaa6e8d0611778ddd366bc557f61}{start\_write\_data\_nanos}}\ =\ 0;}
\DoxyCodeLine{00182\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a61db4ef077d66f0e798020c6ae433066}{load\_cost\_millis}}\ =\ 0;}
\DoxyCodeLine{00183\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a3b88db94472d18e49551031702d02c53}{begin\_txn\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00184\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a52bb1dc6d522f87811fbcba6591a72ed}{stream\_load\_put\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00185\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a5dfaed58aefde99193ede6c1b13b7c9b}{commit\_and\_publish\_txn\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00186\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a91162d7f229e2803f8039da9d2587357}{pre\_commit\_txn\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00187\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a14d8596985317f414f26fbd704eab664}{read\_data\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00188\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_acdeb8239ecd1df77320b9d36f8e977e6}{write\_data\_cost\_nanos}}\ =\ 0;}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aba0c661fd6535539bd0e582e55460851}{error\_url}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ if\ label\ already\ be\ used,\ set\ existing\ job's\ status\ here}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ should\ be\ RUNNING\ or\ FINISHED}}
\DoxyCodeLine{00193\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_afb2f9656135d03d8fdcf1f698336048e}{existing\_job\_status}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ std::unique\_ptr<KafkaLoadInfo>\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a17e4961e69cec6dff2022b1cbb4ec02f}{kafka\_info}};}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ consumer\_id\ is\ used\ for\ data\ consumer\ cache\ key.}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ to\ identified\ a\ specified\ data\ consumer.}}
\DoxyCodeLine{00199\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_ad6669e198cb6236dfc1e5009802cf92a}{consumer\_id}};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ If\ this\ is\ an\ transactional\ insert\ operation,\ this\ will\ be\ true}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a4c19e31abe82ca5df81094045cbc2835}{need\_commit\_self}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{comment}{//\ csv\ with\ header\ type}}
\DoxyCodeLine{00205\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_aa730487eb7fbdc6c8c2be49ee14ff60e}{header\_type}}\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_exec_env}{ExecEnv}}*\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a7e0d0163a03ace13113f67bc696d5194}{exec\_env}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a1597f639b99219fa0b93e8ca8c9e5f3a}{\_exec\_env}};\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_exec_env}{ExecEnv}}*\ \mbox{\hyperlink{classdoris_1_1_stream_load_context_a1597f639b99219fa0b93e8ca8c9e5f3a}{\_exec\_env}};}
\DoxyCodeLine{00212\ \};}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
