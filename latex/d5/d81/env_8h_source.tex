\hypertarget{env_8h_source}{}\doxysection{env.\+h}
\label{env_8h_source}\index{/Users/dabowang/be\_all/env/env.h@{/Users/dabowang/be\_all/env/env.h}}
\mbox{\hyperlink{env_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ \ Copyright\ (c)\ 2011-\/present,\ Facebook,\ Inc.\ \ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ \ This\ source\ code\ is\ licensed\ under\ both\ the\ GPLv2\ (found\ in\ the}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ \ COPYING\ file\ in\ the\ root\ directory)\ and\ Apache\ 2.0\ License}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ \ (found\ in\ the\ LICENSE.Apache\ file\ in\ the\ root\ directory).}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Copyright\ (c)\ 2011\ The\ LevelDB\ Authors.\ All\ rights\ reserved.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Use\ of\ this\ source\ code\ is\ governed\ by\ a\ BSD-\/style\ license\ that\ can\ be}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ found\ in\ the\ LICENSE\ file.\ See\ the\ AUTHORS\ file\ for\ names\ of\ contributors}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/olap\_file.pb.h"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{slice_8h}{util/slice.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{class\ }RandomAccessFile;}
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }RandomRWFile;}
\DoxyCodeLine{00024\ \textcolor{keyword}{class\ }WritableFile;}
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }PosixEnv;}
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }StorageBackend;}
\DoxyCodeLine{00027\ \textcolor{keyword}{struct\ }FilePathDesc;}
\DoxyCodeLine{00028\ \textcolor{keyword}{struct\ }WritableFileOptions;}
\DoxyCodeLine{00029\ \textcolor{keyword}{struct\ }RandomAccessFileOptions;}
\DoxyCodeLine{00030\ \textcolor{keyword}{struct\ }RandomRWFileOptions;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace\ }io\ \{}
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1io_1_1_file_system}{FileSystem}};}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_env}{Env}}\ \{}
\DoxyCodeLine{00037\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ Governs\ if/how\ the\ file\ is\ created.}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//\ enum\ value\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ file\ exists\ \ \ \ \ \ \ |\ file\ does\ not\ exist}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/+-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//\ CREATE\_OR\_OPEN\_WITH\_TRUNCATE\ |\ opens\ +\ truncates\ |\ creates}}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ CREATE\_OR\_OPEN\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ opens\ \ \ \ \ \ \ \ \ \ \ \ \ |\ creates}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ MUST\_CREATE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ fails\ \ \ \ \ \ \ \ \ \ \ \ \ |\ creates}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ MUST\_EXIST\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ opens\ \ \ \ \ \ \ \ \ \ \ \ \ |\ fails}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2}{OpenMode}}\ \{\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a33ea0e1f7bfae51389ad84743f882dfe}{CREATE\_OR\_OPEN\_WITH\_TRUNCATE}},\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a82e9d6ffb829e173b609682f83917f55}{CREATE\_OR\_OPEN}},\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a4ae728c26b39e93c7788a4b071705fa2}{MUST\_CREATE}},\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a2b007bd42b702cd13847b2b4a9d1f87b}{MUST\_EXIST}}\ \};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_env_a34b0da82037de8cadad91b4c194565e4}{Env}}()\ \{\}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_env_aa5eb7f724dd4e3d0c66c458e5cc079e9}{\string~Env}}()\ \{\}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ Return\ a\ default\ environment\ suitable\ for\ the\ current\ operating}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ system.\ \ Sophisticated\ users\ may\ wish\ to\ provide\ their\ own\ Env}}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ implementation\ instead\ of\ relying\ on\ this\ default\ environment.}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_env}{Env}}*\ \mbox{\hyperlink{classdoris_1_1_env_ab24c189602db2d904a63350aa1890c96}{Default}}();}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ brand\ new\ random\ access\ read-\/only\ file\ with\ the}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ specified\ name.\ \ On\ success,\ stores\ a\ pointer\ to\ the\ new\ file\ in}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ *result\ and\ returns\ OK.\ \ On\ failure\ stores\ nullptr\ in\ *result\ and}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ returns\ non-\/OK.\ \ If\ the\ file\ does\ not\ exist,\ returns\ a\ non-\/OK}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ status.}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ The\ returned\ file\ may\ be\ concurrently\ accessed\ by\ multiple\ threads.}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a39a294aba2d0d8ed2f3b0f757d46cecd}{new\_random\_access\_file}}(\textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RandomAccessFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_aec57a75f2ef0ce693ff6151c5533c5ec}{new\_random\_access\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_random_access_file_options}{RandomAccessFileOptions}}\&\ opts,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RandomAccessFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ Create\ an\ object\ that\ writes\ to\ a\ new\ file\ with\ the\ specified}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ name.\ \ Deletes\ any\ existing\ file\ with\ the\ same\ name\ and\ creates\ a}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ new\ file.\ \ On\ success,\ stores\ a\ pointer\ to\ the\ new\ file\ in}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ *result\ and\ returns\ OK.\ \ On\ failure\ stores\ nullptr\ in\ *result\ and}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ returns\ non-\/OK.}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ The\ returned\ file\ will\ only\ be\ accessed\ by\ one\ thread\ at\ a\ time.}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_aa02838b86520b880b82f5d155ba545d0}{new\_writable\_file}}(\textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<WritableFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ Like\ the\ previous\ new\_writable\_file,\ but\ allows\ options\ to\ be}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ specified.}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_aa0b174fe0331ab89420e90717c72dbc1}{new\_writable\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_writable_file_options}{WritableFileOptions}}\&\ opts,\ \textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<WritableFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ Creates\ a\ new\ readable\ and\ writable\ file.\ If\ a\ file\ with\ the\ same\ name}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ already\ exists\ on\ disk,\ it\ is\ deleted.}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ Some\ of\ the\ methods\ of\ the\ new\ file\ may\ be\ accessed\ concurrently,}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ while\ others\ are\ only\ safe\ for\ access\ by\ one\ thread\ at\ a\ time.}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a53b0e8877fade0d6ef4420294fdb5924}{new\_random\_rw\_file}}(\textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RandomRWFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ Like\ the\ previous\ new\_random\_rw\_file,\ but\ allows\ options\ to\ be\ specified.}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a811e04d01334cdebc4e6bbefea71c047}{new\_random\_rw\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_random_r_w_file_options}{RandomRWFileOptions}}\&\ opts,\ \textcolor{keyword}{const}\ std::string\&\ fname,}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RandomRWFile>*\ result)\ =\ 0;}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ Returns\ OK\ if\ the\ path\ exists.}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ NotFound\ if\ the\ named\ file\ does\ not\ exist,}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ the\ calling\ process\ does\ not\ have\ permission\ to\ determine}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ whether\ this\ file\ exists,\ or\ if\ the\ path\ is\ invalid.}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ IOError\ if\ an\ IO\ Error\ was\ encountered}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a08f65a57d7db0a34d0bfa63a792c8b61}{path\_exists}}(\textcolor{keyword}{const}\ std::string\&\ fname,\ \textcolor{keywordtype}{bool}\ is\_dir\ =\ \textcolor{keyword}{false})\ =\ 0;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ Store\ in\ *result\ the\ names\ of\ the\ children\ of\ the\ specified\ directory.}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ The\ names\ are\ relative\ to\ "{}dir"{}.}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ Original\ contents\ of\ *results\ are\ dropped.}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ Returns\ OK\ if\ "{}dir"{}\ exists\ and\ "{}*result"{}\ contains\ its\ children.}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ NotFound\ if\ "{}dir"{}\ does\ not\ exist,\ the\ calling\ process\ does\ not\ have}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permission\ to\ access\ "{}dir"{},\ or\ if\ "{}dir"{}\ is\ invalid.}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ IOError\ if\ an\ IO\ Error\ was\ encountered}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a3d6153c4729ebbd2429222fa6061b1fe}{get\_children}}(\textcolor{keyword}{const}\ std::string\&\ dir,\ std::vector<std::string>*\ result)\ =\ 0;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ Iterate\ the\ specified\ directory\ and\ call\ given\ callback\ function\ with\ child's}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//\ name.\ This\ function\ continues\ execution\ until\ all\ children\ have\ been\ iterated}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ or\ callback\ function\ return\ false.}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{comment}{//\ The\ names\ are\ relative\ to\ "{}dir"{}.}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ The\ function\ call\ extra\ cost\ is\ acceptable.\ Compared\ with\ returning\ all\ children}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ into\ a\ given\ vector,\ the\ performance\ of\ this\ method\ is\ 5\%\ worse.\ However\ this}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{comment}{//\ approach\ is\ more\ flexible\ and\ efficient\ in\ fulfilling\ other\ requirements.}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ Returns\ OK\ if\ "{}dir"{}\ exists.}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ NotFound\ if\ "{}dir"{}\ does\ not\ exist,\ the\ calling\ process\ does\ not\ have}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permission\ to\ access\ "{}dir"{},\ or\ if\ "{}dir"{}\ is\ invalid.}}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ IOError\ if\ an\ IO\ Error\ was\ encountered}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_ab231585e8c30c4f62fc16a4ed173caeb}{iterate\_dir}}(\textcolor{keyword}{const}\ std::string\&\ dir,}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{bool}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*)>\&\ cb)\ =\ 0;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{comment}{//\ Delete\ the\ named\ file.}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_aa96ea5024c655c7136c0146ed83cdd12}{delete\_file}}(\textcolor{keyword}{const}\ std::string\&\ fname)\ =\ 0;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ specified\ directory.}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ It\ will\ return\ error\ if\ the\ path\ already\ exist(not\ necessarily\ as\ a\ directory)}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a40bfe729f7d2a0d32e02e27815711b96}{create\_dir}}(\textcolor{keyword}{const}\ std::string\&\ dirname)\ =\ 0;}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ Creates\ directory\ if\ missing.}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Return\ OK\ if\ it\ exists,\ or\ successful\ in\ Creating.}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a41012fd63027a72fef82140088801ca8}{create\_dir\_if\_missing}}(\textcolor{keyword}{const}\ std::string\&\ dirname,\ \textcolor{keywordtype}{bool}*\ created\ =\ \textcolor{keyword}{nullptr})\ =\ 0;}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ Delete\ the\ specified\ directory.}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ The\ dir\ must\ be\ empty.}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a058eebee56c797f747472b98420bd901}{delete\_dir}}(\textcolor{keyword}{const}\ std::string\&\ dirname)\ =\ 0;}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ Synchronize\ the\ entry\ for\ a\ specific\ directory.}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a94d057ac778dbd1aeda7c55c6e668bdd}{sync\_dir}}(\textcolor{keyword}{const}\ std::string\&\ dirname)\ =\ 0;}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ Checks\ if\ the\ file\ is\ a\ directory.\ Returns\ an\ error\ if\ it\ doesn't}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ exist,\ otherwise\ writes\ true\ or\ false\ into\ 'is\_dir'\ appropriately.}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_aa17d481968b713d24833057758e15463}{is\_directory}}(\textcolor{keyword}{const}\ std::string\&\ path,\ \textcolor{keywordtype}{bool}*\ is\_dir)\ =\ 0;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ Canonicalize\ 'path'\ by\ applying\ the\ following\ conversions:}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ -\/\ Converts\ a\ relative\ path\ into\ an\ absolute\ one\ using\ the\ cwd.}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ -\/\ Converts\ '.'\ and\ '..'\ references.}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{comment}{//\ -\/\ Resolves\ all\ symbolic\ links.}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ All\ directory\ entries\ in\ 'path'\ must\ exist\ on\ the\ filesystem.}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a0c20bda069fa94eb9c4958c55cde95c3}{canonicalize}}(\textcolor{keyword}{const}\ std::string\&\ path,\ std::string*\ result)\ =\ 0;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a0c044cd044f0ca0e33dc8a0f7dc739e9}{get\_file\_size}}(\textcolor{keyword}{const}\ std::string\&\ fname,\ uint64\_t*\ size)\ =\ 0;}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ Store\ the\ last\ modification\ time\ of\ fname\ in\ *file\_mtime.}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a8772ebecd062517f84dc95820e7e5705}{get\_file\_modified\_time}}(\textcolor{keyword}{const}\ std::string\&\ fname,\ uint64\_t*\ file\_mtime)\ =\ 0;}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ copy\ path\ from\ src\ to\ target.}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_adec3a09b2239f02b22b6404843a74752}{copy\_path}}(\textcolor{keyword}{const}\ std::string\&\ src,\ \textcolor{keyword}{const}\ std::string\&\ target)\ =\ 0;}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ Rename\ file\ src\ to\ target.}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_ad50d7267144c9161488299b3d920b32c}{rename\_file}}(\textcolor{keyword}{const}\ std::string\&\ src,\ \textcolor{keyword}{const}\ std::string\&\ target)\ =\ 0;}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ Rename\ dir\ src\ to\ target.}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a6ce06c31c03a82a5d973522d5a9e0898}{rename\_dir}}(\textcolor{keyword}{const}\ std::string\&\ src,\ \textcolor{keyword}{const}\ std::string\&\ target)\ =\ 0;}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{//\ create\ a\ hard-\/link}}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a22b9b11667be2e5506f8da8311da8193}{link\_file}}(\textcolor{keyword}{const}\ std::string\&\ \textcolor{comment}{/*old\_path*/},\ \textcolor{keyword}{const}\ std::string\&\ \textcolor{comment}{/*new\_path*/})\ =\ 0;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ get\ space\ info\ for\ local\ and\ remote\ system}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_a915eb2e62953ee9edd02d41b49f38b85}{get\_space\_info}}(\textcolor{keyword}{const}\ std::string\&\ path,\ int64\_t*\ capacity,}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t*\ available)\ =\ 0;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ Create\ directory\ of\ dir\_path,}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ This\ function\ will\ create\ directory\ recursively,}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{comment}{//\ if\ dir's\ parent\ directory\ doesn't\ exist}}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{comment}{//\ RETURNS:}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ \ Status::OK()\ \ \ \ \ \ if\ create\ directory\ success\ or\ directory\ already\ exists}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_env_afe6ee8bb34f72dca45f439f5234fab8d}{create\_dirs}}(\textcolor{keyword}{const}\ std::string\&\ dirname)\ =\ 0;}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<PosixEnv>\ \mbox{\hyperlink{classdoris_1_1_env_a1927f63d34b41222b04903d550eb880f}{\_posix\_env}};}
\DoxyCodeLine{00188\ \};}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_file_path_desc}{FilePathDesc}}\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_path_desc_aa87c1a43c398cc12c580bd6dc423e687}{FilePathDesc}}(\textcolor{keyword}{const}\ std::string\&\ path)\ \{\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a01bc76119a191c5eaa74ceca20aedd14}{filepath}}\ =\ path;\ \}}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_path_desc_acc4e87eb823e825ded1c749d7578b597}{FilePathDesc}}()\ \{\}}
\DoxyCodeLine{00193\ \ \ \ \ TStorageMedium::type\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}}\ =\ TStorageMedium::HDD;}
\DoxyCodeLine{00194\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a01bc76119a191c5eaa74ceca20aedd14}{filepath}};}
\DoxyCodeLine{00195\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a26e884d1bc590b4fc5057d9c067c1899}{remote\_path}};}
\DoxyCodeLine{00196\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a498c07e429e614ec4666361d9fcc9aeb}{storage\_name}};}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_file_system}{io::FileSystem}}*\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a00d3256d837961c55ca8738881d5b97c}{file\_system}};}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_ae21c3e223fb1aec0439964d01e5e0282}{debug\_string}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ ss\ <<\ \textcolor{stringliteral}{"{}storage\_medium:\ "{}}\ <<\ \mbox{\hyperlink{decimal12_8h_aac993ecccd3d88aafefb6b8e3caa1dee}{to\_string}}(\mbox{\hyperlink{structdoris_1_1_file_path_desc_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}})\ <<\ \textcolor{stringliteral}{"{},\ local\_path:\ "{}}\ <<\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a01bc76119a191c5eaa74ceca20aedd14}{filepath}};}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structdoris_1_1_file_path_desc_a26e884d1bc590b4fc5057d9c067c1899}{remote\_path}}.empty())\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ ss\ <<\ \textcolor{stringliteral}{"{},\ storage\_name:\ "{}}\ <<\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a498c07e429e614ec4666361d9fcc9aeb}{storage\_name}}\ <<\ \textcolor{stringliteral}{"{},\ remote\_path:\ "{}}\ <<\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a26e884d1bc590b4fc5057d9c067c1899}{remote\_path}};}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ REMOTE\_CACHE\ is\ the\ local\ cache\ path\ for\ remote\ path,\ if\ a\ data\_dir\ is\ REMOTE\_CACHE,}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{comment}{//\ it\ means\ the\ tablet\ in\ it\ will\ be\ set\ as\ a\ remote\ path.}}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a2e3f1f623391027b47edf84830b72a34}{is\_remote}}(TStorageMedium::type\ checked\_storage\_medium)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ checked\_storage\_medium\ ==\ TStorageMedium::S3\ ||}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checked\_storage\_medium\ ==\ TStorageMedium::REMOTE\_CACHE;}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{is\_remote}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{is\_remote}}(\mbox{\hyperlink{structdoris_1_1_file_path_desc_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}});\ \}}
\DoxyCodeLine{00214\ \};}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\ \{}
\DoxyCodeLine{00217\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_aa2cf612a4c3cac0211b87eeb82649e25}{operator<<}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_file_path_desc}{FilePathDesc}}\&\ val)\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a01bc76119a191c5eaa74ceca20aedd14}{filepath}};}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}\ =\ val.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}};}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_aa2cc563a2b2a09018be179658a03b83e}{\_storage\_name}}\ =\ val.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a498c07e429e614ec4666361d9fcc9aeb}{storage\_name}};}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a26e884d1bc590b4fc5057d9c067c1899}{remote\_path}};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a49a01454abdaa8200eac2e65315f8b49}{operator<<}}(\textcolor{keyword}{const}\ std::string\&\ val)\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a82d3b282b5a86fa803a5936988f1b89a}{operator<<}}(uint64\_t\ val)\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00240\ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a1c8635e2c53842d90b5fa2f9c8acaa1a}{operator<<}}(int64\_t\ val)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val;}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a37357431ac3ee352cf3b6fefc73484e4}{operator<<}}(uint32\_t\ val)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val;}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val;}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream}{FilePathDescStream}}\&\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ae9794f28164bf3c8c438fa0137eaa69a}{operator<<}}(int32\_t\ val)\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}\ <<\ val;}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}\ <<\ val;}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00261\ \ \ \ \ \}}
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_path_desc}{FilePathDesc}}\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}}()\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_path_desc}{FilePathDesc}}\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}}.str());}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}}.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}}\ =\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structdoris_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}))\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}}.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a26e884d1bc590b4fc5057d9c067c1899}{remote\_path}}\ =\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}}.str();}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}}.\mbox{\hyperlink{structdoris_1_1_file_path_desc_a498c07e429e614ec4666361d9fcc9aeb}{storage\_name}}\ =\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_aa2cc563a2b2a09018be179658a03b83e}{\_storage\_name}};}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_ad2b50ffe9cba911c581a65b978b31d35}{path\_desc}};}
\DoxyCodeLine{00270\ \ \ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00273\ \ \ \ \ TStorageMedium::type\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}\ =\ TStorageMedium::HDD;}
\DoxyCodeLine{00274\ \ \ \ \ std::stringstream\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a75e1c076909bfe8140aea9389a7dbbd0}{\_filepath\_stream}};}
\DoxyCodeLine{00275\ \ \ \ \ std::stringstream\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_a25e57686f81340fe16a6b9959e97b589}{\_remote\_path\_stream}};}
\DoxyCodeLine{00276\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_file_path_desc_stream_aa2cc563a2b2a09018be179658a03b83e}{\_storage\_name}};}
\DoxyCodeLine{00277\ \};}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_random_access_file_options}{RandomAccessFileOptions}}\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_random_access_file_options_a82c013b9de54241dc7107a74900dd948}{RandomAccessFileOptions}}()\ \{\}}
\DoxyCodeLine{00281\ \};}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{comment}{//\ Creation-\/time\ options\ for\ WritableFile}}
\DoxyCodeLine{00284\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_writable_file_options}{WritableFileOptions}}\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{comment}{//\ Call\ Sync()\ during\ Close().}}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_writable_file_options_a405d92889a618823b6ce6acc1da1bc76}{sync\_on\_close}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{//\ See\ OpenMode\ for\ details.}}
\DoxyCodeLine{00288\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2}{Env::OpenMode}}\ \mbox{\hyperlink{structdoris_1_1_writable_file_options_a55cbdc32e9b4020032d03c4b726ed9d5}{mode}}\ =\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a33ea0e1f7bfae51389ad84743f882dfe}{Env::CREATE\_OR\_OPEN\_WITH\_TRUNCATE}};}
\DoxyCodeLine{00289\ \};}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \textcolor{comment}{//\ Creation-\/time\ options\ for\ RWFile}}
\DoxyCodeLine{00292\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_random_r_w_file_options}{RandomRWFileOptions}}\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{comment}{//\ Call\ Sync()\ during\ Close().}}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_random_r_w_file_options_a405d92889a618823b6ce6acc1da1bc76}{sync\_on\_close}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{comment}{//\ See\ OpenMode\ for\ details.}}
\DoxyCodeLine{00296\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2}{Env::OpenMode}}\ \mbox{\hyperlink{structdoris_1_1_random_r_w_file_options_a55cbdc32e9b4020032d03c4b726ed9d5}{mode}}\ =\ \mbox{\hyperlink{classdoris_1_1_env_a3a70f8b621474c9885f80fe709e2dca2a33ea0e1f7bfae51389ad84743f882dfe}{Env::CREATE\_OR\_OPEN\_WITH\_TRUNCATE}};}
\DoxyCodeLine{00297\ \};}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_random_access_file}{RandomAccessFile}}\ \{}
\DoxyCodeLine{00300\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00301\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_random_access_file_ab96641a712f71d456cc41d71c8655f2f}{RandomAccessFile}}()\ \{\}}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_random_access_file_a058c8564b670241853bc2e5e803f6bc1}{\string~RandomAccessFile}}()\ \{\}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{comment}{//\ Read\ "{}result.size"{}\ bytes\ from\ the\ file\ starting\ at\ "{}offset"{}.}}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{comment}{//\ Copies\ the\ resulting\ data\ into\ "{}result.data"{}.}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{comment}{//\ If\ an\ error\ was\ encountered,\ returns\ a\ non-\/OK\ status.}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{comment}{//\ This\ method\ will\ internally\ retry\ on\ EINTR\ and\ "{}short\ reads"{}\ in\ order\ to}}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{comment}{//\ fully\ read\ the\ requested\ number\ of\ bytes.\ In\ the\ event\ that\ it\ is\ not}}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ possible\ to\ read\ exactly\ 'length'\ bytes,\ an\ IOError\ is\ returned.}}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{comment}{//\ Safe\ for\ concurrent\ use\ by\ multiple\ threads.}}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_access_file_a764325a21f5e8709eef1ac05277ade02}{read\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}*\ result)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{comment}{//\ Reads\ up\ to\ the\ "{}results"{}\ aggregate\ size,\ based\ on\ each\ Slice's\ "{}size"{},}}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ from\ the\ file\ starting\ at\ 'offset'.\ The\ Slices\ must\ point\ to\ already-\/allocated}}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{comment}{//\ buffers\ for\ the\ data\ to\ be\ written\ to.}}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{comment}{//\ If\ an\ error\ was\ encountered,\ returns\ a\ non-\/OK\ status.}}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{comment}{//\ This\ method\ will\ internally\ retry\ on\ EINTR\ and\ "{}short\ reads"{}\ in\ order\ to}}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{comment}{//\ fully\ read\ the\ requested\ number\ of\ bytes.\ In\ the\ event\ that\ it\ is\ not}}
\DoxyCodeLine{00324\ \ \ \ \ \textcolor{comment}{//\ possible\ to\ read\ exactly\ 'length'\ bytes,\ an\ IOError\ is\ returned.}}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{comment}{//\ Safe\ for\ concurrent\ use\ by\ multiple\ threads.}}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_access_file_a79912a524d7b996247b29bcd23e8d71e}{readv\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}*\ result,\ \textcolor{keywordtype}{size\_t}\ res\_cnt)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ read\ all\ data\ from\ this\ file}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_access_file_a72b096a2bdf546a1531de27afa424a0f}{read\_all}}(std::string*\ content)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ size\ of\ this\ file}}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_access_file_ab2c4cac4b7848043e36fea546b697df9}{size}}(uint64\_t*\ \mbox{\hyperlink{classdoris_1_1_random_access_file_ab2c4cac4b7848043e36fea546b697df9}{size}})\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ Return\ name\ of\ this\ file}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_random_access_file_a6492ce504e1d83771c3fe0b2c2a416ce}{file\_name}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00337\ \};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{comment}{//\ A\ file\ abstraction\ for\ sequential\ writing.\ \ The\ implementation}}
\DoxyCodeLine{00340\ \textcolor{comment}{//\ must\ provide\ buffering\ since\ callers\ may\ append\ small\ fragments}}
\DoxyCodeLine{00341\ \textcolor{comment}{//\ at\ a\ time\ to\ the\ file.}}
\DoxyCodeLine{00342\ \textcolor{comment}{//\ Note:\ To\ avoid\ user\ misuse,\ WritableFile's\ API\ should\ support\ only}}
\DoxyCodeLine{00343\ \textcolor{comment}{//\ one\ of\ Append\ or\ PositionedAppend.\ We\ support\ only\ Append\ here.}}
\DoxyCodeLine{00344\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_writable_file}{WritableFile}}\ \{}
\DoxyCodeLine{00345\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a176a9bfd7c7126426a83ca4b5408d134}{FlushMode}}\ \{\ \mbox{\hyperlink{classdoris_1_1_writable_file_a176a9bfd7c7126426a83ca4b5408d134a3ab77f1cd21d2b4f105c971d05055a33}{FLUSH\_SYNC}},\ \mbox{\hyperlink{classdoris_1_1_writable_file_a176a9bfd7c7126426a83ca4b5408d134a467d2409c908b1e05707ecff17bab8d9}{FLUSH\_ASYNC}}\ \};}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_writable_file_a168e8d0d5f00284bf6f0a2f8fbe61866}{WritableFile}}()\ \{\}}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_writable_file_ac322276c91d8fe237c1389cba6861d53}{\string~WritableFile}}()\ \{\}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{comment}{//\ Append\ data\ to\ the\ end\ of\ the\ file}}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a5d3d04f5ec3472e549df04b1201a1598}{append}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}})\ =\ 0;}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{comment}{//\ If\ possible,\ uses\ scatter-\/gather\ I/O\ to\ efficiently\ append}}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{comment}{//\ multiple\ buffers\ to\ a\ file.\ Otherwise,\ falls\ back\ to\ regular\ I/O.}}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{comment}{//\ For\ implementation\ specific\ quirks\ and\ details,\ see\ comments\ in}}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{comment}{//\ implementation\ source\ code\ (e.g.,\ env\_posix.cc)}}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a4ce63c54e3b62bc3b31f7b62d59d90ef}{appendv}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}*\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ \textcolor{keywordtype}{size\_t}\ cnt)\ =\ 0;}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{comment}{//\ Pre-\/allocates\ 'size'\ bytes\ for\ the\ file\ in\ the\ underlying\ filesystem.}}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ size\ bytes\ are\ added\ to\ the\ current\ pre-\/allocated\ size\ or\ to\ the\ current}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ offset,\ whichever\ is\ bigger.\ In\ no\ case\ is\ the\ file\ truncated\ by\ this}}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ operation.}}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{comment}{//\ On\ some\ implementations,\ preallocation\ is\ done\ without\ initializing\ the}}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{comment}{//\ contents\ of\ the\ data\ blocks\ (as\ opposed\ to\ writing\ zeroes),\ requiring\ no}}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{comment}{//\ IO\ to\ the\ data\ blocks.}}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{comment}{//\ In\ no\ case\ is\ the\ file\ truncated\ by\ this\ operation.}}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a7c1a8b60da472df6d490b658dd43210e}{pre\_allocate}}(uint64\_t\ \mbox{\hyperlink{classdoris_1_1_writable_file_ad6e91c334a35c6b6398de28ccbfaece2}{size}})\ =\ 0;}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a864be434d994c154c0fa5c0291f3e7eb}{close}}()\ =\ 0;}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{comment}{//\ Flush\ all\ dirty\ data\ (not\ metadata)\ to\ disk.}}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{comment}{//\ If\ the\ flush\ mode\ is\ synchronous,\ will\ wait\ for\ flush\ to\ finish\ and}}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{comment}{//\ return\ a\ meaningful\ status.}}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_afe6d15b35cfb3713222a4816f6f257f0}{flush}}(\mbox{\hyperlink{classdoris_1_1_writable_file_a176a9bfd7c7126426a83ca4b5408d134}{FlushMode}}\ mode)\ =\ 0;}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_writable_file_ab61da2a1f0b285bd63ea52a4badf1a2b}{sync}}()\ =\ 0;}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keyword}{virtual}\ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_writable_file_ad6e91c334a35c6b6398de28ccbfaece2}{size}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ filename\ provided\ when\ the\ WritableFile\ was\ constructed.}}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_writable_file_a90066f4846fa7a8a82efe9ae477b280e}{filename}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ No\ copying\ allowed}}
\DoxyCodeLine{00390\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_writable_file_ac1021ca45798ce4f64922b6d50c6005b}{WritableFile}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_writable_file}{WritableFile}}\&);}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_writable_file_a0415b8960ac3742d401c9e7cbf59fa16}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_writable_file}{WritableFile}}\&);}
\DoxyCodeLine{00392\ \};}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{comment}{//\ A\ file\ abstraction\ for\ random\ reading\ and\ writing.}}
\DoxyCodeLine{00395\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_random_r_w_file}{RandomRWFile}}\ \{}
\DoxyCodeLine{00396\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a176a9bfd7c7126426a83ca4b5408d134}{FlushMode}}\ \{\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a176a9bfd7c7126426a83ca4b5408d134a3ab77f1cd21d2b4f105c971d05055a33}{FLUSH\_SYNC}},\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a176a9bfd7c7126426a83ca4b5408d134a467d2409c908b1e05707ecff17bab8d9}{FLUSH\_ASYNC}}\ \};}
\DoxyCodeLine{00398\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a81baf18f1ffb9f2c2c6303e709eb51bd}{RandomRWFile}}()\ \{\}}
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a3b00da486aea0d12cd55835f1a68b985}{\string~RandomRWFile}}()\ \{\}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a05bb3f25dd4e075bef92cc29f692f50f}{read\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ result)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_ab4d94cfd51fa296ccfa1bd19c10fa0d1}{readv\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}*\ res,\ \textcolor{keywordtype}{size\_t}\ res\_cnt)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a1a6cc0cedb7b4e1e0d85479d83f212ac}{write\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}})\ =\ 0;}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_affa9c91b24139a2b0a3247617e44f2b0}{writev\_at}}(uint64\_t\ offset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}*\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ \textcolor{keywordtype}{size\_t}\ data\_cnt)\ =\ 0;}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a62bb54dc25a714821f66acff9c1a27a7}{flush}}(\mbox{\hyperlink{classdoris_1_1_random_r_w_file_a176a9bfd7c7126426a83ca4b5408d134}{FlushMode}}\ mode,\ uint64\_t\ offset,\ \textcolor{keywordtype}{size\_t}\ length)\ =\ 0;}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_ab61da2a1f0b285bd63ea52a4badf1a2b}{sync}}()\ =\ 0;}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a864be434d994c154c0fa5c0291f3e7eb}{close}}()\ =\ 0;}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_ab2c4cac4b7848043e36fea546b697df9}{size}}(uint64\_t*\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_ab2c4cac4b7848043e36fea546b697df9}{size}})\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_random_r_w_file_a90066f4846fa7a8a82efe9ae477b280e}{filename}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00417\ \};}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
