\hypertarget{charset_8h_source}{}\doxysection{charset.\+h}
\label{charset_8h_source}\index{/Users/dabowang/be\_all/gutil/strings/charset.h@{/Users/dabowang/be\_all/gutil/strings/charset.h}}
\mbox{\hyperlink{charset_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ 2008\ Google\ Inc.\ All\ Rights\ Reserved.}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{integral__types_8h}{gutil/integral\_types.h}}"{}}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacestrings}{strings}}\ \{}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{//\ A\ CharSet\ is\ a\ simple\ map\ from\ (1-\/byte)\ characters\ to\ Booleans.\ It\ simply}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ exposes\ the\ mechanism\ of\ checking\ if\ a\ given\ character\ is\ in\ the\ set,\ fairly}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ efficiently.\ Useful\ for\ string\ tokenizing\ routines.}}
\DoxyCodeLine{00012\ \textcolor{comment}{//}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ Run\ on\ asherah\ (2\ X\ 2400\ MHz\ CPUs);\ 2008/11/10-\/13:18:03}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ CPU:\ Intel\ Core2\ (2\ cores)\ dL1:32KB\ dL2:4096KB}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ ***WARNING***\ CPU\ scaling\ is\ enabled,\ the\ benchmark\ timings\ may\ be\ noisy,}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Benchmark\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Time(ns)\ \ \ \ CPU(ns)\ Iterations}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ BM\_CharSetTesting/1K\ \ \ \ \ \ \ \ \ \ \ 21\ \ \ \ \ \ \ \ \ 21\ \ \ 32563138}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ BM\_CharSetTesting/4K\ \ \ \ \ \ \ \ \ \ \ 21\ \ \ \ \ \ \ \ \ 21\ \ \ 31968433}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ BM\_CharSetTesting/32K\ \ \ \ \ \ \ \ \ \ 21\ \ \ \ \ \ \ \ \ 21\ \ \ 32114953}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ BM\_CharSetTesting/256K\ \ \ \ \ \ \ \ \ 22\ \ \ \ \ \ \ \ \ 22\ \ \ 31679082}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ BM\_CharSetTesting/1M\ \ \ \ \ \ \ \ \ \ \ 21\ \ \ \ \ \ \ \ \ 21\ \ \ 32563138}}
\DoxyCodeLine{00023\ \textcolor{comment}{//}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ This\ class\ is\ thread-\/compatible.}}
\DoxyCodeLine{00025\ \textcolor{comment}{//}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ This\ class\ has\ an\ implicit\ constructor.}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ Style\ guide\ exception\ granted:}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ http://goto/style-\/guide-\/exception-\/20978288}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classstrings_1_1_char_set}{CharSet}}\ \{}
\DoxyCodeLine{00031\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ Initialize\ a\ CharSet\ containing\ no\ characters\ or\ the\ given\ set\ of}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ characters,\ respectively.}}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classstrings_1_1_char_set_abb991af17ccb9d6090105acc7924f02e}{CharSet}}();}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{comment}{//\ Deliberately\ an\ implicit\ constructor,\ so\ anything\ that\ takes\ a\ CharSet}}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{comment}{//\ can\ also\ take\ an\ explicit\ list\ of\ characters.}}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classstrings_1_1_char_set_abb991af17ccb9d6090105acc7924f02e}{CharSet}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ characters);\ \textcolor{comment}{//\ NOLINT(runtime/explicit)}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classstrings_1_1_char_set_abb991af17ccb9d6090105acc7924f02e}{CharSet}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classstrings_1_1_char_set}{CharSet}}\&\ other);}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//\ Add\ or\ remove\ a\ character\ from\ the\ set.}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classstrings_1_1_char_set_a2684991b76da510eb8e83a1636339a1b}{Add}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c)\ \{\ \mbox{\hyperlink{classstrings_1_1_char_set_aafd20d9f3a0b77368e4d954ac2569a5e}{bits\_}}[\mbox{\hyperlink{classstrings_1_1_char_set_a2bcdbb9a5b19c077e3d84865e1fcc416}{Word}}(c)]\ |=\ \mbox{\hyperlink{classstrings_1_1_char_set_a2dd7a49d863d0bdf67e75c1dd3db28ca}{BitMask}}(c);\ \}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classstrings_1_1_char_set_a9044236e9845c23e35130bc3344a4648}{Remove}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c)\ \{\ \mbox{\hyperlink{classstrings_1_1_char_set_aafd20d9f3a0b77368e4d954ac2569a5e}{bits\_}}[\mbox{\hyperlink{classstrings_1_1_char_set_a2bcdbb9a5b19c077e3d84865e1fcc416}{Word}}(c)]\ \&=\ \string~BitMask(c);\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ Return\ true\ if\ this\ character\ is\ in\ the\ set}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classstrings_1_1_char_set_ad8cbe0715dc4d1b73c87868c4cf40ba9}{Test}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classstrings_1_1_char_set_aafd20d9f3a0b77368e4d954ac2569a5e}{bits\_}}[\mbox{\hyperlink{classstrings_1_1_char_set_a2bcdbb9a5b19c077e3d84865e1fcc416}{Word}}(c)]\ \&\ \mbox{\hyperlink{classstrings_1_1_char_set_a2dd7a49d863d0bdf67e75c1dd3db28ca}{BitMask}}(c);\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ The\ numbers\ below\ are\ optimized\ for\ 64-\/bit\ hardware.\ TODO(user):\ In\ the}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ future,\ we\ should\ change\ this\ to\ use\ uword\_t\ and\ do\ various\ bits\ of\ magic}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ to\ calculate\ the\ numbers\ at\ compile\ time.}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ In\ general,}}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ static\ const\ int\ kNumWords\ =\ max(32\ /\ sizeof(uword\_t),\ 1);}}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{classstrings_1_1_char_set_aafd20d9f3a0b77368e4d954ac2569a5e}{bits\_}}[4];}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ 4\ words\ =>\ the\ high\ 2\ bits\ of\ c\ are\ the\ word\ number.\ In\ general,}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ kShiftValue\ =\ 8\ -\/\ log2(kNumWords)}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classstrings_1_1_char_set_a2bcdbb9a5b19c077e3d84865e1fcc416}{Word}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c)\ \{\ \textcolor{keywordflow}{return}\ c\ >>\ 6;\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ And\ the\ value\ we\ AND\ with\ c\ is\ ((1\ <<\ shift\ value)\ -\/\ 1)}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ static\ const\ int\ kLowBitsMask\ =\ (256\ /\ kNumWords)\ -\/\ 1;}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{classstrings_1_1_char_set_a2dd7a49d863d0bdf67e75c1dd3db28ca}{BitMask}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ mask\ =\ 1;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mask\ <<\ (c\ \&\ 0x3f);}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \}\ \textcolor{comment}{//\ namespace\ strings}}

\end{DoxyCode}
