\hypertarget{aggregate__function__java__udaf_8h}{}\doxysection{/\+Users/dabowang/be\+\_\+all/vec/aggregate\+\_\+functions/aggregate\+\_\+function\+\_\+java\+\_\+udaf.h 文件参考}
\label{aggregate__function__java__udaf_8h}\index{/Users/dabowang/be\_all/vec/aggregate\_functions/aggregate\_function\_java\_udaf.h@{/Users/dabowang/be\_all/vec/aggregate\_functions/aggregate\_function\_java\_udaf.h}}
{\ttfamily \#include $<$jni.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$cstdint$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
{\ttfamily \#include \char`\"{}common/status.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}gutil/strings/substitute.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}runtime/user\+\_\+function\+\_\+cache.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}util/jni-\/util.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/aggregate\+\_\+functions/aggregate\+\_\+function.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/columns/column\+\_\+string.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/string\+\_\+ref.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/core/field.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/core/types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/io/io\+\_\+helper.\+h\char`\"{}}\newline
aggregate\+\_\+function\+\_\+java\+\_\+udaf.\+h 的引用(Include)关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/d20/aggregate__function__java__udaf_8h__incl}
\end{center}
\end{figure}
此图展示该文件直接或间接的被哪些文件引用了\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=238pt]{db/dcc/aggregate__function__java__udaf_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structdoris_1_1vectorized_1_1_aggregate_java_udaf_data}{Aggregate\+Java\+Udaf\+Data}}
\item 
class \mbox{\hyperlink{classdoris_1_1vectorized_1_1_aggregate_java_udaf}{Aggregate\+Java\+Udaf}}
\end{DoxyCompactItemize}
\doxysubsection*{命名空间}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacedoris}{doris}}
\begin{DoxyCompactList}\small\item\em Utilities for collecting timings. \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacedoris_1_1vectorized}{doris\+::vectorized}}
\begin{DoxyCompactList}\small\item\em Common helper methods for implementation of different columns. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{aggregate__function__java__udaf_8h_acfad49dbee2c25f7851a0ad92d6af30e}{EVALUATE\+\_\+\+JAVA\+\_\+\+UDAF}}
\end{DoxyCompactItemize}
\doxysubsection*{变量}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_af80f1918e0effe07c35a42001382ba93}{UDAF\+\_\+\+EXECUTOR\+\_\+\+CLASS}} = \char`\"{}org/apache/doris/udf/Udaf\+Executor\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a22284d4ad47522c8c413cb217815e277}{UDAF\+\_\+\+EXECUTOR\+\_\+\+CTOR\+\_\+\+SIGNATURE}} = \char`\"{}(\mbox{[}B)V\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a9f158e6b26314fda63450cafa36bbd0d}{UDAF\+\_\+\+EXECUTOR\+\_\+\+CLOSE\+\_\+\+SIGNATURE}} = \char`\"{}()V\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_aca595176fe93d8ab2ded6e10a14148e9}{UDAF\+\_\+\+EXECUTOR\+\_\+\+DESTROY\+\_\+\+SIGNATURE}} = \char`\"{}()V\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a8ad2f420e459289db3f46a932d7066c8}{UDAF\+\_\+\+EXECUTOR\+\_\+\+ADD\+\_\+\+SIGNATURE}} = \char`\"{}(ZJJ)V\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a00467dfaa5312f39e0b0ec6f922e3525}{UDAF\+\_\+\+EXECUTOR\+\_\+\+SERIALIZE\+\_\+\+SIGNATURE}} = \char`\"{}(J)\mbox{[}B\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21e162524239c1373c6299aff07c8bb1}{UDAF\+\_\+\+EXECUTOR\+\_\+\+MERGE\+\_\+\+SIGNATURE}} = \char`\"{}(J\mbox{[}\mbox{\hyperlink{log_8c_a111da81ae5883147168bbb8366377b10}{B}})V\char`\"{}
\item 
const char $\ast$ \mbox{\hyperlink{namespacedoris_1_1vectorized_a956129ab6dd2cb5d4f2d39505887dbd4}{UDAF\+\_\+\+EXECUTOR\+\_\+\+RESULT\+\_\+\+SIGNATURE}} = \char`\"{}(JJ)Z\char`\"{}
\end{DoxyCompactItemize}


\doxysubsection{宏定义说明}
\mbox{\Hypertarget{aggregate__function__java__udaf_8h_acfad49dbee2c25f7851a0ad92d6af30e}\label{aggregate__function__java__udaf_8h_acfad49dbee2c25f7851a0ad92d6af30e}} 
\index{aggregate\_function\_java\_udaf.h@{aggregate\_function\_java\_udaf.h}!EVALUATE\_JAVA\_UDAF@{EVALUATE\_JAVA\_UDAF}}
\index{EVALUATE\_JAVA\_UDAF@{EVALUATE\_JAVA\_UDAF}!aggregate\_function\_java\_udaf.h@{aggregate\_function\_java\_udaf.h}}
\doxysubsubsection{\texorpdfstring{EVALUATE\_JAVA\_UDAF}{EVALUATE\_JAVA\_UDAF}}
{\footnotesize\ttfamily \#define EVALUATE\+\_\+\+JAVA\+\_\+\+UDAF}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (data\_col.is\_column\_string())\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ColumnString*\ str\_col\ =\ check\_and\_get\_column<ColumnString>(data\_col);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ColumnString::Chars\&\ chars\ =\ \textcolor{keyword}{const\_cast<}ColumnString::Chars\&\textcolor{keyword}{>}(str\_col-\/>get\_chars());\ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ ColumnString::Offsets\&\ offsets\ =\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ const\_cast<ColumnString::Offsets\&>(str\_col-\/>get\_offsets());\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ increase\_buffer\_size\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ int32\_t\ buffer\_size\ =\ JniUtil::IncreaseReservedBufferSize(increase\_buffer\_size);\ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ chars.resize(buffer\_size);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ *output\_value\_buffer\ =\ \textcolor{keyword}{reinterpret\_cast<}int64\_t\textcolor{keyword}{>}(chars.data());\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ *output\_offsets\_ptr\ =\ \textcolor{keyword}{reinterpret\_cast<}int64\_t\textcolor{keyword}{>}(offsets.data());\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ *output\_intermediate\_state\_ptr\ =\ chars.size();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ jboolean\ res\ =\ env-\/>CallNonvirtualBooleanMethod(executor\_obj,\ executor\_cl,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ executor\_result\_id,\ to.size()\ -\/\ 1,\ place);\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ while\ (res\ !=\ JNI\_TRUE)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ increase\_buffer\_size++;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ buffer\_size\ =\ JniUtil::IncreaseReservedBufferSize(increase\_buffer\_size);\ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ chars.resize(buffer\_size);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ *output\_value\_buffer\ =\ \textcolor{keyword}{reinterpret\_cast<}int64\_t\textcolor{keyword}{>}(chars.data());\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ *output\_intermediate\_state\_ptr\ =\ chars.size();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ res\ =\ env-\/>CallNonvirtualBooleanMethod(executor\_obj,\ executor\_cl,\ executor\_result\_id,\ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to.size()\ -\/\ 1,\ place);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (data\_col.is\_numeric()\ ||\ data\_col.is\_column\_decimal())\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ *output\_value\_buffer\ =\ \textcolor{keyword}{reinterpret\_cast<}int64\_t\textcolor{keyword}{>}(data\_col.get\_raw\_data().data);\ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ env-\/>CallNonvirtualBooleanMethod(executor\_obj,\ executor\_cl,\ executor\_result\_id,\ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to.size()\ -\/\ 1,\ place);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::InvalidArgument(\mbox{\hyperlink{namespacestrings_a4f3ca92d957daf4bd11169509bdb79ef}{strings::Substitute}}(\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Java\ UDAF\ doesn't\ support\ return\ type\ is\ \$0\ now\ !"{}},\ result\_type-\/>get\_name()));\ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}}

\end{DoxyCode}
