\hypertarget{classdoris_1_1_volnitsky_base}{}\doxysection{Volnitsky\+Base\texorpdfstring{$<$}{<} Case\+Sensitive, ASCII, Fallback\+Searcher \texorpdfstring{$>$}{>} 模板类 参考}
\label{classdoris_1_1_volnitsky_base}\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}


{\ttfamily \#include $<$volnitsky.\+h$>$}

\doxysubsection*{Public 类型}
\begin{DoxyCompactItemize}
\item 
using \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a0e273c3b143eb117aa256c31867a4016}{Searcher}} = Fallback\+Searcher
\end{DoxyCompactItemize}
\doxysubsection*{Public 成员函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdoris_1_1_volnitsky_base_a43580485c049028abb0cb2af5e8faed1}{Volnitsky\+Base}} (const char $\ast$const needle\+\_\+, const size\+\_\+t needle\+\_\+size\+\_\+, size\+\_\+t haystack\+\_\+size\+\_\+hint=0)
\item 
const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$ \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a0e2c3c5d3d54d5a865b2c426968814ec}{search}} (const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$const haystack, const size\+\_\+t haystack\+\_\+size) const
\begin{DoxyCompactList}\small\item\em If not found, the end of the haystack is returned. \end{DoxyCompactList}\item 
const char $\ast$ \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac4b57462fe195293df2213bbfbee517d}{search}} (const char $\ast$haystack, size\+\_\+t haystack\+\_\+size) const
\end{DoxyCompactItemize}
\doxysubsection*{Protected 成员函数}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a5dd8a6e52d1152338d58c930b5d9f851}{put\+NGram\+Base}} (const \mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_a2c8aec128b5de8c15e4b5912dd60b720}{Volnitsky\+Traits\+::\+Ngram}} ngram, const int offset)
\end{DoxyCompactItemize}
\doxysubsection*{Protected 属性}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$ \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a066c5ae8dfcf4e56bd1d07b3f7ebe023}{needle}}
\item 
size\+\_\+t \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}{needle\+\_\+size}}
\item 
const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$ \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a63aaa7b1f63b42b26631b4ca301f6577}{needle\+\_\+end}} = \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a066c5ae8dfcf4e56bd1d07b3f7ebe023}{needle}} + \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}{needle\+\_\+size}}
\item 
size\+\_\+t \mbox{\hyperlink{classdoris_1_1_volnitsky_base_aa4d697c762fb380a0b8af7043dea701b}{step}} = \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}{needle\+\_\+size}} -\/ sizeof(\mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_a2c8aec128b5de8c15e4b5912dd60b720}{Volnitsky\+Traits\+::\+Ngram}}) + 1
\begin{DoxyCompactList}\small\item\em For how long we move, if the n-\/gram from haystack is not found in the hash table. \end{DoxyCompactList}\item 
std\+::unique\+\_\+ptr$<$ \mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_af1be2513bce0c752816a174c0489f992}{Volnitsky\+Traits\+::\+Offset}}\mbox{[}$\,$\mbox{]}$>$ \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a2b3a83e65c25aee60ac88804dd1c491d}{hash}}
\item 
bool \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a912a01c1a45a1b5ac103bcd7fab6cd45}{fallback}}
\begin{DoxyCompactList}\small\item\em Hash table. \end{DoxyCompactList}\item 
Fallback\+Searcher \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a97b2a710d147aa252a4e11d7975de7c6}{fallback\+\_\+searcher}}
\begin{DoxyCompactList}\small\item\em Do we need to use the fallback algorithm. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
\subsubsection*{template$<$bool Case\+Sensitive, bool ASCII, typename Fallback\+Searcher$>$\newline
class doris\+::\+Volnitsky\+Base$<$ Case\+Sensitive, ASCII, Fallback\+Searcher $>$}
\begin{DoxyRefDesc}{待办事项}
\item[\mbox{\hyperlink{todo__todo000001}{待办事项}}]store lowercase needle to speed up in case there are numerous occurrences of bigrams from needle in haystack \end{DoxyRefDesc}


\doxysubsection{成员类型定义说明}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a0e273c3b143eb117aa256c31867a4016}\label{classdoris_1_1_volnitsky_base_a0e273c3b143eb117aa256c31867a4016}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!Searcher@{Searcher}}
\index{Searcher@{Searcher}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{Searcher}{Searcher}}
{\footnotesize\ttfamily using \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a0e273c3b143eb117aa256c31867a4016}{Searcher}} =  Fallback\+Searcher}



\doxysubsection{构造及析构函数说明}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a43580485c049028abb0cb2af5e8faed1}\label{classdoris_1_1_volnitsky_base_a43580485c049028abb0cb2af5e8faed1}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!VolnitskyBase@{VolnitskyBase}}
\index{VolnitskyBase@{VolnitskyBase}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{VolnitskyBase()}{VolnitskyBase()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classdoris_1_1_volnitsky_base}{Volnitsky\+Base}} (\begin{DoxyParamCaption}\item[{const char $\ast$const}]{needle\+\_\+,  }\item[{const size\+\_\+t}]{needle\+\_\+size\+\_\+,  }\item[{size\+\_\+t}]{haystack\+\_\+size\+\_\+hint = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

haystack\+\_\+size\+\_\+hint -\/ the expected total size of the haystack for {\ttfamily search} calls. Optional (zero means unspecified). If you specify it small enough, the fallback algorithm will be used, since it is considered that it\textquotesingle{}s useless to waste time initializing the hash table. ssize\+\_\+t is used here because unsigned can\textquotesingle{}t be used with condition like {\ttfamily i \texorpdfstring{$>$}{>}= 0}, unsigned always \texorpdfstring{$>$}{>}= 0 And also adding from the end guarantees that we will find first occurrence because we will lookup bigger offsets first.

{\ttfamily put\+NGram\+UTF8\+Case\+Insensitive} does not work if characters with lower and upper cases are represented by different number of bytes or code points. So, use fallback if error occurred.函数调用图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{d5/d84/classdoris_1_1_volnitsky_base_a43580485c049028abb0cb2af5e8faed1_cgraph}
\end{center}
\end{figure}


\doxysubsection{成员函数说明}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a0e2c3c5d3d54d5a865b2c426968814ec}\label{classdoris_1_1_volnitsky_base_a0e2c3c5d3d54d5a865b2c426968814ec}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!search@{search}}
\index{search@{search}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{search()}{search()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$ search (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}} $\ast$const}]{haystack,  }\item[{const size\+\_\+t}]{haystack\+\_\+size }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



If not found, the end of the haystack is returned. 

Let\textquotesingle{}s \char`\"{}apply\char`\"{} the needle to the haystack and compare the n-\/gram from the end of the needle.

We look at all the cells of the hash table that can correspond to the n-\/gram from haystack.

When found -\/ compare bytewise, using the offset from the hash table.

pointer in the code is always padded array so we can use pagesafe semantics函数调用图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{d5/d84/classdoris_1_1_volnitsky_base_a0e2c3c5d3d54d5a865b2c426968814ec_cgraph}
\end{center}
\end{figure}
这是这个函数的调用关系图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=208pt]{d5/d84/classdoris_1_1_volnitsky_base_a0e2c3c5d3d54d5a865b2c426968814ec_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_ac4b57462fe195293df2213bbfbee517d}\label{classdoris_1_1_volnitsky_base_ac4b57462fe195293df2213bbfbee517d}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!search@{search}}
\index{search@{search}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{search()}{search()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily const char $\ast$ search (\begin{DoxyParamCaption}\item[{const char $\ast$}]{haystack,  }\item[{size\+\_\+t}]{haystack\+\_\+size }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}

函数调用图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/d84/classdoris_1_1_volnitsky_base_ac4b57462fe195293df2213bbfbee517d_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a5dd8a6e52d1152338d58c930b5d9f851}\label{classdoris_1_1_volnitsky_base_a5dd8a6e52d1152338d58c930b5d9f851}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!putNGramBase@{putNGramBase}}
\index{putNGramBase@{putNGramBase}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{putNGramBase()}{putNGramBase()}}
{\footnotesize\ttfamily void put\+NGram\+Base (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_a2c8aec128b5de8c15e4b5912dd60b720}{Volnitsky\+Traits\+::\+Ngram}}}]{ngram,  }\item[{const int}]{offset }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}

Put the offset for the n-\/gram in the corresponding cell or the nearest free cell.

Search for the next free cell.这是这个函数的调用关系图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{d5/d84/classdoris_1_1_volnitsky_base_a5dd8a6e52d1152338d58c930b5d9f851_icgraph}
\end{center}
\end{figure}


\doxysubsection{类成员变量说明}
\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a066c5ae8dfcf4e56bd1d07b3f7ebe023}\label{classdoris_1_1_volnitsky_base_a066c5ae8dfcf4e56bd1d07b3f7ebe023}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!needle@{needle}}
\index{needle@{needle}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{needle}{needle}}
{\footnotesize\ttfamily const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}}$\ast$ needle\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}\label{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!needle\_size@{needle\_size}}
\index{needle\_size@{needle\_size}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{needle\_size}{needle\_size}}
{\footnotesize\ttfamily size\+\_\+t needle\+\_\+size\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a63aaa7b1f63b42b26631b4ca301f6577}\label{classdoris_1_1_volnitsky_base_a63aaa7b1f63b42b26631b4ca301f6577}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!needle\_end@{needle\_end}}
\index{needle\_end@{needle\_end}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{needle\_end}{needle\_end}}
{\footnotesize\ttfamily const \mbox{\hyperlink{namespacedoris_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}}$\ast$ needle\+\_\+end = \mbox{\hyperlink{classdoris_1_1_volnitsky_base_a066c5ae8dfcf4e56bd1d07b3f7ebe023}{needle}} + \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}{needle\+\_\+size}}\hspace{0.3cm}{\ttfamily [protected]}}

\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_aa4d697c762fb380a0b8af7043dea701b}\label{classdoris_1_1_volnitsky_base_aa4d697c762fb380a0b8af7043dea701b}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!step@{step}}
\index{step@{step}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{step}{step}}
{\footnotesize\ttfamily size\+\_\+t step = \mbox{\hyperlink{classdoris_1_1_volnitsky_base_ac0d173c16e65473deb24d426137c4595}{needle\+\_\+size}} -\/ sizeof(\mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_a2c8aec128b5de8c15e4b5912dd60b720}{Volnitsky\+Traits\+::\+Ngram}}) + 1\hspace{0.3cm}{\ttfamily [protected]}}



For how long we move, if the n-\/gram from haystack is not found in the hash table. 

\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a2b3a83e65c25aee60ac88804dd1c491d}\label{classdoris_1_1_volnitsky_base_a2b3a83e65c25aee60ac88804dd1c491d}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!hash@{hash}}
\index{hash@{hash}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{hash}{hash}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$\mbox{\hyperlink{namespacedoris_1_1_volnitsky_traits_af1be2513bce0c752816a174c0489f992}{Volnitsky\+Traits\+::\+Offset}}\mbox{[}$\,$\mbox{]}$>$ hash\hspace{0.3cm}{\ttfamily [protected]}}

max needle length is 255, max distinct ngrams for case-\/sensitive is (255 -\/ 1), case-\/insensitive is 4 $\ast$ (255 -\/ 1) storage of 64K ngrams (n = 2, 128 KB) should be large enough for both cases \mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a912a01c1a45a1b5ac103bcd7fab6cd45}\label{classdoris_1_1_volnitsky_base_a912a01c1a45a1b5ac103bcd7fab6cd45}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!fallback@{fallback}}
\index{fallback@{fallback}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{fallback}{fallback}}
{\footnotesize\ttfamily bool fallback\hspace{0.3cm}{\ttfamily [protected]}}



Hash table. 

\mbox{\Hypertarget{classdoris_1_1_volnitsky_base_a97b2a710d147aa252a4e11d7975de7c6}\label{classdoris_1_1_volnitsky_base_a97b2a710d147aa252a4e11d7975de7c6}} 
\index{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}!fallback\_searcher@{fallback\_searcher}}
\index{fallback\_searcher@{fallback\_searcher}!VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$@{VolnitskyBase$<$ CaseSensitive, ASCII, FallbackSearcher $>$}}
\doxysubsubsection{\texorpdfstring{fallback\_searcher}{fallback\_searcher}}
{\footnotesize\ttfamily Fallback\+Searcher fallback\+\_\+searcher\hspace{0.3cm}{\ttfamily [protected]}}



Do we need to use the fallback algorithm. 



该类的文档由以下文件生成\+:\begin{DoxyCompactItemize}
\item 
/\+Users/dabowang/doris/be/src/vec/common/\mbox{\hyperlink{volnitsky_8h}{volnitsky.\+h}}\end{DoxyCompactItemize}
