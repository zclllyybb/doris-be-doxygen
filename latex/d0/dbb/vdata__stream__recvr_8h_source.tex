\hypertarget{vdata__stream__recvr_8h_source}{}\doxysection{vdata\+\_\+stream\+\_\+recvr.\+h}
\label{vdata__stream__recvr_8h_source}\index{/Users/dabowang/be\_all/vec/runtime/vdata\_stream\_recvr.h@{/Users/dabowang/be\_all/vec/runtime/vdata\_stream\_recvr.h}}
\mbox{\hyperlink{vdata__stream__recvr_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <deque>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{global__types_8h}{common/global\_types.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{object__pool_8h}{common/object\_pool.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{descriptors_8h}{runtime/descriptors.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{query__statistics_8h}{runtime/query\_statistics.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{runtime__profile_8h}{util/runtime\_profile.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialize__block_8h}{vec/core/materialize\_block.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacegoogle}{google}}\ \{}
\DoxyCodeLine{00036\ \textcolor{keyword}{namespace\ }protobuf\ \{}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }Closure;}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ \}\ \textcolor{comment}{//\ namespace\ google}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00042\ \textcolor{keyword}{class\ }MemTracker;}
\DoxyCodeLine{00043\ \textcolor{keyword}{class\ }RuntimeProfile;}
\DoxyCodeLine{00044\ \textcolor{keyword}{class\ }PBlock;}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00047\ \textcolor{keyword}{class\ }Block;}
\DoxyCodeLine{00048\ \textcolor{keyword}{class\ }VDataStreamMgr;}
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }VSortedRunMerger;}
\DoxyCodeLine{00050\ \textcolor{keyword}{class\ }VExprContext;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr}{VDataStreamRecvr}}\ \{}
\DoxyCodeLine{00053\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr}{VDataStreamRecvr}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_mgr}{VDataStreamMgr}}*\ stream\_mgr,\ \mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a71a00e4c4e79f6e8b26a047a9cda64fa}{row\_desc}},}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TUniqueId\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4798bb17802cd5fd4af6a751af70f361}{fragment\_instance\_id}},\ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a5ea431e97c26d6dad6342d8e870c6c3e}{dest\_node\_id}},}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_senders,\ \textcolor{keywordtype}{bool}\ is\_merging,\ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<QueryStatisticsRecvr>\ sub\_plan\_query\_statistics\_recvr);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a56b913e88ecf8d362d1dd619f35b395d}{\string~VDataStreamRecvr}}();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_aedf6e73a4ff8a8946d052abb5172f4c2}{create\_merger}}(\textcolor{keyword}{const}\ std::vector<VExprContext*>\&\ ordering\_expr,}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<bool>\&\ is\_asc\_order,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<bool>\&\ nulls\_first,\ \textcolor{keywordtype}{size\_t}\ batch\_size,\ int64\_t\ limit,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_af059e6c544f51117f6469f8d2e76ef3a}{add\_block}}(\textcolor{keyword}{const}\ PBlock\&\ pblock,\ \textcolor{keywordtype}{int}\ sender\_id,\ \textcolor{keywordtype}{int}\ be\_number,\ int64\_t\ packet\_seq,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ::google::protobuf::Closure**\ done);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_af059e6c544f51117f6469f8d2e76ef3a}{add\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{int}\ sender\_id,\ \textcolor{keywordtype}{bool}\ use\_move);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_aa40c69d55082f06dbc5ccbca0a326cab}{ready\_to\_read}}();}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a89320523f44f56fcd4486ea505f26c92}{get\_next}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}*\ eos);}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{const}\ TUniqueId\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4798bb17802cd5fd4af6a751af70f361}{fragment\_instance\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}};\ \}}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a5ea431e97c26d6dad6342d8e870c6c3e}{dest\_node\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}};\ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a71a00e4c4e79f6e8b26a047a9cda64fa}{row\_desc}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a0480f56fef43928b30c2b610d4c7c7c9}{\_row\_desc}};\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ab3e72f6dbbf680cc5800eccbd8e030de}{add\_sub\_plan\_statistics}}(\textcolor{keyword}{const}\ PQueryStatistics\&\ statistics,\ \textcolor{keywordtype}{int}\ sender\_id)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ac17f16488ec77d7eb7fc319b2a333efd}{\_sub\_plan\_query\_statistics\_recvr}}-\/>insert(statistics,\ sender\_id);}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ Indicate\ that\ a\ particular\ sender\ is\ done.\ Delegated\ to\ the\ appropriate}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ sender\ queue.\ Called\ from\ DataStreamMgr.}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ab4afb29631a4e5bb246a4475734492b9}{remove\_sender}}(\textcolor{keywordtype}{int}\ sender\_id,\ \textcolor{keywordtype}{int}\ be\_number);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a7eee233bfa3bfa5082fbfca7009ea964}{cancel\_stream}}();}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a5ae591df94fc66ccb85cbb6565368bca}{close}}();}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a6f9d65b0b510f000e74247014689611a}{exceeds\_limit}}(\textcolor{keywordtype}{int}\ batch\_size)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a88622d55d2e7019c8d6fa001676ddf2c}{\_num\_buffered\_bytes}}\ +\ batch\_size\ >\ config::exchg\_node\_buffer\_size\_bytes;}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a8a5e6d255f86080f0f9590c64155c235}{is\_closed}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a6a7c9f0db03d1ee8f7e0e2d5a1392c2e}{\_is\_closed}};\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keyword}{class\ }SenderQueue;}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{class\ }PipSenderQueue;}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_block_supplier_sort_cursor_impl}{BlockSupplierSortCursorImpl}};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ DataStreamMgr\ instance\ used\ to\ create\ this\ recvr.\ (Not\ owned)}}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_mgr}{VDataStreamMgr}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_aadf34cc756e4e3a7adbfa07fe85b972e}{\_mgr}};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{preprocessor}{\#ifdef\ USE\_MEM\_TRACKER}}
\DoxyCodeLine{00106\ \ \ \ \ std::shared\_ptr<MemTrackerLimiter>\ \_query\_mem\_tracker;}
\DoxyCodeLine{00107\ \ \ \ \ TUniqueId\ \_query\_id;}
\DoxyCodeLine{00108\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ Fragment\ and\ node\ id\ of\ the\ destination\ exchange\ node\ this\ receiver\ is\ used\ by.}}
\DoxyCodeLine{00111\ \ \ \ \ TUniqueId\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}};}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//\ Row\ schema,\ copied\ from\ the\ caller\ of\ CreateRecvr().}}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a0480f56fef43928b30c2b610d4c7c7c9}{\_row\_desc}};}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//\ True\ if\ this\ reciver\ merges\ incoming\ rows\ from\ different\ senders.\ Per-\/sender}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ row\ batch\ queues\ are\ maintained\ in\ this\ case.}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ab05d0cfd5aab268ea51cd04f8de3eeb0}{\_is\_merging}};}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a6a7c9f0db03d1ee8f7e0e2d5a1392c2e}{\_is\_closed}};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ std::atomic<int>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a88622d55d2e7019c8d6fa001676ddf2c}{\_num\_buffered\_bytes}};}
\DoxyCodeLine{00123\ \ \ \ \ std::unique\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a589c3f7fd9800e4fd09e03c9dd12d33f}{\_mem\_tracker}};}
\DoxyCodeLine{00124\ \ \ \ \ std::vector<SenderQueue*>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_adfd0762c3afefe5410a5198014227b21}{\_sender\_queues}};}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ std::unique\_ptr<VSortedRunMerger>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a5a0adde30cb4e92a0796cb33589f72e3}{\_merger}};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_acaa447d0bd20f801767181843194fdf2}{\_sender\_queue\_pool}};}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a2e859f47407c7a031f6c1e087775e510}{\_profile}};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ae6114742e0589d4f9eabd5498c3face7}{\_bytes\_received\_counter}};}
\DoxyCodeLine{00132\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4739d6276c87c0c086377445cfaa0223}{\_local\_bytes\_received\_counter}};}
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a6850283033866475d9abf5afd753c2db}{\_deserialize\_row\_batch\_timer}};}
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a57f0767b0114a40cdf124c90725c25f3}{\_first\_batch\_wait\_total\_timer}};}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ab6158ddf3cb8ec0927a5d8ae0ec6ab55}{\_buffer\_full\_total\_timer}};}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ad39946ed7c70195829610541d01d4d7f}{\_data\_arrival\_timer}};}
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4fa7ec9d4aabb1535309b0073e4a7c2c}{\_decompress\_timer}};}
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a0c972870ade087717ef04915b0881f8e}{\_decompress\_bytes}};}
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_high_water_mark_counter}{RuntimeProfile::HighWaterMarkCounter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a64a04efdc5f5e48b328f957d85f17848}{\_blocks\_memory\_usage}};}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ std::shared\_ptr<QueryStatisticsRecvr>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_ac17f16488ec77d7eb7fc319b2a333efd}{\_sub\_plan\_query\_statistics\_recvr}};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a7d955c2894dc92551872ae32666c98d5}{\_enable\_pipeline}};}
\DoxyCodeLine{00144\ \};}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure}{ThreadClosure}}\ :\ \textcolor{keyword}{public}\ google::protobuf::Closure\ \{}
\DoxyCodeLine{00147\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure_a29139ac9719e08c506c84696ea694060}{Run}}()\textcolor{keyword}{\ override\ }\{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure_af56bf411a50a75827bda31c148e9d0ee}{\_cv}}.notify\_one();\ \}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure_a59b3df1e818272e3fa96295aeb115d52}{wait}}(std::unique\_lock<std::mutex>\&\ lock)\ \{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure_af56bf411a50a75827bda31c148e9d0ee}{\_cv}}.wait(lock);\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00152\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_thread_closure_af56bf411a50a75827bda31c148e9d0ee}{\_cv}};}
\DoxyCodeLine{00153\ \};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue}{VDataStreamRecvr::SenderQueue}}\ \{}
\DoxyCodeLine{00156\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue}{SenderQueue}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr}{VDataStreamRecvr}}*\ parent\_recvr,\ \textcolor{keywordtype}{int}\ num\_senders,\ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a3a57cd0e6c8d308d3831c1317453cc51}{\string~SenderQueue}}();}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a25bc0ec6c551af08058c2389588e19e9}{should\_wait}}();}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a9271fca1587104cbd2fb9bb74b883e55}{get\_batch}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}**\ next\_block);}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a83d2b71b68c8a947e875a349252f0fcb}{add\_block}}(\textcolor{keyword}{const}\ PBlock\&\ pblock,\ \textcolor{keywordtype}{int}\ be\_number,\ int64\_t\ packet\_seq,}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ::google::protobuf::Closure**\ done);}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a83d2b71b68c8a947e875a349252f0fcb}{add\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}\ use\_move);}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a8a1fd8221728e9c6ce146fb02a5a5a7f}{decrement\_senders}}(\textcolor{keywordtype}{int}\ sender\_id);}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a02d5fa6b14e221f3012a794b905be166}{cancel}}();}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a5ae591df94fc66ccb85cbb6565368bca}{close}}();}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a1bdfd469c5b45e6b797d994bbe6ef6a2}{current\_block}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a48d85dde77b8c1d3552cbd11f8caaf94}{\_current\_block}}.get();\ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a781f454f0731f7a47660fcea40f4ea3c}{\_update\_block\_queue\_empty}}()\ \{\}}
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a77f9b8870f03611df53ddd624ae08ad9}{\_inner\_get\_batch}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}**\ next\_block);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr}{VDataStreamRecvr}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_add34abe271b9f1e6f71c9b96e6d6914c}{\_recvr}};}
\DoxyCodeLine{00183\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a888111eeda289ae698cf8e8b92ab9d30}{\_lock}};}
\DoxyCodeLine{00184\ \ \ \ \ std::atomic\_bool\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_aa13490e19f6f2bf0a6f8a9a9d1a6573f}{\_is\_cancelled}};}
\DoxyCodeLine{00185\ \ \ \ \ std::atomic\_int\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a2f23b7fb0cc994abbc58fac78aaa028b}{\_num\_remaining\_senders}};}
\DoxyCodeLine{00186\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a3b771e8ec10a6c2cea9f1c9bf1218536}{\_data\_arrival\_cv}};}
\DoxyCodeLine{00187\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_ab9270884e9054599a7cfc2b518c28fc8}{\_data\_removal\_cv}};}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_abbba063fd6b7891487aa8767b67860e8}{VecBlockQueue}}\ =\ std::list<std::pair<int,\ Block*>>;}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_abbba063fd6b7891487aa8767b67860e8}{VecBlockQueue}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a9e91643c60465dd00ebf49e13995f927}{\_block\_queue}};}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ std::atomic\_bool\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a4c9a8859a104fc7ebc7c575e968839a6}{\_block\_queue\_empty}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ std::unique\_ptr<Block>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a48d85dde77b8c1d3552cbd11f8caaf94}{\_current\_block}};}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a30ede5e4da213d4d6cbc32c06c2275ea}{\_received\_first\_batch}};}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ sender\_id}}
\DoxyCodeLine{00198\ \ \ \ \ std::unordered\_set<int>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a447e667e7f77acaa589cfa70ab7b74e5}{\_sender\_eos\_set}};}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{comment}{//\ be\_number\ =>\ packet\_seq}}
\DoxyCodeLine{00200\ \ \ \ \ std::unordered\_map<int,\ int64\_t>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a2d4b7cd2a00e751a42eee12a5692f129}{\_packet\_seq\_map}};}
\DoxyCodeLine{00201\ \ \ \ \ std::deque<std::pair<google::protobuf::Closure*,\ MonotonicStopWatch>>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a14d061c552bb1907f9e404937948c498}{\_pending\_closures}};}
\DoxyCodeLine{00202\ \ \ \ \ std::unordered\_map<std::thread::id,\ std::unique\_ptr<ThreadClosure>>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a2299193ec5d350cd41134075367dab07}{\_local\_closure}};}
\DoxyCodeLine{00203\ \};}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue}{VDataStreamRecvr::PipSenderQueue}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue}{SenderQueue}}\ \{}
\DoxyCodeLine{00206\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a1e61ad095ce4b4a0c4edf3da867991d6}{PipSenderQueue}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr}{VDataStreamRecvr}}*\ parent\_recvr,\ \textcolor{keywordtype}{int}\ num\_senders,\ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile)}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue}{SenderQueue}}(parent\_recvr,\ num\_senders,\ profile)\ \{\}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a5a989003c084827460c3a2ad84cb0376}{should\_wait}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_aa13490e19f6f2bf0a6f8a9a9d1a6573f}{\_is\_cancelled}}\ \&\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a4c9a8859a104fc7ebc7c575e968839a6}{\_block\_queue\_empty}}\ \&\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a2f23b7fb0cc994abbc58fac78aaa028b}{\_num\_remaining\_senders}}\ >\ 0;}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a19e9f8bb017376f183cb7e13ef2818c2}{\_update\_block\_queue\_empty}}()\textcolor{keyword}{\ override\ }\{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a4c9a8859a104fc7ebc7c575e968839a6}{\_block\_queue\_empty}}\ =\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a9e91643c60465dd00ebf49e13995f927}{\_block\_queue}}.empty();\ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a69111683ce6bb9f777418d575422b982}{get\_batch}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}**\ next\_block)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ CHECK(!\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a5a989003c084827460c3a2ad84cb0376}{should\_wait}}())\ <<\ \textcolor{stringliteral}{"{}\ \_is\_cancelled:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_aa13490e19f6f2bf0a6f8a9a9d1a6573f}{\_is\_cancelled}}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ \_block\_queue\_empty:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a4c9a8859a104fc7ebc7c575e968839a6}{\_block\_queue\_empty}}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ \_num\_remaining\_senders:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a2f23b7fb0cc994abbc58fac78aaa028b}{\_num\_remaining\_senders}};}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\ l(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a888111eeda289ae698cf8e8b92ab9d30}{\_lock}});\ \textcolor{comment}{//\ protect\ \_block\_queue}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a77f9b8870f03611df53ddd624ae08ad9}{\_inner\_get\_batch}}(next\_block);}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a55f2a493bb00c309fdd5e303d37f15f3}{add\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}\ use\_move)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Avoid\ deadlock\ when\ calling\ SenderQueue::cancel()\ in\ tcmalloc\ hook,}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ limit\ memory\ via\ DataStreamRecvr::exceeds\_limit.}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{thread__context_8h_ac9a3c83af472b1f82ce6e4658fcbccb1}{STOP\_CHECK\_THREAD\_MEM\_TRACKER\_LIMIT}}();}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_aa13490e19f6f2bf0a6f8a9a9d1a6573f}{\_is\_cancelled}}\ ||\ !block-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a9be86262d8ec3739dba5e0910c2339ad}{rows}}())\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ nblock\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}(block-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a79a5eaccd78c58ebaacb39fe0d6d70eb}{get\_columns\_with\_type\_and\_name}}());}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ local\ exchange\ should\ copy\ the\ block\ contented\ if\ use\ move\ ==\ false}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (use\_move)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ block-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_ac8bb3912a3ce86b15842e79d0b421204}{clear}}();}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ rows\ =\ block-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a9be86262d8ec3739dba5e0910c2339ad}{rows}}();}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ nblock-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a08f559e5612203aeedf927d660e77b67}{columns}}();\ ++i)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nblock-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a54f8f7eae676dfa49029fff7c7ce8f05}{get\_by\_position}}(i).\mbox{\hyperlink{structdoris_1_1vectorized_1_1_column_with_type_and_name_aa89d995364ccfc1a11c2f34d08e89b2b}{column}}\ =}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nblock-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a54f8f7eae676dfa49029fff7c7ce8f05}{get\_by\_position}}(i).\mbox{\hyperlink{structdoris_1_1vectorized_1_1_column_with_type_and_name_aa89d995364ccfc1a11c2f34d08e89b2b}{column}}-\/>clone\_resized(rows);}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1vectorized_a98098b7e6a56f491ec15d797399ea226}{materialize\_block\_inplace}}(*nblock);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ block\_size\ =\ nblock-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_a3b73c6479b9490ad49b8156e14473541}{bytes}}();}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\_mem\_size\ =\ nblock-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_acd47db4f184c2a88c3c8eee3406d13db}{allocated\_bytes}}();}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ l(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a888111eeda289ae698cf8e8b92ab9d30}{\_lock}});}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a9e91643c60465dd00ebf49e13995f927}{\_block\_queue}}.emplace\_back(block\_size,\ nblock);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{runtime__profile_8h_a3c0413085db33b5cfe29ea149ed3cf0c}{COUNTER\_UPDATE}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_add34abe271b9f1e6f71c9b96e6d6914c}{\_recvr}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4739d6276c87c0c086377445cfaa0223}{\_local\_bytes\_received\_counter}},\ block\_size);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_add34abe271b9f1e6f71c9b96e6d6914c}{\_recvr}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a64a04efdc5f5e48b328f957d85f17848}{\_blocks\_memory\_usage}}-\/>\mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_high_water_mark_counter_aabe30c223f7d9d108c6b0217a1681133}{add}}(block\_mem\_size);}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_pip_sender_queue_a19e9f8bb017376f183cb7e13ef2818c2}{\_update\_block\_queue\_empty}}();}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_a3b771e8ec10a6c2cea9f1c9bf1218536}{\_data\_arrival\_cv}}.notify\_one();}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_add34abe271b9f1e6f71c9b96e6d6914c}{\_recvr}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a88622d55d2e7019c8d6fa001676ddf2c}{\_num\_buffered\_bytes}}\ +=\ block\_size;}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{runtime__profile_8h_a3c0413085db33b5cfe29ea149ed3cf0c}{COUNTER\_UPDATE}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_1_1_sender_queue_add34abe271b9f1e6f71c9b96e6d6914c}{\_recvr}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_recvr_a4739d6276c87c0c086377445cfaa0223}{\_local\_bytes\_received\_counter}},\ block\_size);}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ \};}
\DoxyCodeLine{00261\ \}\ \textcolor{comment}{//\ namespace\ vectorized}}
\DoxyCodeLine{00262\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
