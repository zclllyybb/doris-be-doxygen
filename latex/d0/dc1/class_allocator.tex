\hypertarget{class_allocator}{}\doxysection{Allocator\texorpdfstring{$<$}{<} clear\+\_\+memory\+\_\+, mmap\+\_\+populate \texorpdfstring{$>$}{>} 模板类 参考}
\label{class_allocator}\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}


{\ttfamily \#include $<$allocator.\+h$>$}



类 Allocator\texorpdfstring{$<$}{<} clear\+\_\+memory\+\_\+, mmap\+\_\+populate \texorpdfstring{$>$}{>} 继承关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/d90/class_allocator__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public 成员函数}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \mbox{\hyperlink{class_allocator_a35677db523083f8c3a508d75cd9bb77b}{alloc}} (size\+\_\+t size, size\+\_\+t alignment=0)
\begin{DoxyCompactList}\small\item\em Allocate memory range. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{class_allocator_a82e090801fb5ae0c014e85fc401bca47}{free}} (void $\ast$buf, size\+\_\+t size)
\begin{DoxyCompactList}\small\item\em Free memory range. \end{DoxyCompactList}\item 
void $\ast$ \mbox{\hyperlink{class_allocator_af48b30af68c846da954ef85a876ac5a9}{realloc}} (void $\ast$buf, size\+\_\+t old\+\_\+size, size\+\_\+t new\+\_\+size, size\+\_\+t alignment=0)
\end{DoxyCompactItemize}
\doxysubsection*{静态 Protected 成员函数}
\begin{DoxyCompactItemize}
\item 
static constexpr size\+\_\+t \mbox{\hyperlink{class_allocator_a60b3b47bca967c70d89d5bda6d5c50c0}{get\+\_\+stack\+\_\+threshold}} ()
\end{DoxyCompactItemize}
\doxysubsection*{静态 Protected 属性}
\begin{DoxyCompactItemize}
\item 
static constexpr bool \mbox{\hyperlink{class_allocator_aef026d27e574609185dcf1d047e241d6}{clear\+\_\+memory}} = clear\+\_\+memory\+\_\+
\item 
static constexpr int \mbox{\hyperlink{class_allocator_a4823c06be87da26bc7f8fd6573d7efb8}{mmap\+\_\+flags}} = MAP\+\_\+\+PRIVATE $\vert$ \mbox{\hyperlink{allocator_8h_ae4f86bff73414c5fc08c058f957212f0}{MAP\+\_\+\+ANONYMOUS}}
\end{DoxyCompactItemize}
\doxysubsection*{Private 成员函数}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \mbox{\hyperlink{class_allocator_a2e4223e7158b40f4e4c5cc08216f0a56}{get\+\_\+mmap\+\_\+hint}} ()
\end{DoxyCompactItemize}


\doxysubsection{详细描述}
\subsubsection*{template$<$bool clear\+\_\+memory\+\_\+, bool mmap\+\_\+populate$>$\newline
class Allocator$<$ clear\+\_\+memory\+\_\+, mmap\+\_\+populate $>$}
Responsible for allocating / freeing memory. Used, for example, in PODArray, Arena. Also used in hash tables. The interface is different from std\+::allocator
\begin{DoxyItemize}
\item the presence of the method realloc, which for large chunks of memory uses mremap;
\item passing the size into the {\ttfamily free} method;
\item by the presence of the {\ttfamily alignment} argument;
\item the possibility of zeroing memory (used in hash tables);
\item random hint address for mmap
\item mmap\+\_\+threshold for using mmap less or more
\end{DoxyItemize}

This file provides forward declarations for \mbox{\hyperlink{class_allocator}{Allocator}}. 

\doxysubsection{成员函数说明}
\mbox{\Hypertarget{class_allocator_a35677db523083f8c3a508d75cd9bb77b}\label{class_allocator_a35677db523083f8c3a508d75cd9bb77b}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!alloc@{alloc}}
\index{alloc@{alloc}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{alloc()}{alloc()}}
{\footnotesize\ttfamily void $\ast$ alloc (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size,  }\item[{size\+\_\+t}]{alignment = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Allocate memory range. 

No need for zero-\/fill, because mmap guarantees it.函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{d0/dc1/class_allocator_a35677db523083f8c3a508d75cd9bb77b_cgraph}
\end{center}
\end{figure}
这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_a35677db523083f8c3a508d75cd9bb77b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{class_allocator_a82e090801fb5ae0c014e85fc401bca47}\label{class_allocator_a82e090801fb5ae0c014e85fc401bca47}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!free@{free}}
\index{free@{free}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{free()}{free()}}
{\footnotesize\ttfamily void free (\begin{DoxyParamCaption}\item[{void $\ast$}]{buf,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Free memory range. 

函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_a82e090801fb5ae0c014e85fc401bca47_cgraph}
\end{center}
\end{figure}
这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_a82e090801fb5ae0c014e85fc401bca47_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{class_allocator_af48b30af68c846da954ef85a876ac5a9}\label{class_allocator_af48b30af68c846da954ef85a876ac5a9}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!realloc@{realloc}}
\index{realloc@{realloc}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{realloc()}{realloc()}}
{\footnotesize\ttfamily void $\ast$ realloc (\begin{DoxyParamCaption}\item[{void $\ast$}]{buf,  }\item[{size\+\_\+t}]{old\+\_\+size,  }\item[{size\+\_\+t}]{new\+\_\+size,  }\item[{size\+\_\+t}]{alignment = {\ttfamily 0} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Enlarge memory range. Data from old range is moved to the beginning of new range. Address of memory range could change. nothing to do. BTW, it\textquotesingle{}s not possible to change alignment while doing realloc.

Resize malloc\textquotesingle{}d memory region with no special alignment requirement.

Resize mmap\textquotesingle{}d memory region.

No need for zero-\/fill, because mmap guarantees it.函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_af48b30af68c846da954ef85a876ac5a9_cgraph}
\end{center}
\end{figure}
这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_af48b30af68c846da954ef85a876ac5a9_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{class_allocator_a60b3b47bca967c70d89d5bda6d5c50c0}\label{class_allocator_a60b3b47bca967c70d89d5bda6d5c50c0}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!get\_stack\_threshold@{get\_stack\_threshold}}
\index{get\_stack\_threshold@{get\_stack\_threshold}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{get\_stack\_threshold()}{get\_stack\_threshold()}}
{\footnotesize\ttfamily static constexpr size\+\_\+t get\+\_\+stack\+\_\+threshold (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}, {\ttfamily [constexpr]}, {\ttfamily [protected]}}

\mbox{\Hypertarget{class_allocator_a2e4223e7158b40f4e4c5cc08216f0a56}\label{class_allocator_a2e4223e7158b40f4e4c5cc08216f0a56}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!get\_mmap\_hint@{get\_mmap\_hint}}
\index{get\_mmap\_hint@{get\_mmap\_hint}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{get\_mmap\_hint()}{get\_mmap\_hint()}}
{\footnotesize\ttfamily void $\ast$ get\+\_\+mmap\+\_\+hint (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

In debug builds, request mmap() at random addresses (a kind of ASLR), to reproduce more memory stomping bugs. Note that Linux doesn\textquotesingle{}t do it by default. This may lead to worse TLB performance. 这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dc1/class_allocator_a2e4223e7158b40f4e4c5cc08216f0a56_icgraph}
\end{center}
\end{figure}


\doxysubsection{类成员变量说明}
\mbox{\Hypertarget{class_allocator_aef026d27e574609185dcf1d047e241d6}\label{class_allocator_aef026d27e574609185dcf1d047e241d6}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!clear\_memory@{clear\_memory}}
\index{clear\_memory@{clear\_memory}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{clear\_memory}{clear\_memory}}
{\footnotesize\ttfamily constexpr bool clear\+\_\+memory = clear\+\_\+memory\+\_\+\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}, {\ttfamily [protected]}}

\mbox{\Hypertarget{class_allocator_a4823c06be87da26bc7f8fd6573d7efb8}\label{class_allocator_a4823c06be87da26bc7f8fd6573d7efb8}} 
\index{Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}!mmap\_flags@{mmap\_flags}}
\index{mmap\_flags@{mmap\_flags}!Allocator$<$ clear\_memory\_, mmap\_populate $>$@{Allocator$<$ clear\_memory\_, mmap\_populate $>$}}
\doxysubsubsection{\texorpdfstring{mmap\_flags}{mmap\_flags}}
{\footnotesize\ttfamily constexpr int mmap\+\_\+flags = MAP\+\_\+\+PRIVATE $\vert$ \mbox{\hyperlink{allocator_8h_ae4f86bff73414c5fc08c058f957212f0}{MAP\+\_\+\+ANONYMOUS}}\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}, {\ttfamily [protected]}}



该类的文档由以下文件生成\+:\begin{DoxyCompactItemize}
\item 
/\+Users/dabowang/be\+\_\+all/vec/common/\mbox{\hyperlink{allocator_8h}{allocator.\+h}}\end{DoxyCompactItemize}
