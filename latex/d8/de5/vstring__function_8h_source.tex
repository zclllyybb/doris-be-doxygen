\hypertarget{vstring__function_8h_source}{}\doxysection{vstring\+\_\+function.\+h}
\label{vstring__function_8h_source}\index{/Users/dabowang/be\_all/util/simd/vstring\_function.h@{/Users/dabowang/be\_all/util/simd/vstring\_function.h}}
\mbox{\hyperlink{vstring__function_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#ifdef\ \_\_aarch64\_\_}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <sse2neon.h>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lower__upper__impl_8h}{util/simd/lower\_upper\_impl.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__ref_8h}{vec/common/string\_ref.h}}"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::array<uint8,\ 256>\ \mbox{\hyperlink{namespacedoris_a9f755ebd0f13f9137f459133121f9b88}{UTF8\_BYTE\_LENGTH}}\ =\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 2,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ 3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 4,\ 4,\ 4,\ 4,\ 4,\ 4,\ 4,\ 4,\ 5,\ 5,\ 5,\ 5,\ 6,\ 6,\ 6,\ 6\};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{inline}\ uint8\_t\ \mbox{\hyperlink{namespacedoris_aa451369048423082caf41bc8ddbb0f24}{get\_utf8\_byte\_length}}(uint8\_t\ character)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacedoris_a9f755ebd0f13f9137f459133121f9b88}{UTF8\_BYTE\_LENGTH}}[character];}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{namespace\ }simd\ \{}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions}{VStringFunctions}}\ \{}
\DoxyCodeLine{00053\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#if\ defined(\_\_SSE2\_\_)\ ||\ defined(\_\_aarch64\_\_)}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ REGISTER\_SIZE\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{memcpy__aarch64_8cpp_ae568b00e462205af997f7d5d84814f70}{\_\_m128i}});}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00058\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_a14b92c3484a2c816aa72cc48aee73f75}{rtrim}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\&\ str)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (str.\mbox{\hyperlink{structdoris__udf_1_1_any_val_acf9d169b4bd3c066e3696495e7b2f874}{is\_null}}\ ||\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ ==\ 0)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ begin\ =\ 0;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ end\ =\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ -\/\ 1;}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#if\ defined(\_\_SSE2\_\_)\ ||\ defined(\_\_aarch64\_\_)}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ blank\ =\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ pattern\ =\ \_mm\_set1\_epi8(blank);}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (end\ -\/\ begin\ +\ 1\ >=\ REGISTER\_SIZE)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ v\_haystack\ =\ \_mm\_loadu\_si128(}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{memcpy__aarch64_8cpp_ae568b00e462205af997f7d5d84814f70}{\_\_m128i}}*\textcolor{keyword}{>}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ end\ +\ 1\ -\/\ REGISTER\_SIZE));}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ v\_against\_pattern\ =\ \_mm\_cmpeq\_epi8(v\_haystack,\ pattern);}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ mask\ =\ \_mm\_movemask\_epi8(v\_against\_pattern);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ offset\ =\ \_\_builtin\_clz(\string~(mask\ <<\ REGISTER\_SIZE));}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (offset\ ==\ 0)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ begin,\ end\ -\/\ begin\ +\ 1);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ end\ -\/=\ offset;}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (end\ >=\ begin\ \&\&\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}[end]\ ==\ \textcolor{charliteral}{'\ '})\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/end;}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end\ <\ 0)\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ begin,\ end\ -\/\ begin\ +\ 1);}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_af5ae97e9172b502b99ac1b09d13b3c3f}{ltrim}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\&\ str)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (str.\mbox{\hyperlink{structdoris__udf_1_1_any_val_acf9d169b4bd3c066e3696495e7b2f874}{is\_null}}\ ||\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ ==\ 0)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ begin\ =\ 0;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ end\ =\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ -\/\ 1;}
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#if\ defined(\_\_SSE2\_\_)\ ||\ defined(\_\_aarch64\_\_)}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ blank\ =\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ pattern\ =\ \_mm\_set1\_epi8(blank);}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (end\ -\/\ begin\ +\ 1\ >=\ REGISTER\_SIZE)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ v\_haystack\ =}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_mm\_loadu\_si128(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{memcpy__aarch64_8cpp_ae568b00e462205af997f7d5d84814f70}{\_\_m128i}}*\textcolor{keyword}{>}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ begin));}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ v\_against\_pattern\ =\ \_mm\_cmpeq\_epi8(v\_haystack,\ pattern);}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ mask\ =\ \_mm\_movemask\_epi8(v\_against\_pattern)\ \string^\ 0xffff;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mask\ ==\ 0)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ begin\ +=\ REGISTER\_SIZE;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ offset\ =\ \_\_builtin\_ctz(mask);}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ begin\ +=\ offset;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ begin,\ end\ -\/\ begin\ +\ 1);}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (begin\ <=\ end\ \&\&\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}[begin]\ ==\ \textcolor{charliteral}{'\ '})\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ ++begin;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ begin,\ end\ -\/\ begin\ +\ 1);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_a44a499cdf442251882128e807b591b28}{trim}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\&\ str)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (str.\mbox{\hyperlink{structdoris__udf_1_1_any_val_acf9d169b4bd3c066e3696495e7b2f874}{is\_null}}\ ||\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ ==\ 0)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ str;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_a14b92c3484a2c816aa72cc48aee73f75}{rtrim}}(\mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_af5ae97e9172b502b99ac1b09d13b3c3f}{ltrim}}(str));}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ Gcc\ will\ do\ auto\ simd\ in\ this\ function}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_aa6a5adac0c1621320c39381d5b3494db}{is\_ascii}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\&\ str)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ or\_code\ =\ 0;}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}};\ i++)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ or\_code\ |=\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}[i];}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !(or\_code\ \&\ 0x80);}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_acbd2a32fa57154beaccf1fcb851ad738}{reverse}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\&\ str,\ \mbox{\hyperlink{structdoris__udf_1_1_string_val}{StringVal}}\ dst)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_aa6a5adac0c1621320c39381d5b3494db}{is\_ascii}}(str))\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ begin\ =\ 0;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ end\ =\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}};}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ result\_end\ =\ dst.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ -\/\ 1;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ SIMD\ here}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \_\_restrict\ l\ =\ dst.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ \_\_restrict\ r\ =\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}};}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ begin\ <\ end;\ ++begin,\ -\/-\/result\_end)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ l[result\_end]\ =\ r[begin];}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0,\ char\_size\ =\ 0;\ i\ <\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}};\ i\ +=\ char\_size)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ char\_size\ =\ \mbox{\hyperlink{namespacedoris_a9f755ebd0f13f9137f459133121f9b88}{UTF8\_BYTE\_LENGTH}}[(\textcolor{keywordtype}{unsigned}\ char)(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}})[i]];}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ there\ exists\ occasion\ where\ the\ last\ character\ is\ an\ illegal\ UTF-\/8\ one\ which\ returns}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ a\ char\_size\ larger\ than\ the\ actual\ space,\ which\ would\ cause\ offset\ execeeding\ the\ buffer\ range}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ example,\ consider\ str.len=4,\ i\ =\ 3,\ then\ the\ last\ char\ returns\ char\_size\ 2,\ then}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ str.ptr\ +\ offset\ would\ exceed\ the\ buffer\ range}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset\ =\ i\ +\ char\_size;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (offset\ >\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}})\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offset\ =\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}};}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ i,\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ offset,\ dst.\mbox{\hyperlink{structdoris__udf_1_1_string_val_aaa8222c604b0b520bc2205ddcc42d855}{ptr}}\ +\ str.\mbox{\hyperlink{structdoris__udf_1_1_string_val_afd163bc9bdb9ed66148f87e6017e8712}{len}}\ -\/\ offset);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_a1c3a4bd0c4e69190f269f4d63c641bc0}{hex\_encode}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ src\_str,\ \textcolor{keywordtype}{size\_t}\ length,\ \textcolor{keywordtype}{char}*\ dst\_str)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ hex\_table\ =\ \textcolor{stringliteral}{"{}0123456789ABCDEF"{}};}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ src\_str\_end\ =\ src\_str\ +\ length;}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \textcolor{preprocessor}{\#if\ defined(\_\_SSE2\_\_)\ ||\ defined(\_\_aarch64\_\_)}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ step\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}});}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (src\_str\ +\ step\ <\ src\_str\_end)\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ hex\_map\ =\ \_mm\_loadu\_si128(\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{memcpy__aarch64_8cpp_ae568b00e462205af997f7d5d84814f70}{\_\_m128i}}*\textcolor{keyword}{>}(hex\_table));}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ mask\_map\ =\ \_mm\_set1\_epi8(0x0F);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}}\ =\ \_mm\_loadu\_si64(src\_str);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hex\_loc\ =}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_mm\_and\_si128(\_mm\_unpacklo\_epi8(\_mm\_srli\_epi64(\mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ 4),\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}}),\ mask\_map);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_mm\_storeu\_si128(\textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{memcpy__aarch64_8cpp_ae568b00e462205af997f7d5d84814f70}{\_\_m128i}}*\textcolor{keyword}{>}(dst\_str),}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_mm\_shuffle\_epi8(hex\_map,\ hex\_loc));}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ src\_str\ +=\ step;}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dst\_str\ +=\ step\ *\ 2;}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (src\_str\ +\ step\ <\ src\_str\_end);}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ res[2];}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ hex(str)\ str\ length\ is\ n,\ result\ must\ be\ 2\ *\ n\ length}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ src\_str\ <\ src\_str\_end;\ src\_str\ +=\ 1,\ dst\_str\ +=\ 2)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ low\ 4\ bits}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ *(res\ +\ 1)\ =\ hex\_table[src\_str[0]\ \&\ 0x0F];}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ high\ 4\ bits}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ *res\ =\ hex\_table[(src\_str[0]\ >>\ 4)];}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(res,\ res\ +\ 2,\ dst\_str);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_a3bc50f63e160a8636fb4875308ace2af}{to\_lower}}(\textcolor{keyword}{const}\ uint8\_t*\ src,\ int64\_t\ len,\ uint8\_t*\ dst)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (len\ <=\ 0)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1simd_1_1_lower_upper_impl}{LowerUpperImpl}}<\textcolor{charliteral}{'A'},\ \textcolor{charliteral}{'Z'}>\ lowerUpper;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ lowerUpper.\mbox{\hyperlink{classdoris_1_1simd_1_1_lower_upper_impl_a726ed750c673b959e012c7ce63ee994b}{transfer}}(src,\ src\ +\ len,\ dst);}
\DoxyCodeLine{00204\ \ \ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1simd_1_1_v_string_functions_afab3b1dadd4aea20f326316488469b7d}{to\_upper}}(\textcolor{keyword}{const}\ uint8\_t*\ src,\ int64\_t\ len,\ uint8\_t*\ dst)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (len\ <=\ 0)\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1simd_1_1_lower_upper_impl}{LowerUpperImpl}}<\textcolor{charliteral}{'a'},\ \textcolor{charliteral}{'z'}>\ lowerUpper;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ lowerUpper.\mbox{\hyperlink{classdoris_1_1simd_1_1_lower_upper_impl_a726ed750c673b959e012c7ce63ee994b}{transfer}}(src,\ src\ +\ len,\ dst);}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \};}
\DoxyCodeLine{00214\ \}\ \textcolor{comment}{//\ namespace\ simd}}
\DoxyCodeLine{00215\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
