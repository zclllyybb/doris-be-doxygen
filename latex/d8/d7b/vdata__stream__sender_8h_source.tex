\hypertarget{vdata__stream__sender_8h_source}{}\doxysection{vdata\+\_\+stream\+\_\+sender.\+h}
\label{vdata__stream__sender_8h_source}\index{/Users/dabowang/doris/be/src/vec/sink/vdata\_stream\_sender.h@{/Users/dabowang/doris/be/src/vec/sink/vdata\_stream\_sender.h}}
\mbox{\hyperlink{vdata__stream__sender_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{global__types_8h}{common/global\_types.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{data__sink_8h}{exec/data\_sink.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/PaloInternalService\_types.h"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/data.pb.h"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/internal\_service.pb.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{exchange__sink__buffer_8h}{pipeline/exec/exchange\_sink\_buffer.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{descriptors_8h}{runtime/descriptors.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{backend__options_8h}{service/backend\_options.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ref__count__closure_8h}{util/ref\_count\_closure.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uid__util_8h}{util/uid\_util.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vexpr_8h}{vec/exprs/vexpr.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vexpr__context_8h}{vec/exprs/vexpr\_context.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vdata__stream__mgr_8h}{vec/runtime/vdata\_stream\_mgr.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vdata__stream__recvr_8h}{vec/runtime/vdata\_stream\_recvr.h}}"{}}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }ObjectPool;}
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }RuntimeState;}
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }RuntimeProfile;}
\DoxyCodeLine{00041\ \textcolor{keyword}{class\ }BufferControlBlock;}
\DoxyCodeLine{00042\ \textcolor{keyword}{class\ }MemTracker;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{namespace\ }pipeline\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{class\ }ExchangeSinkOperator;}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }VExprContext;}
\DoxyCodeLine{00050\ \textcolor{keyword}{class\ }Channel;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00053\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper}{AtomicWrapper}}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ std::atomic<T>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_a5935c15e5a11d2ed6f9c24c103302e3b}{AtomicWrapper}}()\ :\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}()\ \{\}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_a95762d0dee0219106a740a4d25938b6a}{AtomicWrapper}}(\textcolor{keyword}{const}\ std::atomic<T>\&\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}})\ :\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}(\mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}.load())\ \{\}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_a9fca2bad30db778a1550a93f5c0f5b93}{AtomicWrapper}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper}{AtomicWrapper}}\&\ other)\ :\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}(other.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.load())\ \{\}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper}{AtomicWrapper}}\&\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_a1b0ce44e0223870e05f253414f9c1be9}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper}{AtomicWrapper}}\&\ other)\ \{\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.store(other.\_a.load());\ \}}
\DoxyCodeLine{00063\ \};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{comment}{//\ We\ use\ BroadcastPBlockHolder\ to\ hold\ a\ broadcasted\ PBlock.\ For\ broadcast\ shuffle,\ one\ PBlock}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ will\ be\ shared\ between\ different\ channel,\ so\ we\ have\ to\ use\ a\ ref\ count\ to\ mark\ if\ this}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ PBlock\ is\ available\ for\ next\ serialization.}}
\DoxyCodeLine{00068\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder}{BroadcastPBlockHolder}}\ \{}
\DoxyCodeLine{00069\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a70eb89b39c1adc190ca2d57ccdafdb6f}{BroadcastPBlockHolder}}()\ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}}(0)\ \{\}}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a2540e11749d40b27ed825fe44c1c15a8}{\string~BroadcastPBlockHolder}}()\ noexcept\ =\ default;}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a83d8e03f3166078db6e7ff0169bcdedb}{unref}}()\ noexcept\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ DCHECK\_GT(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}}.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}},\ 0);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}}.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.fetch\_sub(1);}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_aa6ed9010a8498f4b538e4251d22d23ac}{ref}}()\ noexcept\ \{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}}.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.fetch\_add(1);\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a4a47f12debf6d5d7273c3e5fb360417a}{available}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}}.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper_ac1d3943636440a3d541416cc7787aa9e}{\_value}}\ ==\ 0;\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ PBlock*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a8268ceaca4ee970f90601f540be8fd01}{get\_block}}()\ \{\ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0e20d6d9486cf4ee65e32671c2ee7549}{pblock}};\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_atomic_wrapper}{AtomicWrapper<uint32\_t>}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0ff92a2ad95828330f2c5e94931da2ea}{\_ref\_count}};}
\DoxyCodeLine{00085\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a0e20d6d9486cf4ee65e32671c2ee7549}{pblock}};}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_data_sink}{DataSink}}\ \{}
\DoxyCodeLine{00089\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_operator}{pipeline::ExchangeSinkOperator}};}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}},\ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}*\ pool,\ \textcolor{keywordtype}{int}\ sender\_id,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a48a09d232178e1821ad6d3f9b39eaf55}{row\_desc}},\ \textcolor{keyword}{const}\ TDataStreamSink\&\ sink,}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TPlanFragmentDestination>\&\ destinations,}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ per\_channel\_buffer\_size,\ \textcolor{keywordtype}{bool}\ send\_query\_statistics\_with\_every\_batch);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}(\mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}*\ pool,\ \textcolor{keywordtype}{int}\ sender\_id,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a48a09d232178e1821ad6d3f9b39eaf55}{row\_desc}},}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ dest\_node\_id,}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TPlanFragmentDestination>\&\ destinations,}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ per\_channel\_buffer\_size,\ \textcolor{keywordtype}{bool}\ send\_query\_statistics\_with\_every\_batch);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}(\mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}*\ pool,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a48a09d232178e1821ad6d3f9b39eaf55}{row\_desc}},\ \textcolor{keywordtype}{int}\ per\_channel\_buffer\_size,}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ send\_query\_statistics\_with\_every\_batch);}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa22e34c803888657a550cca7ad2c2ef1}{\string~VDataStreamSender}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab08988e0c60bf1fb58ce83da90759184}{init}}(\textcolor{keyword}{const}\ TDataSink\&\ thrift\_sink)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa1a9d3c8096a7d5dc7ae0b91b62b7e34}{prepare}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a019f7d127e3f74f7fea421a226699777}{open}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ae6e28a41372229bdbf6076675d85615d}{send}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}},\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa7244ec43ccffe0e0c671740374e20be}{close}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}},\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ exec\_status)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a04225bd72d53c2c8c1a401b682aae2f1}{profile}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2e859f47407c7a031f6c1e087775e510}{\_profile}};\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2ccf49be12555d373b883be1aa7b6709}{state}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a91f2150e84757ffe2be5129f52c9e85a}{\_state}};\ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_adc0f1acee9a4c1683ddbc68e1c8feaa8}{serialize\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ src,\ PBlock*\ dest,\ \textcolor{keywordtype}{int}\ num\_receivers\ =\ 1);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a0f3b97c364b02c8915e019b0370d0b41}{registe\_channels}}(\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer}{pipeline::ExchangeSinkBuffer}}*\ buffer);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab515ed2e40e9d17f98049d4fbdc79db8}{channel\_all\_can\_write}}();}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a48a09d232178e1821ad6d3f9b39eaf55}{row\_desc}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a5c5a52331b8a61dfcf22b82f22598bb7}{\_row\_desc}};\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel}{Channel}};}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer}{pipeline::ExchangeSinkBuffer}};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab226213f61e222f3a675e444ffe04e90}{\_roll\_pb\_block}}();}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_afc01ce0128068ffe87ef22ca4df56180}{\_get\_next\_available\_buffer}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder}{BroadcastPBlockHolder}}**\ holder);}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ac4c5ea3a3f4f8d64c6de721388d4d731}{get\_partition\_column\_result}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{int}*\ result)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ counter\ =\ 0;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ ctx\ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa741cff48db341089ada680f1ad35afe}{\_partition\_expr\_ctxs}})\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(ctx-\/>execute(block,\ \&result[counter++]));}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00139\ \ \ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Channels>}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a4599e91c13e2430c57044ebe2806327a}{channel\_add\_rows}}(Channels\&\ channels,\ \textcolor{keywordtype}{int}\ num\_channels,\ \textcolor{keyword}{const}\ uint64\_t*\ channel\_ids,}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rows,\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_v_data_stream_sender_1_1hash__128}{hash\_128}}\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_v_data_stream_sender_1_1hash__128_a9997109464efa7a7fc24efcaca7a9fb3}{high}};}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ uint64\_t\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_v_data_stream_sender_1_1hash__128_a8325b33af041490126f231fdfd194797}{low}};}
\DoxyCodeLine{00148\ \ \ \ \ \};}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_v_data_stream_sender_1_1hash__128}{hash\_128\_t}}\ =\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_v_data_stream_sender_1_1hash__128}{hash\_128}};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a3dba644746a9066b57ead79df573f963}{handle\_unpartitioned}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block);}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{comment}{//\ Sender\ instance\ id,\ unique\ within\ a\ fragment.}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2a05354de44751abec53bfc70e81642e}{\_sender\_id}};}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a91f2150e84757ffe2be5129f52c9e85a}{\_state}};}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a141dedecd6d2ccf5c7949deafa8e65e7}{\_pool}};}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a5c5a52331b8a61dfcf22b82f22598bb7}{\_row\_desc}};}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ad329d1f9be6864d4c009ad9bc9b3032a}{\_current\_channel\_idx}};\ \textcolor{comment}{//\ index\ of\ current\ channel\ to\ send\ to\ if\ \_random\ ==\ true}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ TPartitionType::type\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a1f76e3f1871f509f51b9b363fe8f34a2}{\_part\_type}};}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a80af2e488e865b5023419536c8b98b82}{\_ignore\_not\_found}};}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ serialized\ batches\ for\ broadcasting;\ we\ need\ two\ so\ we\ can\ write}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ one\ while\ the\ other\ one\ is\ still\ being\ sent}}
\DoxyCodeLine{00168\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a6af1dc79c792cac3adc856a0f6b413a6}{\_pb\_block1}};}
\DoxyCodeLine{00169\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab7b84df46f5cea9b20c9287015668a83}{\_pb\_block2}};}
\DoxyCodeLine{00170\ \ \ \ \ PBlock*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab55cd174b2135abffa7add48d8ce8538}{\_cur\_pb\_block}};}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ used\ by\ pipeline\ engine}}
\DoxyCodeLine{00173\ \ \ \ \ std::vector<BroadcastPBlockHolder>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a70025f87c02cf5c90d36c25795c7a4bb}{\_broadcast\_pb\_blocks}};}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a13de00b568033f03efea1070604cfd48}{\_broadcast\_pb\_block\_idx}};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ compute\ per-\/row\ partition\ values}}
\DoxyCodeLine{00177\ \ \ \ \ std::vector<VExprContext*>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa741cff48db341089ada680f1ad35afe}{\_partition\_expr\_ctxs}};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ std::vector<Channel*>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a5ebe97c1552a0e2c6ef152f1b20cde6a}{\_channels}};}
\DoxyCodeLine{00180\ \ \ \ \ std::vector<std::shared\_ptr<Channel>>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_adc44894a10e5b415a1f38c2980982845}{\_channel\_shared\_ptrs}};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2e859f47407c7a031f6c1e087775e510}{\_profile}};\ \textcolor{comment}{//\ Allocated\ from\ \_pool}}
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a86ac3180ad2a7714a08fc5aff1952e06}{\_serialize\_batch\_timer}};}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab4082620b8f0cb4241269d0f8b3e9b9d}{\_compress\_timer}};}
\DoxyCodeLine{00185\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a4647cbdfdbc9c85fd87cfeb362a3823e}{\_brpc\_send\_timer}};}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aeced1fce8f2cbb8aa7d6ff0ceed2e715}{\_brpc\_wait\_timer}};}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_acaac5dbcd61e5a9a44d3ed05677ed32b}{\_bytes\_sent\_counter}};}
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a3adc3189818090150847a8f6c7da3afa}{\_uncompressed\_bytes\_counter}};}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a51fca4f52d3905b153f43e825b73e492}{\_ignore\_rows}};}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a609113b672e0eabb604655c0871eb6a9}{\_local\_sent\_rows}};}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a7de73ed9abd6d004838420d60e37164c}{\_local\_send\_timer}};}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a7059d744286498cf41dc41ff83126f12}{\_split\_block\_hash\_compute\_timer}};}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a789a02eeb52afc6af870b498dd278dde}{\_split\_block\_distribute\_by\_channel\_timer}};}
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a65754a500fc3df13d035957e7f09e2b9}{\_blocks\_sent\_counter}};}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ std::unique\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a589c3f7fd9800e4fd09e03c9dd12d33f}{\_mem\_tracker}};}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ Throughput\ per\ total\ time\ spent\ in\ sender}}
\DoxyCodeLine{00199\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aa687bc789fd92cdd184bc104c7582e1c}{\_overall\_throughput}};}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ Used\ to\ counter\ send\ bytes\ under\ local\ data\ exchange}}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ab269b19ea726cd1a13379dd394d8edd1}{\_local\_bytes\_send\_counter}};}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{comment}{//\ Identifier\ of\ the\ destination\ plan\ node.}}
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}};}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ User\ can\ change\ this\ config\ at\ runtime,\ avoid\ it\ being\ modified\ during\ query\ or\ loading\ process.}}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_af53f6939efe3a55ca12e1fefa3411192}{\_transfer\_large\_data\_by\_brpc}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ segment\_v2::CompressionTypePB\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ad0dccf6ce65a54d3559a2b9f2c6c8f55}{\_compression\_type}};}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_ad9aa92f2885f7f412f1ec03249b2b65d}{\_new\_shuffle\_hash\_method}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a9388d89d1eb4a5399451405971b83260}{\_only\_local\_exchange}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a163b64acee147f4f95205adff5d56640}{\_enable\_pipeline\_exec}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00213\ \};}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel}{Channel}}\ \{}
\DoxyCodeLine{00216\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}};}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer}{pipeline::ExchangeSinkBuffer}};}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{comment}{//\ Create\ channel\ to\ send\ data\ to\ particular\ ipaddress/port/query/node}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ combination.\ buffer\_size\ is\ specified\ in\ bytes\ and\ a\ soft\ limit\ on}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ how\ much\ tuple\ data\ is\ getting\ accumulated\ before\ being\ sent;\ it\ only\ applies}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{comment}{//\ when\ data\ is\ added\ via\ add\_row()\ and\ not\ sent\ directly\ via\ send\_batch().}}
\DoxyCodeLine{00223\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_aefd862cd2ff456d221d1b1783ed001a2}{Channel}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}*\ parent,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ row\_desc,}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TNetworkAddress\&\ brpc\_dest,\ \textcolor{keyword}{const}\ TUniqueId\&\ fragment\_instance\_id,}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ dest\_node\_id,\ \textcolor{keywordtype}{int}\ buffer\_size,\ \textcolor{keywordtype}{bool}\ is\_transfer\_chain,}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ send\_query\_statistics\_with\_every\_batch)}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af551507ffae78c3c43302b826a0ecbe9}{\_parent}}(parent),}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a5c5a52331b8a61dfcf22b82f22598bb7}{\_row\_desc}}(row\_desc),}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}}(fragment\_instance\_id),}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}}(dest\_node\_id),}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb61a062c41126dbe2f04bae82dceb29}{\_num\_data\_bytes\_sent}}(0),}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a001a126aaf4b961dd36fcfda37efbf43}{\_packet\_seq}}(0),}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0ae39418973dab2403806bfb913433c4}{\_need\_close}}(false),}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_abc28cffa27d12398d61e1b028b81f31d}{\_brpc\_dest\_addr}}(brpc\_dest),}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a33acfea8455290c5e1eb0a7d01f06b0d}{\_is\_transfer\_chain}}(is\_transfer\_chain),}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ae78e45ec0f2b73dc6031aaf02bd30246}{\_send\_query\_statistics\_with\_every\_batch}}(send\_query\_statistics\_with\_every\_batch)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ std::string\ localhost\ =\ \mbox{\hyperlink{classdoris_1_1_backend_options_a07e4505e62ab1e64490b48b117523422}{BackendOptions::get\_localhost}}();}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0b0fe41ad23a86641da38be4888cfb48}{\_is\_local}}\ =\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_abc28cffa27d12398d61e1b028b81f31d}{\_brpc\_dest\_addr}}.hostname\ ==\ localhost)\ \&\&}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_abc28cffa27d12398d61e1b028b81f31d}{\_brpc\_dest\_addr}}.port\ ==\ config::brpc\_port);}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0b0fe41ad23a86641da38be4888cfb48}{\_is\_local}})\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_a18eaecaf99d52cb40ba1da6343fa8449}{VLOG\_NOTICE}}\ <<\ \textcolor{stringliteral}{"{}will\ use\ local\ Exchange,\ dest\_node\_id\ is\ :\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}};}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}}\ =\ \&\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_acd26203e48c7b9a6f5bf8156dba68b72}{\_ch\_pb\_block1}};}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ac8917ded4599c304977c2842014de6a6}{\string~Channel}}()\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}-\/>\mbox{\hyperlink{classdoris_1_1_ref_count_closure_aedee0f893c0e1766f4a89c544eec5c02}{unref}}())\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ release\ this\ before\ request\ desctruct}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a61598ac5ef24c8ae80030cdb21f42841}{\_brpc\_request}}.release\_finst\_id();}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a61598ac5ef24c8ae80030cdb21f42841}{\_brpc\_request}}.release\_query\_id();}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{comment}{//\ Initialize\ channel.}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{comment}{//\ Returns\ OK\ if\ successful,\ error\ indication\ otherwise.}}
\DoxyCodeLine{00257\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ae11504d162442173f29bc3a21bc8ad00}{init}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state);}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{comment}{//\ Asynchronously\ sends\ a\ row\ batch.}}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ status\ of\ the\ most\ recently\ finished\ transmit\_data}}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ rpc\ (or\ OK\ if\ there\ wasn't\ one\ that\ hasn't\ been\ reported\ yet).}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ if\ batch\ is\ nullptr,\ send\ the\ eof\ packet}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0c27bc94400627799fe7b677ae0639cc}{send\_block}}(PBlock*\ block,\ \textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_abef6d6d087a5f288eb51014bd398e3ef}{send\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder}{BroadcastPBlockHolder}}*\ block,\ \textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::InternalError(\textcolor{stringliteral}{"{}Send\ BroadcastPBlockHolder\ is\ not\ allowed!"{}});}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a48c290ba2be0c5b3eb2c771cb5b92f0f}{add\_rows}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keyword}{const}\ std::vector<int>\&\ row);}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a2b293ca3505c879c10f473314a8cffdb}{send\_current\_block}}(\textcolor{keywordtype}{bool}\ eos);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a01a2f3a3299210d1095c7d0842926a2c}{send\_local\_block}}(\textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a01a2f3a3299210d1095c7d0842926a2c}{send\_local\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block);}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{comment}{//\ Flush\ buffered\ rows\ and\ close\ channel.\ This\ function\ don't\ wait\ the\ response}}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{comment}{//\ of\ close\ operation,\ client\ should\ call\ close\_wait()\ to\ finish\ channel's\ close.}}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{comment}{//\ We\ split\ one\ close\ operation\ into\ two\ phases\ in\ order\ to\ make\ multiple\ channels}}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{comment}{//\ can\ run\ parallel.}}
\DoxyCodeLine{00280\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a4cd0274c89d380200b7a409715948fc3}{close}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ Get\ close\ wait's\ response,\ to\ finish\ channel\ close\ operation.}}
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a2cd09239160586b7f96b1ddcdc6bf7ef}{close\_wait}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state);}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ab93ba7165e221aaf40e048a3a049d632}{num\_data\_bytes\_sent}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb61a062c41126dbe2f04bae82dceb29}{\_num\_data\_bytes\_sent}};\ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ PBlock*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a985b91fbc0f02b0afe94911cc19cc802}{ch\_cur\_pb\_block}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}};\ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ab31693ad6d7768fb22c32bd88479389c}{get\_fragment\_instance\_id\_str}}()\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}\ uid(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}});}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ uid.\mbox{\hyperlink{structdoris_1_1_unique_id_aac993ecccd3d88aafefb6b8e3caa1dee}{to\_string}}();}
\DoxyCodeLine{00292\ \ \ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_aef8e753cccabd64207d9ca9e8e034133}{is\_local}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0b0fe41ad23a86641da38be4888cfb48}{\_is\_local}};\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a18eb5b2c5d0f0e5a43ff3151f1790b92}{ch\_roll\_pb\_block}}();}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ad5d5463ecab1b181bfea07cc5ddf4ac7}{can\_write}}()\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_aef8e753cccabd64207d9ca9e8e034133}{is\_local}}())\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ local\ recvr\ queue\ mem\ over\ the\ exchange\ node\ mem\ limit,\ we\ must\ ensure\ each\ queue}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ has\ one\ block\ to\ do\ merge\ sort\ in\ exchange\ node\ to\ prevent\ the\ logic\ dead\ lock}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}\ ||\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}-\/>is\_closed()\ ||\ !\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}-\/>exceeds\_limit(0)\ ||}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}-\/>sender\_queue\_empty(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af551507ffae78c3c43302b826a0ecbe9}{\_parent}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a2a05354de44751abec53bfc70e81642e}{\_sender\_id}});}
\DoxyCodeLine{00307\ \ \ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_acb700d38f9e3f7d41a71e63ea444eb5e}{\_recvr\_is\_valid}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}\ \&\&\ !\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}}-\/>is\_closed();\ \}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0921684e081cb6650dba84aa29458f4c}{\_wait\_last\_brpc}}()\ \{}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{runtime__profile_8h_aaa9a2971c6368e3ddd3f5140a0295eb7}{SCOPED\_TIMER}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af551507ffae78c3c43302b826a0ecbe9}{\_parent}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_aeced1fce8f2cbb8aa7d6ff0ceed2e715}{\_brpc\_wait\_timer}});}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ cntl\ =\ \&\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}-\/>\mbox{\hyperlink{classdoris_1_1_ref_count_closure_a1b9feb80c44a619c43e50572b147e61c}{cntl}};}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ call\_id\ =\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}-\/>\mbox{\hyperlink{classdoris_1_1_ref_count_closure_a1b9feb80c44a619c43e50572b147e61c}{cntl}}.call\_id();}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ brpc::Join(call\_id);}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cntl-\/>Failed())\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ err\ =\ fmt::format(}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}failed\ to\ send\ brpc\ batch,\ error=\{\},\ error\_text=\{\},\ client:\ \{\},\ "{}}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}latency\ =\ \{\}"{}},}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ berror(cntl-\/>ErrorCode()),\ cntl-\/>ErrorText(),\ \mbox{\hyperlink{classdoris_1_1_backend_options_a07e4505e62ab1e64490b48b117523422}{BackendOptions::get\_localhost}}(),}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cntl-\/>latency\_us());}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ LOG(WARNING)\ <<\ err;}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::RpcError(err);}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00330\ \ \ \ \ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{comment}{//\ Serialize\ \_batch\ into\ \_thrift\_batch\ and\ send\ via\ send\_batch().}}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{comment}{//\ Returns\ send\_batch()\ status.}}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ab3a8893c10442350070debb21084058d}{send\_current\_batch}}(\textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a13d55729866c5017614abb0de589237d}{close\_internal}}();}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af551507ffae78c3c43302b826a0ecbe9}{\_parent}};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a5c5a52331b8a61dfcf22b82f22598bb7}{\_row\_desc}};}
\DoxyCodeLine{00340\ \ \ \ \ TUniqueId\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}};}
\DoxyCodeLine{00341\ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a64bf35ab71213d2bc866041e02ffa8f9}{\_dest\_node\_id}};}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ the\ number\ of\ RowBatch.data\ bytes\ sent\ successfully}}
\DoxyCodeLine{00344\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb61a062c41126dbe2f04bae82dceb29}{\_num\_data\_bytes\_sent}};}
\DoxyCodeLine{00345\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a001a126aaf4b961dd36fcfda37efbf43}{\_packet\_seq}};}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{comment}{//\ we're\ accumulating\ rows\ into\ this\ batch}}
\DoxyCodeLine{00348\ \ \ \ \ std::unique\_ptr<MutableBlock>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb3cdfb32013431bee5f9bd8f3db17aa}{\_mutable\_block}};}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0ae39418973dab2403806bfb913433c4}{\_need\_close}};}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a855d0e85d78e5ddd08efa767628801f1}{\_be\_number}};}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ TNetworkAddress\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_abc28cffa27d12398d61e1b028b81f31d}{\_brpc\_dest\_addr}};}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ PUniqueId\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ad6812dbff52627bb054685074f0c3c36}{\_finst\_id}};}
\DoxyCodeLine{00356\ \ \ \ \ PUniqueId\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a709a1c41038639612e09876b6f1a248c}{\_query\_id}};}
\DoxyCodeLine{00357\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afab3d3aa8b9ecdcc979d05472bdb0347}{\_pb\_block}};}
\DoxyCodeLine{00358\ \ \ \ \ PTransmitDataParams\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a61598ac5ef24c8ae80030cdb21f42841}{\_brpc\_request}};}
\DoxyCodeLine{00359\ \ \ \ \ std::shared\_ptr<PBackendService\_Stub>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af276b6f2a6e751c4c6a72d9adb8081af}{\_brpc\_stub}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00360\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_count_closure}{RefCountClosure<PTransmitDataResult>}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a378533ca0b5d21fbc95e797b346b5afb}{\_closure}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00361\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0086608d03feda1db60fb71f0ec1641e}{\_brpc\_timeout\_ms}}\ =\ 500;}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ whether\ the\ dest\ can\ be\ treated\ as\ query\ statistics\ transfer\ chain.}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a33acfea8455290c5e1eb0a7d01f06b0d}{\_is\_transfer\_chain}};}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_ae78e45ec0f2b73dc6031aaf02bd30246}{\_send\_query\_statistics\_with\_every\_batch}};}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a91f2150e84757ffe2be5129f52c9e85a}{\_state}};}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a0b0fe41ad23a86641da38be4888cfb48}{\_is\_local}};}
\DoxyCodeLine{00368\ \ \ \ \ std::shared\_ptr<VDataStreamRecvr>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_adc43bf9157682ad83227836843c0459b}{\_local\_recvr}};}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{comment}{//\ serialized\ blocks\ for\ broadcasting;\ we\ need\ two\ so\ we\ can\ write}}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{comment}{//\ one\ while\ the\ other\ one\ is\ still\ being\ sent.}}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ Which\ is\ for\ same\ reason\ as\ `\_cur\_pb\_block`,\ `\_pb\_block1`\ and\ `\_pb\_block2`}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ in\ VDataStreamSender.}}
\DoxyCodeLine{00373\ \ \ \ \ PBlock*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00374\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_acd26203e48c7b9a6f5bf8156dba68b72}{\_ch\_pb\_block1}};}
\DoxyCodeLine{00375\ \ \ \ \ PBlock\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a8a0362317723e0f2981367e7816a20ab}{\_ch\_pb\_block2}};}
\DoxyCodeLine{00376\ \};}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Channels>}
\DoxyCodeLine{00379\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_a4599e91c13e2430c57044ebe2806327a}{VDataStreamSender::channel\_add\_rows}}(Channels\&\ channels,\ \textcolor{keywordtype}{int}\ num\_channels,}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint64\_t*\ \_\_restrict\ channel\_ids,\ \textcolor{keywordtype}{int}\ rows,}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block)\ \{}
\DoxyCodeLine{00382\ \ \ \ \ std::vector<int>\ channel2rows[num\_channels];}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ rows;\ i++)\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ channel2rows[channel\_ids[i]].emplace\_back(i);}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_channels;\ ++i)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!channel2rows[i].empty())\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(channels[i]-\/>add\_rows(block,\ channel2rows[i]));}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00395\ \}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel}{PipChannel}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel}{Channel}}\ \{}
\DoxyCodeLine{00398\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00399\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_af5c27057311daa3882947bda1e597493}{PipChannel}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}}*\ parent,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_descriptor}{RowDescriptor}}\&\ row\_desc,}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TNetworkAddress\&\ brpc\_dest,\ \textcolor{keyword}{const}\ TUniqueId\&\ fragment\_instance\_id,}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_aff3646637706beab0cfaa610f75f298d}{PlanNodeId}}\ dest\_node\_id,\ \textcolor{keywordtype}{int}\ buffer\_size,\ \textcolor{keywordtype}{bool}\ is\_transfer\_chain,}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ send\_query\_statistics\_with\_every\_batch)}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel}{Channel}}(parent,\ row\_desc,\ brpc\_dest,\ fragment\_instance\_id,\ dest\_node\_id,\ buffer\_size,}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_transfer\_chain,\ send\_query\_statistics\_with\_every\_batch)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a503f07c153798e28637ca703c505fcfe}{ch\_roll\_pb\_block}}();}
\DoxyCodeLine{00406\ \ \ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7d8d1d3c986315551fa03378a9a4474c}{\string~PipChannel}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}})\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}};}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00412\ \ \ \ \ \}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a503f07c153798e28637ca703c505fcfe}{ch\_roll\_pb\_block}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ two\ choices\ here.}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1.\ Use\ a\ PBlock\ pool\ and\ fetch\ an\ available\ PBlock\ if\ we\ need\ one.\ In\ this\ way,\ we\ can}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ reuse\ the\ memory,\ but\ we\ have\ to\ use\ a\ lock\ to\ synchronize.}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2.\ Create\ a\ new\ PBlock\ every\ time.\ In\ this\ way\ we\ don't\ need\ a\ lock\ but\ have\ to\ allocate}}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ new\ memory.}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ use\ the\ second\ way.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a1d5a536487a4de54987df51781cb625c}{\_ch\_cur\_pb\_block}}\ =\ \textcolor{keyword}{new}\ PBlock();}
\DoxyCodeLine{00422\ \ \ \ \ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{comment}{//\ Asynchronously\ sends\ a\ block}}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ status\ of\ the\ most\ recently\ finished\ transmit\_data}}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{comment}{//\ rpc\ (or\ OK\ if\ there\ wasn't\ one\ that\ hasn't\ been\ reported\ yet).}}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{comment}{//\ if\ batch\ is\ nullptr,\ send\ the\ eof\ packet}}
\DoxyCodeLine{00428\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_abc87cb3fe080d337daec540b52526f53}{send\_block}}(PBlock*\ block,\ \textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (eos)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a52fd35408ff58bc51876a3c9af8b6f1d}{\_eos\_send}})\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a52fd35408ff58bc51876a3c9af8b6f1d}{\_eos\_send}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (eos\ ||\ block-\/>column\_metas\_size())\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7ff88976465ce6045ac9b14c8b2e1d30}{\_buffer}}-\/>\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer_a6bf5c5e10d840ac7f687a74699645e91}{add\_block}}(}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{this,\ block\ ?\ std::make\_unique<PBlock>(*block)\ :\ nullptr,\ eos\}));}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00441\ \ \ \ \ \}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a6278e01b912029a81f0d2058476cef4b}{send\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder}{BroadcastPBlockHolder}}*\ block,\ \textcolor{keywordtype}{bool}\ eos\ =\ \textcolor{keyword}{false})\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (eos)\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a52fd35408ff58bc51876a3c9af8b6f1d}{\_eos\_send}})\ \{}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a52fd35408ff58bc51876a3c9af8b6f1d}{\_eos\_send}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (eos\ ||\ block-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_broadcast_p_block_holder_a8268ceaca4ee970f90601f540be8fd01}{get\_block}}()-\/>column\_metas\_size())\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7ff88976465ce6045ac9b14c8b2e1d30}{\_buffer}}-\/>\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer_a6bf5c5e10d840ac7f687a74699645e91}{add\_block}}(\{this,\ block,\ eos\}));}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00455\ \ \ \ \ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{comment}{//\ send\ \_mutable\_block}}
\DoxyCodeLine{00458\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a68ad42171b2669c2525ceacbbcd0c21d}{send\_current\_block}}(\textcolor{keywordtype}{bool}\ eos)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_aef8e753cccabd64207d9ca9e8e034133}{is\_local}}())\ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a01a2f3a3299210d1095c7d0842926a2c}{send\_local\_block}}(eos);}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ PBlock*\ block\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb3cdfb32013431bee5f9bd8f3db17aa}{\_mutable\_block}})\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ block\_ptr\ =\ \textcolor{keyword}{new}\ PBlock();\ \textcolor{comment}{//\ TODO:\ need\ a\ pool\ of\ PBlock()}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ block\ =\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb3cdfb32013431bee5f9bd8f3db17aa}{\_mutable\_block}}-\/>to\_block();}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_af551507ffae78c3c43302b826a0ecbe9}{\_parent}}-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender_adc0f1acee9a4c1683ddbc68e1c8feaa8}{serialize\_block}}(\&block,\ block\_ptr));}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ block.clear\_column\_data();}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_afb3cdfb32013431bee5f9bd8f3db17aa}{\_mutable\_block}}-\/>set\_muatable\_columns(block.mutate\_columns());}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_abc87cb3fe080d337daec540b52526f53}{send\_block}}(block\_ptr,\ eos));}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00473\ \ \ \ \ \}}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a1909b6eaed430b21dd27ae0e4ab18886}{registe}}(\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer}{pipeline::ExchangeSinkBuffer}}*\ buffer)\ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7ff88976465ce6045ac9b14c8b2e1d30}{\_buffer}}\ =\ buffer;}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7ff88976465ce6045ac9b14c8b2e1d30}{\_buffer}}-\/>\mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer_a4394ae08dd61a900047fe6fa1fd65d01}{register\_sink}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_channel_a969d360d5b2bf368cef4a6a1041b9141}{\_fragment\_instance\_id}});}
\DoxyCodeLine{00478\ \ \ \ \ \}}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_data_stream_sender}{VDataStreamSender}};}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_exchange_sink_buffer}{pipeline::ExchangeSinkBuffer}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a7ff88976465ce6045ac9b14c8b2e1d30}{\_buffer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00484\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_pip_channel_a52fd35408ff58bc51876a3c9af8b6f1d}{\_eos\_send}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00485\ \};}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \}\ \textcolor{comment}{//\ namespace\ vectorized}}
\DoxyCodeLine{00488\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
