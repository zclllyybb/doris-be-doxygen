\hypertarget{data__queue_8h_source}{}\doxysection{data\+\_\+queue.\+h}
\label{data__queue_8h_source}\index{/Users/dabowang/doris/be/src/pipeline/exec/data\_queue.h@{/Users/dabowang/doris/be/src/pipeline/exec/data\_queue.h}}
\mbox{\hyperlink{data__queue_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <deque>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }Block;}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }pipeline\ \{}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue}{DataQueue}}\ \{}
\DoxyCodeLine{00033\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//always\ one\ is\ enough,\ but\ in\ union\ node\ it's\ has\ more\ children}}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue}{DataQueue}}(\textcolor{keywordtype}{int}\ child\_count\ =\ 1);}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a8c8ecfb934c765efc114a18c169703b0}{\string~DataQueue}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a4d3d5a543f7581782223255e40ac91b4}{get\_block\_from\_queue}}(std::unique\_ptr<vectorized::Block>*\ block,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}*\ child\_idx\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a59dcc7ea7ea107602c746a0dd226b13b}{push\_block}}(std::unique\_ptr<vectorized::Block>\ block,\ \textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ std::unique\_ptr<vectorized::Block>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_ad0467bb11ed0ef08d51f87a5bad65e40}{get\_free\_block}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_ae62a9e570d710de5db40e2abc777a534}{push\_free\_block}}(std::unique\_ptr<vectorized::Block>\ output\_block,\ \textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a34b3c5a7c8cfa92307331884f8f4258f}{set\_finish}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a6dc98d7e56920f704770f5f3fdc4a55b}{set\_canceled}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);\ \textcolor{comment}{//\ should\ set\ before\ finish}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a7eb9008884bf3d0c9b07c0a41b4c4309}{is\_finish}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_aa8aa7660819ded30ef7b4587084dbd87}{is\_all\_finish}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a4dd364c5ede642205ac56c7737b723a5}{has\_enough\_space\_to\_push}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a0a46aaf5f99168df7001cfcabaf1a2fc}{has\_data\_or\_finished}}(\textcolor{keywordtype}{int}\ child\_idx\ =\ 0);}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_ad516cd57df39db2c3d439c070b35e4f2}{remaining\_has\_data}}();}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_af3a7e19d028e56728193ece51c5fdf4f}{max\_bytes\_in\_queue}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_af879249a20936e0753c51e61dfa1fded}{\_max\_bytes\_in\_queue}};\ \}}
\DoxyCodeLine{00057\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a358b5f9fb068aac8805564431afff1c6}{max\_size\_of\_queue}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a8ed7f762d95674703580a22e731d83c1}{\_max\_size\_of\_queue}};\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a2afe72e1dfb8ee0a8821a20cad54b9d1}{data\_exhausted}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a06891fade6c582583401cca9864fdf8e}{\_data\_exhausted}};\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00062\ \ \ \ \ std::vector<std::unique\_ptr<std::mutex>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a947a0d59ef59cf41619ba4cc9bbd5a4d}{\_queue\_blocks\_lock}};}
\DoxyCodeLine{00063\ \ \ \ \ std::vector<std::deque<std::unique\_ptr<vectorized::Block>>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_aa3affd381d775e4c344ed56d9c5b768f}{\_queue\_blocks}};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ std::vector<std::unique\_ptr<std::mutex>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a709b12332270401f8edc7658d3aaf210}{\_free\_blocks\_lock}};}
\DoxyCodeLine{00066\ \ \ \ \ std::vector<std::deque<std::unique\_ptr<vectorized::Block>>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_af167358802ba84d940f1f01d08d6af72}{\_free\_blocks}};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//how\ many\ deque\ will\ be\ init,\ always\ will\ be\ one}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_acd2188aeace93edc77d0a61d5b2c1e87}{\_child\_count}}\ =\ 0;}
\DoxyCodeLine{00070\ \ \ \ \ std::deque<std::atomic<bool>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_acb8a7da3b3e39ec7663cf2aabccb7bd2}{\_is\_finished}};}
\DoxyCodeLine{00071\ \ \ \ \ std::deque<std::atomic<bool>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a8e5e1e227b98ae5377c4f998e2b472c0}{\_is\_canceled}};}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ int64\_t\ just\ for\ counter\ of\ profile}}
\DoxyCodeLine{00073\ \ \ \ \ std::deque<std::atomic<int64\_t>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a957e9765930154b27b88b4937069bd73}{\_cur\_bytes\_in\_queue}};}
\DoxyCodeLine{00074\ \ \ \ \ std::deque<std::atomic<uint32\_t>>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_ac8c04115a059b753965524177d360f20}{\_cur\_blocks\_nums\_in\_queue}};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//this\ will\ be\ indicate\ which\ queue\ has\ data,\ it's\ useful\ when\ have\ many\ queues}}
\DoxyCodeLine{00077\ \ \ \ \ std::atomic<int>\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_ad72b4ab002a86278e2823916c869d6bd}{\_flag\_queue\_idx}}\ =\ 0;}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ only\ used\ by\ streaming\ agg\ source\ operator}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a06891fade6c582583401cca9864fdf8e}{\_data\_exhausted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//this\ only\ use\ to\ record\ the\ queue[0]\ for\ profile}}
\DoxyCodeLine{00082\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_af879249a20936e0753c51e61dfa1fded}{\_max\_bytes\_in\_queue}}\ =\ 0;}
\DoxyCodeLine{00083\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a8ed7f762d95674703580a22e731d83c1}{\_max\_size\_of\_queue}}\ =\ 0;}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_data_queue_a65d94d95ca96073b8b6945b782ac6bd5}{MAX\_BYTE\_OF\_QUEUE}}\ =\ 1024l\ *\ 1024\ *\ 1024\ /\ 10;}
\DoxyCodeLine{00085\ \};}
\DoxyCodeLine{00086\ \}\ \textcolor{comment}{//\ namespace\ pipeline}}
\DoxyCodeLine{00087\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
