\hypertarget{classdoris_1_1_cumulative_compaction_policy}{}\doxysection{Cumulative\+Compaction\+Policy类 参考}
\label{classdoris_1_1_cumulative_compaction_policy}\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}


{\ttfamily \#include $<$cumulative\+\_\+compaction\+\_\+policy.\+h$>$}



类 Cumulative\+Compaction\+Policy 继承关系图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{dc/d1e/classdoris_1_1_cumulative_compaction_policy__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public 成员函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_ac2afd00917208345649b818ff639f6cb}{Cumulative\+Compaction\+Policy}} ()
\item 
virtual \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_ac0907e3d5261f2eb1f871315702c21ea}{$\sim$\+Cumulative\+Compaction\+Policy}} ()
\begin{DoxyCompactList}\small\item\em Destructor function of \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}}. \end{DoxyCompactList}\item 
virtual uint32\+\_\+t \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_a4d8b17498731ea3034346b42a8a4e890}{calc\+\_\+cumulative\+\_\+compaction\+\_\+score}} (\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$tablet)=0
\item 
virtual int \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_abe0974c008cdf58ba27952cdeff3f430}{pick\+\_\+input\+\_\+rowsets}} (\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$tablet, const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ \&candidate\+\_\+rowsets, const int64\+\_\+t max\+\_\+compaction\+\_\+score, const int64\+\_\+t min\+\_\+compaction\+\_\+score, std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ $\ast$input\+\_\+rowsets, \mbox{\hyperlink{structdoris_1_1_version}{Version}} $\ast$last\+\_\+delete\+\_\+version, size\+\_\+t $\ast$compaction\+\_\+score)=0
\item 
virtual void \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_a4b34b6f469138cd6cb7209e5beae4ebb}{update\+\_\+cumulative\+\_\+point}} (\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$tablet, const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ \&input\+\_\+rowsets, \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} output\+\_\+rowset, \mbox{\hyperlink{structdoris_1_1_version}{Version}} \&last\+\_\+delete\+\_\+version)=0
\item 
virtual void \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_adee345202204a9e65fb2340ca0d6db7f}{calculate\+\_\+cumulative\+\_\+point}} (\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$tablet, const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a8e1aa733e7ffe7bd29887ebdf7c1303d}{Rowset\+Meta\+Shared\+Ptr}} $>$ \&all\+\_\+rowsets, int64\+\_\+t current\+\_\+cumulative\+\_\+point, int64\+\_\+t $\ast$cumulative\+\_\+point)=0
\item 
virtual std\+::string \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy_a338331e32e424c27f3f50d6435b0c7da}{name}} ()=0
\begin{DoxyCompactList}\small\item\em Fetch cumulative policy name \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
This class \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}} is the base class of cumulative compaction policy. It defines the policy to do cumulative compaction. It has different derived classes, which implements concrete cumulative compaction algorithm. The policy is configured by conf\+::cumulative\+\_\+compaction\+\_\+policy. The policy functions is the main steps to do cumulative compaction. For example, how to pick candidate rowsets from tablet using current policy, how to calculate the cumulative point and how to calculate the tablet cumulative compaction score and so on. 

\doxysubsection{构造及析构函数说明}
\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_ac2afd00917208345649b818ff639f6cb}\label{classdoris_1_1_cumulative_compaction_policy_ac2afd00917208345649b818ff639f6cb}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{CumulativeCompactionPolicy()}{CumulativeCompactionPolicy()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}} (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Constructor function of \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}}, it needs tablet pointer to access tablet method. param tablet, the shared pointer of tablet \mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_ac0907e3d5261f2eb1f871315702c21ea}\label{classdoris_1_1_cumulative_compaction_policy_ac0907e3d5261f2eb1f871315702c21ea}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!````~CumulativeCompactionPolicy@{$\sim$CumulativeCompactionPolicy}}
\index{````~CumulativeCompactionPolicy@{$\sim$CumulativeCompactionPolicy}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{$\sim$CumulativeCompactionPolicy()}{~CumulativeCompactionPolicy()}}
{\footnotesize\ttfamily virtual $\sim$\mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}} (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Destructor function of \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{Cumulative\+Compaction\+Policy}}. 



\doxysubsection{成员函数说明}
\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_a4d8b17498731ea3034346b42a8a4e890}\label{classdoris_1_1_cumulative_compaction_policy_a4d8b17498731ea3034346b42a8a4e890}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!calc\_cumulative\_compaction\_score@{calc\_cumulative\_compaction\_score}}
\index{calc\_cumulative\_compaction\_score@{calc\_cumulative\_compaction\_score}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{calc\_cumulative\_compaction\_score()}{calc\_cumulative\_compaction\_score()}}
{\footnotesize\ttfamily virtual uint32\+\_\+t calc\+\_\+cumulative\+\_\+compaction\+\_\+score (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$}]{tablet }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}

Calculate the cumulative compaction score of the tablet. This function uses rowsets meta and current cumulative point to calculative the score of tablet. The score depends on the concrete algorithm of policy. In general, the score represents the segments nums to do cumulative compaction in total rowsets. The more score tablet gets, the earlier it can do cumulative compaction. param all\+\_\+rowsets, all rowsets in tablet. param current\+\_\+cumulative\+\_\+point, current cumulative point value. return score, the result score after calculate. 

在 \mbox{\hyperlink{classdoris_1_1_size_based_cumulative_compaction_policy_ad5872f5d8ad6ff174d2335b6b0c387f7}{Size\+Based\+Cumulative\+Compaction\+Policy}} 内被实现.

\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_abe0974c008cdf58ba27952cdeff3f430}\label{classdoris_1_1_cumulative_compaction_policy_abe0974c008cdf58ba27952cdeff3f430}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!pick\_input\_rowsets@{pick\_input\_rowsets}}
\index{pick\_input\_rowsets@{pick\_input\_rowsets}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{pick\_input\_rowsets()}{pick\_input\_rowsets()}}
{\footnotesize\ttfamily virtual int pick\+\_\+input\+\_\+rowsets (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$}]{tablet,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ \&}]{candidate\+\_\+rowsets,  }\item[{const int64\+\_\+t}]{max\+\_\+compaction\+\_\+score,  }\item[{const int64\+\_\+t}]{min\+\_\+compaction\+\_\+score,  }\item[{std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ $\ast$}]{input\+\_\+rowsets,  }\item[{\mbox{\hyperlink{structdoris_1_1_version}{Version}} $\ast$}]{last\+\_\+delete\+\_\+version,  }\item[{size\+\_\+t $\ast$}]{compaction\+\_\+score }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}

Pick input rowsets from candidate rowsets for compaction. This function is pure virtual function. Its implementation depends on concrete compaction policy. param candidate\+\_\+rowsets, the candidate\+\_\+rowsets vector container to pick input rowsets return input\+\_\+rowsets, the vector container as return return last\+\_\+delete\+\_\+version, if has delete rowset, record the delete version from input\+\_\+rowsets return compaction\+\_\+score, calculate the compaction score of picked input rowset 

在 \mbox{\hyperlink{classdoris_1_1_size_based_cumulative_compaction_policy_a3220157fa77fd36edaea621cd1177956}{Size\+Based\+Cumulative\+Compaction\+Policy}} 内被实现.

\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_a4b34b6f469138cd6cb7209e5beae4ebb}\label{classdoris_1_1_cumulative_compaction_policy_a4b34b6f469138cd6cb7209e5beae4ebb}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!update\_cumulative\_point@{update\_cumulative\_point}}
\index{update\_cumulative\_point@{update\_cumulative\_point}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{update\_cumulative\_point()}{update\_cumulative\_point()}}
{\footnotesize\ttfamily virtual void update\+\_\+cumulative\+\_\+point (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$}]{tablet,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}} $>$ \&}]{input\+\_\+rowsets,  }\item[{\mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{Rowset\+Shared\+Ptr}}}]{output\+\_\+rowset,  }\item[{\mbox{\hyperlink{structdoris_1_1_version}{Version}} \&}]{last\+\_\+delete\+\_\+version }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}

Update tablet\textquotesingle{}s cumulative point after cumulative compaction finished. This function is pure virtual function. Each derived has its own update policy which depends on its concrete algorithm. When the cumulative point moves after output rowset, then output rowset will do base compaction next time. param input\+\_\+rowsets, the picked input rowset to do compaction just now param output\+\_\+rowset, the result rowset after compaction 

在 \mbox{\hyperlink{classdoris_1_1_size_based_cumulative_compaction_policy_a3523f47e95cab903b180e4fb310bd320}{Size\+Based\+Cumulative\+Compaction\+Policy}} 内被实现.

\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_adee345202204a9e65fb2340ca0d6db7f}\label{classdoris_1_1_cumulative_compaction_policy_adee345202204a9e65fb2340ca0d6db7f}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!calculate\_cumulative\_point@{calculate\_cumulative\_point}}
\index{calculate\_cumulative\_point@{calculate\_cumulative\_point}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{calculate\_cumulative\_point()}{calculate\_cumulative\_point()}}
{\footnotesize\ttfamily virtual void calculate\+\_\+cumulative\+\_\+point (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}} $\ast$}]{tablet,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{namespacedoris_a8e1aa733e7ffe7bd29887ebdf7c1303d}{Rowset\+Meta\+Shared\+Ptr}} $>$ \&}]{all\+\_\+rowsets,  }\item[{int64\+\_\+t}]{current\+\_\+cumulative\+\_\+point,  }\item[{int64\+\_\+t $\ast$}]{cumulative\+\_\+point }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}

Calculate tablet\textquotesingle{}s cumulative point before compaction. This calculation just executes once when the tablet compacts first time after BE initialization and then motion of cumulative point depends on update\+\_\+cumulative\+\_\+point policy. This function is pure virtual function. In general, the cumulative point splits the rowsets into two parts\+: base rowsets, cumulative rowsets. param all\+\_\+rowsets, all rowsets in the tablet param current\+\_\+cumulative\+\_\+point, current cumulative position return cumulative\+\_\+point, the result of calculating cumulative point position 

在 \mbox{\hyperlink{classdoris_1_1_size_based_cumulative_compaction_policy_aa53788b20b707f9b68b93881c9a4a919}{Size\+Based\+Cumulative\+Compaction\+Policy}} 内被实现.

\mbox{\Hypertarget{classdoris_1_1_cumulative_compaction_policy_a338331e32e424c27f3f50d6435b0c7da}\label{classdoris_1_1_cumulative_compaction_policy_a338331e32e424c27f3f50d6435b0c7da}} 
\index{CumulativeCompactionPolicy@{CumulativeCompactionPolicy}!name@{name}}
\index{name@{name}!CumulativeCompactionPolicy@{CumulativeCompactionPolicy}}
\doxysubsubsection{\texorpdfstring{name()}{name()}}
{\footnotesize\ttfamily virtual std\+::string name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [pure virtual]}}



Fetch cumulative policy name 



在 \mbox{\hyperlink{classdoris_1_1_size_based_cumulative_compaction_policy_abf14a745a4908c83f69c87965fe8eb7e}{Size\+Based\+Cumulative\+Compaction\+Policy}} 内被实现.

这是这个函数的调用关系图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/da2/classdoris_1_1_cumulative_compaction_policy_a338331e32e424c27f3f50d6435b0c7da_icgraph}
\end{center}
\end{figure}


该类的文档由以下文件生成\+:\begin{DoxyCompactItemize}
\item 
/\+Users/dabowang/doris/be/src/olap/\mbox{\hyperlink{cumulative__compaction__policy_8h}{cumulative\+\_\+compaction\+\_\+policy.\+h}}\end{DoxyCompactItemize}
