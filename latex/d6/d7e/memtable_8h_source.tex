\hypertarget{memtable_8h_source}{}\doxysection{memtable.\+h}
\label{memtable_8h_source}\index{/Users/dabowang/doris/be/src/olap/memtable.h@{/Users/dabowang/doris/be/src/olap/memtable.h}}
\mbox{\hyperlink{memtable_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <ostream>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{object__pool_8h}{common/object\_pool.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__define_8h}{olap/olap\_define.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{skiplist_8h}{olap/skiplist.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet_8h}{olap/tablet.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mem__tracker_8h}{runtime/memory/mem\_tracker.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{aggregate__function_8h}{vec/aggregate\_functions/aggregate\_function.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{arena_8h}{vec/common/arena.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__ref_8h}{vec/common/string\_ref.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }RowsetWriter;}
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }Schema;}
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }SlotDescriptor;}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }TabletSchema;}
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }TupleDescriptor;}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_mem_table}{MemTable}}\ \{}
\DoxyCodeLine{00041\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_mem_table}{MemTable}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,\ \mbox{\hyperlink{classdoris_1_1_schema}{Schema}}*\ schema,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_schema}{TabletSchema}}*\ tablet\_schema,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<SlotDescriptor*>*\ slot\_descs,\ \mbox{\hyperlink{classdoris_1_1_tuple_descriptor}{TupleDescriptor}}*\ tuple\_desc,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,\ \mbox{\hyperlink{namespacedoris_a9eac641d2af334ef0f001d2ca2a498a4}{DeleteBitmapPtr}}\ delete\_bitmap,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}\&\ rowset\_ids,\ int64\_t\ cur\_max\_version,}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<MemTracker>\&\ insert\_mem\_tracker,}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<MemTracker>\&\ flush\_mem\_tracker);}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_mem_table_adbcd5815597071be14aca3a416fddb07}{\string~MemTable}}();}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_aebbec7014f0cd07f57f939f781c46763}{tablet\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a98f28be525261e7ac6cde67ff645ab91}{\_tablet}}-\/>tablet\_id();\ \}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_mem_table_adc337a3b4a43cacb3f425d3ff59fa388}{memory\_usage}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a83cb8ba5f51de74b95d295b34a61ff0b}{\_insert\_mem\_tracker}}-\/>consumption()\ +\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad6c37db25100e4194df5d2acde1f4ecb}{\_arena}}-\/>used\_size()\ +}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_mem_table_af7465948c437414ce84581e269b56d13}{\_flush\_mem\_tracker}}-\/>consumption();}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ insert\ tuple\ from\ (row\_pos)\ to\ (row\_pos+num\_rows)}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a214d2934b7feaa1689d1a63cf274d5c7}{insert}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block,\ \textcolor{keyword}{const}\ std::vector<int>\&\ row\_idxs,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_append\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ae79d51db33335b8b598238b69b214e2f}{shrink\_memtable\_by\_agg}}();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad15bc622ea0caa42a4d158cd0807d02d}{need\_flush}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a396930ca9d781996ed7e46db2b972174}{need\_agg}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a9538544d9aeadf8c4ea33231fe825eb2}{flush}}();}
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_aee1c6f7d85af14d039dec07dc31ae862}{close}}();}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_ac3038a0a3af9bc1f32da9d989ebce588}{flush\_size}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ab0d2b75810b87925a8e58124a75ac368}{\_flush\_size}};\ \}}
\DoxyCodeLine{00070\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_add2dd280e09dbdfab37cc1aae5571767}{merged\_rows}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a30a2808be916836a5ac0d74377140862}{\_merged\_rows}};\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a65c273aab0df0fe51d5d068947c97ed7}{\_do\_flush}}(int64\_t\&\ duration\_ns);}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ row\ pos\ in\ \_input\_mutable\_block}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_aa4e7dd1c98b384dc94669c64bd10868c}{\_row\_pos}};}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a0ad9155ed41f4b8f6160be581dcd8078}{\_agg\_mem}};}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}*\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a69349815b9fb4e6e931be505bee04736}{\_agg\_state\_offset}};}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_ad7812c836ec4f6fbe57e2d07ab3f9cf8}{RowInBlock}}(\textcolor{keywordtype}{size\_t}\ row)\ :\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_aa4e7dd1c98b384dc94669c64bd10868c}{\_row\_pos}}(row)\ \{\}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a33729f8d98bc4f3f8120576c00088bda}{init\_agg\_places}}(\textcolor{keywordtype}{char}*\ agg\_mem,\ \textcolor{keywordtype}{size\_t}*\ agg\_state\_offset)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a0ad9155ed41f4b8f6160be581dcd8078}{\_agg\_mem}}\ =\ agg\_mem;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a69349815b9fb4e6e931be505bee04736}{\_agg\_state\_offset}}\ =\ agg\_state\_offset;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a93827339f57889cffa3af430763ec688}{agg\_places}}(\textcolor{keywordtype}{size\_t}\ offset)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a0ad9155ed41f4b8f6160be581dcd8078}{\_agg\_mem}}\ +\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block_a69349815b9fb4e6e931be505bee04736}{\_agg\_state\_offset}}[offset];\ \}}
\DoxyCodeLine{00089\ \ \ \ \ \};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator}{RowInBlockComparator}}\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_addae3b6b87fe056392441d2284f06b6d}{RowInBlockComparator}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_schema}{Schema}}*\ schema)\ :\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a756a11838517375695fd8ddc33307da7}{\_schema}}(schema)\ \{\}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ call\ set\_block\ before\ operator().}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ first\ time\ insert\ block\ to\ create\ \_input\_mutable\_block,}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ can\ not\ Comparator\ of\ construct\ to\ set\ pblock}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a5190aab77dee3e239d98864115b38135}{set\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_mutable_block}{vectorized::MutableBlock}}*\ pblock)\ \{\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a1bd178f44dc3874d3c897b3fcf882b69}{\_pblock}}\ =\ pblock;\ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a90085506ea5738deac444e406395b56c}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}*\ left,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}*\ right)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_schema}{Schema}}*\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a756a11838517375695fd8ddc33307da7}{\_schema}};}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_mutable_block}{vectorized::MutableBlock}}*\ \mbox{\hyperlink{classdoris_1_1_mem_table_1_1_row_in_block_comparator_a1bd178f44dc3874d3c897b3fcf882b69}{\_pblock}};\ \textcolor{comment}{//\ 对应Memtable::\_input\_mutable\_block}}
\DoxyCodeLine{00103\ \ \ \ \ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_skip_list}{VecTable}}\ =\ \mbox{\hyperlink{classdoris_1_1_skip_list}{SkipList<RowInBlock*,\ RowInBlockComparator>}};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ for\ vectorized}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ac0e2f98ffe2ff53eefcf1ec7ec0b577d}{\_insert\_one\_row\_from\_block}}(\mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}*\ row\_in\_block);}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a125c80705d9d8f7f037e3310846d1a85}{\_aggregate\_two\_row\_in\_block}}(\mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}*\ new\_row,\ \mbox{\hyperlink{structdoris_1_1_mem_table_1_1_row_in_block}{RowInBlock}}*\ row\_in\_skiplist);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad3dadd9096e94c8bca90cd870f9b7b01}{\_generate\_delete\_bitmap}}(int64\_t\ atomic\_num\_segments\_before\_flush,}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ atomic\_num\_segments\_after\_flush);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{comment}{//\ serialize\ block\ to\ row\ store\ format\ and\ append\ serialized\ data\ into\ row\ store\ column}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//\ in\ block}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a77a654af3d731c4ac975097780594557}{serialize\_block\_to\_row\_column}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}\&\ block);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{comment}{//\ Unfold\ variant\ column\ to\ Block}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ Eg.\ [A\ |\ B\ |\ C\ |\ (D,\ E,\ F)]}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ After\ unfold\ block\ structure\ changed\ to\ -\/>\ [A\ |\ B\ |\ C\ |\ D\ |\ E\ |\ F]}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ The\ expanded\ D,\ E,\ F\ is\ dynamic\ part\ of\ the\ block}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad1f8b785c9433045597f5891f88c896e}{unfold\_variant\_column}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}\&\ block);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a98f28be525261e7ac6cde67ff645ab91}{\_tablet}};}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{const}\ KeysType\ \mbox{\hyperlink{classdoris_1_1_mem_table_af9166059709b699acdd9d1100699f58b}{\_keys\_type}};}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema}{Schema}}*\ \mbox{\hyperlink{classdoris_1_1_mem_table_a0f0a292e7e3e626d4eaa75a6c1018298}{\_schema}};}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_schema}{TabletSchema}}*\ \mbox{\hyperlink{classdoris_1_1_mem_table_a6498d8a181259201e10dd7c021f97e15}{\_tablet\_schema}};}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ std::shared\_ptr<RowInBlockComparator>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a295abf8cf40c73154cf9cb7b5867a13b}{\_vec\_row\_comparator}};}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ `\_insert\_manual\_mem\_tracker`\ manually\ records\ the\ memory\ value\ of\ memtable\ insert()}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ `\_flush\_hook\_mem\_tracker`\ automatically\ records\ the\ memory\ value\ of\ memtable\ flush()\ through\ mem\ hook.}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ Is\ used\ to\ flush\ when\ \_insert\_manual\_mem\_tracker\ larger\ than\ write\_buffer\_size\ and\ run\ flush\ memtable}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ when\ the\ sum\ of\ all\ memtable\ (\_insert\_manual\_mem\_tracker\ +\ \_flush\_hook\_mem\_tracker)\ exceeds\ the\ limit.}}
\DoxyCodeLine{00138\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a83cb8ba5f51de74b95d295b34a61ff0b}{\_insert\_mem\_tracker}};}
\DoxyCodeLine{00139\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_mem_table_af7465948c437414ce84581e269b56d13}{\_flush\_mem\_tracker}};}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ It\ is\ only\ used\ for\ verification\ when\ the\ value\ of\ `\_insert\_manual\_mem\_tracker`\ is\ suspected\ to\ be\ wrong.}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ The\ memory\ value\ automatically\ tracked\ by\ the\ mem\ hook\ is\ 20\%\ less\ than\ the\ manually\ recorded}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ value\ in\ the\ memtable,\ because\ some\ freed\ memory\ is\ not\ allocated\ in\ the\ DeltaWriter.}}
\DoxyCodeLine{00143\ \ \ \ \ std::unique\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a90a4a82bd35688162277459afb0efae4}{\_insert\_mem\_tracker\_use\_hook}};}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ Only\ the\ rows\ will\ be\ inserted\ into\ SkipList\ can\ allocate\ memory\ from\ \_arena.}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ In\ this\ way,\ we\ can\ make\ MemTable::memory\_usage()\ to\ be\ more\ accurate,\ and\ eventually}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ reduce\ the\ number\ of\ segment\ files\ that\ are\ generated\ by\ current\ load}}
\DoxyCodeLine{00147\ \ \ \ \ std::unique\_ptr<vectorized::Arena>\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad6c37db25100e4194df5d2acde1f4ecb}{\_arena}};}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ The\ object\ buffer\ pool\ for\ convert\ tuple\ to\ row}}
\DoxyCodeLine{00149\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ae409333a65104d992bf09c2bf55e6b83}{\_agg\_buffer\_pool}};}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ Only\ the\ rows\ will\ be\ inserted\ into\ SkipList\ can\ acquire\ the\ owner\ ship\ from}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ `\_agg\_buffer\_pool`}}
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a073401b667984b8bb7d20af64f35b7f9}{\_agg\_object\_pool}};}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_mem_table_aeebf3d05f83efc32c2ae4447c9668fc4}{\_schema\_size}};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ std::unique\_ptr<VecTable>\ \mbox{\hyperlink{classdoris_1_1_mem_table_ab5079df44cb5b7c6e7d033817bd6bccd}{\_vec\_skip\_list}};}
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_skip_list_1_1_hint}{VecTable::Hint}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a2db06837ad1c933e0a68a5b9ea1d7133}{\_vec\_hint}};}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a8c6a6adcf94ada65ce8bbcfde8dfb853}{\_init\_columns\_offset\_by\_slot\_descs}}(\textcolor{keyword}{const}\ std::vector<SlotDescriptor*>*\ slot\_descs,}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tuple_descriptor}{TupleDescriptor}}*\ tuple\_desc);}
\DoxyCodeLine{00160\ \ \ \ \ std::vector<int>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a26ae273037dca38c0eb9b2da9a10a586}{\_column\_offset}};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ \mbox{\hyperlink{classdoris_1_1_mem_table_a961e51d30f6d47e202b61b90c4c8b8bf}{\_rowset\_writer}};}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ the\ data\ size\ flushed\ on\ disk\ of\ this\ memtable}}
\DoxyCodeLine{00165\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_ab0d2b75810b87925a8e58124a75ac368}{\_flush\_size}}\ =\ 0;}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ Number\ of\ rows\ inserted\ to\ this\ memtable.}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ This\ is\ not\ the\ rows\ in\ this\ memtable,\ because\ rows\ may\ be\ merged}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ in\ unique\ or\ aggregate\ key\ model.}}
\DoxyCodeLine{00169\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_a8ba9cb40f23daa6b1ff64dfcc1bc2915}{\_rows}}\ =\ 0;}
\DoxyCodeLine{00170\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_a30a2808be916836a5ac0d74377140862}{\_merged\_rows}}\ =\ 0;}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//for\ vectorized}}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_mutable_block}{vectorized::MutableBlock}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a2a64298ef91e2b848f805d3c74515497}{\_input\_mutable\_block}};}
\DoxyCodeLine{00174\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_mutable_block}{vectorized::MutableBlock}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a527b614829a407e55585da942b9da72f}{\_output\_mutable\_block}};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{bool}\ is\_final>}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ad346adb96e877f957397dcbf78f64032}{\_collect\_vskiplist\_results}}();}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a3f2a18deb83ed945dc56deeb01e10f48}{\_is\_first\_insertion}};}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a2e8bec7e0eb0a94df0479ba191a7a427}{\_init\_agg\_functions}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block);}
\DoxyCodeLine{00181\ \ \ \ \ std::vector<vectorized::AggregateFunctionPtr>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a582530cbfe78b7492f53427691cbeea0}{\_agg\_functions}};}
\DoxyCodeLine{00182\ \ \ \ \ std::vector<size\_t>\ \mbox{\hyperlink{classdoris_1_1_mem_table_a57c1244d5c9b2997063219e8971cf444}{\_offsets\_of\_aggregate\_states}};}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_mem_table_aa8a8e29a1a0d57e19e881bd30abd8d2c}{\_total\_size\_of\_aggregate\_states}};}
\DoxyCodeLine{00184\ \ \ \ \ std::vector<RowInBlock*>\ \mbox{\hyperlink{classdoris_1_1_mem_table_ae87c27c967326ed6beb8521d079d9da5}{\_row\_in\_blocks}};}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ Memory\ usage\ without\ \_arena.}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_mem_table_a639950ba2ca7304dd5fd71d68dd0d6a0}{\_mem\_usage}};}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9eac641d2af334ef0f001d2ca2a498a4}{DeleteBitmapPtr}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ac30aae5b34b17a0cd2343478de640e8b}{\_delete\_bitmap}};}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}\ \mbox{\hyperlink{classdoris_1_1_mem_table_ab54d4d8f118d426ce8496316b87dd6f0}{\_rowset\_ids}};}
\DoxyCodeLine{00190\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_mem_table_a9653b2cca36edd9e84193e5a0824b767}{\_cur\_max\_version}};}
\DoxyCodeLine{00191\ \};\ \textcolor{comment}{//\ class\ MemTable}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \textcolor{keyword}{inline}\ std::ostream\&\ operator<<(std::ostream\&\ os,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_mem_table}{MemTable}}\&\ table)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ os\ <<\ \textcolor{stringliteral}{"{}MemTable(addr="{}}\ <<\ \&table\ <<\ \textcolor{stringliteral}{"{},\ tablet="{}}\ <<\ table.\mbox{\hyperlink{classdoris_1_1_mem_table_aebbec7014f0cd07f57f939f781c46763}{tablet\_id}}()}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ mem="{}}\ <<\ table.\mbox{\hyperlink{classdoris_1_1_mem_table_adc337a3b4a43cacb3f425d3ff59fa388}{memory\_usage}}();}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordflow}{return}\ os;}
\DoxyCodeLine{00197\ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
