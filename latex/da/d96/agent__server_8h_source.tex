\hypertarget{agent__server_8h_source}{}\doxysection{agent\+\_\+server.\+h}
\label{agent__server_8h_source}\index{/Users/dabowang/be\_all/agent/agent\_server.h@{/Users/dabowang/be\_all/agent/agent\_server.h}}
\mbox{\hyperlink{agent__server_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/AgentService\_types.h"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{exec__env_8h}{runtime/exec\_env.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }TaskWorkerPool;}
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }TopicSubscriber;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{comment}{//\ Each\ method\ corresponds\ to\ one\ RPC\ from\ FE\ Master,\ see\ BackendService.}}
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_agent_server}{AgentServer}}\ \{}
\DoxyCodeLine{00034\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_agent_server}{AgentServer}}(\mbox{\hyperlink{classdoris_1_1_exec_env}{ExecEnv}}*\ exec\_env,\ \textcolor{keyword}{const}\ TMasterInfo\&\ master\_info);}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_agent_server_ab5820aee1477acf21addd3291437f6cd}{\string~AgentServer}}();}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ Receive\ agent\ task\ from\ FE\ master}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_agent_server_a1cecd02deeed0bc78e6531ee211bb5c4}{submit\_tasks}}(TAgentResult\&\ agent\_result,\ \textcolor{keyword}{const}\ std::vector<TAgentTaskRequest>\&\ tasks);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ TODO(lingbin):\ make\ the\ agent\_result\ to\ be\ a\ pointer,\ because\ it\ will\ be\ modified.}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_agent_server_a1bb6748da185fafdd19636f3174c8167}{make\_snapshot}}(TAgentResult\&\ agent\_result,\ \textcolor{keyword}{const}\ TSnapshotRequest\&\ snapshot\_request);}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_agent_server_a344ca585deb8cf0bca64986355219d5f}{release\_snapshot}}(TAgentResult\&\ agent\_result,\ \textcolor{keyword}{const}\ std::string\&\ snapshot\_path);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ Deprecated}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{//\ TODO(lingbin):\ This\ method\ is\ deprecated,\ should\ be\ removed\ later.}}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ [[deprecated]]}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_agent_server_ac0c969aacbfa3f53841abb99760415a0}{publish\_cluster\_state}}(TAgentResult\&\ agent\_result,\ \textcolor{keyword}{const}\ TAgentPublishRequest\&\ request);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_agent_server_a73895f33a1c9e7efac8ae87c83799d80}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_agent_server}{AgentServer}});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ Reference\ to\ the\ ExecEnv::\_master\_info}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{const}\ TMasterInfo\&\ \mbox{\hyperlink{classdoris_1_1_agent_server_ad3267e4b7df922e3d05dfd5000784975}{\_master\_info}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_ab9986c8b1c4f88a023ae52c635785d39}{\_create\_tablet\_workers}};}
\DoxyCodeLine{00057\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a1d8e0fc369a375f1d06fd0c73c9612ad}{\_drop\_tablet\_workers}};}
\DoxyCodeLine{00058\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a06719a7d10dc0e1412b3f092a4f36b31}{\_push\_workers}};}
\DoxyCodeLine{00059\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a8215fda896129409f455d10337f09cad}{\_publish\_version\_workers}};}
\DoxyCodeLine{00060\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_ac295839a684db2bce12faf6a24686a24}{\_clear\_transaction\_task\_workers}};}
\DoxyCodeLine{00061\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_ae57474c2bee02abcbc8b0af13c36ccde}{\_delete\_workers}};}
\DoxyCodeLine{00062\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a0a1bc335fa06a00f6ba581a3b03f65f2}{\_alter\_tablet\_workers}};}
\DoxyCodeLine{00063\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a1f785bffebbae4328ae2a3ecb30c5a9f}{\_push\_cooldown\_conf\_workers}};}
\DoxyCodeLine{00064\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_afb52c1795b608b0b9b111cf9cfe8e67e}{\_clone\_workers}};}
\DoxyCodeLine{00065\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_ad6e395102db5ac124478fd975d85c169}{\_storage\_medium\_migrate\_workers}};}
\DoxyCodeLine{00066\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a678d14fa33bb487a22a463251d6528aa}{\_check\_consistency\_workers}};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ These\ 3\ worker-\/pool\ do\ not\ accept\ tasks\ from\ FE.}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ It\ is\ self\ triggered\ periodically\ and\ reports\ to\ Fe\ master}}
\DoxyCodeLine{00070\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a26316212051b0eb0605428c84a4ae091}{\_report\_task\_workers}};}
\DoxyCodeLine{00071\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a5e2f8dcc99fecf263f34799b8900345f}{\_report\_disk\_state\_workers}};}
\DoxyCodeLine{00072\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a3e95c776032c82851d13f2c4ddb856ac}{\_report\_tablet\_workers}};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a9f67c1e1872afe728d51dd909c95aa1b}{\_upload\_workers}};}
\DoxyCodeLine{00075\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_acc5ec3d116f165f1d969d6f9d854857f}{\_download\_workers}};}
\DoxyCodeLine{00076\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a8dd2d2c5beb95001a32611374124fe94}{\_make\_snapshot\_workers}};}
\DoxyCodeLine{00077\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a7d46fd67ae191229405a66249d8ed692}{\_release\_snapshot\_workers}};}
\DoxyCodeLine{00078\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a93a8b22969d6d2c20d62c6da7283fd8d}{\_move\_dir\_workers}};}
\DoxyCodeLine{00079\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a74a7f15e5197b731faa40a8f95d2e501}{\_recover\_tablet\_workers}};}
\DoxyCodeLine{00080\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a278ee66bf87712c2af73a18471efe047}{\_update\_tablet\_meta\_info\_workers}};}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_a89be21b3f4dc7c61ac9febee7cf0ec43}{\_submit\_table\_compaction\_workers}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ std::unique\_ptr<TaskWorkerPool>\ \mbox{\hyperlink{classdoris_1_1_agent_server_afce75d1762ce41cdf3c435875fed5cfd}{\_push\_storage\_policy\_workers}};}
\DoxyCodeLine{00085\ \ \ \ \ std::unique\_ptr<TopicSubscriber>\ \mbox{\hyperlink{classdoris_1_1_agent_server_afc0855b6b3d212d02c4f1ed98d6f87e0}{\_topic\_subscriber}};}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \}\ \textcolor{comment}{//\ end\ namespace\ doris}}

\end{DoxyCode}
