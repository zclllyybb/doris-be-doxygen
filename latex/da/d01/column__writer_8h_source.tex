\hypertarget{column__writer_8h_source}{}\doxysection{column\+\_\+writer.\+h}
\label{column__writer_8h_source}\index{/Users/dabowang/be\_all/olap/rowset/segment\_v2/column\_writer.h@{/Users/dabowang/be\_all/olap/rowset/segment\_v2/column\_writer.h}}
\mbox{\hyperlink{column__writer_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <memory>}\ \textcolor{comment}{//\ for\ unique\_ptr}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ Status}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/segment\_v2.pb.h"{}}\ \textcolor{comment}{//\ for\ EncodingTypePB}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{inverted__index__parser_8h}{olap/inverted\_index\_parser.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_8h}{olap/rowset/segment\_v2/common.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{page__pointer_8h}{olap/rowset/segment\_v2/page\_pointer.h}}"{}}\ \textcolor{comment}{//\ for\ PagePointer}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet__schema_8h}{olap/tablet\_schema.h}}"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ TabletColumn}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmap_8h}{util/bitmap.h}}"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ BitmapChange}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{slice_8h}{util/slice.h}}"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ OwnedSlice}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }TypeInfo;}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }BlockCompressionCodec;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{namespace\ }io\ \{}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }FileWriter;}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{namespace\ }segment\_v2\ \{}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ input\ and\ output\ parameter:}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ -\/\ input:\ column\_id/unique\_id/type/length/encoding/compression/is\_nullable\ members}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ -\/\ output:\ encoding/indexes/dict\_page\ members}}
\DoxyCodeLine{00046\ \ \ \ \ ColumnMetaPB*\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_adebc58ec62c734223b10c5c6ab6a06eb}{meta}};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a0e4215735914715237cf19ca79d16d10}{data\_page\_size}}\ =\ 64\ *\ 1024;}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ store\ compressed\ page\ only\ when\ space\ saving\ is\ above\ the\ threshold.}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ space\ saving\ =\ 1\ -\/\ compressed\_size\ /\ uncompressed\_size}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a7ddd1551c67e67087f5b4607502ccf4a}{compression\_min\_space\_saving}}\ =\ 0.1;}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a1bd421156df7c5a585ba690790702147}{need\_zone\_map}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_aabbb6a9d530eec16f25b0f881c1b4255}{need\_bitmap\_index}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a0d4fc30a9457427b8c6057b39fc0bd48}{need\_bloom\_filter}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a4b877e1e8ab5e94eb00d2a32d0fdba9c}{is\_ngram\_bf\_index}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00055\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a01a11efa06e2e3005fccc674abf7eb2a}{gram\_size}};}
\DoxyCodeLine{00056\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a8683dfb575640c5f79c9c034121a7664}{gram\_bf\_size}};}
\DoxyCodeLine{00057\ \ \ \ \ std::vector<const\ TabletIndex*>\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_ac72a53eb943278817a2456fa59373c07}{indexes}};}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_index}{TabletIndex}}*\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_afa8d164ccd5111109bcd25ea14b6ca3a}{inverted\_index}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00059\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_aac993ecccd3d88aafefb6b8e3caa1dee}{to\_string}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ ss\ <<\ std::boolalpha\ <<\ \textcolor{stringliteral}{"{}meta="{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_adebc58ec62c734223b10c5c6ab6a06eb}{meta}}-\/>DebugString()}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ data\_page\_size="{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a0e4215735914715237cf19ca79d16d10}{data\_page\_size}}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ compression\_min\_space\_saving\ =\ "{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a7ddd1551c67e67087f5b4607502ccf4a}{compression\_min\_space\_saving}}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ need\_zone\_map="{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a1bd421156df7c5a585ba690790702147}{need\_zone\_map}}\ <<\ \textcolor{stringliteral}{"{},\ need\_bitmap\_index="{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_aabbb6a9d530eec16f25b0f881c1b4255}{need\_bitmap\_index}}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ need\_bloom\_filter"{}}\ <<\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a0d4fc30a9457427b8c6057b39fc0bd48}{need\_bloom\_filter}};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{keyword}{class\ }BitmapIndexWriter;}
\DoxyCodeLine{00071\ \textcolor{keyword}{class\ }InvertedIndexColumnWriter;}
\DoxyCodeLine{00072\ \textcolor{keyword}{class\ }EncodingInfo;}
\DoxyCodeLine{00073\ \textcolor{keyword}{class\ }NullBitmapBuilder;}
\DoxyCodeLine{00074\ \textcolor{keyword}{class\ }OrdinalIndexWriter;}
\DoxyCodeLine{00075\ \textcolor{keyword}{class\ }PageBuilder;}
\DoxyCodeLine{00076\ \textcolor{keyword}{class\ }BloomFilterIndexWriter;}
\DoxyCodeLine{00077\ \textcolor{keyword}{class\ }ZoneMapIndexWriter;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer}{ColumnWriter}}\ \{}
\DoxyCodeLine{00080\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a6cb958085a0e31bf0fa475d9f9b20d33}{create}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\&\ opts,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_column}{TabletColumn}}*\ column,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_file_writer}{io::FileWriter}}*\ file\_writer,\ std::unique\_ptr<ColumnWriter>*\ writer);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a13a8bf488514d4d252ee81fbe9ca5738}{ColumnWriter}}(std::unique\_ptr<Field>\ field,\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a383b4bf9fa5747435372f741fd1747f3}{is\_nullable}})}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_ad29e691b99dce07a7f7e00932e7fe3f1}{\_field}}(std::move(field)),\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a1a279717e7cbd0fd2f8ef16a2c82ce98}{\_is\_nullable}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a383b4bf9fa5747435372f741fd1747f3}{is\_nullable}})\ \{\}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_ad6dd3a3a0a6fbcdae082ec0b19740f5a}{\string~ColumnWriter}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_ab2f77770a6c9c118512d8969992c6add}{init}}()\ =\ 0;}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ CellType>}
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a688db19a8802adab5d4d8cb802c261b0}{append}}(\textcolor{keyword}{const}\ CellType\&\ cell)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a1a279717e7cbd0fd2f8ef16a2c82ce98}{\_is\_nullable}})\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ uint8\_t\ nullmap\ =\ 0;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9a0ed2032b24a9fb9e8df7cbf00bdcb9}{BitmapChange}}(\&nullmap,\ 0,\ cell.is\_null());}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a5e3a34575f5b5bf6e01f5f9a2ae1a339}{append\_nullable}}(\&nullmap,\ cell.cell\_ptr(),\ 1);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ cel\_ptr\ =\ cell.cell\_ptr();}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a121af5a5dc45d10bcf184d2d484b8655}{append\_data}}((\textcolor{keyword}{const}\ uint8\_t**)\&cel\_ptr,\ 1);}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ Now\ we\ only\ support\ append\ one\ by\ one,\ we\ should\ support\ append}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ multi\ rows\ in\ one\ call}}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_af3a932a1a3a70b4cc701d1a1f698ac98}{append}}(\textcolor{keywordtype}{bool}\ is\_null,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}})\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ uint8\_t\ nullmap\ =\ 0;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9a0ed2032b24a9fb9e8df7cbf00bdcb9}{BitmapChange}}(\&nullmap,\ 0,\ is\_null);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a5e3a34575f5b5bf6e01f5f9a2ae1a339}{append\_nullable}}(\&nullmap,\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ 1);}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a688db19a8802adab5d4d8cb802c261b0}{append}}(\textcolor{keyword}{const}\ uint8\_t*\ nullmap,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ \textcolor{keywordtype}{size\_t}\ num\_rows);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a5e3a34575f5b5bf6e01f5f9a2ae1a339}{append\_nullable}}(\textcolor{keyword}{const}\ uint8\_t*\ nullmap,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ \textcolor{keywordtype}{size\_t}\ num\_rows);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ use\ only\ in\ vectorized\ load}}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a5e3a34575f5b5bf6e01f5f9a2ae1a339}{append\_nullable}}(\textcolor{keyword}{const}\ uint8\_t*\ null\_map,\ \textcolor{keyword}{const}\ uint8\_t**\ \mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ \textcolor{keywordtype}{size\_t}\ num\_rows);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a8d4f855acb7f978106c59646e6dabdc8}{append\_nulls}}(\textcolor{keywordtype}{size\_t}\ num\_rows)\ =\ 0;}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a6e20bf56a3a6b201e1f6b3dd869f5098}{finish\_current\_page}}()\ =\ 0;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{virtual}\ uint64\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a085f706aefa17b590dbd139fd10d9374}{estimate\_buffer\_size}}()\ =\ 0;}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ finish\ append\ data}}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a73c2c7b26af4034e369697f05853c81b}{finish}}()\ =\ 0;}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ write\ all\ data\ into\ file}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_aa3eda65e0479bb8fc481c28dd975ee88}{write\_data}}()\ =\ 0;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_aff4b649d245661ef1a9dbf99acaad0cc}{write\_ordinal\_index}}()\ =\ 0;}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a52ba5aa0929d2cf568caa4c61661ca3a}{write\_zone\_map}}()\ =\ 0;}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a1843a28bad7d24390776d72f8105fd2c}{write\_bitmap\_index}}()\ =\ 0;}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a02ca8c1310ed66ae74b7993f5cd91bbd}{write\_inverted\_index}}()\ =\ 0;}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a013007a97e046cf9933b8cb31ebb342c}{write\_bloom\_filter\_index}}()\ =\ 0;}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a313e7bf2db3241cab2c57c1d0466abe0}{get\_next\_rowid}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ used\ for\ append\ not\ null\ data.}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a121af5a5dc45d10bcf184d2d484b8655}{append\_data}}(\textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}\ num\_rows)\ =\ 0;}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a383b4bf9fa5747435372f741fd1747f3}{is\_nullable}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a1a279717e7cbd0fd2f8ef16a2c82ce98}{\_is\_nullable}};\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_field}{Field}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_aaba6d5a8ba7e89f42d49ab26d764bb98}{get\_field}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_ad29e691b99dce07a7f7e00932e7fe3f1}{\_field}}.get();\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00150\ \ \ \ \ std::unique\_ptr<Field>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_ad29e691b99dce07a7f7e00932e7fe3f1}{\_field}};}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a1a279717e7cbd0fd2f8ef16a2c82ce98}{\_is\_nullable}};}
\DoxyCodeLine{00152\ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer_a808b530660cce82f7781d6d6648a634f}{\_null\_bitmap}};}
\DoxyCodeLine{00153\ \};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_flush_page_callback}{FlushPageCallback}}\ \{}
\DoxyCodeLine{00156\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_flush_page_callback_adf95cd80028df586abb3f709e824f054}{put\_extra\_info\_in\_page}}(DataPageFooterPB*\ footer)\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();\ \}}
\DoxyCodeLine{00158\ \};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{comment}{//\ Encode\ one\ column's\ data\ into\ some\ memory\ slice.}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ Because\ some\ columns\ would\ be\ stored\ in\ a\ file,\ we\ should\ wait}}
\DoxyCodeLine{00162\ \textcolor{comment}{//\ until\ all\ columns\ has\ been\ finished,\ and\ then\ data\ can\ be\ written}}
\DoxyCodeLine{00163\ \textcolor{comment}{//\ to\ file}}
\DoxyCodeLine{00164\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer}{ScalarColumnWriter}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer}{ColumnWriter}}\ \{}
\DoxyCodeLine{00165\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer}{ScalarColumnWriter}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\&\ opts,\ std::unique\_ptr<Field>\ field,}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_file_writer}{io::FileWriter}}*\ file\_writer);}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ad7e47f3093b9666cbe849796898cc3b4}{\string~ScalarColumnWriter}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a0142844ee6c98e6bdd1e728c48f1445e}{init}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ada92bb61c523c6d0e3041783686bf07a}{append\_nulls}}(\textcolor{keywordtype}{size\_t}\ num\_rows)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a55c91ed38a23ba30bbe59ff772c87854}{finish\_current\_page}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a34bb060376ee854b41a3fe31c3cb04d6}{estimate\_buffer\_size}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ finish\ append\ data}}
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ad040292e932cc1c1ff2043dfc48c864d}{finish}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a35b4d453b60cfd634338ad378c8539cc}{write\_data}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ad2d35d822ffa5b8d7ab45342dda355bc}{write\_ordinal\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ab29e1a909155fca767afe95a2f7d14fc}{write\_zone\_map}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00185\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_acaee11106bacd9e7f2f73dee39b652ba}{write\_bitmap\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a92cf767ddaf1b2c5dc0b0fea6668e2aa}{write\_inverted\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_af5966baf6cfa5fa715aa7b686ccc7fdd}{write\_bloom\_filter\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a538114ab17e713407a95c1e5e266b7fe}{get\_next\_rowid}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_af9f6bec9ec71f312a5ea4b56ce99f608}{\_next\_rowid}};\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a97de3d1ea294225a1b5e2e676cc29828}{register\_flush\_page\_callback}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_flush_page_callback}{FlushPageCallback}}*\ flush\_page\_callback)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a56820af52b8c3c78b76953fab7117908}{\_new\_page\_callback}}\ =\ flush\_page\_callback;}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aff942b80d87cc0b7fe6a016a62419fc0}{append\_data}}(\textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}\ num\_rows)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ used\ for\ append\ not\ null\ data.\ When\ page\ is\ full,\ will\ append\ data\ not\ reach\ num\_rows.}}
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a076b154ffa05775e3d8f12bcf7a61bf7}{append\_data\_in\_current\_page}}(\textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}*\ num\_written);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a076b154ffa05775e3d8f12bcf7a61bf7}{append\_data\_in\_current\_page}}(\textcolor{keyword}{const}\ uint8\_t*\ ptr,\ \textcolor{keywordtype}{size\_t}*\ num\_written);}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer}{ArrayColumnWriter}};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00202\ \ \ \ \ std::unique\_ptr<PageBuilder>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a7692887264ce76803ef5e36e3d94e150}{\_page\_builder}};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ std::unique\_ptr<NullBitmapBuilder>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a432611aa03a500309a2388fe883f3d16}{\_null\_bitmap\_builder}};}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a63cfc7cb999964710c7e4e61f9199d6c}{\_opts}};}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_encoding_info}{EncodingInfo}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a93c7f48a8f3fa7bba228df3545db1d6a}{\_encoding\_info}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_af9f6bec9ec71f312a5ea4b56ce99f608}{\_next\_rowid}}\ =\ 0;}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ All\ Pages\ will\ be\ organized\ into\ a\ linked\ list}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page}{Page}}\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ data\ vector\ may\ contain:}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ 1.\ one\ OwnedSlice\ if\ the\ page\ body\ is\ compressed}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ 2.\ one\ OwnedSlice\ if\ the\ page\ body\ is\ not\ compressed\ and\ doesn't\ have\ nullmap}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ 3.\ two\ OwnedSlice\ if\ the\ page\ body\ is\ not\ compressed\ and\ has\ nullmap}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ use\ vector\ for\ easier\ management\ for\ lifetime\ of\ OwnedSlice}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ std::vector<OwnedSlice>\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_ac74f2bf047642e3b76e5144c06226869}{data}};}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ PageFooterPB\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_a4c270fdb9ed832dbabaf2594b92fed8c}{footer}};}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page}{Page}}*\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_aaab76a399b95d2d6fe7cacb0197fa83a}{next}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00222\ \ \ \ \ \};}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head}{PageHead}}\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page}{Page}}*\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_aed964c707665191683447d59355098e3}{head}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page}{Page}}*\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_a5e7c1ad684a6aabb34fcbf90b88c56c6}{tail}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00227\ \ \ \ \ \};}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a38f191e83892953b72b0126a4f7bc64c}{\_push\_back\_page}}(\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page}{Page}}*\ page)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ page\ to\ pages'\ tail}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_a5e7c1ad684a6aabb34fcbf90b88c56c6}{tail}}\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_a5e7c1ad684a6aabb34fcbf90b88c56c6}{tail}}-\/>\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_aaab76a399b95d2d6fe7cacb0197fa83a}{next}}\ =\ page;}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_a5e7c1ad684a6aabb34fcbf90b88c56c6}{tail}}\ =\ page;}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_aed964c707665191683447d59355098e3}{head}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head_aed964c707665191683447d59355098e3}{head}}\ =\ page;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ data\_slice\ :\ page-\/>\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_ac74f2bf047642e3b76e5144c06226869}{data}})\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ae6529dd93f77de0f80fc521c1d30f815}{\_data\_size}}\ +=\ data\_slice.slice().size;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ estimate\ (page\ footer\ +\ footer\ size\ +\ checksum)\ took\ 20\ bytes}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ae6529dd93f77de0f80fc521c1d30f815}{\_data\_size}}\ +=\ 20;}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a4937ba64d49cfa7a058c07a31e3ed64b}{\_write\_data\_page}}(Page*\ page);}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_file_writer}{io::FileWriter}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a701aff32e16125760fe20d9703b6cbbd}{\_file\_writer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ total\ size\ of\ data\ page\ list}}
\DoxyCodeLine{00250\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ae6529dd93f77de0f80fc521c1d30f815}{\_data\_size}};}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ cached\ generated\ pages,}}
\DoxyCodeLine{00253\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_scalar_column_writer_1_1_page_head}{PageHead}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_aa629653c09b85082d9454f934c3b64e1}{\_pages}};}
\DoxyCodeLine{00254\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a21a0b789bd49c46f3396bf5453c0e5b5}{\_first\_rowid}}\ =\ 0;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_block_compression_codec}{BlockCompressionCodec}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a6265a2da4d087124fb6dcedf63120663}{\_compress\_codec}};}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ std::unique\_ptr<OrdinalIndexWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a1989b57a838c708d2cdef18e3187efee}{\_ordinal\_index\_builder}};}
\DoxyCodeLine{00259\ \ \ \ \ std::unique\_ptr<ZoneMapIndexWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a38eb543076d5363f879787ec3745ddff}{\_zone\_map\_index\_builder}};}
\DoxyCodeLine{00260\ \ \ \ \ std::unique\_ptr<BitmapIndexWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ad51796dd917fbcace0c8b6778cd5c384}{\_bitmap\_index\_builder}};}
\DoxyCodeLine{00261\ \ \ \ \ std::unique\_ptr<InvertedIndexColumnWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a36006116856787c2561f92ffa6faeaca}{\_inverted\_index\_builder}};}
\DoxyCodeLine{00262\ \ \ \ \ std::unique\_ptr<BloomFilterIndexWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_ab1dafa4be73aa6d11e633f7b393eae07}{\_bloom\_filter\_index\_builder}};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ call\ before\ flush\ data\ page.}}
\DoxyCodeLine{00265\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_flush_page_callback}{FlushPageCallback}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer_a56820af52b8c3c78b76953fab7117908}{\_new\_page\_callback}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00266\ \};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer}{ArrayColumnWriter}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_writer}{ColumnWriter}},\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_flush_page_callback}{FlushPageCallback}}\ \{}
\DoxyCodeLine{00269\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer}{ArrayColumnWriter}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\&\ opts,\ std::unique\_ptr<Field>\ field,}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer}{ScalarColumnWriter}}*\ offset\_writer,\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_scalar_column_writer}{ScalarColumnWriter}}*\ null\_writer,}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<ColumnWriter>\ item\_writer);}
\DoxyCodeLine{00273\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a53362282865d4e4fcdd31712bec1c8eb}{\string~ArrayColumnWriter}}()\ \textcolor{keyword}{override}\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a0142844ee6c98e6bdd1e728c48f1445e}{init}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_aff942b80d87cc0b7fe6a016a62419fc0}{append\_data}}(\textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}\ num\_rows)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a34bb060376ee854b41a3fe31c3cb04d6}{estimate\_buffer\_size}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ad040292e932cc1c1ff2043dfc48c864d}{finish}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a35b4d453b60cfd634338ad378c8539cc}{write\_data}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ad2d35d822ffa5b8d7ab45342dda355bc}{write\_ordinal\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00284\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ada92bb61c523c6d0e3041783686bf07a}{append\_nulls}}(\textcolor{keywordtype}{size\_t}\ num\_rows)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a55c91ed38a23ba30bbe59ff772c87854}{finish\_current\_page}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ab29e1a909155fca767afe95a2f7d14fc}{write\_zone\_map}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a63cfc7cb999964710c7e4e61f9199d6c}{\_opts}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a1bd421156df7c5a585ba690790702147}{need\_zone\_map}})\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}array\ not\ support\ zone\ map"{}});}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_acaee11106bacd9e7f2f73dee39b652ba}{write\_bitmap\_index}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a63cfc7cb999964710c7e4e61f9199d6c}{\_opts}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_aabbb6a9d530eec16f25b0f881c1b4255}{need\_bitmap\_index}})\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}array\ not\ support\ bitmap\ index"{}});}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00300\ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a92cf767ddaf1b2c5dc0b0fea6668e2aa}{write\_inverted\_index}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00302\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_af5966baf6cfa5fa715aa7b686ccc7fdd}{write\_bloom\_filter\_index}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a63cfc7cb999964710c7e4e61f9199d6c}{\_opts}}.\mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options_a0d4fc30a9457427b8c6057b39fc0bd48}{need\_bloom\_filter}})\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}array\ not\ support\ bloom\ filter\ index"{}});}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00307\ \ \ \ \ \}}
\DoxyCodeLine{00308\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a538114ab17e713407a95c1e5e266b7fe}{get\_next\_rowid}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a58b65b9aa5fbbc39e8e13cefe602ef43}{\_offset\_writer}}-\/>get\_next\_rowid();\ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ad361889a70160220a1457c855b1f9051}{put\_extra\_info\_in\_page}}(DataPageFooterPB*\ header)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_ae674b5f7510a082ab13d88ef84d39c29}{write\_null\_column}}(\textcolor{keywordtype}{size\_t}\ num\_rows,\ \textcolor{keywordtype}{bool}\ is\_null);\ \textcolor{comment}{//\ 写入num\_rows个null标记}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a99de58a23e5b4d679c305c0c09b1a797}{has\_empty\_items}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a6864b37b3f48ae0f1b6e5ad396fec75d}{\_item\_writer}}-\/>get\_next\_rowid()\ ==\ 0;\ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00316\ \ \ \ \ std::unique\_ptr<ScalarColumnWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a58b65b9aa5fbbc39e8e13cefe602ef43}{\_offset\_writer}};}
\DoxyCodeLine{00317\ \ \ \ \ std::unique\_ptr<ScalarColumnWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a061bc14065904e942bb8e9e8e0fb5a17}{\_null\_writer}};}
\DoxyCodeLine{00318\ \ \ \ \ std::unique\_ptr<ColumnWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a6864b37b3f48ae0f1b6e5ad396fec75d}{\_item\_writer}};}
\DoxyCodeLine{00319\ \ \ \ \ std::unique\_ptr<InvertedIndexColumnWriter>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a36006116856787c2561f92ffa6faeaca}{\_inverted\_index\_builder}};}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1segment__v2_1_1_column_writer_options}{ColumnWriterOptions}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_array_column_writer_a63cfc7cb999964710c7e4e61f9199d6c}{\_opts}};}
\DoxyCodeLine{00321\ \};}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \}\ \textcolor{comment}{//\ namespace\ segment\_v2}}
\DoxyCodeLine{00324\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
