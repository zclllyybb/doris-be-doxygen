\hypertarget{vec_2common_2hash__table_2hash_8h}{}\doxysection{/\+Users/dabowang/be\+\_\+all/vec/common/hash\+\_\+table/hash.h 文件参考}
\label{vec_2common_2hash__table_2hash_8h}\index{/Users/dabowang/be\_all/vec/common/hash\_table/hash.h@{/Users/dabowang/be\_all/vec/common/hash\_table/hash.h}}
{\ttfamily \#include $<$type\+\_\+traits$>$}\newline
{\ttfamily \#include \char`\"{}parallel\+\_\+hashmap/phmap\+\_\+utils.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/string\+\_\+ref.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/uint128.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/core/types.\+h\char`\"{}}\newline
hash.\+h 的引用(Include)关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d8a/vec_2common_2hash__table_2hash_8h__incl}
\end{center}
\end{figure}
此图展示该文件直接或间接的被哪些文件引用了\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d7/d9d/vec_2common_2hash__table_2hash_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_default_hash_3_01_t_00_01std_1_1enable__if__t_3_01std_1_1is__arithmetic__v_3_01_t_01_4_01_4_01_4}{Default\+Hash$<$ T, std\+::enable\+\_\+if\+\_\+t$<$ std\+::is\+\_\+arithmetic\+\_\+v$<$ T $>$ $>$ $>$}}
\item 
struct \mbox{\hyperlink{struct_default_hash_3_01doris_1_1vectorized_1_1_int128_i_01_4}{Default\+Hash$<$ doris\+::vectorized\+::\+Int128\+I $>$}}
\item 
struct \mbox{\hyperlink{struct_default_hash_3_01doris_1_1_string_ref_01_4}{Default\+Hash$<$ doris\+::\+String\+Ref $>$}}
\item 
struct \mbox{\hyperlink{struct_hash_mix_wrapper}{Hash\+Mix\+Wrapper$<$ Key, Hash $>$}}
\item 
struct \mbox{\hyperlink{struct_hash_c_r_c32_3_01doris_1_1vectorized_1_1_u_int256_01_4}{Hash\+CRC32$<$ doris\+::vectorized\+::\+UInt256 $>$}}
\item 
struct \mbox{\hyperlink{struct_trivial_hash}{Trivial\+Hash}}
\begin{DoxyCompactList}\small\item\em It is reasonable to use for UInt8, UInt16 with sufficient hash table size. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct_int_hash32}{Int\+Hash32$<$ T, salt $>$}}
\begin{DoxyCompactList}\small\item\em For containers. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_ac7b760b6f8508267dde2e4c3429b91ff}{DEFINE\+\_\+\+HASH}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})
\end{DoxyCompactItemize}
\doxysubsection*{函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_ab4f912d10f1cdb6b8f821c7c1a2a6b01}{int\+\_\+hash64}} (\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} x)
\item 
\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_a67854cba63eda258599a8916345bb223}{int\+\_\+hash\+\_\+crc32}} (\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} x)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}} $>$ }\\size\+\_\+t \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_a9b970f381cb6f76ded087471bb81d70a}{default\+\_\+hash64}} (\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}} key)
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}} $>$ }\\size\+\_\+t \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_a19bcc94b5928964a3ff6c46ee50c052b}{hash\+\_\+crc32}} (\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}} key)
\item 
template$<$$>$ size\+\_\+t \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_a72b2ba82175e10dd0371ea34b1cb184d}{hash\+\_\+crc32}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128}{doris\+::vectorized\+::\+UInt128}} u)
\item 
template$<$$>$ size\+\_\+t \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_ae90c4131f2a74f34e4ae07ee35446e66}{hash\+\_\+crc32}} (\mbox{\hyperlink{namespacedoris_1_1vectorized_aeaa392671300adb30bdafd242ac2d21b}{doris\+::vectorized\+::\+Int128}} u)
\item 
{\footnotesize template$<$\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} salt$>$ }\\\mbox{\hyperlink{namespacedoris_1_1vectorized_a16bda7e33183fb876dbb944cbb556702}{doris\+::vectorized\+::\+UInt32}} \mbox{\hyperlink{vec_2common_2hash__table_2hash_8h_aefe901054515b1c3601bd80ee64ccdd9}{int\+\_\+hash32}} (\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} key)
\end{DoxyCompactItemize}


\doxysubsection{宏定义说明}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_ac7b760b6f8508267dde2e4c3429b91ff}\label{vec_2common_2hash__table_2hash_8h_ac7b760b6f8508267dde2e4c3429b91ff}} 
\index{hash.h@{hash.h}!DEFINE\_HASH@{DEFINE\_HASH}}
\index{DEFINE\_HASH@{DEFINE\_HASH}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{DEFINE\_HASH}{DEFINE\_HASH}}
{\footnotesize\ttfamily \#define DEFINE\+\_\+\+HASH(\begin{DoxyParamCaption}\item[{}]{\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}} }\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_hash_c_r_c32}{HashCRC32}}<\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ operator()(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ key)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ hash\_crc32<T>(key);\ \}\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \};}

\end{DoxyCode}


\doxysubsection{函数说明}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_ab4f912d10f1cdb6b8f821c7c1a2a6b01}\label{vec_2common_2hash__table_2hash_8h_ab4f912d10f1cdb6b8f821c7c1a2a6b01}} 
\index{hash.h@{hash.h}!int\_hash64@{int\_hash64}}
\index{int\_hash64@{int\_hash64}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{int\_hash64()}{int\_hash64()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} int\+\_\+hash64 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}}}]{x }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Hash functions that are better than the trivial function std\+::hash.

Example\+: when we do aggregation by the visitor ID, the performance increase is more than 5 times. This is because of following reasons\+:
\begin{DoxyItemize}
\item in Yandex, visitor identifier is an integer that has timestamp with seconds resolution in lower bits;
\item in typical implementation of standard library, hash function for integers is trivial and just use lower bits;
\item traffic is non-\/uniformly distributed across a day;
\item we are using open-\/addressing linear probing hash tables that are most critical to hash function quality, and trivial hash function gives disastrous results. Taken from Murmur\+Hash. This is Murmur finalizer. Faster than int\+\_\+hash32 when inserting into the hash table UInt64 -\/\texorpdfstring{$>$}{>} UInt64, where the key is the visitor ID. 
\end{DoxyItemize}这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/d01/vec_2common_2hash__table_2hash_8h_ab4f912d10f1cdb6b8f821c7c1a2a6b01_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_a67854cba63eda258599a8916345bb223}\label{vec_2common_2hash__table_2hash_8h_a67854cba63eda258599a8916345bb223}} 
\index{hash.h@{hash.h}!int\_hash\_crc32@{int\_hash\_crc32}}
\index{int\_hash\_crc32@{int\_hash\_crc32}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{int\_hash\_crc32()}{int\_hash\_crc32()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}} int\+\_\+hash\+\_\+crc32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}}}]{x }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

CRC32C is not very high-\/quality as a hash function, according to avalanche and bit independence tests (see SMHasher software), as well as a small number of bits, but can behave well when used in hash tables, due to high speed (latency 3 + 1 clock cycle, throughput 1 clock cycle). Works only with SSE 4.\+2 support. On other platforms we do not have CRC32. NOTE This can be confusing.函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{da/d01/vec_2common_2hash__table_2hash_8h_a67854cba63eda258599a8916345bb223_cgraph}
\end{center}
\end{figure}
这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=266pt]{da/d01/vec_2common_2hash__table_2hash_8h_a67854cba63eda258599a8916345bb223_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_a9b970f381cb6f76ded087471bb81d70a}\label{vec_2common_2hash__table_2hash_8h_a9b970f381cb6f76ded087471bb81d70a}} 
\index{hash.h@{hash.h}!default\_hash64@{default\_hash64}}
\index{default\_hash64@{default\_hash64}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{default\_hash64()}{default\_hash64()}}
{\footnotesize\ttfamily size\+\_\+t default\+\_\+hash64 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}}]{key }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=263pt]{da/d01/vec_2common_2hash__table_2hash_8h_a9b970f381cb6f76ded087471bb81d70a_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_a19bcc94b5928964a3ff6c46ee50c052b}\label{vec_2common_2hash__table_2hash_8h_a19bcc94b5928964a3ff6c46ee50c052b}} 
\index{hash.h@{hash.h}!hash\_crc32@{hash\_crc32}}
\index{hash\_crc32@{hash\_crc32}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{hash\_crc32()}{hash\_crc32()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily size\+\_\+t hash\+\_\+crc32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}}]{key }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/d01/vec_2common_2hash__table_2hash_8h_a19bcc94b5928964a3ff6c46ee50c052b_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_a72b2ba82175e10dd0371ea34b1cb184d}\label{vec_2common_2hash__table_2hash_8h_a72b2ba82175e10dd0371ea34b1cb184d}} 
\index{hash.h@{hash.h}!hash\_crc32@{hash\_crc32}}
\index{hash\_crc32@{hash\_crc32}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{hash\_crc32()}{hash\_crc32()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily size\+\_\+t hash\+\_\+crc32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128}{doris\+::vectorized\+::\+UInt128}}}]{u }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_ae90c4131f2a74f34e4ae07ee35446e66}\label{vec_2common_2hash__table_2hash_8h_ae90c4131f2a74f34e4ae07ee35446e66}} 
\index{hash.h@{hash.h}!hash\_crc32@{hash\_crc32}}
\index{hash\_crc32@{hash\_crc32}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{hash\_crc32()}{hash\_crc32()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily size\+\_\+t hash\+\_\+crc32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacedoris_1_1vectorized_aeaa392671300adb30bdafd242ac2d21b}{doris\+::vectorized\+::\+Int128}}}]{u }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{vec_2common_2hash__table_2hash_8h_aefe901054515b1c3601bd80ee64ccdd9}\label{vec_2common_2hash__table_2hash_8h_aefe901054515b1c3601bd80ee64ccdd9}} 
\index{hash.h@{hash.h}!int\_hash32@{int\_hash32}}
\index{int\_hash32@{int\_hash32}!hash.h@{hash.h}}
\doxysubsubsection{\texorpdfstring{int\_hash32()}{int\_hash32()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacedoris_1_1vectorized_a16bda7e33183fb876dbb944cbb556702}{doris\+::vectorized\+::\+UInt32}} int\+\_\+hash32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{doris\+::vectorized\+::\+UInt64}}}]{key }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

A relatively good non-\/cryptographic hash function from UInt64 to UInt32. But worse (both in quality and speed) than just cutting int\+\_\+hash64. Taken from here\+: \href{http://www.concentric.net/~ttwang/tech/inthash.htm}{\texttt{ http\+://www.\+concentric.\+net/$\sim$ttwang/tech/inthash.\+htm}}

Slightly changed compared to the function by link\+: shifts to the right are accidentally replaced by a cyclic shift to the right. This change did not affect the smhasher test results.

It is recommended to use different salt for different tasks. That was the case that in the database values were sorted by hash (for low-\/quality pseudo-\/random spread), and in another place, in the aggregate function, the same hash was used in the hash table, as a result, this aggregate function was monstrously slowed due to collisions.

NOTE Salting is far from perfect, because it commutes with first steps of calculation.

NOTE As mentioned, this function is slower than int\+\_\+hash64. But occasionally, it is faster, when written in a loop and loop is vectorized. 
