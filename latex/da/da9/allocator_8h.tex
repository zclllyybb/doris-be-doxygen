\hypertarget{allocator_8h}{}\doxysection{/\+Users/dabowang/doris/be/src/vec/common/allocator.h 文件参考}
\label{allocator_8h}\index{/Users/dabowang/doris/be/src/vec/common/allocator.h@{/Users/dabowang/doris/be/src/vec/common/allocator.h}}
{\ttfamily \#include $<$fmt/format.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}common/config.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}common/status.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}runtime/memory/chunk.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}runtime/memory/chunk\+\_\+allocator.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}runtime/thread\+\_\+context.\+h\char`\"{}}\newline
{\ttfamily \#include $<$malloc.\+h$>$}\newline
{\ttfamily \#include $<$sys/mman.\+h$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$cstdlib$>$}\newline
{\ttfamily \#include \char`\"{}common/compiler\+\_\+util.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}common/exception.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/allocator\+\_\+fwd.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/mremap.\+h\char`\"{}}\newline
allocator.\+h 的引用(Include)关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d5d/allocator_8h__incl}
\end{center}
\end{figure}
此图展示该文件直接或间接的被哪些文件引用了\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/d8f/allocator_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{类}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{class_allocator}{Allocator$<$ clear\+\_\+memory\+\_\+, mmap\+\_\+populate $>$}}
\item 
class \mbox{\hyperlink{class_allocator_with_stack_memory}{Allocator\+With\+Stack\+Memory$<$ Base, N, Alignment $>$}}
\end{DoxyCompactItemize}
\doxysubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{allocator_8h_ace6d45e8d2305406ecc7a73d3badca9d}{ALLOCATOR\+\_\+\+ASLR}}~1
\item 
\#define \mbox{\hyperlink{allocator_8h_ae4f86bff73414c5fc08c058f957212f0}{MAP\+\_\+\+ANONYMOUS}}~MAP\+\_\+\+ANON
\begin{DoxyCompactList}\small\item\em Required for older Darwin builds, that lack definition of MAP\+\_\+\+ANONYMOUS \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{allocator_8h_a6720c44816a7aac128eded15e6729ceb}{RETURN\+\_\+\+BAD\+\_\+\+ALLOC}}(err)
\item 
\#define \mbox{\hyperlink{allocator_8h_ad4a9a2b0e747054f4c561af9d2726a04}{RETURN\+\_\+\+BAD\+\_\+\+ALLOC\+\_\+\+IF\+\_\+\+PRE\+\_\+\+CATCH}}(err)
\end{DoxyCompactItemize}
\doxysubsection*{变量}
\begin{DoxyCompactItemize}
\item 
static constexpr size\+\_\+t \mbox{\hyperlink{allocator_8h_a8f9ff85e04c2b66a9ae72381531a1d3d}{MMAP\+\_\+\+THRESHOLD}} = 4096
\item 
static constexpr size\+\_\+t \mbox{\hyperlink{allocator_8h_a6963abeb0ed8cc9e5b71a64d84c61a29}{CHUNK\+\_\+\+THRESHOLD}} = 1024
\item 
static constexpr size\+\_\+t \mbox{\hyperlink{allocator_8h_ad24280b750e61c20dc60d3a7bfc65e80}{MMAP\+\_\+\+MIN\+\_\+\+ALIGNMENT}} = 4096
\item 
static constexpr size\+\_\+t \mbox{\hyperlink{allocator_8h_ae60f6e1fe30d304fcc3db0663d50d61d}{MALLOC\+\_\+\+MIN\+\_\+\+ALIGNMENT}} = 8
\end{DoxyCompactItemize}


\doxysubsection{宏定义说明}
\mbox{\Hypertarget{allocator_8h_ace6d45e8d2305406ecc7a73d3badca9d}\label{allocator_8h_ace6d45e8d2305406ecc7a73d3badca9d}} 
\index{allocator.h@{allocator.h}!ALLOCATOR\_ASLR@{ALLOCATOR\_ASLR}}
\index{ALLOCATOR\_ASLR@{ALLOCATOR\_ASLR}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{ALLOCATOR\_ASLR}{ALLOCATOR\_ASLR}}
{\footnotesize\ttfamily \#define ALLOCATOR\+\_\+\+ASLR~1}

\mbox{\Hypertarget{allocator_8h_ae4f86bff73414c5fc08c058f957212f0}\label{allocator_8h_ae4f86bff73414c5fc08c058f957212f0}} 
\index{allocator.h@{allocator.h}!MAP\_ANONYMOUS@{MAP\_ANONYMOUS}}
\index{MAP\_ANONYMOUS@{MAP\_ANONYMOUS}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{MAP\_ANONYMOUS}{MAP\_ANONYMOUS}}
{\footnotesize\ttfamily \#define MAP\+\_\+\+ANONYMOUS~MAP\+\_\+\+ANON}



Required for older Darwin builds, that lack definition of MAP\+\_\+\+ANONYMOUS 

\mbox{\Hypertarget{allocator_8h_a6720c44816a7aac128eded15e6729ceb}\label{allocator_8h_a6720c44816a7aac128eded15e6729ceb}} 
\index{allocator.h@{allocator.h}!RETURN\_BAD\_ALLOC@{RETURN\_BAD\_ALLOC}}
\index{RETURN\_BAD\_ALLOC@{RETURN\_BAD\_ALLOC}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{RETURN\_BAD\_ALLOC}{RETURN\_BAD\_ALLOC}}
{\footnotesize\ttfamily \#define RETURN\+\_\+\+BAD\+\_\+\+ALLOC(\begin{DoxyParamCaption}\item[{}]{err }\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{do}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ LOG(WARNING)\ <<\ err;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (!\mbox{\hyperlink{namespacedoris_a21a47b46c497d4e73372a36a77b712e3}{doris::enable\_thread\_catch\_bad\_alloc}})\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ doris::MemTrackerLimiter::print\_log\_process\_usage(err);\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::bad\_alloc\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{while}\ (0)}

\end{DoxyCode}
\mbox{\Hypertarget{allocator_8h_ad4a9a2b0e747054f4c561af9d2726a04}\label{allocator_8h_ad4a9a2b0e747054f4c561af9d2726a04}} 
\index{allocator.h@{allocator.h}!RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH@{RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH}}
\index{RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH@{RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH}{RETURN\_BAD\_ALLOC\_IF\_PRE\_CATCH}}
{\footnotesize\ttfamily \#define RETURN\+\_\+\+BAD\+\_\+\+ALLOC\+\_\+\+IF\+\_\+\+PRE\+\_\+\+CATCH(\begin{DoxyParamCaption}\item[{}]{err }\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{do}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ LOG(WARNING)\ <<\ err;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (!\mbox{\hyperlink{namespacedoris_a21a47b46c497d4e73372a36a77b712e3}{doris::enable\_thread\_catch\_bad\_alloc}})\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ doris::MemTrackerLimiter::print\_log\_process\_usage(err);\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::bad\_alloc\ \{\};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ \}\ \textcolor{keywordflow}{while}\ (0)}

\end{DoxyCode}


\doxysubsection{变量说明}
\mbox{\Hypertarget{allocator_8h_a8f9ff85e04c2b66a9ae72381531a1d3d}\label{allocator_8h_a8f9ff85e04c2b66a9ae72381531a1d3d}} 
\index{allocator.h@{allocator.h}!MMAP\_THRESHOLD@{MMAP\_THRESHOLD}}
\index{MMAP\_THRESHOLD@{MMAP\_THRESHOLD}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{MMAP\_THRESHOLD}{MMAP\_THRESHOLD}}
{\footnotesize\ttfamily constexpr size\+\_\+t MMAP\+\_\+\+THRESHOLD = 4096\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}}

In debug build, use small mmap threshold to reproduce more memory stomping bugs. Along with ASLR it will hopefully detect more issues than ASan. The program may fail due to the limit on number of memory mappings. \mbox{\Hypertarget{allocator_8h_a6963abeb0ed8cc9e5b71a64d84c61a29}\label{allocator_8h_a6963abeb0ed8cc9e5b71a64d84c61a29}} 
\index{allocator.h@{allocator.h}!CHUNK\_THRESHOLD@{CHUNK\_THRESHOLD}}
\index{CHUNK\_THRESHOLD@{CHUNK\_THRESHOLD}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{CHUNK\_THRESHOLD}{CHUNK\_THRESHOLD}}
{\footnotesize\ttfamily constexpr size\+\_\+t CHUNK\+\_\+\+THRESHOLD = 1024\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}}

\mbox{\Hypertarget{allocator_8h_ad24280b750e61c20dc60d3a7bfc65e80}\label{allocator_8h_ad24280b750e61c20dc60d3a7bfc65e80}} 
\index{allocator.h@{allocator.h}!MMAP\_MIN\_ALIGNMENT@{MMAP\_MIN\_ALIGNMENT}}
\index{MMAP\_MIN\_ALIGNMENT@{MMAP\_MIN\_ALIGNMENT}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{MMAP\_MIN\_ALIGNMENT}{MMAP\_MIN\_ALIGNMENT}}
{\footnotesize\ttfamily constexpr size\+\_\+t MMAP\+\_\+\+MIN\+\_\+\+ALIGNMENT = 4096\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}}

\mbox{\Hypertarget{allocator_8h_ae60f6e1fe30d304fcc3db0663d50d61d}\label{allocator_8h_ae60f6e1fe30d304fcc3db0663d50d61d}} 
\index{allocator.h@{allocator.h}!MALLOC\_MIN\_ALIGNMENT@{MALLOC\_MIN\_ALIGNMENT}}
\index{MALLOC\_MIN\_ALIGNMENT@{MALLOC\_MIN\_ALIGNMENT}!allocator.h@{allocator.h}}
\doxysubsubsection{\texorpdfstring{MALLOC\_MIN\_ALIGNMENT}{MALLOC\_MIN\_ALIGNMENT}}
{\footnotesize\ttfamily constexpr size\+\_\+t MALLOC\+\_\+\+MIN\+\_\+\+ALIGNMENT = 8\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [constexpr]}}

