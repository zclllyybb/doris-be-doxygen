\hypertarget{aggregation__common_8h_source}{}\doxysection{aggregation\+\_\+common.\+h}
\label{aggregation__common_8h_source}\index{/Users/dabowang/be\_all/vec/common/aggregation\_common.h@{/Users/dabowang/be\_all/vec/common/aggregation\_common.h}}
\mbox{\hyperlink{aggregation__common_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ copied\ from}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ https://github.com/ClickHouse/ClickHouse/blob/master/src/Interpreters/AggregationCommon.h}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ and\ modified\ by\ Doris}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column_8h}{vec/columns/column.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{columns__number_8h}{vec/columns/columns\_number.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{arena_8h}{vec/common/arena.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{assert__cast_8h}{vec/common/assert\_cast.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vec_2common_2hash__table_2hash_8h}{vec/common/hash\_table/hash.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{memcpy__small_8h}{vec/common/memcpy\_small.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sip__hash_8h}{vec/common/sip\_hash.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__ref_8h}{vec/common/string\_ref.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uint128_8h}{vec/common/uint128.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris_1_1vectorized}{doris::vectorized}}\ \{}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_1_1vectorized_acd363b547e2751740ee131fc0a5911ab}{Sizes}}\ =\ std::vector<size\_t>;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{namespace\ }\{}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ clang-\/format\ off}}
\DoxyCodeLine{00056\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00057\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ get\_bitmap\_size()\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ ==\ 32)}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 4:\ (\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ ==\ 16)}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 2:\ ((\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ ==\ 8)}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 1:\ ((\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ ==\ 4)\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 1:\ ((\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ ==\ 2)\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 1:\ 0)));}
\DoxyCodeLine{00064\ \}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ clang-\/format\ on}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \}\ \textcolor{comment}{//\ namespace}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00070\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_1_1vectorized_a5cb3ca4f7fe6de0f912e245370b89532}{KeysNullMap}}\ =\ std::array<UInt8,\ get\_bitmap\_size<T>()>;}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{bool}\ has\_low\_cardinality\ =\ false>}
\DoxyCodeLine{00075\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}}
\DoxyCodeLine{00076\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a088747e70b93b87fe0411ef0e0d784f1}{pack\_fixed}}(\textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keywordtype}{size\_t}\ keys\_size,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21d8623653ca0034d9268644110394b6}{ColumnRawPtrs}}\&\ key\_columns,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_acd363b547e2751740ee131fc0a5911ab}{Sizes}}\&\ key\_sizes,}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21d8623653ca0034d9268644110394b6}{ColumnRawPtrs}}*\ low\_cardinality\_positions\ [[maybe\_unused]]\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_acd363b547e2751740ee131fc0a5911ab}{Sizes}}*\ low\_cardinality\_sizes\ [[maybe\_unused]]\ =\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ key;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ bytes[\textcolor{keyword}{sizeof}(key)]\ =\ \{\};}
\DoxyCodeLine{00082\ \ \ \ \ \};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset\ =\ 0;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ keys\_size;\ ++j)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ =\ i;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column}{IColumn}}*\ column\ =\ key\_columns[j];}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (has\_low\_cardinality)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column}{IColumn}}*\ positions\ =\ (*low\_cardinality\_positions)[j])\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ ((*low\_cardinality\_sizes)[j])\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacedoris_1_1vectorized_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}}):}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ =\ assert\_cast<const\ ColumnUInt8*>(positions)-\/>get\_element(i);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacedoris_1_1vectorized_afab11e51a98da69a0956ae5110641c8d}{UInt16}}):}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ =\ assert\_cast<const\ ColumnUInt16*>(positions)-\/>get\_element(i);}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacedoris_1_1vectorized_a16bda7e33183fb876dbb944cbb556702}{UInt32}}):}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ =\ assert\_cast<const\ ColumnUInt32*>(positions)-\/>get\_element(i);}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacedoris_1_1vectorized_a81586a76c764e2556f67139907fa5440}{UInt64}}):}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ =\ assert\_cast<const\ ColumnUInt64*>(positions)-\/>get\_element(i);}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LOG(FATAL)\ <<\ \textcolor{stringliteral}{"{}Unexpected\ size\ of\ index\ type\ for\ low\ cardinality\ column."{}};}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (key\_sizes[j])\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(column)-\/>get\_raw\_data\_begin<1>()\ +\ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}},}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1);}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 1;}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(column)-\/>get\_raw\_data\_begin<2>()\ +}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ *\ 2,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2);}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 2;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(column)-\/>get\_raw\_data\_begin<4>()\ +}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ *\ 4,}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 4);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 4;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 8:}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(column)-\/>get\_raw\_data\_begin<8>()\ +}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ *\ 8,}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 8);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 8;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(column)-\/>get\_raw\_data\_begin<1>()\ +}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}\ *\ key\_sizes[j],}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_sizes[j]);}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ key\_sizes[j];}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{return}\ key;}
\DoxyCodeLine{00148\ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00151\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00152\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a088747e70b93b87fe0411ef0e0d784f1}{pack\_fixed}}(\textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keywordtype}{size\_t}\ keys\_size,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21d8623653ca0034d9268644110394b6}{ColumnRawPtrs}}\&\ key\_columns,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_acd363b547e2751740ee131fc0a5911ab}{Sizes}}\&\ key\_sizes,}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a5cb3ca4f7fe6de0f912e245370b89532}{KeysNullMap<T>}}\&\ bitmap)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{union\ }\{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ key;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ bytes[\textcolor{keyword}{sizeof}(key)]\ =\ \{\};}
\DoxyCodeLine{00158\ \ \ \ \ \};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset\ =\ 0;}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ bitmap\_size\ =\ std::tuple\_size<KeysNullMap<T>>\mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{::value}};}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ has\_bitmap\ =\ bitmap\_size\ >\ 0;}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_bitmap)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,\ bitmap.data(),\ bitmap\_size\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespacedoris_1_1vectorized_ac82f32fb6f16dbdc32cb4076004e63c4}{UInt8}}));}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ offset\ +=\ bitmap\_size;}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ keys\_size;\ ++j)\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_null;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_bitmap)}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ is\_null\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bucket\ =\ j\ /\ 8;}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ off\ =\ j\ \%\ 8;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ is\_null\ =\ ((bitmap[bucket]\ >>\ off)\ \&\ 1)\ ==\ 1;}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_null)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (key\_sizes[j])\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(key\_columns[j])-\/>get\_raw\_data\_begin<1>()\ +}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i,}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1);}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 1;}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(key\_columns[j])-\/>get\_raw\_data\_begin<2>()\ +}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ *\ 2,}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 2;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(key\_columns[j])-\/>get\_raw\_data\_begin<4>()\ +}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ *\ 4,}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 4);}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 4;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 8:}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(key\_columns[j])-\/>get\_raw\_data\_begin<8>()\ +}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ *\ 8,}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 8);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ 8;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a156c5821f16ed93be8c7d315303f7b2a}{memcpy}}(bytes\ +\ offset,}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_helper}{ColumnVectorHelper}}*\textcolor{keyword}{>}(key\_columns[j])-\/>get\_raw\_data\_begin<1>()\ +}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\ *\ key\_sizes[j],}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key\_sizes[j]);}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ +=\ key\_sizes[j];}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{return}\ key;}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00225\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128}{UInt128}}\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a84d714919d56c978b9ec45725d464b90}{hash128}}(\textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keywordtype}{size\_t}\ keys\_size,}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21d8623653ca0034d9268644110394b6}{ColumnRawPtrs}}\&\ key\_columns)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128}{UInt128}}\ key;}
\DoxyCodeLine{00228\ \ \ \ \ \mbox{\hyperlink{class_sip_hash}{SipHash}}\ hash;}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ keys\_size;\ ++j)\ key\_columns[j]-\/>update\_hash\_with\_value(i,\ hash);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ hash.\mbox{\hyperlink{class_sip_hash_a64bae5e3103c171c37305840842e8a80}{get128}}(key.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128_ac26d66d8d18a2c23206a9c3de0feca60}{low}},\ key.\mbox{\hyperlink{structdoris_1_1vectorized_1_1_u_int128_af876e53503a96f86c2550a66a1b42309}{high}});}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{return}\ key;}
\DoxyCodeLine{00235\ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00238\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}*\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a4451c3600ff37d8f68ba10814f9977b4}{place\_keys\_in\_pool}}(\textcolor{keywordtype}{size\_t}\ keys\_size,\ \mbox{\hyperlink{namespacedoris_a494c71c8e0815e0ec4f66099446082dc}{StringRefs}}\&\ keys,}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_arena}{Arena}}\&\ pool)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ keys\_size;\ ++j)\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}*\ place\ =\ pool.\mbox{\hyperlink{classdoris_1_1vectorized_1_1_arena_aeb27080055c9e3a4b7844ccabbd6b823}{alloc}}(keys[j].size);}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{memcpy__small_8h_a1df3b415150f123dd87bece89f712794}{memcpy\_small\_allow\_read\_write\_overflow15}}(place,\ keys[j].\mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}},\ keys[j].size);}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ keys[j].data\ =\ place;}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordtype}{char}*\ res\ =\ pool.\mbox{\hyperlink{classdoris_1_1vectorized_1_1_arena_ae6c7a06a0d6c88f10fccfc5b72cf42d1}{aligned\_alloc}}(keys\_size\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}),\ \textcolor{keyword}{alignof}(\mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}));}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{memcpy__small_8h_a1df3b415150f123dd87bece89f712794}{memcpy\_small\_allow\_read\_write\_overflow15}}(res,\ keys.data(),\ keys\_size\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}));}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}*\textcolor{keyword}{>}(res);}
\DoxyCodeLine{00251\ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00255\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structdoris_1_1_string_ref}{StringRef}}\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_ad06a10d235b14b3215446ac8d89b158e}{serialize\_keys\_to\_pool\_contiguous}}(}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keywordtype}{size\_t}\ keys\_size,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_a21d8623653ca0034d9268644110394b6}{ColumnRawPtrs}}\&\ key\_columns,\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_arena}{Arena}}\&\ pool)\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ begin\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sum\_size\ =\ 0;}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ keys\_size;\ ++j)}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ sum\_size\ +=\ key\_columns[j]-\/>serialize\_value\_into\_arena(i,\ pool,\ begin).\mbox{\hyperlink{structdoris_1_1_string_ref_a854352f53b148adc24983a58a1866d66}{size}};}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{return}\ \{begin,\ sum\_size\};}
\DoxyCodeLine{00264\ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \}\ \textcolor{comment}{//\ namespace\ doris::vectorized}}

\end{DoxyCode}
