\hypertarget{segment_8h_source}{}\doxysection{segment.\+h}
\label{segment_8h_source}\index{/Users/dabowang/be\_all/olap/rowset/segment\_v2/segment.h@{/Users/dabowang/be\_all/olap/rowset/segment\_v2/segment.h}}
\mbox{\hyperlink{segment_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <memory>}\ \textcolor{comment}{//\ for\ unique\_ptr}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}\ \textcolor{comment}{//\ Status}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/segment\_v2.pb.h"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macros_8h}{gutil/macros.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{file__system_8h}{io/fs/file\_system.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{iterators_8h}{olap/iterators.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{primary__key__index_8h}{olap/primary\_key\_index.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__reader_8h}{olap/rowset/segment\_v2/column\_reader.h}}"{}}\ \textcolor{comment}{//\ ColumnReader}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{page__handle_8h}{olap/rowset/segment\_v2/page\_handle.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{short__key__index_8h}{olap/short\_key\_index.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet__schema_8h}{olap/tablet\_schema.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{faststring_8h}{util/faststring.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{once_8h}{util/once.h}}"{}}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }TabletSchema;}
\DoxyCodeLine{00041\ \textcolor{keyword}{class\ }ShortKeyIndexDecoder;}
\DoxyCodeLine{00042\ \textcolor{keyword}{class\ }Schema;}
\DoxyCodeLine{00043\ \textcolor{keyword}{class\ }StorageReadOptions;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{namespace\ }segment\_v2\ \{}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_bitmap_index_iterator}{BitmapIndexIterator}};}
\DoxyCodeLine{00048\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_reader}{ColumnReader}};}
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_iterator}{ColumnIterator}};}
\DoxyCodeLine{00050\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment}{Segment}};}
\DoxyCodeLine{00051\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_iterator}{SegmentIterator}};}
\DoxyCodeLine{00052\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_1_1segment__v2_ab2ba176a3388632308b762a79938d8ad}{SegmentSharedPtr}}\ =\ std::shared\_ptr<Segment>;}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ A\ Segment\ is\ used\ to\ represent\ a\ segment\ in\ memory\ format.\ When\ segment\ is}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ generated,\ it\ won't\ be\ modified,\ so\ this\ struct\ aimed\ to\ help\ read\ operation.}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ It\ will\ prepare\ all\ ColumnReader\ to\ create\ ColumnIterator\ as\ needed.}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ And\ user\ can\ create\ a\ RowwiseIterator\ through\ new\_iterator\ function.}}
\DoxyCodeLine{00057\ \textcolor{comment}{//}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ NOTE:\ This\ segment\ is\ used\ to\ a\ specified\ TabletSchema,\ when\ TabletSchema}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ is\ changed,\ this\ segment\ can\ not\ be\ used\ any\ more.\ For\ example,\ after\ a\ schema}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ change\ finished,\ client\ should\ disable\ all\ cached\ Segment\ for\ old\ TabletSchema.}}
\DoxyCodeLine{00061\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment}{Segment}}\ :\ \textcolor{keyword}{public}\ std::enable\_shared\_from\_this<Segment>\ \{}
\DoxyCodeLine{00062\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aa7a08f6704eaaffbe602555d32e904f9}{open}}(\mbox{\hyperlink{namespacedoris_1_1io_aea8c56ba684d61150520d391a154c910}{io::FileSystemSPtr}}\ fs,\ \textcolor{keyword}{const}\ std::string\&\ path,\ uint32\_t\ segment\_id,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a154068040e19040b8e2468c080e00e05}{rowset\_id}},\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ tablet\_schema,}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1io_1_1_file_reader_options}{io::FileReaderOptions}}\&\ reader\_options,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<Segment>*\ output);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_ad2cdb84af19c487faea18b01af25dcf3}{\string~Segment}}();}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a57d5f71d1e2c983e6ad2ba9a90c8d653}{new\_iterator}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_schema}{Schema}}\&\ schema,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_storage_read_options}{StorageReadOptions}}\&\ read\_options,}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RowwiseIterator>*\ iter);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_ae8d9b78e6db34a355e194e35dfdccbf9}{id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a31f6529e46d67bc68e77c1fe3628ab11}{\_segment\_id}};\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a154068040e19040b8e2468c080e00e05}{rowset\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a420b7994585cc3552792a3e411e201d3}{\_rowset\_id}};\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a42a7f7e3318640396313f48694226f2d}{num\_rows}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}}.num\_rows();\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a3022b0b3696e6dd7e04a6d7a098a935c}{new\_column\_iterator}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_column}{TabletColumn}}\&\ tablet\_column,\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_column_iterator}{ColumnIterator}}**\ iter);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aad63d9fa029fd215c0405f2aa7b4cf62}{new\_bitmap\_index\_iterator}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_column}{TabletColumn}}\&\ tablet\_column,\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_bitmap_index_iterator}{BitmapIndexIterator}}**\ iter);}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_adb3512e924312d74889495e087e78d8f}{new\_inverted\_index\_iterator}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_column}{TabletColumn}}\&\ tablet\_column,}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_index}{TabletIndex}}*\ index\_meta,\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_inverted_index_iterator}{InvertedIndexIterator}}**\ iter);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_short_key_index_decoder}{ShortKeyIndexDecoder}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a54e77bf91d2416f9be20e402ae037039}{get\_short\_key\_index}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ DCHECK(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a9dbc80624564a9ae6367c9f30a0e82f9}{\_load\_index\_once}}.has\_called()\ \&\&\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a9dbc80624564a9ae6367c9f30a0e82f9}{\_load\_index\_once}}.stored\_result().ok());}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_afd88ec00471771cd6c3dfa95436d3cde}{\_sk\_index\_decoder}}.get();}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_primary_key_index_reader}{PrimaryKeyIndexReader}}*\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aa23c2ac27453aeb57a32582d94ffd5bf}{get\_primary\_key\_index}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ DCHECK(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a9dbc80624564a9ae6367c9f30a0e82f9}{\_load\_index\_once}}.has\_called()\ \&\&\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a9dbc80624564a9ae6367c9f30a0e82f9}{\_load\_index\_once}}.stored\_result().ok());}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a1cac00092b8c28018d470150ff8888fc}{\_pk\_index\_reader}}.get();}
\DoxyCodeLine{00094\ \ \ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_ae383d7f29aae2b4ab51394c920835012}{lookup\_row\_key}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ key,\ \mbox{\hyperlink{structdoris_1_1_row_location}{RowLocation}}*\ row\_location);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ only\ used\ by\ UT}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{const}\ SegmentFooterPB\&\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_afa41e4e367acab1bc97f08e227e8bece}{footer}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}};\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_abb57dd6d394b486561f0d8896e6ac32f}{load\_index}}();}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_abae2b7ade06fbe359059e4cd1c423dd3}{load\_pk\_index\_and\_bf}}();}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a301c02b7c98b0a240c30dc3d803c1e3f}{min\_key}}()\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ DCHECK(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a5f256212214e141eee2fe15b9b042e18}{\_tablet\_schema}}-\/>keys\_type()\ ==\ UNIQUE\_KEYS\ \&\&\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}}.has\_primary\_key\_index\_meta());}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}}.primary\_key\_index\_meta().min\_key();}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a96032ef0eb4e3f787da203f64208f751}{max\_key}}()\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ DCHECK(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a5f256212214e141eee2fe15b9b042e18}{\_tablet\_schema}}-\/>keys\_type()\ ==\ UNIQUE\_KEYS\ \&\&\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}}.has\_primary\_key\_index\_meta());}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}}.primary\_key\_index\_meta().max\_key();}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a4fab59e5f39ac7c318b993fa0c5265ee}{io::FileReaderSPtr}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_add30ba8e3dd30b4b2facd26e05f41a38}{file\_reader}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a0c94b8447f79ad7c6166e0b4e50c5cf8}{\_file\_reader}};\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00117\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a95084a747d20d34acdb39a62f8228345}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment}{Segment}});}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment}{Segment}}(uint32\_t\ segment\_id,\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a154068040e19040b8e2468c080e00e05}{rowset\_id}},\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ tablet\_schema);}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ open\ segment\ file\ and\ read\ the\ minimum\ amount\ of\ necessary\ information\ (footer)}}
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a963e4c4f53318ab52b14e8035da814d6}{\_open}}();}
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a8afa2d2ae7b871795568e96b9a569f29}{\_parse\_footer}}();}
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a7fee385565639dd26a57d15de2b63aa4}{\_create\_column\_readers}}();}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a6b24808af7f3ce80eb1f04daaa827af8}{\_load\_pk\_bloom\_filter}}();}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_iterator}{SegmentIterator}};}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a4fab59e5f39ac7c318b993fa0c5265ee}{io::FileReaderSPtr}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a0c94b8447f79ad7c6166e0b4e50c5cf8}{\_file\_reader}};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a31f6529e46d67bc68e77c1fe3628ab11}{\_segment\_id}};}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a420b7994585cc3552792a3e411e201d3}{\_rowset\_id}};}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a5f256212214e141eee2fe15b9b042e18}{\_tablet\_schema}};}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_ae955266e38ac7aa7c5fe9bcbf014fd72}{\_meta\_mem\_usage}};}
\DoxyCodeLine{00134\ \ \ \ \ SegmentFooterPB\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_aff85542c1cf26c7b634851e7ca7b8465}{\_footer}};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ Map\ from\ column\ unique\ id\ to\ column\ ordinal\ in\ footer's\ ColumnMetaPB}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ If\ we\ can't\ find\ unique\ id\ from\ it,\ it\ means\ this\ segment\ is\ created}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ with\ an\ old\ schema.}}
\DoxyCodeLine{00139\ \ \ \ \ std::unordered\_map<uint32\_t,\ uint32\_t>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a6e53b5cb4afe71855cc3d51bd7da95e4}{\_column\_id\_to\_footer\_ordinal}};}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ map\ column\ unique\ id\ -\/-\/-\/>\ column\ reader}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ ColumnReader\ for\ each\ column\ in\ TabletSchema.\ If\ ColumnReader\ is\ nullptr,}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ This\ means\ that\ this\ segment\ has\ no\ data\ for\ that\ column,\ which\ may\ be\ added}}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ after\ this\ segment\ is\ generated.}}
\DoxyCodeLine{00145\ \ \ \ \ std::map<int32\_t,\ std::unique\_ptr<ColumnReader>>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a449174bc9b79df62d6af7917a86feed9}{\_column\_readers}};}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ used\ to\ guarantee\ that\ short\ key\ index\ will\ be\ loaded\ at\ most\ once\ in\ a\ thread-\/safe\ way}}
\DoxyCodeLine{00148\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_doris_call_once}{DorisCallOnce<Status>}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a9dbc80624564a9ae6367c9f30a0e82f9}{\_load\_index\_once}};}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ used\ to\ guarantee\ that\ primary\ key\ bloom\ filter\ will\ be\ loaded\ at\ most\ once\ in\ a\ thread-\/safe\ way}}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_doris_call_once}{DorisCallOnce<Status>}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a77727d2d32530a97ed5b3a1f9cf53479}{\_load\_pk\_bf\_once}};}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ used\ to\ hold\ short\ key\ index\ page\ in\ memory}}
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_handle}{PageHandle}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a8ed18d17d6008f4302058c34bc954267}{\_sk\_index\_handle}};}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ short\ key\ index\ decoder}}
\DoxyCodeLine{00154\ \ \ \ \ std::unique\_ptr<ShortKeyIndexDecoder>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_afd88ec00471771cd6c3dfa95436d3cde}{\_sk\_index\_decoder}};}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ primary\ key\ index\ reader}}
\DoxyCodeLine{00156\ \ \ \ \ std::unique\_ptr<PrimaryKeyIndexReader>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a1cac00092b8c28018d470150ff8888fc}{\_pk\_index\_reader}};}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ Segment\ may\ be\ destructed\ after\ StorageEngine,\ in\ order\ to\ exit\ gracefully.}}
\DoxyCodeLine{00158\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_segment_a723b84d2a0b5e43fa7ce34ce85fdec6b}{\_segment\_meta\_mem\_tracker}};}
\DoxyCodeLine{00159\ \};}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \}\ \textcolor{comment}{//\ namespace\ segment\_v2}}
\DoxyCodeLine{00162\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
