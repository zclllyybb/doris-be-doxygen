\hypertarget{block__lru__file__cache_8h_source}{}\doxysection{block\+\_\+lru\+\_\+file\+\_\+cache.\+h}
\label{block__lru__file__cache_8h_source}\index{/Users/dabowang/be\_all/io/cache/block/block\_lru\_file\_cache.h@{/Users/dabowang/be\_all/io/cache/block/block\_lru\_file\_cache.h}}
\mbox{\hyperlink{block__lru__file__cache_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ copied\ from}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ https://github.com/ClickHouse/ClickHouse/blob/master/src/Interpreters/Cache/LRUFileCachePriority.h}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ and\ modified\ by\ Doris}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <optional>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block__file__cache_8h}{io/cache/block/block\_file\_cache.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block__file__segment_8h}{io/cache/block/block\_file\_segment.h}}"{}}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00033\ \textcolor{keyword}{namespace\ }io\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache}{LRUFileCache}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1io_1_1_i_file_cache}{IFileCache}}\ \{}
\DoxyCodeLine{00040\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache}{LRUFileCache}}(\textcolor{keyword}{const}\ std::string\&\ cache\_base\_path,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_file_cache_settings}{FileCacheSettings}}\&\ cache\_settings);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_file_blocks_holder}{FileBlocksHolder}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_aa01842a257dfda4a1079d7817291181a}{get\_or\_set}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{size\_t}\ offset,\ \textcolor{keywordtype}{size\_t}\ size,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ init\ file\ cache}}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a795d70c736c3b9b8296faf7959f83403}{initialize}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ remove\ the\ files\ belong\ to\ key}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_aa47a7087bd47c22bfda85416b3aa9b24}{remove\_if\_exists}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ remove\ the\ files\ only\ catched\ by\ cache}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a81306e93a8759d883c10f2335dc06d4b}{remove\_if\_releasable}}(\textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a17c021e102f9a430377feed83a3a8b13}{try\_get\_cache\_paths}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_ad4c327f08641ee8ce840a7d54b4c9745}{get\_used\_cache\_size}}(\textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_aa6a7fdbfb1146b13107e4e1dfd100182}{get\_file\_segments\_num}}(\textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a7b4eb20d4fdfaa0bd58cb48243d3b246}{FileBlockSPtr}}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aeab1f50c2e118b5200cd29260606a8e3}{file\_segment}};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ std::optional<LRUQueue::Iterator>\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aec064cf463d3eff11c9f6861a1ef89e9}{queue\_iterator}};}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_a42ee8ceb738a1e98fcf6432f7c029b6c}{releasable}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aeab1f50c2e118b5200cd29260606a8e3}{file\_segment}}.unique();\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_a259cb5a711406a8c3e5d937eb9350cca}{size}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aeab1f50c2e118b5200cd29260606a8e3}{file\_segment}}-\/>\_segment\_range.size();\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}(\mbox{\hyperlink{namespacedoris_1_1io_a7b4eb20d4fdfaa0bd58cb48243d3b246}{FileBlockSPtr}}\ file\_segment\_,\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache}{LRUFileCache}}*\ cache,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_acb96a86552dfec7904144871e68d9e19}{FileBlockCell}}(\mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\&\&\ other)\ noexcept}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aeab1f50c2e118b5200cd29260606a8e3}{file\_segment}}(std::move(other.file\_segment)),}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_aec064cf463d3eff11c9f6861a1ef89e9}{queue\_iterator}}(other.queue\_iterator)\ \{\}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\&\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_a29dc9cdfd7a64a826782d28207a82842}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell_a149c52efeb7d2003137e3113bbeef9fc}{FileBlockCell}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00091\ \ \ \ \ \};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a71537e7046cc842769c9e7474a084bd8}{FileBlocksByOffset}}\ =\ std::map<size\_t,\ FileBlockCell>;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_hash_cached_file_key}{HashCachedFileKey}}\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ std::size\_t\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_hash_cached_file_key_a336b012a2fc298c9c22377aa928b1590}{operator()}}(\textcolor{keyword}{const}\ std::pair<Key,\ bool>\&\ k)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1io_1_1_key_hash}{KeyHash}}()(k.first);\ \}}
\DoxyCodeLine{00097\ \ \ \ \ \};}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ key:\ <file\ key,\ is\_persistent>}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a3ad54d3b33fc242ffb81e0c4dfeb99eb}{CachedFiles}}\ =}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ std::unordered\_map<std::pair<Key,\ bool>,\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a71537e7046cc842769c9e7474a084bd8}{FileBlocksByOffset}},\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_hash_cached_file_key}{HashCachedFileKey}}>;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a3ad54d3b33fc242ffb81e0c4dfeb99eb}{CachedFiles}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a31a366c9f070d46beffc14bcd67f2fdd}{\_files}};}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_i_file_cache_1_1_l_r_u_queue}{LRUQueue}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a850e2ffd8de08325716b5f9a9e5dcb86}{\_queue}};}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_i_file_cache_1_1_l_r_u_queue}{LRUQueue}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a6601fe68ab2b631161709dcd4517d006}{\_persistent\_queue}};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a12b7a12e387d2192f0feb8ce5f59c116}{FileBlocks}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a4d35604cf57218b4aec594da6fd17366}{get\_impl}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_file_block_1_1_range}{FileBlock::Range}}\&\ range,\ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}*\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_af0bf665f1497fb81251f9cf4c8d2fde5}{get\_cell}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent,\ \textcolor{keywordtype}{size\_t}\ offset,}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}*\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a581f197265ee91151badf10b10015dc9}{add\_cell}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent,\ \textcolor{keywordtype}{size\_t}\ offset,\ \textcolor{keywordtype}{size\_t}\ size,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1io_1_1_file_block_a5d74787dedbc4e11c1ab15bf487e61f8}{FileBlock::State}}\ state,\ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a7e9e107d96582116fc575449a9cd2bda}{use\_cell}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_l_r_u_file_cache_1_1_file_block_cell}{FileBlockCell}}\&\ cell,\ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a12b7a12e387d2192f0feb8ce5f59c116}{FileBlocks}}\&\ result,\ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_aa12d90e78295c706f726f3f38ba0937f}{try\_reserve}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_persistent,\ \textcolor{keywordtype}{size\_t}\ offset,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ size,\ std::lock\_guard<std::mutex>\&\ cache\_lock)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a76b1555e78804c6b63cd0038ec6ad512}{try\_reserve\_for\_main\_list}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \mbox{\hyperlink{classdoris_1_1io_1_1_i_file_cache_a8c66fc6bb666006ac6243084864487b6}{QueryFileCacheContextPtr}}\ query\_context,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_persistent,\ \textcolor{keywordtype}{size\_t}\ offset,\ \textcolor{keywordtype}{size\_t}\ size,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a9842f06e7eca4524f3dfa4b09f1cbb9c}{remove}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent,\ \textcolor{keywordtype}{size\_t}\ offset,}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock,}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ segment\_lock)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_af09bfc1a2d83f1089bc31ec8e30048fa}{get\_available\_cache\_size}}(\textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_ae4193c23e933aff85769c000f25bd413}{load\_cache\_info\_into\_memory}}(std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a12b7a12e387d2192f0feb8ce5f59c116}{FileBlocks}}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a678600500e1d9a7ac56f07ff7c9882dc}{split\_range\_into\_cells}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset,\ \textcolor{keywordtype}{size\_t}\ size,\ \mbox{\hyperlink{classdoris_1_1io_1_1_file_block_a5d74787dedbc4e11c1ab15bf487e61f8}{FileBlock::State}}\ state,}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_ad4bd0a5783832f110b9c43288d4cec5b}{dump\_structure\_unlocked}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_afc9456e4757b4e8625c8c611859c71b9}{fill\_holes\_with\_empty\_file\_segments}}(\mbox{\hyperlink{namespacedoris_1_1io_a12b7a12e387d2192f0feb8ce5f59c116}{FileBlocks}}\&\ file\_segments,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_file_block_1_1_range}{FileBlock::Range}}\&\ range,}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_af6e665ae416cd0bb806ccc36fd2b414b}{get\_used\_cache\_size\_unlocked}}(\textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a0781f1ed534dad10e7af439ce08d6d09}{get\_available\_cache\_size\_unlocked}}(\textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_ac5c5b4161254a93f22dbeaf58a4eec17}{get\_file\_segments\_num\_unlocked}}(\textcolor{keywordtype}{bool}\ is\_persistent,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::lock\_guard<std::mutex>\&\ cache\_lock)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00155\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1io_1_1_l_r_u_file_cache_a7500355b22c1715b6d9ae0facdc05453}{dump\_structure}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1io_1_1_i_file_cache_1_1_key}{Key}}\&\ key,\ \textcolor{keywordtype}{bool}\ is\_persistent)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00156\ \};}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \}\ \textcolor{comment}{//\ namespace\ io}}
\DoxyCodeLine{00159\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
