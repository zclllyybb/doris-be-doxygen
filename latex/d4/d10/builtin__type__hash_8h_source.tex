\hypertarget{builtin__type__hash_8h_source}{}\doxysection{builtin\+\_\+type\+\_\+hash.\+h}
\label{builtin__type__hash_8h_source}\index{/Users/dabowang/doris/be/src/gutil/hash/builtin\_type\_hash.h@{/Users/dabowang/doris/be/src/gutil/hash/builtin\_type\_hash.h}}
\mbox{\hyperlink{builtin__type__hash_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ 2011\ Google\ Inc.\ All\ Rights\ Reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Hash\ functions\ for\ C++\ builtin\ types.\ These\ are\ all\ of\ the\ fundamental}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ integral\ and\ floating\ point\ types\ in\ the\ language\ as\ well\ as\ pointers.\ This}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ library\ provides\ a\ minimal\ set\ of\ interfaces\ for\ hashing\ these\ values.}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{casts_8h}{gutil/casts.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{jenkins__lookup2_8h}{gutil/hash/jenkins\_lookup2.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{integral__types_8h}{gutil/integral\_types.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macros_8h}{gutil/macros.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ \mbox{\hyperlink{builtin__type__hash_8h_aaf7d0a24a8e32d63eebc60e663ff42e4}{Hash32NumWithSeed}}(\mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ num,\ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ c)\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ b\ =\ 0x9e3779b9UL;\ \textcolor{comment}{//\ the\ golden\ ratio;\ an\ arbitrary\ value}}
\DoxyCodeLine{00019\ \ \ \ \ \mbox{\hyperlink{jenkins__lookup2_8h_af1266f1a262fb4ce37900bfc9dd38b9d}{mix}}(num,\ b,\ c);}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordflow}{return}\ c;}
\DoxyCodeLine{00021\ \}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{builtin__type__hash_8h_a3b2f2b23d87f1209550289fd30c88b35}{Hash64NumWithSeed}}(\mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ num,\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ c)\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ b\ =\ \mbox{\hyperlink{integral__types_8h_a786084546298ed4128cd0742d10e280c}{GG\_ULONGLONG}}(0xe08c1d668b756f82);\ \textcolor{comment}{//\ more\ of\ the\ golden\ ratio}}
\DoxyCodeLine{00025\ \ \ \ \ \mbox{\hyperlink{jenkins__lookup2_8h_af1266f1a262fb4ce37900bfc9dd38b9d}{mix}}(num,\ b,\ c);}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordflow}{return}\ c;}
\DoxyCodeLine{00027\ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\ This\ function\ hashes\ pointer\ sized\ items\ and\ returns\ a\ 32b\ hash,}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ convenienty\ hiding\ the\ fact\ that\ pointers\ may\ be\ 32b\ or\ 64b,}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ depending\ on\ the\ architecture.}}
\DoxyCodeLine{00032\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ \mbox{\hyperlink{builtin__type__hash_8h_ac4b49d5bdd2dc5a7a7474333a4c05d77}{Hash32PointerWithSeed}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ p,\ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ seed)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ uintptr\_t\ pvalue\ =\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}(p);}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\ h\ =\ seed;}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{comment}{//\ Hash\ the\ pointer\ 32b\ at\ a\ time.}}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \textcolor{keyword}{sizeof}(pvalue);\ i\ +=\ 4)\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ h\ =\ \mbox{\hyperlink{builtin__type__hash_8h_aaf7d0a24a8e32d63eebc60e663ff42e4}{Hash32NumWithSeed}}(\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}\textcolor{keyword}{>}(pvalue\ >>\ (i\ *\ 8)),\ h);}
\DoxyCodeLine{00038\ \ \ \ \ \}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordflow}{return}\ h;}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ Hash64FloatWithSeed}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ Hash64DoubleWithSeed}}
\DoxyCodeLine{00045\ \textcolor{comment}{//\ \ \ Functions\ for\ computing\ a\ hash\ value\ of\ floating-\/point\ numbers.}}
\DoxyCodeLine{00046\ \textcolor{comment}{//\ \ \ On\ systems\ where\ float\ and\ double\ comply\ with\ IEEE\ 754,\ these\ hashes}}
\DoxyCodeLine{00047\ \textcolor{comment}{//\ \ \ guarantee\ that\ if\ a\ ==\ b,\ Hash64FloatWithSeed(a,\ c)\ ==}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ \ \ Hash64FloatWithSeed(b,\ c).\ Note\ that\ NaN\ does\ not\ compare\ equal\ to}}
\DoxyCodeLine{00049\ \textcolor{comment}{//\ \ \ itself,\ so\ two\ NaN\ inputs\ will\ not\ necessarily\ hash\ to\ the\ same\ value.}}
\DoxyCodeLine{00050\ \textcolor{comment}{//}}
\DoxyCodeLine{00051\ \textcolor{comment}{//\ \ \ It\ is\ often\ a\ mistake\ to\ compare\ floating-\/point\ values\ for\ equality,}}
\DoxyCodeLine{00052\ \textcolor{comment}{//\ \ \ since\ floating-\/point\ computations\ do\ not\ produce\ exact\ values,\ due\ to}}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ \ \ rounding.\ If\ equality\ comparison\ doesn't\ make\ sense\ in\ your\ situation,}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ \ \ hashing\ almost\ certainly\ doesn't\ make\ sense\ either.}}
\DoxyCodeLine{00055\ \textcolor{comment}{//}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ \ \ Not\ guaranteed\ to\ return\ the\ same\ value\ in\ different\ builds,\ or\ to}}
\DoxyCodeLine{00057\ \textcolor{comment}{//\ \ \ avoid\ any\ reserved\ values.}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00059\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{builtin__type__hash_8h_afb92e5279c89062d248af0939e96d871}{Hash64FloatWithSeed}}(\textcolor{keywordtype}{float}\ num,\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ seed)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ +0\ and\ -\/0\ are\ the\ only\ floating\ point\ numbers\ which\ compare\ equal\ but}}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{comment}{//\ have\ distinct\ bitwise\ representations\ in\ IEEE\ 754.\ To\ work\ around\ this,}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ we\ force\ 0\ to\ be\ +0.}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\ ==\ 0)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ num\ =\ 0;}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ COMPILE\_ASSERT(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float})\ ==\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{integral__types_8h_acbd4acd0d29e2d6c43104827f77d9cd2}{uint32}}),\ float\_has\_wrong\_size);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ kMul\ =\ 0xc6a4a7935bd1e995ULL;}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ =\ (bit\_cast<uint32>(num)\ +\ seed)\ *\ kMul;}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ \string^=\ (\mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ >>\ 47);}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ *=\ kMul;}
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ \string^=\ (\mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ >>\ 47);}
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ *=\ kMul;}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}};}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{builtin__type__hash_8h_aafd5ff8a2edaad6d6fb2bcaea3d87203}{Hash64DoubleWithSeed}}(\textcolor{keywordtype}{double}\ num,\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ seed)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\ ==\ 0)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ num\ =\ 0;}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ COMPILE\_ASSERT(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double})\ ==\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}),\ double\_has\_wrong\_size);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ kMul\ =\ 0xc6a4a7935bd1e995ULL;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{integral__types_8h_abc0f5bc07737e498f287334775dff2b6}{uint64}}\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ =\ (bit\_cast<uint64>(num)\ +\ seed)\ *\ kMul;}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ \string^=\ (\mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ >>\ 47);}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ *=\ kMul;}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ \string^=\ (\mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ >>\ 47);}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}\ *=\ kMul;}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}};}
\DoxyCodeLine{00092\ \}}

\end{DoxyCode}
