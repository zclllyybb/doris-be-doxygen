\hypertarget{bit__stream__utils_8h_source}{}\doxysection{bit\+\_\+stream\+\_\+utils.\+h}
\label{bit__stream__utils_8h_source}\index{/Users/dabowang/doris/be/src/util/bit\_stream\_utils.h@{/Users/dabowang/doris/be/src/util/bit\_stream\_utils.h}}
\mbox{\hyperlink{bit__stream__utils_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ copied\ from}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ https://github.com/apache/impala/blob/branch-\/2.9.0/be/src/util/bit-\/stream-\/utils.h}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ and\ modified\ by\ Doris}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{port_8h}{gutil/port.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bit__packing_8h}{util/bit\_packing.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bit__util_8h}{util/bit\_util.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{faststring_8h}{util/faststring.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_bit_util}{doris::BitUtil}};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{comment}{//\ Utility\ class\ to\ write\ bit/byte\ streams.\ \ This\ class\ can\ write\ data\ to\ either\ be}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ bit\ packed\ or\ byte\ aligned\ (and\ a\ single\ stream\ that\ has\ a\ mix\ of\ both).}}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_bit_writer}{BitWriter}}\ \{}
\DoxyCodeLine{00035\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{comment}{//\ buffer:\ buffer\ to\ write\ bits\ to.}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_ae75eb10d4d7f9ea900e27d57be39a56d}{BitWriter}}(\mbox{\hyperlink{classdoris_1_1faststring}{faststring}}*\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a5b2143bf308dbc12b90f99e25ac9724c}{buffer}})\ :\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a387ae995b4a7d9150e1630ec6d5f1c49}{buffer\_}}(\mbox{\hyperlink{classdoris_1_1_bit_writer_a5b2143bf308dbc12b90f99e25ac9724c}{buffer}})\ \{\ \mbox{\hyperlink{classdoris_1_1_bit_writer_aa71d36872f416feaa853788a7a7a7ef8}{Clear}}();\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_aa71d36872f416feaa853788a7a7a7ef8}{Clear}}()\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_writer_adc033a5e038feb634fe7436abc5a087c}{buffered\_values\_}}\ =\ 0;}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_writer_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}}\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_writer_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}}\ =\ 0;}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_writer_a387ae995b4a7d9150e1630ec6d5f1c49}{buffer\_}}-\/>\mbox{\hyperlink{classdoris_1_1faststring_ac8bb3912a3ce86b15842e79d0b421204}{clear}}();}
\DoxyCodeLine{00044\ \ \ \ \ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{//\ Returns\ a\ pointer\ to\ the\ underlying\ buffer}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1faststring}{faststring}}*\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a5b2143bf308dbc12b90f99e25ac9724c}{buffer}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a387ae995b4a7d9150e1630ec6d5f1c49}{buffer\_}};\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ current\ bytes\ written,\ including\ the\ current\ byte\ (i.e.\ may\ include\ a}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ fraction\ of\ a\ byte).\ Includes\ buffered\ values.}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a6ae2fccc9813f5a23fa87c595c0f7bbe}{bytes\_written}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}}\ +\ \mbox{\hyperlink{classdoris_1_1_bit_util_ab9002e6aac9b818996faf615f08e426a}{BitUtil::Ceil}}(\mbox{\hyperlink{classdoris_1_1_bit_writer_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}},\ 8);\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ Writes\ a\ value\ to\ buffered\_values\_,\ flushing\ to\ buffer\_\ if\ necessary.\ \ This\ is\ bit}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ packed.}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a6693eab19a6504d732c31ef7af639cf8}{PutValue}}(uint64\_t\ v,\ \textcolor{keywordtype}{int}\ num\_bits);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ Writes\ v\ to\ the\ next\ aligned\ byte\ using\ num\_bits.\ If\ T\ is\ larger\ than\ num\_bits,\ the}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ extra\ high-\/order\ bits\ will\ be\ ignored.}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a7123bf7d8934fe03d6115a490140e3b0}{PutAligned}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ v,\ \textcolor{keywordtype}{int}\ num\_bits);}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ Write\ a\ Vlq\ encoded\ int\ to\ the\ buffer.\ The\ value\ is\ written\ byte\ aligned.}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ For\ more\ details\ on\ vlq:\ en.wikipedia.org/wiki/Variable-\/length\_quantity}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a24d31d895216450c01488ec8b0ee8548}{PutVlqInt}}(int32\_t\ v);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ index\ to\ the\ next\ aligned\ byte\ and\ advance\ the\ underlying\ buffer\ by\ num\_bytes.}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a0769ebd9118de7439519005c4e904d4c}{GetByteIndexAndAdvance}}(\textcolor{keywordtype}{int}\ num\_bytes)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ uint8\_t*\ ptr\ =\ \mbox{\hyperlink{classdoris_1_1_bit_writer_afe6d2ee2837c730dfdf0bc22603c0542}{GetNextBytePtr}}(num\_bytes);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ptr\ -\/\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a387ae995b4a7d9150e1630ec6d5f1c49}{buffer\_}}-\/>\mbox{\hyperlink{classdoris_1_1faststring_a215eaf2835bd078eb7cf0da711115346}{data}}();}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ Get\ a\ pointer\ to\ the\ next\ aligned\ byte\ and\ advance\ the\ underlying\ buffer\ by\ num\_bytes.}}
\DoxyCodeLine{00073\ \ \ \ \ uint8\_t*\ \mbox{\hyperlink{classdoris_1_1_bit_writer_afe6d2ee2837c730dfdf0bc22603c0542}{GetNextBytePtr}}(\textcolor{keywordtype}{int}\ num\_bytes);}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ Flushes\ all\ buffered\ values\ to\ the\ buffer.\ Call\ this\ when\ done\ writing\ to\ the\ buffer.}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ If\ 'align'\ is\ true,\ buffered\_values\_\ is\ reset\ and\ any\ future\ writes\ will\ be\ written}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ to\ the\ next\ byte\ boundary.}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a051cd25893f7b8c8722cdb8d184a65c6}{Flush}}(\textcolor{keywordtype}{bool}\ align\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ Bit-\/packed\ values\ are\ initially\ written\ to\ this\ variable\ before\ being\ memcpy'd\ to}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ buffer\_.\ This\ is\ faster\ than\ writing\ values\ byte\ by\ byte\ directly\ to\ buffer\_.}}
\DoxyCodeLine{00083\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_bit_writer_adc033a5e038feb634fe7436abc5a087c}{buffered\_values\_}};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1faststring}{faststring}}*\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a387ae995b4a7d9150e1630ec6d5f1c49}{buffer\_}};}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}};\ \textcolor{comment}{//\ Offset\ in\ buffer\_}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_writer_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}};\ \ \textcolor{comment}{//\ Offset\ in\ buffered\_values\_}}
\DoxyCodeLine{00088\ \};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{comment}{//\ Utility\ class\ to\ read\ bit/byte\ stream.\ \ This\ class\ can\ read\ bits\ or\ bytes}}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ that\ are\ either\ byte\ aligned\ or\ not.\ \ It\ also\ has\ utilities\ to\ read\ multiple}}
\DoxyCodeLine{00092\ \textcolor{comment}{//\ bytes\ in\ one\ read\ (e.g.\ encoded\ int).}}
\DoxyCodeLine{00093\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_bit_reader}{BitReader}}\ \{}
\DoxyCodeLine{00094\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{comment}{//\ 'buffer'\ is\ the\ buffer\ to\ read\ from.\ \ The\ buffer's\ length\ is\ 'buffer\_len'.}}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_reader_ac0726f5aac68a2b4539003b7892f6ad9}{BitReader}}(\textcolor{keyword}{const}\ uint8\_t*\ buffer,\ \textcolor{keywordtype}{int}\ buffer\_len);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bit_reader_ac0726f5aac68a2b4539003b7892f6ad9}{BitReader}}()\ :\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a83fa585f5b2aa9ac3601d380761d38af}{buffer\_}}(nullptr),\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a163ead0e7ab6eeff4bdd55ac51bd054b}{max\_bytes\_}}(0)\ \{\}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ Gets\ the\ next\ value\ from\ the\ buffer.\ \ Returns\ true\ if\ 'v'\ could\ be\ read\ or\ false\ if}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ there\ are\ not\ enough\ bytes\ left.\ num\_bits\ must\ be\ <=\ 32.}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_af4fe3f02c5d5296029b792a6c18884c4}{GetValue}}(\textcolor{keywordtype}{int}\ num\_bits,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ v);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ Reads\ a\ 'num\_bytes'-\/sized\ value\ from\ the\ buffer\ and\ stores\ it\ in\ 'v'.\ T\ needs\ to\ be\ a}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ little-\/endian\ native\ type\ and\ big\ enough\ to\ store\ 'num\_bytes'.\ The\ value\ is\ assumed}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ to\ be\ byte-\/aligned\ so\ the\ stream\ will\ be\ advanced\ to\ the\ start\ of\ the\ next\ byte}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ before\ 'v'\ is\ read.\ Returns\ false\ if\ there\ are\ not\ enough\ bytes\ left.}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_aeb4acca07e7a6965211244f1186dddfc}{GetAligned}}(\textcolor{keywordtype}{int}\ num\_bytes,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ v);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Reads\ a\ vlq\ encoded\ int\ from\ the\ stream.\ \ The\ encoded\ int\ must\ start\ at\ the}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ beginning\ of\ a\ byte.\ Return\ false\ if\ there\ were\ not\ enough\ bytes\ in\ the\ buffer.}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_aad9ecc1ad5467883e9318003a5822b37}{GetVlqInt}}(uint32\_t*\ v);}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ Reads\ a\ zigzag\ encoded\ int\ `into`\ v.}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a75102df3117e036b588034675faccc41}{GetZigZagVlqInt}}(int32\_t*\ v);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ Reads\ a\ vlq\ encoded\ int\ from\ the\ stream.\ \ The\ encoded\ int\ must\ start\ at\ the}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ beginning\ of\ a\ byte.\ Return\ false\ if\ there\ were\ not\ enough\ bytes\ in\ the\ buffer.}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_aad9ecc1ad5467883e9318003a5822b37}{GetVlqInt}}(uint64\_t*\ v);}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ Reads\ a\ zigzag\ encoded\ int\ `into`\ v.}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a75102df3117e036b588034675faccc41}{GetZigZagVlqInt}}(int64\_t*\ v);}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ number\ of\ bytes\ left\ in\ the\ stream,\ not\ including\ the\ current\ byte\ (i.e.,}}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ there\ may\ be\ an\ additional\ fraction\ of\ a\ byte).}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a7edd581ca3bdf5df0619edc68eb3c8f9}{bytes\_left}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a163ead0e7ab6eeff4bdd55ac51bd054b}{max\_bytes\_}}\ -\/\ (\mbox{\hyperlink{classdoris_1_1_bit_reader_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}}\ +\ \mbox{\hyperlink{classdoris_1_1_bit_util_ab9002e6aac9b818996faf615f08e426a}{BitUtil::Ceil}}(\mbox{\hyperlink{classdoris_1_1_bit_reader_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}},\ 8));\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ Current\ position\ in\ the\ stream,\ by\ bit.}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a186c71f841d085110172059bcb58006b}{position}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}}\ *\ 8\ +\ \mbox{\hyperlink{classdoris_1_1_bit_reader_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}};\ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ Rewind\ the\ stream\ by\ 'num\_bits'\ bits}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_aaa16bfb4016424fa24a0c302df7b4b88}{Rewind}}(\textcolor{keywordtype}{int}\ num\_bits);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ Advance\ the\ stream\ by\ 'num\_bits'\ bits}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a55795053f2555342df877ae5c60ec477}{Advance}}(int64\_t\ num\_bits);}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Seek\ to\ a\ specific\ bit\ in\ the\ buffer}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a971b901a518e54154e3418224a577f78}{SeekToBit}}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ stream\_position);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ Maximum\ byte\ length\ of\ a\ vlq\ encoded\ int}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_aa51d64b66ddebd02f6b94f05a67f9476}{MAX\_VLQ\_BYTE\_LEN}}\ =\ 5;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ Maximum\ byte\ length\ of\ a\ vlq\ encoded\ int64}}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a5beb28f21440839c0b6f04af364040ee}{MAX\_VLQ\_BYTE\_LEN\_FOR\_INT64}}\ =\ 10;}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a7a2108348656c73efe1d72702c96d5c5}{is\_initialized}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a83fa585f5b2aa9ac3601d380761d38af}{buffer\_}}\ !=\ \textcolor{keyword}{nullptr};\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ Used\ by\ SeekToBit()\ and\ GetValue()\ to\ fetch\ the}}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ the\ next\ word\ into\ buffer\_.}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a9349aa34beda34a165dc019b52ab78eb}{BufferValues}}();}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a83fa585f5b2aa9ac3601d380761d38af}{buffer\_}};}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a163ead0e7ab6eeff4bdd55ac51bd054b}{max\_bytes\_}};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ Bytes\ are\ memcpy'd\ from\ buffer\_\ and\ values\ are\ read\ from\ this\ variable.\ This\ is}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ faster\ than\ reading\ values\ byte\ by\ byte\ directly\ from\ buffer\_.}}
\DoxyCodeLine{00158\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_bit_reader_adc033a5e038feb634fe7436abc5a087c}{buffered\_values\_}};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_a6c8e3fb5e081561f38ca43460d136a2f}{byte\_offset\_}};\ \textcolor{comment}{//\ Offset\ in\ buffer\_}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_bit_reader_ab52dc5034c0e004b8993280d95a33b64}{bit\_offset\_}};\ \ \textcolor{comment}{//\ Offset\ in\ buffered\_values\_}}
\DoxyCodeLine{00162\ \};}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00168\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_batched_bit_reader}{BatchedBitReader}}\ \{}
\DoxyCodeLine{00169\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ad2e328d4a337bf07b81c38a3e981b418}{BatchedBitReader}}(\textcolor{keyword}{const}\ uint8\_t*\ buffer,\ int64\_t\ buffer\_len)\ \{\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ac494c84b03a9f016d50521c093365648}{Reset}}(buffer,\ buffer\_len);\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ac22d81ac39d4e8c27aad6f7208a01ec1}{BatchedBitReader}}()\ \{\}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ The\ implicit\ copy\ constructor\ is\ left\ defined.\ If\ a\ BatchedBitReader\ is\ copied,\ the}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ two\ copies\ do\ not\ share\ any\ state.\ Invoking\ functions\ on\ either\ copy\ continues}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ reading\ from\ the\ current\ read\ position\ without\ modifying\ the\ state\ of\ the\ other}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ copy.}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ac494c84b03a9f016d50521c093365648}{Reset}}(\textcolor{keyword}{const}\ uint8\_t*\ buffer,\ int64\_t\ buffer\_len)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ DCHECK(buffer\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ DCHECK\_GE(buffer\_len,\ 0);}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a6b50ac6283692a4144cb59a3d7e9d63f}{buffer\_pos\_}}\ =\ buffer;}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ae27374c9b898a83d8f2a48b054736a74}{buffer\_end\_}}\ =\ buffer\ +\ buffer\_len;}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_acff74898c3a45f097ab227f49e131f4a}{UnpackBatch}}(\textcolor{keywordtype}{int}\ bit\_width,\ \textcolor{keywordtype}{int}\ num\_values,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ v);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a9866c67457c964149cdc86ae8b47bd15}{SkipBatch}}(\textcolor{keywordtype}{int}\ bit\_width,\ \textcolor{keywordtype}{int}\ num\_values\_to\_skip);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a4ac729fbee9fed1817808d55622fdd4a}{UnpackAndDecodeBatch}}(\textcolor{keywordtype}{int}\ bit\_width,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ dict,\ int64\_t\ dict\_len,\ \textcolor{keywordtype}{int}\ num\_values,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ v,}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ stride);}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a26289b3e357fd2130867cc1466f58cb6}{GetBytes}}(\textcolor{keywordtype}{int}\ num\_bytes,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ v);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ UINT\_T>}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_afff8698fa0cd066a9da25c05c17156e4}{GetUleb128}}(UINT\_T*\ v);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ INT\_T>}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_abd52d577b05484e298062c13852b3a1a}{GetZigZagInteger}}(INT\_T*\ v);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a7edd581ca3bdf5df0619edc68eb3c8f9}{bytes\_left}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ae27374c9b898a83d8f2a48b054736a74}{buffer\_end\_}}\ -\/\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a6b50ac6283692a4144cb59a3d7e9d63f}{buffer\_pos\_}};\ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a3fefba72d9241e2abf5bddf4fca43d86}{max\_vlq\_byte\_len}}()\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bit_util_ab9002e6aac9b818996faf615f08e426a}{BitUtil::Ceil}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ *\ 8,\ 7);}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a122f34e44299ecba43fd54a57994935b}{MAX\_BITWIDTH}}\ =\ \mbox{\hyperlink{classdoris_1_1_bit_packing_adb36d537d61c2d9a867fb2613c5b8741}{BitPacking::MAX\_BITWIDTH}};}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_a6b50ac6283692a4144cb59a3d7e9d63f}{buffer\_pos\_}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classdoris_1_1_batched_bit_reader_ae27374c9b898a83d8f2a48b054736a74}{buffer\_end\_}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00260\ \};}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
