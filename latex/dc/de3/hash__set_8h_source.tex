\hypertarget{hash__set_8h_source}{}\doxysection{hash\+\_\+set.\+h}
\label{hash__set_8h_source}\index{/Users/dabowang/doris/be/src/vec/common/hash\_table/hash\_set.h@{/Users/dabowang/doris/be/src/vec/common/hash\_table/hash\_set.h}}
\mbox{\hyperlink{hash__set_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ copied\ from}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ https://github.com/ClickHouse/ClickHouse/blob/master/src/Common/HashTable/HashSet.h}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ and\ modified\ by\ Doris}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vec_2common_2hash__table_2hash_8h}{vec/common/hash\_table/hash.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{hash__table_8h}{vec/common/hash\_table/hash\_table.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{hash__table__allocator_8h}{vec/common/hash\_table/hash\_table\_allocator.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ TCell,\ \textcolor{keyword}{typename}\ Hash\ =\ DefaultHash<Key>,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ Grower\ =\ HashTableGrower<>,\ \textcolor{keyword}{typename}\ Allocator\ =\ HashTableAllocator>}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_hash_set_table}{HashSetTable}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_hash_table}{HashTable}}<Key,\ TCell,\ Hash,\ Grower,\ Allocator>\ \{}
\DoxyCodeLine{00035\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table}{Self}}\ =\ \mbox{\hyperlink{class_hash_set_table}{HashSetTable}};}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table_a4f2b15079adb1c343f7a8849e8f9e99e}{Cell}}\ =\ TCell;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_table}{Base}}\ =\ \mbox{\hyperlink{class_hash_table}{HashTable<Key,\ TCell,\ Hash,\ Grower,\ Allocator>}};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{using\ }typename\ \mbox{\hyperlink{class_hash_table_ae82a47ed54977d3df1587240f9dfcf7a}{Base::LookupResult}};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_hash_set_table_a42f1f9112c37cf4b6781ae40a563d350}{merge}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_hash_set_table}{Self}}\&\ rhs)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!this-\/>get\_has\_zero()\ \&\&\ rhs.get\_has\_zero())\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>set\_get\_has\_zero();}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ ++this-\/>\mbox{\hyperlink{class_hash_table_a0dc3c363255f193681c77b4d2a82e995}{m\_size}};}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ rhs.\mbox{\hyperlink{class_hash_table_ab4741a14c6f81b5f465d578592106276}{grower}}.buf\_size();\ ++i)}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!rhs.\mbox{\hyperlink{class_hash_table_a0206a94df49d5e10d01ca9a286ef2f7a}{buf}}[i].is\_zero(*\textcolor{keyword}{this}))\ this-\/>\mbox{\hyperlink{class_hash_table_a05734408db6e4cbe4a77ce6e1fb07aa1}{insert}}(Cell::get\_key(rhs.\mbox{\hyperlink{class_hash_table_a0206a94df49d5e10d01ca9a286ef2f7a}{buf}}[i].get\_value()));}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ \};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash,\ \textcolor{keyword}{typename}\ TState\ =\ HashTableNoState>}
\DoxyCodeLine{00054\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_hash_set_cell_with_saved_hash}{HashSetCellWithSavedHash}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{struct_hash_table_cell}{HashTableCell}}<Key,\ Hash,\ TState>\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{struct_hash_table_cell}{Base}}\ =\ \mbox{\hyperlink{struct_hash_table_cell}{HashTableCell<Key,\ Hash,\ TState>}};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a969dde42a6854fd04d8d0b259ff446b0}{saved\_hash}};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a4cc08ea409a57bcaeb1407202d5626b5}{HashSetCellWithSavedHash}}()\ :\ \mbox{\hyperlink{struct_hash_table_cell}{Base}}()\ \{\}}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a4ad1b28f024863261324b03f4163dded}{HashSetCellWithSavedHash}}(\textcolor{keyword}{const}\ Key\&\ key\_,\ \textcolor{keyword}{const}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{struct_hash_table_cell_a168977474e1267663223541cbc6de230}{Base::State}}\&\ state)}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{struct_hash_table_cell}{Base}}(key\_,\ state)\ \{\}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a51eea93b7a09f6c8669a8f15eaaab429}{key\_equals}}(\textcolor{keyword}{const}\ Key\&\ key\_)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{struct_hash_table_cell_a96313403719d705d2df812e3ba166772}{key}}\ ==\ key\_;\ \}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_ae4c856aa407aefb885b30cecba95d4ba}{key\_equals}}(\textcolor{keyword}{const}\ Key\&\ key\_,\ \textcolor{keywordtype}{size\_t}\ hash\_)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a969dde42a6854fd04d8d0b259ff446b0}{saved\_hash}}\ ==\ hash\_\ \&\&\ this-\/>\mbox{\hyperlink{struct_hash_table_cell_a96313403719d705d2df812e3ba166772}{key}}\ ==\ key\_;}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a540a3ec30f99b71e1ec1c50ee783ddfa}{key\_equals}}(\textcolor{keyword}{const}\ Key\&\ key\_,\ \textcolor{keywordtype}{size\_t}\ hash\_,\ \textcolor{keyword}{const}\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{struct_hash_table_cell_a168977474e1267663223541cbc6de230}{Base::State}}\&)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a51eea93b7a09f6c8669a8f15eaaab429}{key\_equals}}(key\_,\ hash\_);}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a88eacb12c29a297bda868895dc3b6aaa}{set\_hash}}(\textcolor{keywordtype}{size\_t}\ hash\_value)\ \{\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a969dde42a6854fd04d8d0b259ff446b0}{saved\_hash}}\ =\ hash\_value;\ \}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a0297ae27cf469236037b42286c0b9908}{get\_hash}}(\textcolor{keyword}{const}\ Hash\&\ \textcolor{comment}{/*hash\_function*/})\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_hash_set_cell_with_saved_hash_a969dde42a6854fd04d8d0b259ff446b0}{saved\_hash}};\ \}}
\DoxyCodeLine{00073\ \};}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash,\ \textcolor{keyword}{typename}\ State>}
\DoxyCodeLine{00076\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{hash__set_8h_a427eb5473631d6d6e77217f4c2109884}{lookup\_result\_get\_key}}(\mbox{\hyperlink{struct_hash_set_cell_with_saved_hash}{HashSetCellWithSavedHash<Key,\ Hash,\ State>}}*\ cell)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{return}\ \&cell-\/>\mbox{\hyperlink{struct_hash_table_cell_a96313403719d705d2df812e3ba166772}{key}};}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash,\ \textcolor{keyword}{typename}\ State>}
\DoxyCodeLine{00081\ \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\_INLINE}}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{hash__set_8h_a63410a2fe1881ddfd3e086cee7097818}{lookup\_result\_get\_mapped}}(\mbox{\hyperlink{struct_hash_set_cell_with_saved_hash}{HashSetCellWithSavedHash<Key,\ Hash,\ State>}}*)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00083\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash\ =\ DefaultHash<Key>,\ \textcolor{keyword}{typename}\ Grower\ =\ HashTableGrower<>,}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ Allocator\ =\ HashTableAllocator>}
\DoxyCodeLine{00087\ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table}{HashSet}}\ =\ \mbox{\hyperlink{class_hash_set_table}{HashSetTable<Key,\ HashTableCell<Key,\ Hash>}},\ Hash,\ Grower,\ \mbox{\hyperlink{class_allocator}{Allocator}}>;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash\ =\ DefaultHash<Key>,\ \textcolor{keyword}{typename}\ Grower\ =\ HashTableGrower<>,}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typename}\ Allocator\ =\ HashTableAllocator>}
\DoxyCodeLine{00091\ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table}{HashSetWithSavedHash}}\ =}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_hash_set_table}{HashSetTable<Key,\ HashSetCellWithSavedHash<Key,\ Hash>}},\ Hash,\ Grower,\ \mbox{\hyperlink{class_allocator}{Allocator}}>;}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash,\ \textcolor{keywordtype}{size\_t}\ initial\_size\_degree>}
\DoxyCodeLine{00095\ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table}{HashSetWithStackMemory}}\ =}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_hash_set_table}{HashSet<Key,\ Hash,\ HashTableGrower<initial\_size\_degree>}},}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_allocator_with_stack_memory}{HashTableAllocatorWithStackMemory}}<(1ULL\ <<\ initial\_size\_degree)\ *}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_hash_table_cell}{HashTableCell<Key,\ Hash>}})>>;}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Key,\ \textcolor{keyword}{typename}\ Hash,\ \textcolor{keywordtype}{size\_t}\ initial\_size\_degree>}
\DoxyCodeLine{00101\ \textcolor{keyword}{using\ }\mbox{\hyperlink{class_hash_set_table}{HashSetWithSavedHashWithStackMemory}}\ =\ \mbox{\hyperlink{class_hash_set_table}{HashSetWithSavedHash}}<}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ Key,\ Hash,\ \mbox{\hyperlink{struct_hash_table_grower}{HashTableGrower<initial\_size\_degree>}},}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_allocator_with_stack_memory}{HashTableAllocatorWithStackMemory}}<(1ULL\ <<\ initial\_size\_degree)\ *}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_hash_set_cell_with_saved_hash}{HashSetCellWithSavedHash<Key,\ Hash>}})>>;}

\end{DoxyCode}
