\hypertarget{tablet_8h_source}{}\doxysection{tablet.\+h}
\label{tablet_8h_source}\index{/Users/dabowang/doris/be/src/olap/tablet.h@{/Users/dabowang/doris/be/src/olap/tablet.h}}
\mbox{\hyperlink{tablet_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <shared\_mutex>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <unordered\_set>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/AgentService\_types.h"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/MasterService\_types.h"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/olap\_file.pb.h"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{file__system_8h}{io/fs/file\_system.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{base__tablet_8h}{olap/base\_tablet.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cumulative__compaction__policy_8h}{olap/cumulative\_compaction\_policy.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{data__dir_8h}{olap/data\_dir.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap_2olap__common_8h}{olap/olap\_common.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__define_8h}{olap/olap\_define.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__tuple_8h}{olap/olap\_tuple.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset_8h}{olap/rowset/rowset.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__reader_8h}{olap/rowset/rowset\_reader.h}}"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__tree_8h}{olap/rowset/rowset\_tree.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{segment_8h}{olap/rowset/segment\_v2/segment.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet__meta_8h}{olap/tablet\_meta.h}}"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap_2utils_8h}{olap/utils.h}}"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{version__graph_8h}{olap/version\_graph.h}}"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{once_8h}{util/once.h}}"{}}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{class\ }DataDir;}
\DoxyCodeLine{00053\ \textcolor{keyword}{class\ }Tablet;}
\DoxyCodeLine{00054\ \textcolor{keyword}{class\ }TabletMeta;}
\DoxyCodeLine{00055\ \textcolor{keyword}{class\ }CumulativeCompactionPolicy;}
\DoxyCodeLine{00056\ \textcolor{keyword}{class\ }CumulativeCompaction;}
\DoxyCodeLine{00057\ \textcolor{keyword}{class\ }BaseCompaction;}
\DoxyCodeLine{00058\ \textcolor{keyword}{class\ }RowsetWriter;}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{struct\ }TabletTxnInfo;}
\DoxyCodeLine{00061\ \textcolor{keyword}{struct\ }RowsetWriterContext;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ =\ std::shared\_ptr<Tablet>;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{namespacedoris_a66bbeaaac0be5dcb3d9ec1df4311075c}{TabletStorageType}}\ \{\ \mbox{\hyperlink{namespacedoris_a66bbeaaac0be5dcb3d9ec1df4311075caef53d2893b547c5e0797580eee57e3b4}{STORAGE\_TYPE\_LOCAL}},\ \mbox{\hyperlink{namespacedoris_a66bbeaaac0be5dcb3d9ec1df4311075ca5acaca56574a0e4e4881641a61fa8d0a}{STORAGE\_TYPE\_REMOTE}},\ \mbox{\hyperlink{namespacedoris_a66bbeaaac0be5dcb3d9ec1df4311075caad722650ae538c6bd458840541c1348c}{STORAGE\_TYPE\_REMOTE\_AND\_LOCAL}}\ \};}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_base_tablet}{BaseTablet}}\ \{}
\DoxyCodeLine{00068\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a7b7acc1330fa2e0344ea19732fa84eaf}{create\_tablet\_from\_meta}}(\mbox{\hyperlink{namespacedoris_aed567e6af8c6d82336f03a32fce058cf}{TabletMetaSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c7dd542db3c79c229dec54ca92afb1b}{tablet\_meta}},}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}*\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a516e27408889e1dd490da0c6df34258f}{data\_dir}}\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}}(\mbox{\hyperlink{namespacedoris_aed567e6af8c6d82336f03a32fce058cf}{TabletMetaSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c7dd542db3c79c229dec54ca92afb1b}{tablet\_meta}},\ \mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}*\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a516e27408889e1dd490da0c6df34258f}{data\_dir}},}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ cumulative\_compaction\_type\ =\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a223508714f7b7c2a338265d09a23a25f}{init}}();}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a026f7fae6fd778949febe385d366e692}{init\_succeeded}}();}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a295174512c2d9652acce6f9c8e83289e}{is\_used}}();}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a519deb87c0963bf79bcc79ea50e44743}{register\_tablet\_into\_dir}}();}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a014d85d5211a116eaff2632af07ca0ac}{deregister\_tablet\_from\_dir}}();}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a288c6e8525f9acc762951bb060627046}{save\_meta}}();}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ Used\ in\ clone\ task,\ to\ update\ local\ meta\ when\ finishing\ a\ clone\ job}}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_af5ebdcb9fa7a0f52dcf7d7a2123bcb5a}{revise\_tablet\_meta}}(\textcolor{keyword}{const}\ std::vector<RowsetSharedPtr>\&\ to\_add,}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<RowsetSharedPtr>\&\ to\_delete,}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_incremental\_clone);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a13faf61403b03b727f1c5ff76a48a269}{cumulative\_layer\_point}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1351fccd05aeb846b88fa348233dfa7d}{set\_cumulative\_layer\_point}}(int64\_t\ new\_point);}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{inline}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a8e6f0759066913438062e910ff092bfb}{cumulative\_promotion\_size}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a398ce6bc38ef26386b3065ddce7fddee}{set\_cumulative\_promotion\_size}}(int64\_t\ new\_size);}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ Disk\ space\ occupied\ by\ tablet,\ contain\ local\ and\ remote.}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a07784b73dd6cf35b5c97abe3e76c25c5}{tablet\_footprint}}();}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{comment}{//\ Local\ disk\ space\ occupied\ by\ tablet.}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1749fe146dbfc9dc809812926c42cae3}{tablet\_local\_size}}();}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ Remote\ disk\ space\ occupied\ by\ tablet.}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a477cc35810b3d9f5f565e24e3ec6b4c6}{tablet\_remote\_size}}();}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a09f3ce528b3586d1b3b2bec2ff980cad}{num\_rows}}();}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_tablet_aae17630efad472f4a62a7b99d69f79cd}{version\_count}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a844781a214b4d7565e60ccbc241dc435}{exceed\_version\_limit}}(int32\_t\ limit)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00104\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a61485a9766034e10852627ccc9b62a04}{segment\_count}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab550ea00eeeeff9647b86c0aae3e6075}{max\_version}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_tablet_acba857c5cf187690234af6c6252dc421}{max\_version\_unlocked}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{CumulativeCompactionPolicy}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{cumulative\_compaction\_policy}}();}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0ad2bb3aa004c82a192158f07a6f0113}{enable\_unique\_key\_merge\_on\_write}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ properties\ encapsulated\ in\ TabletSchema}}
\DoxyCodeLine{00111\ \ \ \ \ KeysType\ \mbox{\hyperlink{classdoris_1_1_tablet_a3ddea02f8732dc3470c8693177b3068e}{keys\_type}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00112\ \ \ \ \ SortType\ \mbox{\hyperlink{classdoris_1_1_tablet_a1b29e9e0f59cf4c30b243a724a8631d9}{sort\_type}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_af38893ccfca2880f05684db6fa7f9faa}{sort\_col\_num}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a98e2d9685769a3ebb2c0c9600a4c77b2}{num\_columns}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5604a89877cef6ce4223e3ad53ea1469}{num\_null\_columns}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa61c8f3d8ca82f135c0ef9a8f6193eae}{num\_key\_columns}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_aff54953390337da01f0f0531e1a9eb86}{num\_short\_key\_columns}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad5dca659a8f7688ab968a05ee10ef07b}{num\_rows\_per\_row\_block}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00119\ \ \ \ \ CompressKind\ \mbox{\hyperlink{classdoris_1_1_tablet_ac9af748e07590c5c763b8eeb4f95769f}{compress\_kind}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_tablet_a40e87852d07ef1f9c57aa1131d8b3ab1}{bloom\_filter\_fpp}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5e5adbeb054012d7f7d7ab2303289b6a}{next\_unique\_id}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a153aba81b7b9110fa8ca0073e1153100}{row\_size}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ operation\ in\ rowsets}}
\DoxyCodeLine{00125\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0d27a6abf09a631e3a724be8141bb097}{add\_rowset}}(\mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ rowset);}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0e919ff50d857d429fe3d4e77fc42059}{create\_initial\_rowset}}(\textcolor{keyword}{const}\ int64\_t\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}});}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ac4014906ee83a073371ca969af81825c}{modify\_rowsets}}(std::vector<RowsetSharedPtr>\&\ to\_add,}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetSharedPtr>\&\ to\_delete,\ \textcolor{keywordtype}{bool}\ check\_delete\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{comment}{//\ \_rs\_version\_map\ and\ \_stale\_rs\_version\_map\ should\ be\ protected\ by\ \_meta\_lock}}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ The\ caller\ must\ call\ hold\ \_meta\_lock\ when\ call\ this\ two\ function.}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_af92d88fd5e2af90ebe3256e1e96bd7af}{get\_rowset\_by\_version}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ find\_is\_stale\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aff5a976139f9e9def79b6421d6d7bcce}{get\_stale\_rowset\_by\_version}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a77bee8646b130c7e4bbac5a8c27b23f7}{rowset\_with\_max\_version}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{namespacedoris_a8e1aa733e7ffe7bd29887ebdf7c1303d}{RowsetMetaSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_af345ffbee31b20e959338854bcdaa491}{rowset\_meta\_with\_max\_schema\_version}}(}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<RowsetMetaSharedPtr>\&\ rowset\_metas);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab25bac50b1fe7d4e178188683427baac}{add\_inc\_rowset}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\&\ rowset);}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a55bc7a89362ec130c207d755b6a6c6f3}{delete\_expired\_stale\_rowset}}();}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ Given\ spec\_version,\ find\ a\ continuous\ version\ path\ and\ store\ it\ in\ version\_path.}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ If\ quiet\ is\ true,\ then\ only\ "{}does\ this\ path\ exist"{}\ is\ returned.}}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa8b866b3f40c634b361d0e5069fb9733}{capture\_consistent\_versions}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ spec\_version,}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<Version>*\ version\_path,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ quiet\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ if\ quiet\ is\ true,\ no\ error\ log\ will\ be\ printed\ if\ there\ are\ missing\ versions}}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a23e90a11b3242cb01d5137d54e33e2e5}{check\_version\_integrity}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},\ \textcolor{keywordtype}{bool}\ quiet\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0d25f4ac436309d390300ae05075f9b3}{check\_version\_exist}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad31176240ed59cf03df4497388fa7513}{acquire\_version\_and\_rowsets}}(}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<Version,\ RowsetSharedPtr>>*\ version\_rowsets)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad1303b33c31aa2982dc3840f4fca551f}{capture\_consistent\_rowsets}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ spec\_version,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetSharedPtr>*\ rowsets)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a40a37d33cfc2460d9919bd57e4c6217b}{capture\_rs\_readers}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ spec\_version,}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetReaderSharedPtr>*\ rs\_readers)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a40a37d33cfc2460d9919bd57e4c6217b}{capture\_rs\_readers}}(\textcolor{keyword}{const}\ std::vector<Version>\&\ version\_path,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetReaderSharedPtr>*\ rs\_readers)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<RowsetMetaSharedPtr>\ \mbox{\hyperlink{classdoris_1_1_tablet_abfd76a10209c6331e346cde123b32352}{delete\_predicates}}()\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>delete\_predicates();}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a55c5e5d94eba810354cb0d5bc5c8080a}{version\_for\_delete\_predicate}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}});}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ meta\ lock}}
\DoxyCodeLine{00173\ \ \ \ \ std::shared\_mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_acb50e35fcc32330d141748585473028b}{get\_header\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}};\ \}}
\DoxyCodeLine{00174\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_aa7061027dd5b42c3eb3cfbb16cd1c02c}{get\_rowset\_update\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a36e8cdd04866bfac25bc487fb2c183ca}{\_rowset\_update\_lock}};\ \}}
\DoxyCodeLine{00175\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a8dea7add7f0fd0187869f5627321b3e0}{get\_push\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1d75a1d962915e06fac0f84bdeb4163b}{\_ingest\_lock}};\ \}}
\DoxyCodeLine{00176\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a58e8a229a66fae1bf7edb26a597c9b1c}{get\_base\_compaction\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6db204164f0349d09230933d04361d1d}{\_base\_compaction\_lock}};\ \}}
\DoxyCodeLine{00177\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_abfab73c4b208f2b82ea53f1a8e8975f9}{get\_cumulative\_compaction\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a7618e7b7ca58ecfedcbaf7da029b8730}{\_cumulative\_compaction\_lock}};\ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ std::shared\_mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a44357c6bd762babed1de7176195f4c13}{get\_migration\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1564568b0c40eb9bdd002d675e76e7e0}{\_migration\_lock}};\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a631e9d5612276e8f0c4d1b63222e6af5}{get\_schema\_change\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a978433c3a42693ed7167ae38a49d2b8b}{\_schema\_change\_lock}};\ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ operation\ for\ compaction}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_ac1b3fa5f750bd47d1bfe55f01fd91895}{can\_do\_compaction}}(\textcolor{keywordtype}{size\_t}\ path\_hash,\ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00185\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a30f004cf3654234d574d99cbc5044955}{calc\_compaction\_score}}(}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{cumulative\_compaction\_policy}});}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ operation\ for\ clone}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6828f11e1723d22fc39b34240fcb16d9}{calc\_missed\_versions}}(int64\_t\ spec\_version,\ std::vector<Version>*\ missed\_versions);}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_aeaa48c69fb4cca1fb45161515f7ff8ff}{calc\_missed\_versions\_unlocked}}(int64\_t\ spec\_version,}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<Version>*\ missed\_versions)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ This\ function\ to\ find\ max\ continuous\ version\ from\ the\ beginning.}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ For\ example:\ If\ there\ are\ 1,\ 2,\ 3,\ 5,\ 6,\ 7\ versions\ belongs\ tablet,\ then\ 3\ is\ target.}}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ 3\ will\ be\ saved\ in\ "{}version"{},\ and\ 7\ will\ be\ saved\ in\ "{}max\_version"{},\ if\ max\_version\ !=\ nullptr}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_af1d244128e5c1c358972c66277bd962d}{max\_continuous\_version\_from\_beginning}}(\mbox{\hyperlink{structdoris_1_1_version}{Version}}*\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_ab550ea00eeeeff9647b86c0aae3e6075}{max\_version}}\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_acb5e80f6225c1fb3afc0fa0b6dc43b86}{set\_bad}}(\textcolor{keywordtype}{bool}\ is\_bad)\ \{\ \mbox{\hyperlink{classdoris_1_1_tablet_a05eb0757884676acca63799304eaa1de}{\_is\_bad}}\ =\ is\_bad;\ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_ae5a705cacf591febb0202c7ea3c89e62}{last\_cumu\_compaction\_failure\_time}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a05d00f74dfbe3279286d883a0bf55b16}{\_last\_cumu\_compaction\_failure\_millis}};\ \}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_af4856fe2061b569cd4d5b95e7f415004}{set\_last\_cumu\_compaction\_failure\_time}}(int64\_t\ millis)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a05d00f74dfbe3279286d883a0bf55b16}{\_last\_cumu\_compaction\_failure\_millis}}\ =\ millis;}
\DoxyCodeLine{00204\ \ \ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a5030aed40ffaf2dacff8eaafb6498da9}{last\_base\_compaction\_failure\_time}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1b5f2f36f6e0e0180923ae8525330cca}{\_last\_base\_compaction\_failure\_millis}};\ \}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_aca35db704f6e7fdb0920adc39ab8778d}{set\_last\_base\_compaction\_failure\_time}}(int64\_t\ millis)\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a1b5f2f36f6e0e0180923ae8525330cca}{\_last\_base\_compaction\_failure\_millis}}\ =\ millis;}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a39cae9983ac4b7491c324a694237de40}{last\_cumu\_compaction\_success\_time}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a62f4b43dec34b5b157373f6a2aab8b8b}{\_last\_cumu\_compaction\_success\_millis}};\ \}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a3ec9876866a14788425f0ec9fc6f39}{set\_last\_cumu\_compaction\_success\_time}}(int64\_t\ millis)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a62f4b43dec34b5b157373f6a2aab8b8b}{\_last\_cumu\_compaction\_success\_millis}}\ =\ millis;}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a2f7dbdc4b5981be6bec03ce6911c054e}{last\_base\_compaction\_success\_time}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_adf63ce4c66fecb10cc5e2bca369be3c1}{\_last\_base\_compaction\_success\_millis}};\ \}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_af6a8c406fc01728336a8f5a7bc250d27}{set\_last\_base\_compaction\_success\_time}}(int64\_t\ millis)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_adf63ce4c66fecb10cc5e2bca369be3c1}{\_last\_base\_compaction\_success\_millis}}\ =\ millis;}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a7ae1ee828b6fbf625c85045e92e7c9a2}{delete\_all\_files}}();}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab68efb55e9268bf33fa3cf2c64f397c6}{check\_path}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_tablet_ab68efb55e9268bf33fa3cf2c64f397c6}{check\_path}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_af24ca5541fb424aca89d5be68940d745}{check\_rowset\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa1b29db64928a6e6be81c6895d39bcb2}{set\_partition\_id}}(int64\_t\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a729d7fadedbbd9189bd15d20707b0702}{partition\_id}});}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_tablet_info}{TabletInfo}}\ \mbox{\hyperlink{classdoris_1_1_tablet_af7f25825ce4de54ce12664977bfafd29}{get\_tablet\_info}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ std::vector<RowsetSharedPtr>\ \mbox{\hyperlink{classdoris_1_1_tablet_a84bdb4acc8c11a626ff3b74ecaf04c76}{pick\_candidate\_rowsets\_to\_cumulative\_compaction}}();}
\DoxyCodeLine{00231\ \ \ \ \ std::vector<RowsetSharedPtr>\ \mbox{\hyperlink{classdoris_1_1_tablet_a6b56cd21fbb7d57d9634d81f8eee80f6}{pick\_candidate\_rowsets\_to\_base\_compaction}}();}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a23d79421d337fb887f1a165e40492b74}{calculate\_cumulative\_point}}();}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ TODO(ygl):}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a608d1afd7b90ae9d0c8d31fda21af2a0}{is\_primary\_replica}}()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{comment}{//\ TODO(ygl):}}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{comment}{//\ eco\ mode\ means\ power\ saving\ in\ new\ energy\ car}}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{//\ eco\ mode\ also\ means\ save\ money\ in\ palo}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_afa3d36a52bccdd5753e2338e5eadd268}{in\_eco\_mode}}()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{comment}{//\ return\ true\ if\ the\ checkpoint\ is\ actually\ done}}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a39d838bc29d39352f6ca3f3b4dee4d50}{do\_tablet\_meta\_checkpoint}}();}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ Check\ whether\ the\ rowset\ is\ useful\ or\ not,\ unuseful\ rowset\ can\ be\ swept\ up\ then.}}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{comment}{//\ Rowset\ which\ is\ under\ tablet's\ management\ is\ useful,\ i.e.\ rowset\ is\ in}}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ \_rs\_version\_map,\ or\ \_stale\_rs\_version\_map.}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ Rowset\ whose\ version\ range\ is\ not\ covered\ by\ this\ tablet\ is\ also\ useful.}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a3215faf80e2f97fde4f3104f256993e2}{rowset\_meta\_is\_useful}}(\mbox{\hyperlink{namespacedoris_a8e1aa733e7ffe7bd29887ebdf7c1303d}{RowsetMetaSharedPtr}}\ rowset\_meta);}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_af54493ff469d5152f5a28c1ab1bf5eb4}{build\_tablet\_report\_info}}(TTabletInfo*\ tablet\_info,}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ enable\_consecutive\_missing\_check\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a501f3843dc15eedefe2bd67be06aa50e}{generate\_tablet\_meta\_copy}}(\mbox{\hyperlink{namespacedoris_aed567e6af8c6d82336f03a32fce058cf}{TabletMetaSharedPtr}}\ new\_tablet\_meta)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{comment}{//\ caller\ should\ hold\ the\ \_meta\_lock\ before\ calling\ this\ method}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a88cfaedaf574e3f413714ac3d20f6725}{generate\_tablet\_meta\_copy\_unlocked}}(\mbox{\hyperlink{namespacedoris_aed567e6af8c6d82336f03a32fce058cf}{TabletMetaSharedPtr}}\ new\_tablet\_meta)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ return\ a\ json\ string\ to\ show\ the\ compaction\ status\ of\ this\ tablet}}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad16d2b56a593948a8107873f730afcd5}{get\_compaction\_status}}(std::string*\ json\_result);}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa7eea39cf2f365850b2f993040f94d88}{prepare\_compaction\_and\_calculate\_permits}}(\mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type,}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,\ int64\_t*\ permits);}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae6d94da6c04941e51234a934eb09f297}{execute\_compaction}}(\mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_af4e49047e11625505d79f78e3fdda411}{reset\_compaction}}(\mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a8d0ac4c9cc8d239b831f880b015c15c8}{set\_clone\_occurred}}(\textcolor{keywordtype}{bool}\ clone\_occurred)\ \{\ \mbox{\hyperlink{classdoris_1_1_tablet_a61effaeeaceed66acfe1a4d2374603ff}{\_is\_clone\_occurred}}\ =\ clone\_occurred;\ \}}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6cca6d44c1cd75f76da2983aa22e6eb5}{get\_clone\_occurred}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a61effaeeaceed66acfe1a4d2374603ff}{\_is\_clone\_occurred}};\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_acb82347a8d2c6bcd397d5c490debebc2}{set\_cumulative\_compaction\_policy}}(}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{cumulative\_compaction\_policy}})\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a5f7049fba2a8f6b729da830935edab20}{\_cumulative\_compaction\_policy}}\ =\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{cumulative\_compaction\_policy}};}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_tablet_ae0bb5c944617b5605cf99bde84110630}{get\_cumulative\_compaction\_policy}}()\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5f7049fba2a8f6b729da830935edab20}{\_cumulative\_compaction\_policy}};}
\DoxyCodeLine{00276\ \ \ \ \ \}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae4e335ee0baacd0409ca2a4098ab0dea}{all\_beta}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>all\_beta();}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a9d2320197645f8ced12f9286edb46b0f}{tablet\_schema}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a13504b1de9eb20ac44bf6929e4364911}{get\_max\_version\_schema}}(std::lock\_guard<std::shared\_mutex>\&);}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{//\ Find\ the\ related\ rowset\ with\ specified\ version\ and\ return\ its\ tablet\ schema}}
\DoxyCodeLine{00288\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a63ab16fd84c7494006177ad994673a37}{tablet\_schema}}(\mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>tablet\_schema(\mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}});}
\DoxyCodeLine{00290\ \ \ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a99767255101c44954e9a0fdbc20a3133}{create\_rowset\_writer}}(\mbox{\hyperlink{structdoris_1_1_rowset_writer_context}{RowsetWriterContext}}\&\ context,}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RowsetWriter>*\ rowset\_writer);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6c26ee57977160a8cc7d27d37162c822}{create\_vertical\_rowset\_writer}}(\mbox{\hyperlink{structdoris_1_1_rowset_writer_context}{RowsetWriterContext}}\&\ context,}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<RowsetWriter>*\ rowset\_writer);}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0db3320932befc4ac52f0097e2bce075}{create\_rowset}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a8e1aa733e7ffe7bd29887ebdf7c1303d}{RowsetMetaSharedPtr}}\&\ rowset\_meta,\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}*\ rowset);}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{comment}{//\ MUST\ hold\ EXCLUSIVE\ `\_meta\_lock`}}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a9e1e0f9f5eb4e903951b0123f3362e3d}{add\_rowsets}}(\textcolor{keyword}{const}\ std::vector<RowsetSharedPtr>\&\ to\_add);}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//\ MUST\ hold\ EXCLUSIVE\ `\_meta\_lock`}}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad08c2027403339069b238ed655f74c47}{delete\_rowsets}}(\textcolor{keyword}{const}\ std::vector<RowsetSharedPtr>\&\ to\_delete,\ \textcolor{keywordtype}{bool}\ move\_to\_stale);}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{comment}{//\ MUST\ hold\ SHARED\ `\_meta\_lock`}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a962acedf58a5a9903935d65940404f89}{rowset\_map}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad147a6603c749375097a371bf24b7454}{\_rs\_version\_map}};\ \}}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{comment}{//\ MUST\ hold\ SHARED\ `\_meta\_lock`}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a549283ee6be52324757166121357c3b6}{stale\_rowset\_map}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1d2c314bae2c51712a55337e03add080}{\_stale\_rs\_version\_map}};\ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ begin\ cooldown\ functions}}
\DoxyCodeLine{00313\ \textcolor{comment}{}\ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a516be7a035993311ddabb73e0869ef23}{last\_failed\_follow\_cooldown\_time}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a562768ea19cdce45db9198de942e4dc1}{\_last\_failed\_follow\_cooldown\_time}};\ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Cooldown\ to\ remote\ fs.}}
\DoxyCodeLine{00316\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae9d94e8e466b3e2e0e9b44b430883a66}{cooldown}}();}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6556de356a074fba695f69abc8a0c5af}{pick\_cooldown\_rowset}}();}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a7ea903ac19bd858304bb84017d7a9798}{need\_cooldown}}(int64\_t*\ cooldown\_timestamp,\ \textcolor{keywordtype}{size\_t}*\ file\_size);}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ std::pair<int64\_t,\ int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a48dd589ba7a67e89d3aa33897b21285c}{cooldown\_conf}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ std::shared\_lock\ rlock(\mbox{\hyperlink{classdoris_1_1_tablet_afcd4c1100272ac3a5e1febdeed172d92}{\_cooldown\_conf\_lock}});}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{classdoris_1_1_tablet_a3eda581155096f5e1e14fbdd59ae5f5d}{\_cooldown\_replica\_id}},\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}}\};}
\DoxyCodeLine{00325\ \ \ \ \ \}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ std::pair<int64\_t,\ int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a6d78b8630c6fd8bdfa3095c242302976}{cooldown\_conf\_unlocked}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{classdoris_1_1_tablet_a3eda581155096f5e1e14fbdd59ae5f5d}{\_cooldown\_replica\_id}},\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}}\};}
\DoxyCodeLine{00329\ \ \ \ \ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{comment}{//\ return\ true\ if\ update\ success}}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a26432a7db880777351a5543bef9b916f}{update\_cooldown\_conf}}(int64\_t\ cooldown\_term,\ int64\_t\ cooldown\_replica\_id)\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ std::unique\_lock\ wlock(\mbox{\hyperlink{classdoris_1_1_tablet_afcd4c1100272ac3a5e1febdeed172d92}{\_cooldown\_conf\_lock}},\ std::try\_to\_lock);}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!wlock.owns\_lock())\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ LOG(INFO)\ <<\ \textcolor{stringliteral}{"{}try\ cooldown\_conf\_lock\ failed,\ tablet\_id="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_base_tablet_aebbec7014f0cd07f57f939f781c46763}{tablet\_id}}();}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cooldown\_term\ >\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}})\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ LOG(INFO)\ <<\ \textcolor{stringliteral}{"{}update\ cooldown\ conf.\ tablet\_id="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_base_tablet_aebbec7014f0cd07f57f939f781c46763}{tablet\_id}}()}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ cooldown\_replica\_id:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_tablet_a3eda581155096f5e1e14fbdd59ae5f5d}{\_cooldown\_replica\_id}}\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}}}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ cooldown\_replica\_id\ <<\ \textcolor{stringliteral}{"{},\ cooldown\_term:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}}\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ cooldown\_term;}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a3eda581155096f5e1e14fbdd59ae5f5d}{\_cooldown\_replica\_id}}\ =\ cooldown\_replica\_id;}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}}\ =\ cooldown\_term;}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a6c3914faae3823937c2cec50117902}{remove\_all\_remote\_rowsets}}();}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a6905c5e394ae7292af41d073bdd8c87f}{record\_unused\_remote\_rowset}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id,\ \textcolor{keyword}{const}\ std::string\&\ resource,}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ num\_segments);}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ac7613879f95786dddbaa5a244b5baf67}{remove\_unused\_remote\_files}}();}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{comment}{//\ If\ a\ rowset\ is\ to\ be\ written\ to\ remote\ filesystem,\ MUST\ add\ it\ to\ `pending\_remote\_rowsets`\ before\ uploading,}}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{comment}{//\ and\ then\ erase\ it\ from\ `pending\_remote\_rowsets`\ after\ it\ has\ been\ insert\ to\ the\ Tablet.}}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{comment}{//\ `remove\_unused\_remote\_files`\ MUST\ NOT\ delete\ files\ of\ these\ pending\ rowsets.}}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1fe2b480c84c467452dc5b0d1f85b3e4}{add\_pending\_remote\_rowset}}(std::string\ rowset\_id);}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a53c1ab08f21b1850cc422533160d3930}{erase\_pending\_remote\_rowset}}(\textcolor{keyword}{const}\ std::string\&\ rowset\_id);}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a204bdcfb975724c224bfaf4b9e1cc871}{calc\_cold\_data\_compaction\_score}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ std::mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a8771127c9303d2ca2e7fa37d3ea91e75}{get\_cold\_compaction\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a96dfde11750ef514df86573a469a25ef}{\_cold\_compaction\_lock}};\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \ \ std::shared\_mutex\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a2f27e788735469b7ac57136bc68a584a}{get\_cooldown\_conf\_lock}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_afcd4c1100272ac3a5e1febdeed172d92}{\_cooldown\_conf\_lock}};\ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_adef7df4e6334315dfbdf1f37060ab0bf}{async\_write\_cooldown\_meta}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet);}
\DoxyCodeLine{00370\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a53417ecc9e3f51ac5129623c86192728}{write\_cooldown\_meta}}();}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ end\ cooldown\ functions}}
\DoxyCodeLine{00374\ \textcolor{comment}{}}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{comment}{//\ Lookup\ the\ row\ location\ of\ `encoded\_key`,\ the\ function\ sets\ `row\_location`\ on\ success.}}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ the\ method\ only\ works\ in\ unique\ key\ model\ with\ primary\ key\ index,\ you\ will\ got\ a}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ not\ supported\ error\ in\ other\ data\ model.}}
\DoxyCodeLine{00378\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ac59a429465c6ceb751026d0dc9ab9158}{lookup\_row\_key}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ encoded\_key,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}*\ rowset\_ids,}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_row_location}{RowLocation}}*\ row\_location,\ uint32\_t\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}*\ rowset\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{comment}{//\ Lookup\ a\ row\ with\ TupleDescriptor\ and\ fill\ Block}}
\DoxyCodeLine{00383\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a4d6d0e98111c2822c8e5615abd3eb3f0}{lookup\_row\_data}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ encoded\_key,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_row_location}{RowLocation}}\&\ row\_location,}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ rowset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tuple_descriptor}{TupleDescriptor}}*\ desc,}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_olap_reader_statistics}{OlapReaderStatistics}}\&\ stats,\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block,}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ write\_to\_cache\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{comment}{//\ calc\ delete\ bitmap\ when\ flush\ memtable,\ use\ a\ fake\ version\ to\ calc}}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ For\ example,\ cur\ max\ version\ is\ 5,\ and\ we\ use\ version\ 6\ to\ calc\ but}}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{comment}{//\ finally\ this\ rowset\ publish\ version\ with\ 8,\ we\ should\ make\ up\ data}}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{comment}{//\ for\ rowset\ 6-\/7.\ Also,\ if\ a\ compaction\ happens\ between\ commit\_txn\ and}}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{comment}{//\ publish\_txn,\ we\ should\ remove\ compaction\ input\ rowsets'\ delete\_bitmap}}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{comment}{//\ and\ build\ newly\ generated\ rowset's\ delete\_bitmap}}
\DoxyCodeLine{00394\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa9e358fae9b6361465e2844b1b9bb977}{calc\_delete\_bitmap}}(\mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ rowset\_id,}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<segment\_v2::SegmentSharedPtr>\&\ segments,}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}*\ specified\_rowset\_ids,}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9eac641d2af334ef0f001d2ca2a498a4}{DeleteBitmapPtr}}\ delete\_bitmap,\ int64\_t\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ check\_pre\_segments\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a9531761c1ef7ab067129d2863fc267c2}{update\_delete\_bitmap\_without\_lock}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\&\ rowset);}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a300c99a35bd49081f2066b5bbfb1a2ec}{update\_delete\_bitmap}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\&\ rowset,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_tablet_txn_info}{TabletTxnInfo}}*\ load\_info);}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a659033b18c44f499540a177c520791af}{calc\_compaction\_output\_rowset\_delete\_bitmap}}(}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<RowsetSharedPtr>\&\ input\_rowsets,}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_row_id_conversion}{RowIdConversion}}\&\ rowid\_conversion,\ uint64\_t\ start\_version,\ uint64\_t\ end\_version,}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ std::set<RowLocation>*\ missed\_rows,}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ std::map<\mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}},\ std::list<std::pair<RowLocation,\ RowLocation>>>*\ location\_map,}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_delete_bitmap}{DeleteBitmap}}*\ output\_rowset\_delete\_bitmap);}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a07f6ca485faf2e30b02cb5e5d901e233}{merge\_delete\_bitmap}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_delete_bitmap}{DeleteBitmap}}\&\ delete\_bitmap);}
\DoxyCodeLine{00409\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa6ac6617a220b2cd6431fe1f6e8e709f}{check\_rowid\_conversion}}(}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ dst\_rowset,}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::map<\mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}},\ std::list<std::pair<RowLocation,\ RowLocation>>>\&}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ location\_map);}
\DoxyCodeLine{00413\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae36c6a6c6362279ca31fd2ea53cd6ea8}{all\_rs\_id}}(int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_ab550ea00eeeeff9647b86c0aae3e6075}{max\_version}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a3459d52b82a9a91da95eb1fdc3c043f4}{check\_all\_rowset\_segment}}();}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa536d5d9da279b01e876d871b1e123d9}{update\_max\_version\_schema}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a9d2320197645f8ced12f9286edb46b0f}{tablet\_schema}});}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad06afda3420693850823a609ccca983f}{set\_skip\_compaction}}(\textcolor{keywordtype}{bool}\ skip,}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type\ =\ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576ca748ef00ade8b65886137d6f6392bedf3}{CompactionType::CUMULATIVE\_COMPACTION}},}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ start\ =\ -\/1);}
\DoxyCodeLine{00422\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_afd602d03d169450a27bd4ba639732a2a}{should\_skip\_compaction}}(\mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type,\ int64\_t\ now);}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a535549f946b63aaf96761bd539d42612}{get\_rowset}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id);}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab38e1c0b39fec819b3d8f2ed1d72ca66}{traverse\_rowsets}}(std::function<\textcolor{keywordtype}{void}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\&)>\ visitor)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ std::shared\_lock\ rlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ [v,\ rs]\ :\ \mbox{\hyperlink{classdoris_1_1_tablet_ad147a6603c749375097a371bf24b7454}{\_rs\_version\_map}})\ \{}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ visitor(rs);}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a746c2f19f7e99ceb7b0b7ac8b35bf3fa}{increase\_io\_error\_times}}()\ \{\ ++\mbox{\hyperlink{classdoris_1_1_tablet_a69b879f8c6d23b4ffa6d4e65cef3aa88}{\_io\_error\_times}};\ \}}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keyword}{inline}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a0b568e80b786dfe2252f0f0147c3cf0e}{get\_io\_error\_times}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a69b879f8c6d23b4ffa6d4e65cef3aa88}{\_io\_error\_times}};\ \}}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a38a3f202b6085aa77430707d3dd12325}{is\_io\_error\_too\_times}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ config::max\_tablet\_io\_errors\ >\ 0\ \&\&\ \mbox{\hyperlink{classdoris_1_1_tablet_a69b879f8c6d23b4ffa6d4e65cef3aa88}{\_io\_error\_times}}\ >=\ config::max\_tablet\_io\_errors;}
\DoxyCodeLine{00439\ \ \ \ \ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00442\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa651dd70896c96a39a7007c20940d10a}{\_init\_once\_action}}();}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a2ee1e4d4fb638da84d99bc56561642d3}{\_print\_missed\_versions}}(\textcolor{keyword}{const}\ std::vector<Version>\&\ missed\_versions)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00444\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_aab32ba81259e9e4d04af4df5f12a774d}{\_contains\_rowset}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ rowset\_id);}
\DoxyCodeLine{00445\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad10f1c665f0420c0fa438639b7622d66}{\_contains\_version}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}});}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{comment}{//\ Returns:}}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{comment}{//\ version:\ the\ max\ continuous\ version\ from\ beginning}}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{comment}{//\ max\_version:\ the\ max\ version\ of\ this\ tablet}}
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a4b95e04a567be194c6f1954af62113c3}{\_max\_continuous\_version\_from\_beginning\_unlocked}}(\mbox{\hyperlink{structdoris_1_1_version}{Version}}*\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_ab550ea00eeeeff9647b86c0aae3e6075}{max\_version}},}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}*\ has\_version\_cross)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00452\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a76cc612284ecb9119e578e2303f916f8}{\_rowset\_with\_largest\_size}}();}
\DoxyCodeLine{00455\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a751d5b582ee92d6c2155425a73fab276}{\_delete\_stale\_rowset\_by\_version}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}});}
\DoxyCodeLine{00456\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ac225ad8b314ffcfd44daee9fae47b408}{\_capture\_consistent\_rowsets\_unlocked}}(\textcolor{keyword}{const}\ std::vector<Version>\&\ version\_path,}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetSharedPtr>*\ rowsets)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a1b82d3372998e789250220ab5385e6e0}{\_calc\_cumulative\_compaction\_score}}(}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{cumulative\_compaction\_policy}});}
\DoxyCodeLine{00461\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a8473345df09cd96f57b3be25304abf35}{\_calc\_base\_compaction\_score}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{comment}{//\ When\ the\ proportion\ of\ empty\ edges\ in\ the\ adjacency\ matrix\ used\ to\ represent\ the\ version\ graph}}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{comment}{//\ in\ the\ version\ tracker\ is\ greater\ than\ the\ threshold,\ rebuild\ the\ version\ tracker}}
\DoxyCodeLine{00465\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab8b98819a2dcd15f425cb863ac8061f7}{\_reconstruct\_version\_tracker\_if\_necessary}}();}
\DoxyCodeLine{00466\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad520ac4a44e2c95495ee294982acc701}{\_init\_context\_common\_fields}}(\mbox{\hyperlink{structdoris_1_1_rowset_writer_context}{RowsetWriterContext}}\&\ context);}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a79a5cb1c877c99a5c6ee04c3a21dd75a}{\_check\_pk\_in\_pre\_segments}}(\mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ rowset\_id,}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<segment\_v2::SegmentSharedPtr>\&\ pre\_segments,}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_slice}{Slice}}\&\ key,\ \mbox{\hyperlink{namespacedoris_a9eac641d2af334ef0f001d2ca2a498a4}{DeleteBitmapPtr}}\ delete\_bitmap,}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_row_location}{RowLocation}}*\ loc);}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a51388a8ba360f19ca8774f49faf515cd}{\_rowset\_ids\_difference}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}\&\ cur,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}\&\ pre,}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}*\ to\_add,\ \mbox{\hyperlink{namespacedoris_a0d50dca2f3b30fd0086b9918026b0714}{RowsetIdUnorderedSet}}*\ to\_del);}
\DoxyCodeLine{00474\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a354ed183b0742962d7f8ae3b49852e74}{\_load\_rowset\_segments}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\&\ rowset,}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<segment\_v2::SegmentSharedPtr>*\ segments);}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{comment}{//\ begin\ cooldown\ functions}}
\DoxyCodeLine{00480\ \textcolor{comment}{}\ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5fcf8794639af23fb242b830d3dda65f}{\_cooldown\_data}}();}
\DoxyCodeLine{00481\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a8abc1beb446f95fb13b7987610c9f1d6}{\_follow\_cooldowned\_data}}();}
\DoxyCodeLine{00482\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablet_aca327e2f5c297e6a3be5738a0e946ed4}{\_read\_cooldown\_meta}}(\textcolor{keyword}{const}\ std::shared\_ptr<io::RemoteFileSystem>\&\ fs,}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TabletMetaPB*\ tablet\_meta\_pb);}
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{comment}{//\ end\ cooldown\ functions}}
\DoxyCodeLine{00487\ \textcolor{comment}{}}
\DoxyCodeLine{00488\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a144dd39436c6df388ee1d97d6bee5480}{K\_INVALID\_CUMULATIVE\_POINT}}\ =\ -\/1;}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00492\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_timestamped_version_tracker}{TimestampedVersionTracker}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae3f82580642bfe5f0c09b12b333b000c}{\_timestamped\_version\_tracker}};}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_doris_call_once}{DorisCallOnce<Status>}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab73394fec02359f340669f07740a4693}{\_init\_once}};}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{comment}{//\ meta\ store\ lock\ is\ used\ for\ prevent\ 2\ threads\ do\ checkpoint\ concurrently}}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{comment}{//\ it\ will\ be\ used\ in\ econ-\/mode\ in\ the\ future}}
\DoxyCodeLine{00497\ \ \ \ \ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a3c619658279efd6cc58922812483c53c}{\_meta\_store\_lock}};}
\DoxyCodeLine{00498\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a1d75a1d962915e06fac0f84bdeb4163b}{\_ingest\_lock}};}
\DoxyCodeLine{00499\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a6db204164f0349d09230933d04361d1d}{\_base\_compaction\_lock}};}
\DoxyCodeLine{00500\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a7618e7b7ca58ecfedcbaf7da029b8730}{\_cumulative\_compaction\_lock}};}
\DoxyCodeLine{00501\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a978433c3a42693ed7167ae38a49d2b8b}{\_schema\_change\_lock}};}
\DoxyCodeLine{00502\ \ \ \ \ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a1564568b0c40eb9bdd002d675e76e7e0}{\_migration\_lock}};}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{comment}{//\ TODO(lingbin):\ There\ is\ a\ \_meta\_lock\ TabletMeta\ too,\ there\ should\ be\ a\ comment\ to}}
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{comment}{//\ explain\ how\ these\ two\ locks\ work\ together.}}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keyword}{mutable}\ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}};}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{comment}{//\ In\ unique\ key\ table\ with\ MoW,\ we\ should\ guarantee\ that\ only\ one}}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{comment}{//\ writer\ can\ update\ rowset\ and\ delete\ bitmap\ at\ the\ same\ time.}}
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{comment}{//\ We\ use\ a\ separate\ lock\ rather\ than\ \_meta\_lock,\ to\ avoid\ blocking\ read\ queries}}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{comment}{//\ during\ publish\_txn,\ which\ might\ take\ hundreds\ of\ milliseconds}}
\DoxyCodeLine{00512\ \ \ \ \ \textcolor{keyword}{mutable}\ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a36e8cdd04866bfac25bc487fb2c183ca}{\_rowset\_update\_lock}};}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{comment}{//\ After\ version\ 0.13,\ all\ newly\ created\ rowsets\ are\ saved\ in\ \_rs\_version\_map.}}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{comment}{//\ And\ if\ rowset\ being\ compacted,\ the\ old\ rowsetis\ will\ be\ saved\ in\ \_stale\_rs\_version\_map;}}
\DoxyCodeLine{00516\ \ \ \ \ std::unordered\_map<Version,\ RowsetSharedPtr,\ HashOfVersion>\ \mbox{\hyperlink{classdoris_1_1_tablet_ad147a6603c749375097a371bf24b7454}{\_rs\_version\_map}};}
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{comment}{//\ This\ variable\ \_stale\_rs\_version\_map\ is\ used\ to\ record\ these\ rowsets\ which\ are\ be\ compacted.}}
\DoxyCodeLine{00518\ \ \ \ \ \textcolor{comment}{//\ These\ \_stale\ rowsets\ are\ been\ removed\ when\ rowsets'\ pathVersion\ is\ expired,}}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{comment}{//\ this\ policy\ is\ judged\ and\ computed\ by\ TimestampedVersionTracker.}}
\DoxyCodeLine{00520\ \ \ \ \ std::unordered\_map<Version,\ RowsetSharedPtr,\ HashOfVersion>\ \mbox{\hyperlink{classdoris_1_1_tablet_a1d2c314bae2c51712a55337e03add080}{\_stale\_rs\_version\_map}};}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{comment}{//\ RowsetTree\ is\ used\ to\ locate\ rowsets\ containing\ a\ key\ or\ a\ key\ range\ quickly.}}
\DoxyCodeLine{00522\ \ \ \ \ \textcolor{comment}{//\ It's\ only\ used\ in\ UNIQUE\_KEYS\ data\ model.}}
\DoxyCodeLine{00523\ \ \ \ \ std::unique\_ptr<RowsetTree>\ \mbox{\hyperlink{classdoris_1_1_tablet_a5efe1dc830fc9a0fde5a92d9dc30e699}{\_rowset\_tree}};}
\DoxyCodeLine{00524\ \ \ \ \ \textcolor{comment}{//\ if\ this\ tablet\ is\ broken,\ set\ to\ true.\ default\ is\ false}}
\DoxyCodeLine{00525\ \ \ \ \ std::atomic<bool>\ \mbox{\hyperlink{classdoris_1_1_tablet_a05eb0757884676acca63799304eaa1de}{\_is\_bad}};}
\DoxyCodeLine{00526\ \ \ \ \ \textcolor{comment}{//\ timestamp\ of\ last\ cumu\ compaction\ failure}}
\DoxyCodeLine{00527\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a05d00f74dfbe3279286d883a0bf55b16}{\_last\_cumu\_compaction\_failure\_millis}};}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{comment}{//\ timestamp\ of\ last\ base\ compaction\ failure}}
\DoxyCodeLine{00529\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a1b5f2f36f6e0e0180923ae8525330cca}{\_last\_base\_compaction\_failure\_millis}};}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{comment}{//\ timestamp\ of\ last\ cumu\ compaction\ success}}
\DoxyCodeLine{00531\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a62f4b43dec34b5b157373f6a2aab8b8b}{\_last\_cumu\_compaction\_success\_millis}};}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{comment}{//\ timestamp\ of\ last\ base\ compaction\ success}}
\DoxyCodeLine{00533\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_adf63ce4c66fecb10cc5e2bca369be3c1}{\_last\_base\_compaction\_success\_millis}};}
\DoxyCodeLine{00534\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a0aa1c5ca29cca6843b233682d65d9111}{\_cumulative\_point}};}
\DoxyCodeLine{00535\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_ae448b51861e68115d43737abec6baef9}{\_cumulative\_promotion\_size}};}
\DoxyCodeLine{00536\ \ \ \ \ std::atomic<int32\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_afe3e5cc74c6e637cb30a1bf98d5e26b0}{\_newly\_created\_rowset\_num}};}
\DoxyCodeLine{00537\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_a06ceb0026b9f006d7912370bc393e55f}{\_last\_checkpoint\_time}};}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{comment}{//\ cumulative\ compaction\ policy}}
\DoxyCodeLine{00540\ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_tablet_a5f7049fba2a8f6b729da830935edab20}{\_cumulative\_compaction\_policy}};}
\DoxyCodeLine{00541\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_tablet_a4e911d1ecb28b838c7714206505718c4}{\_cumulative\_compaction\_type}};}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ \ \ std::shared\_ptr<CumulativeCompaction>\ \mbox{\hyperlink{classdoris_1_1_tablet_a8b300a270d10d68fe7bc428635f67483}{\_cumulative\_compaction}};}
\DoxyCodeLine{00544\ \ \ \ \ std::shared\_ptr<BaseCompaction>\ \mbox{\hyperlink{classdoris_1_1_tablet_a4f59665049b844bf848e2539069220c1}{\_base\_compaction}};}
\DoxyCodeLine{00545\ \ \ \ \ \textcolor{comment}{//\ whether\ clone\ task\ occurred\ during\ the\ tablet\ is\ in\ thread\ pool\ queue\ to\ wait\ for\ compaction}}
\DoxyCodeLine{00546\ \ \ \ \ std::atomic<bool>\ \mbox{\hyperlink{classdoris_1_1_tablet_a61effaeeaceed66acfe1a4d2374603ff}{\_is\_clone\_occurred}};}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a59b41cf3cac662f0fcee99a1e5182266}{\_last\_missed\_version}};}
\DoxyCodeLine{00549\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a43b5dd8bb793c8964dc49eef96dc0471}{\_last\_missed\_time\_s}};}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{comment}{//\ Max\ schema\_version\ schema\ from\ Rowset\ or\ FE}}
\DoxyCodeLine{00552\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1272b0b6fa167b11f53433c52299598c}{\_max\_version\_schema}};}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_adfe9f6587203d1fecd9de00e400e8d67}{\_skip\_cumu\_compaction}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00555\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a16ed92d06c48dfdcbdcb5b7e25302630}{\_skip\_cumu\_compaction\_ts}};}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae4eaee318cd88f7d9a099532dabe5a44}{\_skip\_base\_compaction}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00558\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_adb51f1ac4f573be3416bf95872cd6dfa}{\_skip\_base\_compaction\_ts}};}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{comment}{//\ cooldown\ related}}
\DoxyCodeLine{00561\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a3eda581155096f5e1e14fbdd59ae5f5d}{\_cooldown\_replica\_id}}\ =\ -\/1;}
\DoxyCodeLine{00562\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a8a139912a8d6e92cff41f32f4b454ddb}{\_cooldown\_term}}\ =\ -\/1;}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{comment}{//\ `\_cooldown\_conf\_lock`\ is\ used\ to\ serialize\ update\ cooldown\ conf\ and\ all\ operations\ that:}}
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{comment}{//\ 1.\ read\ cooldown\ conf}}
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{comment}{//\ 2.\ upload\ rowsets\ to\ remote\ storage}}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{comment}{//\ 3.\ update\ cooldown\ meta\ id}}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{keyword}{mutable}\ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_afcd4c1100272ac3a5e1febdeed172d92}{\_cooldown\_conf\_lock}};}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{comment}{//\ `\_cold\_compaction\_lock`\ is\ used\ to\ serialize\ cold\ data\ compaction\ and\ all\ operations\ that}}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{comment}{//\ may\ delete\ compaction\ input\ rowsets.}}
\DoxyCodeLine{00570\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablet_a96dfde11750ef514df86573a469a25ef}{\_cold\_compaction\_lock}};}
\DoxyCodeLine{00571\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a562768ea19cdce45db9198de942e4dc1}{\_last\_failed\_follow\_cooldown\_time}}\ =\ 0;}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a606485595b06fadae2777513d5b38066}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}});}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a69b879f8c6d23b4ffa6d4e65cef3aa88}{\_io\_error\_times}}\ =\ 0;}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00578\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_core_local_counter}{IntCounter}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_ae819e898c9db538ee2a70921bdcd8332}{flush\_bytes}};}
\DoxyCodeLine{00579\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_core_local_counter}{IntCounter}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_a3f68ae799f7420e60ecd1b2c33d1ca34}{flush\_finish\_count}};}
\DoxyCodeLine{00580\ \ \ \ \ std::atomic<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablet_aa1e7390fc15b644c1743757e216466f0}{publised\_count}}\ =\ 0;}
\DoxyCodeLine{00581\ \};}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classdoris_1_1_cumulative_compaction_policy}{CumulativeCompactionPolicy}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_a6668911caf5198f9b659f4f2e492cb69}{Tablet::cumulative\_compaction\_policy}}()\ \{}
\DoxyCodeLine{00584\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5f7049fba2a8f6b729da830935edab20}{\_cumulative\_compaction\_policy}}.get();}
\DoxyCodeLine{00585\ \}}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a026f7fae6fd778949febe385d366e692}{Tablet::init\_succeeded}}()\ \{}
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab73394fec02359f340669f07740a4693}{\_init\_once}}.has\_called()\ \&\&\ \mbox{\hyperlink{classdoris_1_1_tablet_ab73394fec02359f340669f07740a4693}{\_init\_once}}.stored\_result().ok();}
\DoxyCodeLine{00589\ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a295174512c2d9652acce6f9c8e83289e}{Tablet::is\_used}}()\ \{}
\DoxyCodeLine{00592\ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{classdoris_1_1_tablet_a05eb0757884676acca63799304eaa1de}{\_is\_bad}}\ \&\&\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a09adc9780f992c409aa4eaf307d9da12}{\_data\_dir}}-\/>\mbox{\hyperlink{classdoris_1_1_data_dir_a209ea2ddfdfa80703799c92da8beb643}{is\_used}}();}
\DoxyCodeLine{00593\ \}}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a519deb87c0963bf79bcc79ea50e44743}{Tablet::register\_tablet\_into\_dir}}()\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_base_tablet_a09adc9780f992c409aa4eaf307d9da12}{\_data\_dir}}-\/>\mbox{\hyperlink{classdoris_1_1_data_dir_ad08173352729e590595e1101aac23abc}{register\_tablet}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00597\ \}}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a014d85d5211a116eaff2632af07ca0ac}{Tablet::deregister\_tablet\_from\_dir}}()\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_base_tablet_a09adc9780f992c409aa4eaf307d9da12}{\_data\_dir}}-\/>\mbox{\hyperlink{classdoris_1_1_data_dir_a218940e1ba12b44d57d512709fefd41b}{deregister\_tablet}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00601\ \}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \textcolor{keyword}{inline}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a13faf61403b03b727f1c5ff76a48a269}{Tablet::cumulative\_layer\_point}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0aa1c5ca29cca6843b233682d65d9111}{\_cumulative\_point}};}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1351fccd05aeb846b88fa348233dfa7d}{Tablet::set\_cumulative\_layer\_point}}(int64\_t\ new\_point)\ \{}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{comment}{//\ cumulative\ point\ should\ only\ be\ reset\ to\ -\/1,\ or\ be\ increased}}
\DoxyCodeLine{00609\ \ \ \ \ CHECK(new\_point\ ==\ \mbox{\hyperlink{classdoris_1_1_tablet_a144dd39436c6df388ee1d97d6bee5480}{Tablet::K\_INVALID\_CUMULATIVE\_POINT}}\ ||\ new\_point\ >=\ \mbox{\hyperlink{classdoris_1_1_tablet_a0aa1c5ca29cca6843b233682d65d9111}{\_cumulative\_point}})}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ cumulative\ point:\ "{}}\ <<\ new\_point}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ origin:\ "{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_tablet_a0aa1c5ca29cca6843b233682d65d9111}{\_cumulative\_point}}.load();}
\DoxyCodeLine{00612\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_a0aa1c5ca29cca6843b233682d65d9111}{\_cumulative\_point}}\ =\ new\_point;}
\DoxyCodeLine{00613\ \}}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \textcolor{keyword}{inline}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a8e6f0759066913438062e910ff092bfb}{Tablet::cumulative\_promotion\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablet_ae448b51861e68115d43737abec6baef9}{\_cumulative\_promotion\_size}};}
\DoxyCodeLine{00617\ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_a398ce6bc38ef26386b3065ddce7fddee}{Tablet::set\_cumulative\_promotion\_size}}(int64\_t\ new\_size)\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_ae448b51861e68115d43737abec6baef9}{\_cumulative\_promotion\_size}}\ =\ new\_size;}
\DoxyCodeLine{00621\ \}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablet_a0ad2bb3aa004c82a192158f07a6f0113}{Tablet::enable\_unique\_key\_merge\_on\_write}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00624\ \textcolor{preprocessor}{\#ifdef\ BE\_TEST}}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00627\ \ \ \ \ \}}
\DoxyCodeLine{00628\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00629\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>enable\_unique\_key\_merge\_on\_write();}
\DoxyCodeLine{00630\ \}}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \textcolor{comment}{//\ TODO(lingbin):\ Why\ other\ methods\ that\ need\ to\ get\ information\ from\ \_tablet\_meta}}
\DoxyCodeLine{00633\ \textcolor{comment}{//\ are\ not\ locked,\ here\ needs\ a\ comment\ to\ explain.}}
\DoxyCodeLine{00634\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a07784b73dd6cf35b5c97abe3e76c25c5}{Tablet::tablet\_footprint}}()\ \{}
\DoxyCodeLine{00635\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>tablet\_footprint();}
\DoxyCodeLine{00637\ \}}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a1749fe146dbfc9dc809812926c42cae3}{Tablet::tablet\_local\_size}}()\ \{}
\DoxyCodeLine{00640\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>tablet\_local\_size();}
\DoxyCodeLine{00642\ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a477cc35810b3d9f5f565e24e3ec6b4c6}{Tablet::tablet\_remote\_size}}()\ \{}
\DoxyCodeLine{00645\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00646\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>tablet\_remote\_size();}
\DoxyCodeLine{00647\ \}}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \textcolor{comment}{//\ TODO(lingbin):\ Why\ other\ methods\ which\ need\ to\ get\ information\ from\ \_tablet\_meta}}
\DoxyCodeLine{00650\ \textcolor{comment}{//\ are\ not\ locked,\ here\ needs\ a\ comment\ to\ explain.}}
\DoxyCodeLine{00651\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a09f3ce528b3586d1b3b2bec2ff980cad}{Tablet::num\_rows}}()\ \{}
\DoxyCodeLine{00652\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00653\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>num\_rows();}
\DoxyCodeLine{00654\ \}}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_tablet_aae17630efad472f4a62a7b99d69f79cd}{Tablet::version\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00657\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>version\_count();}
\DoxyCodeLine{00659\ \}}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_tablet_ab550ea00eeeeff9647b86c0aae3e6075}{Tablet::max\_version}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>max\_version();}
\DoxyCodeLine{00663\ \}}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \textcolor{keyword}{inline}\ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_a61485a9766034e10852627ccc9b62a04}{Tablet::segment\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00666\ \ \ \ \ std::shared\_lock\ rdlock(\mbox{\hyperlink{classdoris_1_1_tablet_aa479f8b73cfe99e5b109f5cdb6bb8282}{\_meta\_lock}});}
\DoxyCodeLine{00667\ \ \ \ \ uint64\_t\ segment\_nums\ =\ 0;}
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ rs\_meta\ :\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>all\_rs\_metas())\ \{}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ segment\_nums\ +=\ rs\_meta-\/>num\_segments();}
\DoxyCodeLine{00670\ \ \ \ \ \}}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{keywordflow}{return}\ segment\_nums;}
\DoxyCodeLine{00672\ \}}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_tablet_acba857c5cf187690234af6c6252dc421}{Tablet::max\_version\_unlocked}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a2987960cc201584161e98901efb5f270}{\_tablet\_meta}}-\/>max\_version();}
\DoxyCodeLine{00676\ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \textcolor{keyword}{inline}\ KeysType\ \mbox{\hyperlink{classdoris_1_1_tablet_a3ddea02f8732dc3470c8693177b3068e}{Tablet::keys\_type}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>keys\_type();}
\DoxyCodeLine{00680\ \}}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \textcolor{keyword}{inline}\ SortType\ \mbox{\hyperlink{classdoris_1_1_tablet_a1b29e9e0f59cf4c30b243a724a8631d9}{Tablet::sort\_type}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>sort\_type();}
\DoxyCodeLine{00684\ \}}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_af38893ccfca2880f05684db6fa7f9faa}{Tablet::sort\_col\_num}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>sort\_col\_num();}
\DoxyCodeLine{00688\ \}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a98e2d9685769a3ebb2c0c9600a4c77b2}{Tablet::num\_columns}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>num\_columns();}
\DoxyCodeLine{00692\ \}}
\DoxyCodeLine{00693\ }
\DoxyCodeLine{00694\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5604a89877cef6ce4223e3ad53ea1469}{Tablet::num\_null\_columns}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00695\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>num\_null\_columns();}
\DoxyCodeLine{00696\ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_aa61c8f3d8ca82f135c0ef9a8f6193eae}{Tablet::num\_key\_columns}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00699\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>num\_key\_columns();}
\DoxyCodeLine{00700\ \}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_aff54953390337da01f0f0531e1a9eb86}{Tablet::num\_short\_key\_columns}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00703\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>num\_short\_key\_columns();}
\DoxyCodeLine{00704\ \}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_ad5dca659a8f7688ab968a05ee10ef07b}{Tablet::num\_rows\_per\_row\_block}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00707\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>num\_rows\_per\_row\_block();}
\DoxyCodeLine{00708\ \}}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00710\ \textcolor{keyword}{inline}\ CompressKind\ \mbox{\hyperlink{classdoris_1_1_tablet_ac9af748e07590c5c763b8eeb4f95769f}{Tablet::compress\_kind}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00711\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>compress\_kind();}
\DoxyCodeLine{00712\ \}}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_tablet_a40e87852d07ef1f9c57aa1131d8b3ab1}{Tablet::bloom\_filter\_fpp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00715\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>bloom\_filter\_fpp();}
\DoxyCodeLine{00716\ \}}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a5e5adbeb054012d7f7d7ab2303289b6a}{Tablet::next\_unique\_id}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>next\_column\_unique\_id();}
\DoxyCodeLine{00720\ \}}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_tablet_a153aba81b7b9110fa8ca0073e1153100}{Tablet::row\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00723\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_base_tablet_a9c9b59974a6e644d6d15e1d57cade701}{\_schema}}-\/>row\_size();}
\DoxyCodeLine{00724\ \}}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00726\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
