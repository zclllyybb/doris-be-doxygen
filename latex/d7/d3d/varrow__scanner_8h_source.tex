\hypertarget{varrow__scanner_8h_source}{}\doxysection{varrow\+\_\+scanner.\+h}
\label{varrow__scanner_8h_source}\index{/Users/dabowang/doris/be/src/vec/exec/varrow\_scanner.h@{/Users/dabowang/doris/be/src/vec/exec/varrow\_scanner.h}}
\mbox{\hyperlink{varrow__scanner_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <arrow/array.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{arrow__reader_8h}{exec/arrow/arrow\_reader.h}}>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{parquet__reader_8h}{exec/arrow/parquet\_reader.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{base__scanner_8h}{exec/base\_scanner.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{file__factory_8h}{io/file\_factory.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{runtime__profile_8h}{util/runtime\_profile.h}}"{}}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris_1_1vectorized}{doris::vectorized}}\ \{}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{comment}{//\ VArrow\ scanner\ convert\ the\ data\ read\ from\ orc|parquet\ to\ doris's\ columns.}}
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner}{VArrowScanner}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_base_scanner}{BaseScanner}}\ \{}
\DoxyCodeLine{00041\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner}{VArrowScanner}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state,\ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TBrokerScanRangeParams\&\ params,\ \textcolor{keyword}{const}\ std::vector<TBrokerRangeDesc>\&\ ranges,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TNetworkAddress>\&\ broker\_addresses,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TExpr>\&\ pre\_filter\_texprs,\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_scanner_counter}{ScannerCounter}}*\ counter);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a953960ea4239649c496f9292cdf10ffb}{\string~VArrowScanner}}();}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ Open\ this\ scanner,\ will\ initialize\ information\ need\ to}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a9226d1cc21f91bcd9ef7c05d6115cc73}{open}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a9c361e227d503395151a9779c38ab968}{get\_next}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}*\ eof)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ Update\ file\ predicate\ filter\ profile}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_ab5ecbf1da45da88fec431f56b8687809}{update\_profile}}(std::shared\_ptr<Statistics>\&\ statistics);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a7008bca493d69ea65f12e0940f3a6886}{close}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_arrow_reader_wrap}{ArrowReaderWrap}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_aab4db80d505d0085f0ddc4130f65695b}{\_new\_arrow\_reader}}(\textcolor{keyword}{const}\ std::vector<SlotDescriptor*>\&\ file\_slot\_descs,}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a4fab59e5f39ac7c318b993fa0c5265ee}{io::FileReaderSPtr}}\ file\_reader,}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int32\_t\ num\_of\_columns\_from\_file,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ range\_start\_offset,\ int64\_t\ range\_size)\ =\ 0;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Read\ next\ buffer\ from\ reader}}
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_ad3ad3f2bd0b1c6091e2e93d5a4cd2d7a}{\_open\_next\_reader}}();}
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a885be2abc6b452a92096ed62155a7376}{\_next\_arrow\_batch}}();}
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a1da9bff0f4504f63710f291e7012bbf6}{\_init\_arrow\_batch\_if\_necessary}}();}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a8ce0448c75d23ceab71e8fc65fe57197}{\_init\_src\_block}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a2757e72fe901132eead85694e57e812a}{\_append\_batch\_to\_src\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block);}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a709ffe79ad037437c4fd8aec20b68354}{\_cast\_src\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block);}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_af4564c4a6b349386f505d70c37c335d1}{\_init\_system\_properties}}(\textcolor{keyword}{const}\ TBrokerRangeDesc\&\ range);}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_ab5a097b43b29956de80d35155320a763}{\_init\_file\_description}}(\textcolor{keyword}{const}\ TBrokerRangeDesc\&\ range);}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ Reader}}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_arrow_reader_wrap}{ArrowReaderWrap}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a9dc7b36790c4f7f9248d2913a8284639}{\_cur\_file\_reader}};}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_afc9d8ea03ca3d134fefd658642f71cae}{\_cur\_file\_eof}};\ \textcolor{comment}{//\ is\ read\ over?}}
\DoxyCodeLine{00080\ \ \ \ \ std::shared\_ptr<arrow::RecordBatch>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a0a327d10b3f940160f0652af3e9b1a41}{\_batch}};}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_addc917af910572cd885ffbf16c00aba6}{\_arrow\_batch\_cur\_idx}};}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_system_properties}{FileSystemProperties}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_aa99904d3b3a8039b8d2b688adc05af09}{\_system\_properties}};}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_file_description}{FileDescription}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a6468159baa92e4af365dcc9a2c22719e}{\_file\_description}};}
\DoxyCodeLine{00084\ \ \ \ \ std::shared\_ptr<io::FileSystem>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a8751e9ef9a871846822e0accf04f0527}{\_file\_system}};}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_aa2e282406ff9d302e2f5c19c2f933dea}{\_filtered\_row\_groups\_counter}};}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a8cb70c0534112be9cf9283d4a3f18f73}{\_filtered\_rows\_counter}};}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_aa4dca3e60da4bd6cc4317e1b4b67df7a}{\_filtered\_bytes\_counter}};}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_a9322ecf28f581b14ff43baa182c262d3}{\_total\_rows\_counter}};}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_v_arrow_scanner_aaac3f1f4466660cde0ef65a09dcc77d3}{\_total\_groups\_counter}};}
\DoxyCodeLine{00091\ \};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \}\ \textcolor{comment}{//\ namespace\ doris::vectorized}}

\end{DoxyCode}
