\hypertarget{data__dir_8h_source}{}\doxysection{data\+\_\+dir.\+h}
\label{data__dir_8h_source}\index{/Users/dabowang/doris/be/src/olap/data\_dir.h@{/Users/dabowang/doris/be/src/olap/data\_dir.h}}
\mbox{\hyperlink{data__dir_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <shared\_mutex>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/olap\_file.pb.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{file__system_8h}{io/fs/file\_system.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{fs__utils_8h}{io/fs/fs\_utils.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap_2olap__common_8h}{olap/olap\_common.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__id__generator_8h}{olap/rowset/rowset\_id\_generator.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{metrics_8h}{util/metrics.h}}"{}}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }Tablet;}
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }TabletManager;}
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }TabletMeta;}
\DoxyCodeLine{00041\ \textcolor{keyword}{class\ }TxnManager;}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{comment}{//\ A\ DataDir\ used\ to\ manage\ data\ in\ same\ path.}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ Now,\ After\ DataDir\ was\ created,\ it\ will\ never\ be\ deleted\ for\ easy\ implementation.}}
\DoxyCodeLine{00045\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}\ \{}
\DoxyCodeLine{00046\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_data_dir_ab00e03d2eef5a496bd9c62006fcaf9e1}{path}},\ int64\_t\ capacity\_bytes\ =\ -\/1,}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ TStorageMedium::type\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4d6a11ca6b41ce6ccebb2ef32e907d99}{storage\_medium}}\ =\ TStorageMedium::HDD,}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_manager}{TabletManager}}*\ tablet\_manager\ =\ \textcolor{keyword}{nullptr},\ \mbox{\hyperlink{classdoris_1_1_txn_manager}{TxnManager}}*\ txn\_manager\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_data_dir_a06099307c018d48ea4e308a64b5073d2}{\string~DataDir}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a223508714f7b7c2a338265d09a23a25f}{init}}();}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a003e84f102a5251c3d10a87b43565350}{stop\_bg\_worker}}();}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_data_dir_ab00e03d2eef5a496bd9c62006fcaf9e1}{path}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a18564f99a748f8daffbf8f5ffaa2a0cb}{\_path}};\ \}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ad9fc3e4195180791542069c283851f65}{path\_hash}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaffec85636edc7f995217a89956237d6}{\_path\_hash}};\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1io_aea8c56ba684d61150520d391a154c910}{io::FileSystemSPtr}}\&\ \mbox{\hyperlink{classdoris_1_1_data_dir_a8e4a0af1f13d44591247f28fc3804b73}{fs}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaca0cd29491e9799d9d9294c4927d715}{\_fs}};\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a209ea2ddfdfa80703799c92da8beb643}{is\_used}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac53356be9838784665e8e4d6898a1b80}{\_is\_used}};\ \}}
\DoxyCodeLine{00061\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_a532e52f34a8ba7d86701b81c0583697d}{cluster\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa5236b4a040f60a559e9f739e98538fb}{\_cluster\_id}};\ \}}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a3a5aa67b9bf52ae1ae5759fff42e1ffb}{cluster\_id\_incomplete}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a7765d4ee4861f3bdacd8bae5df06e060}{\_cluster\_id\_incomplete}};\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_dir_info}{DataDirInfo}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a5a0b0f7a50a705aaa9b318500395ac32}{get\_dir\_info}}()\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_dir_info}{DataDirInfo}}\ info;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_a4d455efceee21e97d8e21ee40e9b4a20}{path}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_a18564f99a748f8daffbf8f5ffaa2a0cb}{\_path}};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_a905fd45db68151275000dfd361b0ba84}{path\_hash}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaffec85636edc7f995217a89956237d6}{\_path\_hash}};}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_a72c8867f76c8ac5e46f188cbb21b31c6}{disk\_capacity}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa22244e651fad9b05d783ea15f6e3525}{\_disk\_capacity\_bytes}};}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_aaad66f0cc1b7dd8b16846c0d3ccf2db2}{available}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4014c626666a369d98d5f1723faca1f4}{\_available\_bytes}};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_acf2b5453263f7c71b27f5a4e3d00f079}{is\_used}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac53356be9838784665e8e4d6898a1b80}{\_is\_used}};}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ info.\mbox{\hyperlink{structdoris_1_1_data_dir_info_a56b6d4bac2317ce7db8bb1d15fb3f812}{storage\_medium}}\ =\ \mbox{\hyperlink{classdoris_1_1_data_dir_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}};}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ info;}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ save\ a\ cluster\_id\ file\ under\ data\ path\ to\ prevent}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ invalid\ be\ config\ for\ example\ two\ be\ use\ the\ same}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ data\ path}}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4b764e9b37637342e931eb7bd23f0a31}{set\_cluster\_id}}(int32\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_a532e52f34a8ba7d86701b81c0583697d}{cluster\_id}});}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a519f248d63c87fea1870dcd1367204e8}{health\_check}}();}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a3b428377fdd22d75a9871e76b4c60231}{get\_shard}}(uint64\_t*\ shard);}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_olap_meta}{OlapMeta}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a15eec5ba694873208e49feaf77524ce2}{get\_meta}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a2d33a5f00552c9def0d6d88da3db646b}{\_meta}};\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac23371ef8da65407a461f290c8f3d0d3}{is\_ssd\_disk}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}}\ ==\ TStorageMedium::SSD;\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a5abc007837f891fb78b3458985a5ffed}{is\_remote}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1io_1_1_file_path_desc_a5abc007837f891fb78b3458985a5ffed}{io::FilePathDesc::is\_remote}}(\mbox{\hyperlink{classdoris_1_1_data_dir_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}});\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ TStorageMedium::type\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4d6a11ca6b41ce6ccebb2ef32e907d99}{storage\_medium}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}};\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ad08173352729e590595e1101aac23abc}{register\_tablet}}(\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}}*\ tablet);}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a218940e1ba12b44d57d512709fefd41b}{deregister\_tablet}}(\mbox{\hyperlink{classdoris_1_1_tablet}{Tablet}}*\ tablet);}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_af722b8ecd086e1567aebaf8c19f46cec}{clear\_tablets}}(std::vector<TabletInfo>*\ tablet\_infos);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_data_dir_a8e425a678979ce4eb687b734f45fa21f}{get\_absolute\_shard\_path}}(int64\_t\ shard\_id);}
\DoxyCodeLine{00096\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_data_dir_a3e15e9766360410478b43854fb2ef3d6}{get\_absolute\_tablet\_path}}(int64\_t\ shard\_id,\ int64\_t\ tablet\_id,\ int32\_t\ schema\_hash);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_adfb8290d3d1a84a4eb1ce8e417158cfe}{find\_tablet\_in\_trash}}(int64\_t\ tablet\_id,\ std::vector<std::string>*\ paths);}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{static}\ std::string\ \mbox{\hyperlink{classdoris_1_1_data_dir_a48ab117b78400073f1c91406c361e545}{get\_root\_path\_from\_schema\_hash\_path\_in\_trash}}(}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ schema\_hash\_dir\_in\_trash);}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ load\ data\ from\ meta\ and\ data\ files}}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a44e40f382c0ee419b234d9ea89d88e21}{load}}();}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa625fef4ffac1beff3fd833123f9a44c}{add\_pending\_ids}}(\textcolor{keyword}{const}\ std::string\&\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a392e9027b3f7594398424f5bcb371e64}{remove\_pending\_ids}}(\textcolor{keyword}{const}\ std::string\&\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ this\ function\ scans\ the\ paths\ in\ data\ dir\ to\ collect\ the\ paths\ to\ check}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ this\ is\ a\ producer\ function.\ After\ scan,\ it\ will\ notify\ the\ perform\_path\_gc\ function\ to\ gc}}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a9356de82fba903f57fae6e583e5e06f5}{perform\_path\_scan}}();}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa67ac3c5a52b87053b036791ca464309}{perform\_path\_gc\_by\_rowsetid}}();}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_add2dfd5ecbffed03dd0fd1d074dc0777}{perform\_path\_gc\_by\_tablet}}();}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a2ad74dc02e9b32f15e14001e6101723b}{perform\_remote\_rowset\_gc}}();}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ab09199293a9d503ecfc49d3023830508}{perform\_remote\_tablet\_gc}}();}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ check\ if\ the\ capacity\ reach\ the\ limit\ after\ adding\ the\ incoming\ data}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ return\ true\ if\ limit\ reached,\ otherwise,\ return\ false.}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ TODO(cmy):\ for\ now\ we\ can\ not\ precisely\ calculate\ the\ capacity\ Doris\ used,}}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ so\ in\ order\ to\ avoid\ running\ out\ of\ disk\ capacity,\ we\ currently\ use\ the\ actual}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{comment}{//\ disk\ available\ capacity\ and\ total\ capacity\ to\ do\ the\ calculation.}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ So\ that\ the\ capacity\ Doris\ actually\ used\ may\ exceeds\ the\ user\ specified\ capacity.}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a801a7c8b987a7f5a8aeb1d14cb4d870a}{reach\_capacity\_limit}}(int64\_t\ incoming\_data\_size);}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ad3de8982359e752160a050c00c367bc9}{update\_capacity}}();}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aea7c056fd4fe1150d0cb508b89d044ba}{update\_local\_data\_size}}(int64\_t\ size);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac549ef29dfcfc0c5529a5fc258a38d0d}{update\_remote\_data\_size}}(int64\_t\ size);}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aef4c704458c3856fcf010012130133e9}{tablet\_size}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a652cf84638718ecd17e98386e964e1c7}{disks\_compaction\_score\_increment}}(int64\_t\ delta);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a2f35fda4eddd8396086f956d853dca6d}{disks\_compaction\_num\_increment}}(int64\_t\ delta);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Move\ tablet\ to\ trash.}}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a20b762cf97988bbae3750e0b59278105}{move\_to\_trash}}(\textcolor{keyword}{const}\ std::string\&\ tablet\_path);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a13882efadc8afca0ee018521f5e941ef}{\_init\_cluster\_id}}();}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a431d252f1a82235e716cd05e42626a29}{\_init\_capacity\_and\_create\_shards}}();}
\DoxyCodeLine{00148\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ae75b718e8d45df45897fb53348e1cf00}{\_init\_meta}}();}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ae3b1e545a3567f9f18cb457c87c8a37b}{\_check\_disk}}();}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a70dde5e9e35072ab50d6dde775aeb925}{\_read\_and\_write\_test\_file}}();}
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_adda807293bd2a3d961e3ade2a65a9878}{read\_cluster\_id}}(\textcolor{keyword}{const}\ std::string\&\ cluster\_id\_path,\ int32\_t*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a532e52f34a8ba7d86701b81c0583697d}{cluster\_id}});}
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_af7858fe9535f671f41c6ff29b5fe7874}{\_write\_cluster\_id\_to\_path}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_data_dir_ab00e03d2eef5a496bd9c62006fcaf9e1}{path}},\ int32\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_a532e52f34a8ba7d86701b81c0583697d}{cluster\_id}});}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{comment}{//\ Check\ whether\ has\ old\ format\ (hdr\_\ start)\ in\ olap.\ When\ doris\ updating\ to\ current\ version,}}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ it\ may\ lead\ to\ data\ missing.\ When\ conf::storage\_strict\_check\_incompatible\_old\_format\ is\ true,}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ process\ will\ log\ fatal.}}
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a73b51454029d42a46bbba349760e8d08}{\_check\_incompatible\_old\_format\_tablet}}();}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa703a21725505704ca374c4e1655f9eb}{\_process\_garbage\_path}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_data_dir_ab00e03d2eef5a496bd9c62006fcaf9e1}{path}});}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a221d03c52b23449663738698675da435}{\_remove\_check\_paths}}(\textcolor{keyword}{const}\ std::set<std::string>\&\ paths);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac37aeadbaeee69b6cf4291a43b2fa4de}{\_check\_pending\_ids}}(\textcolor{keyword}{const}\ std::string\&\ \textcolor{keywordtype}{id});}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00166\ \ \ \ \ std::atomic<bool>\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4347c18d16e1ec34c1eff08f44c6b4e1}{\_stop\_bg\_worker}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_data_dir_a18564f99a748f8daffbf8f5ffaa2a0cb}{\_path}};}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaffec85636edc7f995217a89956237d6}{\_path\_hash}};}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_aea8c56ba684d61150520d391a154c910}{io::FileSystemSPtr}}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaca0cd29491e9799d9d9294c4927d715}{\_fs}};}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ the\ actual\ available\ capacity\ of\ the\ disk\ of\ this\ data\ dir}}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4014c626666a369d98d5f1723faca1f4}{\_available\_bytes}};}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ the\ actual\ capacity\ of\ the\ disk\ of\ this\ data\ dir}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa22244e651fad9b05d783ea15f6e3525}{\_disk\_capacity\_bytes}};}
\DoxyCodeLine{00176\ \ \ \ \ TStorageMedium::type\ \mbox{\hyperlink{classdoris_1_1_data_dir_a63da705b369d45fa2cd9f6ece99b7c62}{\_storage\_medium}};}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_ac53356be9838784665e8e4d6898a1b80}{\_is\_used}};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_manager}{TabletManager}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a4f0c4d3c7e40e0a1321249ef7b9d9fd3}{\_tablet\_manager}};}
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_txn_manager}{TxnManager}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a6edc5e03d72c7af4c8abfd66a7b78229}{\_txn\_manager}};}
\DoxyCodeLine{00181\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa5236b4a040f60a559e9f739e98538fb}{\_cluster\_id}};}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_a7765d4ee4861f3bdacd8bae5df06e060}{\_cluster\_id\_incomplete}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ This\ flag\ will\ be\ set\ true\ if\ this\ store\ was\ not\ in\ root\ path\ when\ reloading}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa0fb5d96bb376f6ac6253470f249bd17}{\_to\_be\_deleted}};}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ used\ to\ protect\ \_current\_shard\ and\ \_tablet\_set}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keyword}{mutable}\ std::mutex\ \mbox{\hyperlink{classdoris_1_1_data_dir_a3f0b4c278cb19f9c2b2dbdb065f51e14}{\_mutex}};}
\DoxyCodeLine{00188\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_a020fadfb596e1dfcb4cfecf309b124e2}{\_current\_shard}};}
\DoxyCodeLine{00189\ \ \ \ \ std::set<TabletInfo>\ \mbox{\hyperlink{classdoris_1_1_data_dir_a028bb231d47329556e23599087b8d473}{\_tablet\_set}};}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_data_dir_a2c66694258cb661aabd137f492553d2d}{MAX\_SHARD\_NUM}}\ =\ 1024;}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_olap_meta}{OlapMeta}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a2d33a5f00552c9def0d6d88da3db646b}{\_meta}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_rowset_id_generator}{RowsetIdGenerator}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a1c25289335e25e04affff9e4a20b5b27}{\_id\_generator}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_data_dir_a83ba0fa05879b54bedfef6f8afc7aaae}{\_check\_path\_mutex}};}
\DoxyCodeLine{00197\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1_data_dir_a7efc1956fad515288ad89b3eebacb5a1}{\_check\_path\_cv}};}
\DoxyCodeLine{00198\ \ \ \ \ std::set<std::string>\ \mbox{\hyperlink{classdoris_1_1_data_dir_acbb23a948c0419f6181c6b0c59a4b2f3}{\_all\_check\_paths}};}
\DoxyCodeLine{00199\ \ \ \ \ std::set<std::string>\ \mbox{\hyperlink{classdoris_1_1_data_dir_a99cb384307ba1ce3a6278bb5ae703c47}{\_all\_tablet\_schemahash\_paths}};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keyword}{mutable}\ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_data_dir_addd9f0a8350b655338b16eb020639a58}{\_pending\_path\_mutex}};}
\DoxyCodeLine{00202\ \ \ \ \ std::set<std::string>\ \mbox{\hyperlink{classdoris_1_1_data_dir_a8041fb90cf7f1aea1bddd79f7a428697}{\_pending\_path\_ids}};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ std::shared\_ptr<MetricEntity>\ \mbox{\hyperlink{classdoris_1_1_data_dir_acc79f89ae684611c8183324d5f3321c1}{\_data\_dir\_metric\_entity}};}
\DoxyCodeLine{00205\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a58257738e3339cbff5e8a76b306adb50}{disks\_total\_capacity}};}
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_aaaa5aa1cb4193a11a14fa1952984d032}{disks\_avail\_capacity}};}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a5468725153ab7377659f18587c737505}{disks\_local\_used\_capacity}};}
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_a22b7e10d7115309ab9b4116b56a22221}{disks\_remote\_used\_capacity}};}
\DoxyCodeLine{00209\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_ae9d902f57469cf7640454865588b0460}{disks\_state}};}
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_afda65dce8c4850dd8e219ed242404261}{disks\_compaction\_score}};}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}*\ \mbox{\hyperlink{classdoris_1_1_data_dir_aa4e098dcb696d006a80b8787f8b75635}{disks\_compaction\_num}};}
\DoxyCodeLine{00212\ \};}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
