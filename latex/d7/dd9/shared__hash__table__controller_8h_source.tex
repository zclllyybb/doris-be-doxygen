\hypertarget{shared__hash__table__controller_8h_source}{}\doxysection{shared\+\_\+hash\+\_\+table\+\_\+controller.\+h}
\label{shared__hash__table__controller_8h_source}\index{/Users/dabowang/doris/be/src/vec/runtime/shared\_hash\_table\_controller.h@{/Users/dabowang/doris/be/src/vec/runtime/shared\_hash\_table\_controller.h}}
\mbox{\hyperlink{shared__hash__table__controller_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }RuntimeState;}
\DoxyCodeLine{00031\ \textcolor{keyword}{class\ }TUniqueId;}
\DoxyCodeLine{00032\ \textcolor{keyword}{class\ }MinMaxFuncBase;}
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }HybridSetBase;}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }BloomFilterFuncBase;}
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }BitmapFilterFuncBase;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }VExprContext;}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_runtime_filter_context}{SharedRuntimeFilterContext}}\ \{}
\DoxyCodeLine{00042\ \ \ \ \ std::shared\_ptr<MinMaxFuncBase>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_runtime_filter_context_aa7d5a6b333780d4cbd625d1dd238adfc}{minmax\_func}};}
\DoxyCodeLine{00043\ \ \ \ \ std::shared\_ptr<HybridSetBase>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_runtime_filter_context_ac7d4b4a951e7f4fc04336acfcd3f8a25}{hybrid\_set}};}
\DoxyCodeLine{00044\ \ \ \ \ std::shared\_ptr<BloomFilterFuncBase>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_runtime_filter_context_a53ffccd11f91132923587e02628061a0}{bloom\_filter\_func}};}
\DoxyCodeLine{00045\ \ \ \ \ std::shared\_ptr<BitmapFilterFuncBase>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_runtime_filter_context_a1857c717b2048f381e2ff5d454efa23b}{bitmap\_filter\_func}};}
\DoxyCodeLine{00046\ \};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context}{SharedHashTableContext}}\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_ab0e0ec0b86ea002697a94ced44b47d61}{SharedHashTableContext}}()}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_ad39690a1f2163999249a6d37b2de464f}{hash\_table\_variants}}(nullptr),}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_acf67c9ba2fdb81f1eca9ec152e646f8a}{signaled}}(false),}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_af2042793be5445f0062f847235f498f0}{short\_circuit\_for\_null\_in\_probe\_side}}(false)\ \{\}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_ae29aa2d4ae440022daaed1107eb306b3}{status}};}
\DoxyCodeLine{00055\ \ \ \ \ std::shared\_ptr<Arena>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_af87faf5c10d385e4c3c26b181087f9e4}{arena}};}
\DoxyCodeLine{00056\ \ \ \ \ std::shared\_ptr<void>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_ad39690a1f2163999249a6d37b2de464f}{hash\_table\_variants}};}
\DoxyCodeLine{00057\ \ \ \ \ std::shared\_ptr<std::vector<Block>>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_a03dab21dc9b1b9a5de39d358f885f3b9}{blocks}};}
\DoxyCodeLine{00058\ \ \ \ \ std::map<int,\ SharedRuntimeFilterContext>\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_a16f1ed60b683f233127cd0da312f9b87}{runtime\_filters}};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_acf67c9ba2fdb81f1eca9ec152e646f8a}{signaled}};}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1vectorized_1_1_shared_hash_table_context_af2042793be5445f0062f847235f498f0}{short\_circuit\_for\_null\_in\_probe\_side}};}
\DoxyCodeLine{00061\ \};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_1_1vectorized_abc426323f573bb7a7bfb529fdb533dca}{SharedHashTableContextPtr}}\ =\ std::shared\_ptr<SharedHashTableContext>;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller}{SharedHashTableController}}\ \{}
\DoxyCodeLine{00066\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a0744bef6d8d439b6ba000a083bc1ebe3}{set\_builder\_and\_consumers}}(TUniqueId\ builder,\ \textcolor{keyword}{const}\ std::vector<TUniqueId>\&\ consumers,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ node\_id);}
\DoxyCodeLine{00070\ \ \ \ \ TUniqueId\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_ac039f88ed6f7e8a6be00e585551e0d8f}{get\_builder\_fragment\_instance\_id}}(\textcolor{keywordtype}{int}\ my\_node\_id);}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1vectorized_abc426323f573bb7a7bfb529fdb533dca}{SharedHashTableContextPtr}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a4be2b365f82457b9cb7afd703cb50c8b}{get\_context}}(\textcolor{keywordtype}{int}\ my\_node\_id);}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_ab09ef7e987a146cac758ac976c26bb71}{signal}}(\textcolor{keywordtype}{int}\ my\_node\_id);}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordtype}{void}\ signal(\textcolor{keywordtype}{int}\ my\_node\_id,\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ status);}
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_abd0b0c2db819ebc3e09479c9a772f045}{wait\_for\_signal}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1vectorized_abc426323f573bb7a7bfb529fdb533dca}{SharedHashTableContextPtr}}\&\ context);}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a8c8152a8dfff95e858aa5fc57be554e8}{should\_build\_hash\_table}}(\textcolor{keyword}{const}\ TUniqueId\&\ fragment\_instance\_id,\ \textcolor{keywordtype}{int}\ my\_node\_id);}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_aa095d793500ded0614681c93e9a5663e}{set\_pipeline\_engine\_enabled}}(\textcolor{keywordtype}{bool}\ enabled)\ \{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_aa5556a213c4883e5dc33a37d56ac4714}{\_pipeline\_engine\_enabled}}\ =\ enabled;\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_aa5556a213c4883e5dc33a37d56ac4714}{\_pipeline\_engine\_enabled}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00080\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a3f0b4c278cb19f9c2b2dbdb065f51e14}{\_mutex}};}
\DoxyCodeLine{00081\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_af56bf411a50a75827bda31c148e9d0ee}{\_cv}};}
\DoxyCodeLine{00082\ \ \ \ \ std::map<int,\ std::vector<TUniqueId>>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a3ad5d510abd1e1460687587a9990efaa}{\_ref\_fragments}};}
\DoxyCodeLine{00083\ \ \ \ \ std::map<\textcolor{keywordtype}{int}\ \textcolor{comment}{/*node\ id*/},\ TUniqueId\ \textcolor{comment}{/*fragment\ instance\ id*/}>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_af898d13705c3f637faad5c1d44eee4a3}{\_builder\_fragment\_ids}};}
\DoxyCodeLine{00084\ \ \ \ \ std::map<\textcolor{keywordtype}{int}\ \textcolor{comment}{/*node\ id*/},\ \mbox{\hyperlink{namespacedoris_1_1vectorized_abc426323f573bb7a7bfb529fdb533dca}{SharedHashTableContextPtr}}>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_shared_hash_table_controller_a69fafc6fa481ccc0ea93b0105a8fcd27}{\_shared\_contexts}};}
\DoxyCodeLine{00085\ \};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \}\ \textcolor{comment}{//\ namespace\ vectorized}}
\DoxyCodeLine{00088\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
