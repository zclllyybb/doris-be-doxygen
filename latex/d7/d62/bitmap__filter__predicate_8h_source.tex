\hypertarget{bitmap__filter__predicate_8h_source}{}\doxysection{bitmap\+\_\+filter\+\_\+predicate.\+h}
\label{bitmap__filter__predicate_8h_source}\index{/Users/dabowang/doris/be/src/olap/bitmap\_filter\_predicate.h@{/Users/dabowang/doris/be/src/olap/bitmap\_filter\_predicate.h}}
\mbox{\hyperlink{bitmap__filter__predicate_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmapfilter__predicate_8h}{exprs/bitmapfilter\_predicate.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{runtime__filter_8h}{exprs/runtime\_filter.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__predicate_8h}{olap/column\_predicate.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wrapper__field_8h}{olap/wrapper\_field.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmap__value_8h}{util/bitmap\_value.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__dictionary_8h}{vec/columns/column\_dictionary.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__nullable_8h}{vec/columns/column\_nullable.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__vector_8h}{vec/columns/column\_vector.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{predicate__column_8h}{vec/columns/predicate\_column.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vruntimefilter__wrapper_8h}{vec/exprs/vruntimefilter\_wrapper.h}}"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{comment}{//\ only\ use\ in\ runtime\ filter\ and\ segment\ v2}}
\DoxyCodeLine{00036\ \textcolor{keyword}{template}\ <PrimitiveType\ T>}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate}{BitmapFilterColumnPredicate}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_column_predicate}{ColumnPredicate}}\ \{}
\DoxyCodeLine{00038\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab456155d0b475f7f6c6545f1186c2a8d}{CppType}}\ =\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structdoris_1_1_primitive_type_traits}{PrimitiveTypeTraits<T>::CppType}};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_bitmap_filter_func}{SpecificFilter}}\ =\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_func}{BitmapFilterFunc<T>}};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ac62a00d38166106ee1c3f85ce7ebc449}{BitmapFilterColumnPredicate}}(uint32\_t\ \mbox{\hyperlink{classdoris_1_1_column_predicate_a1dc741e0ee4ae02d671b288213c01fc3}{column\_id}},}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<BitmapFilterFuncBase>\&\ filter,\ \textcolor{keywordtype}{int})}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1_column_predicate}{ColumnPredicate}}(\mbox{\hyperlink{classdoris_1_1_column_predicate_a1dc741e0ee4ae02d671b288213c01fc3}{column\_id}}),}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a14766e40ac09f718cf7679628d675e5c}{\_filter}}(filter),}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a04560f50b224bc72384b259dd09c90a6}{\_specific\_filter}}(static\_cast<\mbox{\hyperlink{classdoris_1_1_bitmap_filter_func}{SpecificFilter}}*>(\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a14766e40ac09f718cf7679628d675e5c}{\_filter}}.get()))\ \{\}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a22d505387bee35277b2ec1c5aa9c2c99}{\string~BitmapFilterColumnPredicate}}()\ \textcolor{keyword}{override}\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a74200fe7b3fc40cf1385f05359608667}{PredicateType}}\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a352c565b57bc1155b4d9b43436dec0ca}{type}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacedoris_a74200fe7b3fc40cf1385f05359608667a32e90bb264b639296bf2d35a655501a9}{PredicateType::BITMAP\_FILTER}};\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a3aebaf0a158471c93cfdce257f1488dd}{evaluate\_and}}(\textcolor{keyword}{const}\ std::pair<WrapperField*,\ WrapperField*>\&\ statistic)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a04560f50b224bc72384b259dd09c90a6}{\_specific\_filter}}-\/>\mbox{\hyperlink{classdoris_1_1_bitmap_filter_func_base_aea9bb62f1b87993343c97adfec4cf13e}{is\_not\_in}}())\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab456155d0b475f7f6c6545f1186c2a8d}{CppType}}\ max\_value;}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (statistic.second-\/>is\_null())\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ non-\/null\ values}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ max\_value\ =\ *\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab456155d0b475f7f6c6545f1186c2a8d}{CppType}}*\textcolor{keyword}{>}(statistic.second-\/>cell\_ptr());}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab456155d0b475f7f6c6545f1186c2a8d}{CppType}}\ min\_value\ =}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ statistic.first-\/>is\_null()\ \textcolor{comment}{/*\ contains\ null\ values\ */}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ 0}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ *\textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab456155d0b475f7f6c6545f1186c2a8d}{CppType}}*\textcolor{keyword}{>}(statistic.first-\/>cell\_ptr());}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a04560f50b224bc72384b259dd09c90a6}{\_specific\_filter}}-\/>\mbox{\hyperlink{classdoris_1_1_bitmap_filter_func_aeda136089cfdbe0b3389b9fef5bae12e}{contains\_any}}(min\_value,\ max\_value);}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a41231781aac7579103941161e1418989}{evaluate}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_bitmap_index_iterator}{BitmapIndexIterator}}*,\ uint32\_t,\ roaring::Roaring*)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a41231781aac7579103941161e1418989}{evaluate}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column}{vectorized::IColumn}}\&\ column,\ uint16\_t*\ sel,}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ size)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{bool}\ is\_nullable>}
\DoxyCodeLine{00080\ \ \ \ \ uint16\_t\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_af484c97f4f78807e9bbfb814fd734a4c}{evaluate}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column}{vectorized::IColumn}}\&\ column,\ \textcolor{keyword}{const}\ uint8\_t*\ null\_map,\ uint16\_t*\ sel,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ size)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (is\_nullable)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ DCHECK(null\_map);}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ uint16\_t\ new\_size\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ new\_size\ =\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a04560f50b224bc72384b259dd09c90a6}{\_specific\_filter}}-\/>\mbox{\hyperlink{classdoris_1_1_bitmap_filter_func_ace93bcf3f5ea24c2cae415afec2fa8ba}{find\_fixed\_len\_olap\_engine}}(}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{char}*)\textcolor{keyword}{reinterpret\_cast<}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_predicate_column_type}{vectorized::PredicateColumnType<PredicateEvaluateType<T>}}\textcolor{keyword}{>}*>(\&column)}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/>\mbox{\hyperlink{uint24_8h_a2548205c24a5abb8e9a504a1f8cf5862}{get\_data}}()}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .\mbox{\hyperlink{uint24_8h_aa99be7b8b4274b2256b394ea7bf80762}{data}}(),}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ null\_map,\ sel,\ size);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_size;}
\DoxyCodeLine{00094\ \ \ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_ab675b0be49cab2cb7b4b431ec91ef000}{\_debug\_string}}()\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}BitmapFilterColumnPredicate("{}}\ +\ \mbox{\hyperlink{namespacedoris_a66421d0e4ffabe98bf2e77cdaeabdee0}{type\_to\_string}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ +\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ std::shared\_ptr<BitmapFilterFuncBase>\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a14766e40ac09f718cf7679628d675e5c}{\_filter}};}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_func}{SpecificFilter}}*\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a04560f50b224bc72384b259dd09c90a6}{\_specific\_filter}};\ \textcolor{comment}{//\ owned\ by\ \_filter}}
\DoxyCodeLine{00102\ \};}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keyword}{template}\ <PrimitiveType\ T>}
\DoxyCodeLine{00105\ uint16\_t\ \mbox{\hyperlink{classdoris_1_1_bitmap_filter_column_predicate_a41231781aac7579103941161e1418989}{BitmapFilterColumnPredicate<T>::evaluate}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column}{vectorized::IColumn}}\&\ column,\ uint16\_t*\ sel,}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ size)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00107\ \ \ \ \ uint16\_t\ new\_size\ =\ 0;}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{if}\ (column.\mbox{\hyperlink{classdoris_1_1vectorized_1_1_i_column_adf7bb7bb5661fd4437db8a5c333444b2}{is\_nullable}}())\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}*\ nullable\_col\ =\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_nullable}{vectorized::ColumnNullable}}*\textcolor{keyword}{>}(\&column);}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ null\_map\_data\ =\ nullable\_col-\/>\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_nullable_ae0e77dedb4ba70d2b17b3eecf148ffe2}{get\_null\_map\_column}}().\mbox{\hyperlink{classdoris_1_1vectorized_1_1_column_vector_a3206c08675c03058605f3a6e5a452b5c}{get\_data}}();}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ new\_size\ =}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ evaluate<true>(nullable\_col-\/>get\_nested\_column(),\ null\_map\_data.data(),\ sel,\ size);}
\DoxyCodeLine{00113\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ new\_size\ =\ evaluate<false>(column,\ \textcolor{keyword}{nullptr},\ sel,\ size);}
\DoxyCodeLine{00115\ \ \ \ \ \}}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{return}\ new\_size;}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ \}\ \textcolor{comment}{//namespace\ doris}}

\end{DoxyCode}
