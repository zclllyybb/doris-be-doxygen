\hypertarget{tablets__channel_8h_source}{}\doxysection{tablets\+\_\+channel.\+h}
\label{tablets__channel_8h_source}\index{/Users/dabowang/doris/be/src/runtime/tablets\_channel.h@{/Users/dabowang/doris/be/src/runtime/tablets\_channel.h}}
\mbox{\hyperlink{tablets__channel_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <unordered\_set>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/PaloInternalService\_types.h"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/internal\_service.pb.h"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{descriptors_8h}{runtime/descriptors.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmap_8h}{util/bitmap.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uid__util_8h}{util/uid\_util.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_tablets_channel_key}{TabletsChannelKey}}\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_a2c1804289b8301d201107fc05615ffe9}{id}};}
\DoxyCodeLine{00039\ \ \ \ \ int64\_t\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_abc49ebb68933f738f0ecd988eec1d4b2}{index\_id}};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_a9957c3ab62c5a10d2717c2d4e33289ae}{TabletsChannelKey}}(\textcolor{keyword}{const}\ PUniqueId\&\ pid,\ int64\_t\ index\_id\_)\ :\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_a2c1804289b8301d201107fc05615ffe9}{id}}(pid),\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_abc49ebb68933f738f0ecd988eec1d4b2}{index\_id}}(index\_id\_)\ \{\}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_aa0b1320c6b0339055bdb527e63fa2137}{\string~TabletsChannelKey}}()\ noexcept\ \{\}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_ae5bee77a4bcbcca24bbe06f2772f0b01}{operator==}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key}{TabletsChannelKey}}\&\ rhs)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_abc49ebb68933f738f0ecd988eec1d4b2}{index\_id}}\ ==\ rhs.index\_id\ \&\&\ \textcolor{keywordtype}{id}\ ==\ rhs.id;}
\DoxyCodeLine{00047\ \ \ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key_aac993ecccd3d88aafefb6b8e3caa1dee}{to\_string}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00050\ \};}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ std::ostream\&\ operator<<(std::ostream\&\ os,\ \textcolor{keyword}{const}\ TabletsChannelKey\&\ key);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{class\ }DeltaWriter;}
\DoxyCodeLine{00055\ \textcolor{keyword}{class\ }OlapTableSchemaParam;}
\DoxyCodeLine{00056\ \textcolor{keyword}{class\ }LoadChannel;}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{comment}{//\ Write\ channel\ for\ a\ particular\ (load,\ index).}}
\DoxyCodeLine{00059\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_tablets_channel}{TabletsChannel}}\ \{}
\DoxyCodeLine{00060\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel}{TabletsChannel}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key}{TabletsChannelKey}}\&\ key,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}\&\ load\_id,\ \textcolor{keywordtype}{bool}\ is\_high\_priority);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d70d5a649b59b76b702a592a942914f}{\string~TabletsChannel}}();}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_aeed2f12e31d76d3dc81ebfa0aca1f14d}{open}}(\textcolor{keyword}{const}\ PTabletWriterOpenRequest\&\ request);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ no-\/op\ when\ this\ channel\ has\ been\ closed\ or\ cancelled}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ TabletWriterAddRequest,\ \textcolor{keyword}{typename}\ TabletWriterAddResult>}
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a19554c706937fb249dda9a459a048093}{add\_batch}}(\textcolor{keyword}{const}\ TabletWriterAddRequest\&\ request,\ TabletWriterAddResult*\ response);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ Mark\ sender\ with\ 'sender\_id'\ as\ closed.}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ If\ all\ senders\ are\ closed,\ close\ this\ channel,\ set\ '*finished'\ to\ true,\ update\ 'tablet\_vec'}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ to\ include\ all\ tablets\ written\ in\ this\ channel.}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ no-\/op\ when\ this\ channel\ has\ been\ closed\ or\ cancelled}}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a3cbbc1ac11ff5b58de619e3d6369a7ba}{close}}(\mbox{\hyperlink{classdoris_1_1_load_channel}{LoadChannel}}*\ parent,\ \textcolor{keywordtype}{int}\ sender\_id,\ int64\_t\ backend\_id,\ \textcolor{keywordtype}{bool}*\ finished,}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ google::protobuf::RepeatedField<int64\_t>\&\ partition\_ids,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ google::protobuf::RepeatedPtrField<PTabletInfo>*\ tablet\_vec,}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ google::protobuf::RepeatedPtrField<PTabletError>*\ tablet\_error,}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ google::protobuf::Map<int64\_t,\ PSlaveTabletNodes>\&\ slave\_tablet\_nodes,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ google::protobuf::Map<int64\_t,\ PSuccessSlaveTabletNodeIds>*\ success\_slave\_tablet\_node\_ids,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ write\_single\_replica);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ no-\/op\ when\ this\ channel\ has\ been\ closed\ or\ cancelled}}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a0599fdea081424f632643cd7f48d7e93}{cancel}}();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a214c3a8d280bff93dd09bd6a930092ef}{mem\_consumption}}();}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a667953f2239b78b478ba51a3adb68837}{get\_writers\_mem\_consumption\_snapshot}}(}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ std::multimap<int64\_t,\ int64\_t,\ std::greater<int64\_t>>*\ mem\_consumptions)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ std::lock\_guard<SpinLock>\ l(\mbox{\hyperlink{classdoris_1_1_tablets_channel_ae5ff06adac9ad47689f4463b0f468115}{\_tablet\_writers\_lock}});}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ *mem\_consumptions\ =\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a68944f4adcd756816fb023970acc18f6}{\_mem\_consumptions}};}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_af4461dfaef1506eedfae9543547e9874}{flush\_memtable\_async}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a508980a8e3d38100af5e9e32848ccd16}{wait\_flush}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Request>}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a11f296c3cd4c6b30bdfe566ca95998cd}{\_get\_current\_seq}}(int64\_t\&\ cur\_seq,\ \textcolor{keyword}{const}\ Request\&\ request);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ open\ all\ writer}}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_afb48316a3107de46a1e92bca4ca14c89}{\_open\_all\_writers}}(\textcolor{keyword}{const}\ PTabletWriterOpenRequest\&\ request);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a66febccde094cb9b91766df5b9ed870f}{\_try\_to\_wait\_flushing}}();}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ deal\ with\ DeltaWriter\ close\_wait(),\ add\ tablet\ to\ list\ for\ return.}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_adbc5b6814795668cbab92813505f3276}{\_close\_wait}}(\mbox{\hyperlink{classdoris_1_1_delta_writer}{DeltaWriter}}*\ writer,}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ google::protobuf::RepeatedPtrField<PTabletInfo>*\ tablet\_vec,}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ google::protobuf::RepeatedPtrField<PTabletError>*\ tablet\_error,}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PSlaveTabletNodes\ slave\_tablet\_nodes,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ write\_single\_replica);}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a408d8e3599a81e27a7fa31864b728dea}{\_add\_broken\_tablet}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ab9ce26e04c4a304a0f777ec33225dab1}{\_is\_broken\_tablet}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{comment}{//\ id\ of\ this\ load\ channel}}
\DoxyCodeLine{00117\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_tablets_channel_key}{TabletsChannelKey}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ad802b80c3e5a43e0326b41f692272bc3}{\_key}};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ make\ execute\ sequence}}
\DoxyCodeLine{00120\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a888111eeda289ae698cf8e8b92ab9d30}{\_lock}};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_spin_lock}{SpinLock}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ae5ff06adac9ad47689f4463b0f468115}{\_tablet\_writers\_lock}};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8}{State}}\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8ae0b771369dfb01dcddb2c023a9c1f89b}{kInitialized}},}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8a4acd2908d885804f36dbf5807bd65c33}{kOpened}},}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8a4c78a2441e1bc7d8fa26249effb8343a}{kFinished}}\ \textcolor{comment}{//\ closed\ or\ cancelled}}
\DoxyCodeLine{00128\ \ \ \ \ \};}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8}{State}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a17816079e65513d7293a826311d3afdf}{\_state}};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_unique_id}{UniqueId}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a8c801b8bc475020a94d99b06b786f197}{\_load\_id}};}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ initialized\ in\ open\ function}}
\DoxyCodeLine{00134\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ad23f5158666167a1d6105073a7aa506f}{\_txn\_id}}\ =\ -\/1;}
\DoxyCodeLine{00135\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a2d83ce66781470ceb86485bf66481ad0}{\_index\_id}}\ =\ -\/1;}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_olap_table_schema_param}{OlapTableSchemaParam}}*\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ae6bbccc95b7bf60fb49fe102aadd5fcc}{\_schema}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tuple_descriptor}{TupleDescriptor}}*\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_aa8ef43af19ce6ea0931547d1876de7fa}{\_tuple\_desc}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ next\ sequence\ we\ expect}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a2a106d5e294b361f55efa84e2fa8fec3}{\_num\_remaining\_senders}}\ =\ 0;}
\DoxyCodeLine{00142\ \ \ \ \ std::vector<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_af1ffb8724aa608e0a13afecf5ce6c626}{\_next\_seqs}};}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_bitmap}{Bitmap}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_aa6ac0b478730863f43c1b42965c3df96}{\_closed\_senders}};}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ status\ to\ return\ when\ operate\ on\ an\ already\ closed/cancelled\ channel}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ currently\ it's\ OK.}}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_abecb271a0072fa6c388cea6461a3560e}{\_close\_status}};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ tablet\_id\ -\/>\ TabletChannel}}
\DoxyCodeLine{00149\ \ \ \ \ std::unordered\_map<int64\_t,\ DeltaWriter*>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5e34bef093b50e655087aca6adede881}{\_tablet\_writers}};}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ broken\ tablet\ ids.}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ If\ a\ tablet\ write\ fails,\ it's\ id\ will\ be\ added\ to\ this\ set.}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ So\ that\ following\ batch\ will\ not\ handle\ this\ tablet\ anymore.}}
\DoxyCodeLine{00153\ \ \ \ \ std::unordered\_set<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a55f1913f84109e2786316a895760933e}{\_broken\_tablets}};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_acb96a5334e62d57375abe8144329adc7}{\_broken\_tablets\_lock}};}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ std::unordered\_set<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ad803a67d950384ceccaf3b71e23f7b16}{\_reducing\_tablets}};}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ std::unordered\_set<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_abc9a485202d31b3a16c354a4315355e8}{\_partition\_ids}};}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keyword}{static}\ std::atomic<uint64\_t>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a01de2f78bc90a782e6efa67fd3ec25e6}{\_s\_tablet\_writer\_count}};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a1a8e8606755ffcf0b420844bc81259b7}{\_is\_high\_priority}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_aeab71f77a4b6828c30d5a09dedfc3f31}{\_write\_single\_replica}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ mem\ -\/>\ tablet\_id}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ sort\ by\ memory\ size}}
\DoxyCodeLine{00169\ \ \ \ \ std::multimap<int64\_t,\ int64\_t,\ std::greater<int64\_t>>\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a68944f4adcd756816fb023970acc18f6}{\_mem\_consumptions}};}
\DoxyCodeLine{00170\ \};}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Request>}
\DoxyCodeLine{00173\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a11f296c3cd4c6b30bdfe566ca95998cd}{TabletsChannel::\_get\_current\_seq}}(int64\_t\&\ cur\_seq,\ \textcolor{keyword}{const}\ Request\&\ request)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ std::lock\_guard<std::mutex>\ l(\mbox{\hyperlink{classdoris_1_1_tablets_channel_a888111eeda289ae698cf8e8b92ab9d30}{\_lock}});}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_tablets_channel_a17816079e65513d7293a826311d3afdf}{\_state}}\ !=\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8a4acd2908d885804f36dbf5807bd65c33}{kOpened}})\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a17816079e65513d7293a826311d3afdf}{\_state}}\ ==\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a5d74787dedbc4e11c1ab15bf487e61f8a4c78a2441e1bc7d8fa26249effb8343a}{kFinished}}\ ?\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_abecb271a0072fa6c388cea6461a3560e}{\_close\_status}}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ Status::InternalError(\textcolor{stringliteral}{"{}TabletsChannel\ \{\}\ state:\ \{\}"{}},}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablets_channel_ad802b80c3e5a43e0326b41f692272bc3}{\_key}}.\mbox{\hyperlink{structdoris_1_1_tablets_channel_key_aac993ecccd3d88aafefb6b8e3caa1dee}{to\_string}}(),\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_a17816079e65513d7293a826311d3afdf}{\_state}});}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \ \ cur\_seq\ =\ \mbox{\hyperlink{classdoris_1_1_tablets_channel_af1ffb8724aa608e0a13afecf5ce6c626}{\_next\_seqs}}[request.sender\_id()];}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ check\ packet}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{if}\ (request.packet\_seq()\ >\ cur\_seq)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ LOG(WARNING)\ <<\ \textcolor{stringliteral}{"{}lost\ data\ packet,\ expect\_seq="{}}\ <<\ cur\_seq}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ recept\_seq="{}}\ <<\ request.packet\_seq();}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::InternalError(\textcolor{stringliteral}{"{}lost\ data\ packet"{}});}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00188\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
