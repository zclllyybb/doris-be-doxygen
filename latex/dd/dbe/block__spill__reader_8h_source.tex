\hypertarget{block__spill__reader_8h_source}{}\doxysection{block\+\_\+spill\+\_\+reader.\+h}
\label{block__spill__reader_8h_source}\index{/Users/dabowang/doris/be/src/vec/core/block\_spill\_reader.h@{/Users/dabowang/doris/be/src/vec/core/block\_spill\_reader.h}}
\mbox{\hyperlink{block__spill__reader_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{file__reader_8h}{io/fs/file\_reader.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ Read\ data\ spilled\ to\ local\ file.}}
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader}{BlockSpillReader}}\ \{}
\DoxyCodeLine{00027\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00028\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_ae343affeb108c668f0d944a82cb2cfdd}{BlockSpillReader}}(int64\_t\ stream\_id,\ \textcolor{keyword}{const}\ std::string\&\ file\_path,\ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile,}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ delete\_after\_read\ =\ \textcolor{keyword}{true})}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aeaaf268d2f3fb77ec5fd46eebb937f44}{stream\_id\_}}(stream\_id),}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a02e2ecb860d1adca1967869a75d7208e}{file\_path\_}}(file\_path),}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a79b478162f16e40589b4edcb77cf2a8a}{delete\_after\_read\_}}(delete\_after\_read),}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a20ee14efca6695cccc9e8f2dab52d8b2}{profile\_}}(profile)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a56cda409a338385130d676429fbdd899}{\_init\_profile}}();}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a0fadf9aaa5cc0a9318222f6654b673e6}{\string~BlockSpillReader}}()\ \{\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aee1c6f7d85af14d039dec07dc31ae862}{close}}();\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_afbfe7ce3274db0eff63382a83d559439}{open}}();}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aee1c6f7d85af14d039dec07dc31ae862}{close}}();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aaf72b8601c714b62cd935adca0a375ee}{read}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{Block}}*\ block,\ \textcolor{keywordtype}{bool}*\ eos);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a9693d17e17e20c78982d2345345e0a9a}{get\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aeaaf268d2f3fb77ec5fd46eebb937f44}{stream\_id\_}};\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_ae6189ea52f5cfd26ea3bbc9a1f1adfa7}{get\_path}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a02e2ecb860d1adca1967869a75d7208e}{file\_path\_}};\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a56cda409a338385130d676429fbdd899}{\_init\_profile}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_aeaaf268d2f3fb77ec5fd46eebb937f44}{stream\_id\_}};}
\DoxyCodeLine{00053\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a02e2ecb860d1adca1967869a75d7208e}{file\_path\_}};}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a79b478162f16e40589b4edcb77cf2a8a}{delete\_after\_read\_}};}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1io_a4fab59e5f39ac7c318b993fa0c5265ee}{io::FileReaderSPtr}}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a4b89e69aea15e49f80559d60e47128b6}{file\_reader\_}};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_af5f39b92e9e70727bf92bc64eb9ed7c9}{block\_count\_}}\ =\ 0;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_acb4632fad77db107f94bb5400b3a9845}{read\_block\_index\_}}\ =\ 0;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a2026c88f362d9c209ef6d898123ad558}{max\_sub\_block\_size\_}}\ =\ 0;}
\DoxyCodeLine{00060\ \ \ \ \ std::unique\_ptr<char[]>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a981d7c4be11bc2db101e7dd05778d580}{read\_buff\_}};}
\DoxyCodeLine{00061\ \ \ \ \ std::vector<size\_t>\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_af2e4c741a68b06f5325c239d278e22bd}{block\_start\_offsets\_}};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a20ee14efca6695cccc9e8f2dab52d8b2}{profile\_}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a3a13f60f5da6d94fd6b36cf63d65dc9d}{read\_time\_}};}
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block_spill_reader_a252f17fc8a903ad1d9b7ba811e3cb36a}{deserialize\_time\_}};}
\DoxyCodeLine{00066\ \};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_1_1vectorized_a6bda6783237dd31e37b1eb7162bb682b}{BlockSpillReaderUPtr}}\ =\ std::unique\_ptr<BlockSpillReader>;}
\DoxyCodeLine{00069\ \}\ \textcolor{comment}{//\ namespace\ vectorized}}
\DoxyCodeLine{00070\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
