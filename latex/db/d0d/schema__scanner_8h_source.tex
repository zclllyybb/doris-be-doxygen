\hypertarget{schema__scanner_8h_source}{}\doxysection{schema\+\_\+scanner.\+h}
\label{schema__scanner_8h_source}\index{/Users/dabowang/doris/be/src/exec/schema\_scanner.h@{/Users/dabowang/doris/be/src/exec/schema\_scanner.h}}
\mbox{\hyperlink{schema__scanner_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{object__pool_8h}{common/object\_pool.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Descriptors\_types.h"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{runtime__profile_8h}{util/runtime\_profile.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{comment}{//\ forehead\ declare\ class,\ because\ jni\ function\ init\ in\ DorisServer.}}
\DoxyCodeLine{00032\ \textcolor{keyword}{class\ }DorisServer;}
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }RuntimeState;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{namespace\ }vectorized\ \{}
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }Block;}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{comment}{//\ scanner\ parameter\ from\ frontend}}
\DoxyCodeLine{00040\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_schema_scanner_param}{SchemaScannerParam}}\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a9ed5a01e3790dfeec47d2150a54e4bf0}{db}};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a351cef3a1e1631a50797f2ca1a69fe9b}{table}};}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a3b4abc7680edebf2107c0e548321e2be}{wild}};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_aea725cc600255f1d807db7f37b6e4d76}{user}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ deprecated}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a4185a4594ebcf688aedbee457cd1b8e7}{user\_ip}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ deprecated}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{const}\ TUserIdentity*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a885ccb0668d429285cc378470af6345b}{current\_user\_ident}};\ \textcolor{comment}{//\ to\ replace\ the\ user\ and\ user\ ip}}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_ab52417812aa992c80d9822ed797c281d}{ip}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ frontend\ ip}}
\DoxyCodeLine{00048\ \ \ \ \ int32\_t\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_aeaa4dbe9073b8ac679dbacd7459f6f72}{port}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ frontend\ thrift\ port}}
\DoxyCodeLine{00049\ \ \ \ \ int64\_t\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_ac542bb67b736e2cc373b4f15ee4dfc1b}{thread\_id}};}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{const}\ std::string*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a8402498278d6d11357a82dd2d56be710}{catalog}};}
\DoxyCodeLine{00051\ \ \ \ \ std::unique\_ptr<RuntimeProfile>\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a3513cb405d9e37a74c73700b03b9dee6}{profile}};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a4d79bf50e8dd4ae87ff265d0daf5256e}{SchemaScannerParam}}()}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a9ed5a01e3790dfeec47d2150a54e4bf0}{db}}(nullptr),}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a351cef3a1e1631a50797f2ca1a69fe9b}{table}}(nullptr),}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a3b4abc7680edebf2107c0e548321e2be}{wild}}(nullptr),}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_aea725cc600255f1d807db7f37b6e4d76}{user}}(nullptr),}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a4185a4594ebcf688aedbee457cd1b8e7}{user\_ip}}(nullptr),}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a885ccb0668d429285cc378470af6345b}{current\_user\_ident}}(nullptr),}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_ab52417812aa992c80d9822ed797c281d}{ip}}(nullptr),}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_aeaa4dbe9073b8ac679dbacd7459f6f72}{port}}(0),}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param_a8402498278d6d11357a82dd2d56be710}{catalog}}(nullptr)\ \{\}}
\DoxyCodeLine{00063\ \};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{comment}{//\ virtual\ scanner\ for\ all\ schema\ table}}
\DoxyCodeLine{00066\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_schema_scanner}{SchemaScanner}}\ \{}
\DoxyCodeLine{00067\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc}{ColumnDesc}}\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_a8f8f80d37794cde9472343e4487ba3eb}{name}};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a240c1924416689e5700ff0d9f30539d9}{PrimitiveType}}\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_af489c7be15df91529c6ce9709c87cc44}{type}};}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_a439227feff9d7f55384e8780cfc2eb82}{size}};}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_acf9d169b4bd3c066e3696495e7b2f874}{is\_null}};}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_aa95455ed52a8459fad69509a4a0411b5}{precision}}\ =\ -\/1;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structdoris_1_1_schema_scanner_1_1_column_desc_a418e7934b5363ecde8269070181b3cef}{scale}}\ =\ -\/1;}
\DoxyCodeLine{00076\ \ \ \ \ \};}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_scanner}{SchemaScanner}}(\textcolor{keyword}{const}\ std::vector<ColumnDesc>\&\ columns);}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_scanner}{SchemaScanner}}(\textcolor{keyword}{const}\ std::vector<ColumnDesc>\&\ columns,\ TSchemaTableType::type\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_adbfbed670161297b7269a5e3a7e6c00b}{type}});}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a94c40cf702321641cebbc26e3e1cbad2}{\string~SchemaScanner}}();}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ init\ object\ need\ information,\ schema\ etc.}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a9fdb5dd9174940da2fe34a981a2b8384}{init}}(\mbox{\hyperlink{structdoris_1_1_schema_scanner_param}{SchemaScannerParam}}*\ param,\ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}*\ pool);}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ Start\ to\ work}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a5dac85ca24d96ca4fb4bf7926b0638e6}{start}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state);}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a4ffc255813e1017cec477a9c314381b9}{get\_next\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block,\ \textcolor{keywordtype}{bool}*\ eos);}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{const}\ std::vector<ColumnDesc>\&\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a870e05ebb0079b55706680a0560ecc46}{get\_column\_desc}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a8182d2e04cee66e838a69bf47fdbfdb3}{\_columns}};\ \}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ factory\ function}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner}{SchemaScanner}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a7dbcac85e3da84505cd0741c64110b7d}{create}}(TSchemaTableType::type\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_adbfbed670161297b7269a5e3a7e6c00b}{type}});}
\DoxyCodeLine{00089\ \ \ \ \ TSchemaTableType::type\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_adbfbed670161297b7269a5e3a7e6c00b}{type}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a76b94214ec85980354eabd4edc5505ee}{\_schema\_table\_type}};\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a72e9fb96d609e9b8db114a68c7b126a7}{set\_doris\_server}}(DorisServer*\ doris\_server)\ \{\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a6a06293f6dc781e8bdbb186840df3eb8}{\_s\_doris\_server}}\ =\ doris\_server;\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a4ccfffc3258702c7a32ff559bc0e6fe7}{fill\_dest\_column\_for\_range}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block,\ \textcolor{keywordtype}{size\_t}\ pos,}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<void*>\&\ datas);}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a9542b3368055eb7fb0bf36fc2deea1f3}{\_is\_init}};}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ this\ is\ used\ for\ sub\ class}}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_schema_scanner_param}{SchemaScannerParam}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a43c089605a649b8bf70f8a7fcb6022e2}{\_param}};}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ schema\ table's\ column\ desc}}
\DoxyCodeLine{00101\ \ \ \ \ std::vector<ColumnDesc>\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a8182d2e04cee66e838a69bf47fdbfdb3}{\_columns}};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{static}\ DorisServer*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a6a06293f6dc781e8bdbb186840df3eb8}{\_s\_doris\_server}};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ TSchemaTableType::type\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a76b94214ec85980354eabd4edc5505ee}{\_schema\_table\_type}};}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a7c9588e813adf931c3354b91c6e1a0bc}{\_get\_db\_timer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_af77fe501f2112e4a2d1907b7c6facb58}{\_get\_table\_timer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a915a50f105401fba0f111c2743469778}{\_get\_describe\_timer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_runtime_profile_1_1_counter}{RuntimeProfile::Counter}}*\ \mbox{\hyperlink{classdoris_1_1_schema_scanner_a76457bfd8465a284acb35884b6291964}{\_fill\_block\_timer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00111\ \};}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
