\hypertarget{ref__counted_8h_source}{}\doxysection{ref\+\_\+counted.\+h}
\label{ref__counted_8h_source}\index{/Users/dabowang/be\_all/gutil/ref\_counted.h@{/Users/dabowang/be\_all/gutil/ref\_counted.h}}
\mbox{\hyperlink{ref__counted_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2012\ The\ Chromium\ Authors.\ All\ rights\ reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Use\ of\ this\ source\ code\ is\ governed\ by\ a\ BSD-\/style\ license\ that\ can\ be}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ found\ in\ the\ LICENSE\ file.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <cassert>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <utility>}\ \textcolor{comment}{//\ IWYU\ pragma:\ keep}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{atomicops_8h}{gutil/atomicops.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macros_8h}{gutil/macros.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread__collision__warner_8h}{gutil/threading/thread\_collision\_warner.h}}"{}}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }subtle\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{atomicops-internals-gcc_8h_a2ed7901bceb772acd55d33551f752dab}{Atomic32}}\ \mbox{\hyperlink{namespacedoris_1_1subtle_a3f7101c5b0b4ef2392b27137835a0d8a}{AtomicRefCount}};}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base}{RefCountedBase}}\ \{}
\DoxyCodeLine{00021\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a21d5344cad3e7341672d12a5a4b9ad2a}{HasOneRef}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a9930d9540f5668aaf97377f35f1ceae4}{ref\_count\_}}\ ==\ 1;\ \}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00025\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a38bf7784101056e8bf21c038699cc4c5}{RefCountedBase}}();}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a8188a5015124bfa34a147b2f896e8046}{\string~RefCountedBase}}();}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a78b49a9825a2260a867951b75bb93d52}{AddRef}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{comment}{//\ Returns\ true\ if\ the\ object\ should\ self-\/delete.}}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_ac5abd56adb86fcbb02e6424371d5fa0a}{Release}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a9930d9540f5668aaf97377f35f1ceae4}{ref\_count\_}};}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a48e53ca9f4299a484096a7a3105eb92d}{in\_dtor\_}};}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_aac096c22160395ef4aff8ae556b6b05d}{DFAKE\_MUTEX}}(add\_release\_);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a6e84d24377acd882b65f9b741824558d}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base}{RefCountedBase}});}
\DoxyCodeLine{00042\ \};}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base}{RefCountedThreadSafeBase}}\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a21d5344cad3e7341672d12a5a4b9ad2a}{HasOneRef}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_accf5e0271060c16a7747e1c50a8195da}{RefCountedThreadSafeBase}}();}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a9b86491e24f60fd770472b8ec9ebe87d}{\string~RefCountedThreadSafeBase}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a78b49a9825a2260a867951b75bb93d52}{AddRef}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ Returns\ true\ if\ the\ object\ should\ self-\/delete.}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_ac5abd56adb86fcbb02e6424371d5fa0a}{Release}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{namespacedoris_1_1subtle_a3f7101c5b0b4ef2392b27137835a0d8a}{AtomicRefCount}}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a5e3b946508110378e57634b82c0b1980}{ref\_count\_}};}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{mutable}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a48e53ca9f4299a484096a7a3105eb92d}{in\_dtor\_}};}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a0d95a9908c4fd7bca409a8ff0a005d24}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base}{RefCountedThreadSafeBase}});}
\DoxyCodeLine{00064\ \};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \}\ \textcolor{comment}{//\ namespace\ subtle}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{//}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ A\ base\ class\ for\ reference\ counted\ classes.\ \ Otherwise,\ known\ as\ a\ cheap}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ knock-\/off\ of\ WebKit's\ RefCounted<T>\ class.\ \ To\ use\ this\ guy\ just\ extend\ your}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ class\ from\ it\ like\ so:}}
\DoxyCodeLine{00072\ \textcolor{comment}{//}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ \ \ class\ MyFoo\ :\ public\ RefCounted<MyFoo>\ \{}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ \ \ \ ...}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ \ \ \ private:}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ \ \ \ \ friend\ class\ RefCounted<MyFoo>;}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ \ \ \ \ \string~MyFoo();}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ \ \ \};}}
\DoxyCodeLine{00079\ \textcolor{comment}{//}}
\DoxyCodeLine{00080\ \textcolor{comment}{//\ You\ should\ always\ make\ your\ destructor\ private,\ to\ avoid\ any\ code\ deleting}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ the\ object\ accidentally\ while\ there\ are\ references\ to\ it.}}
\DoxyCodeLine{00082\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00083\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_ref_counted}{RefCounted}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base}{subtle::RefCountedBase}}\ \{}
\DoxyCodeLine{00084\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_aebb1990f519367c00c1861b5b3b3e0a5}{RefCounted}}()\ \{\}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_a78b49a9825a2260a867951b75bb93d52}{AddRef}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_a78b49a9825a2260a867951b75bb93d52}{subtle::RefCountedBase::AddRef}}();\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_a9894d8f46d56be577fbf72635d6904f7}{Release}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_base_ac5abd56adb86fcbb02e6424371d5fa0a}{subtle::RefCountedBase::Release}}())\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\textcolor{keyword}{>}(\textcolor{keyword}{this});}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_ae725be496ffd7a9d4bc812d5bb26d58f}{\string~RefCounted}}()\ \{\}}
\DoxyCodeLine{00097\ \};}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{comment}{//\ Forward\ declaration.}}
\DoxyCodeLine{00100\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keyword}{typename}\ Traits>}
\DoxyCodeLine{00101\ \textcolor{keyword}{class\ }RefCountedThreadSafe;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{comment}{//\ Default\ traits\ for\ RefCountedThreadSafe<T>.\ \ Deletes\ the\ object\ when\ its\ ref}}
\DoxyCodeLine{00104\ \textcolor{comment}{//\ count\ reaches\ 0.\ \ Overload\ to\ delete\ it\ on\ a\ different\ thread\ etc.}}
\DoxyCodeLine{00105\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00106\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_default_ref_counted_thread_safe_traits}{DefaultRefCountedThreadSafeTraits}}\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structdoris_1_1_default_ref_counted_thread_safe_traits_ada0f3876e884ac1c1adbc89c453996e3}{Destruct}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ x)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Delete\ through\ RefCountedThreadSafe\ to\ make\ child\ classes\ only\ need\ to\ be}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ friend\ with\ RefCountedThreadSafe\ instead\ of\ this\ struct,\ which\ is\ an}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ implementation\ detail.}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_aecd1415051b1f08bb96b698445ad01ac}{RefCountedThreadSafe<T,\ DefaultRefCountedThreadSafeTraits>::DeleteInternal}}(x);}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ \};}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{comment}{//}}
\DoxyCodeLine{00116\ \textcolor{comment}{//\ A\ thread-\/safe\ variant\ of\ RefCounted<T>}}
\DoxyCodeLine{00117\ \textcolor{comment}{//}}
\DoxyCodeLine{00118\ \textcolor{comment}{//\ \ \ class\ MyFoo\ :\ public\ RefCountedThreadSafe<MyFoo>\ \{}}
\DoxyCodeLine{00119\ \textcolor{comment}{//\ \ \ \ ...}}
\DoxyCodeLine{00120\ \textcolor{comment}{//\ \ \ \};}}
\DoxyCodeLine{00121\ \textcolor{comment}{//}}
\DoxyCodeLine{00122\ \textcolor{comment}{//\ If\ you're\ using\ the\ default\ trait,\ then\ you\ should\ add\ compile\ time}}
\DoxyCodeLine{00123\ \textcolor{comment}{//\ asserts\ that\ no\ one\ else\ is\ deleting\ your\ object.\ \ i.e.}}
\DoxyCodeLine{00124\ \textcolor{comment}{//\ \ \ \ private:}}
\DoxyCodeLine{00125\ \textcolor{comment}{//\ \ \ \ \ friend\ class\ RefCountedThreadSafe<MyFoo>;}}
\DoxyCodeLine{00126\ \textcolor{comment}{//\ \ \ \ \ \string~MyFoo();}}
\DoxyCodeLine{00127\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T,\ \textcolor{keyword}{typename}\ Traits\ =\ DefaultRefCountedThreadSafeTraits<T>>}
\DoxyCodeLine{00128\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe}{RefCountedThreadSafe}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base}{subtle::RefCountedThreadSafeBase}}\ \{}
\DoxyCodeLine{00129\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_a73367ea99be523126ab68bd8d4cdeefc}{RefCountedThreadSafe}}()\ \{\}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_a78b49a9825a2260a867951b75bb93d52}{AddRef}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_a78b49a9825a2260a867951b75bb93d52}{subtle::RefCountedThreadSafeBase::AddRef}}();\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_a9894d8f46d56be577fbf72635d6904f7}{Release}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1subtle_1_1_ref_counted_thread_safe_base_ac5abd56adb86fcbb02e6424371d5fa0a}{subtle::RefCountedThreadSafeBase::Release}}())\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ Traits::Destruct(\textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\textcolor{keyword}{>}(\textcolor{keyword}{this}));}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_a320e2afd15026d0a36eaa030117d78a6}{\string~RefCountedThreadSafe}}()\ \{\}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_default_ref_counted_thread_safe_traits}{DefaultRefCountedThreadSafeTraits}}<\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>;}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_aecd1415051b1f08bb96b698445ad01ac}{DeleteInternal}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ x)\ \{\ \textcolor{keyword}{delete}\ x;\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe_a93f1917265341c348e93e69f1d3e676e}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe}{RefCountedThreadSafe}});}
\DoxyCodeLine{00148\ \};}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \textcolor{comment}{//}}
\DoxyCodeLine{00151\ \textcolor{comment}{//\ A\ thread-\/safe\ wrapper\ for\ some\ piece\ of\ data\ so\ we\ can\ place\ other}}
\DoxyCodeLine{00152\ \textcolor{comment}{//\ things\ in\ scoped\_refptrs<>.}}
\DoxyCodeLine{00153\ \textcolor{comment}{//}}
\DoxyCodeLine{00154\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00155\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_ref_counted_data}{RefCountedData}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe}{doris::RefCountedThreadSafe}}<doris::RefCountedData<T>>\ \{}
\DoxyCodeLine{00156\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_data_a750d5ad6af4c62ed5516791c97707a69}{RefCountedData}}()\ :\ \mbox{\hyperlink{classdoris_1_1_ref_counted_data_aa3ff051a47d9e18487e7b819852521c5}{data}}()\ \{\}}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_ref_counted_data_a61a16e0f46d938d3677c075c6e91e1e4}{RefCountedData}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ in\_value)\ :\ \mbox{\hyperlink{classdoris_1_1_ref_counted_data_aa3ff051a47d9e18487e7b819852521c5}{data}}(in\_value)\ \{\}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_ref_counted_data_aa3ff051a47d9e18487e7b819852521c5}{data}};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_ref_counted_thread_safe}{doris::RefCountedThreadSafe}}<\mbox{\hyperlink{namespacedoris}{doris}}::\mbox{\hyperlink{classdoris_1_1_ref_counted_data}{RefCountedData}}<T>>;}
\DoxyCodeLine{00164\ \ \ \ \ \string~\mbox{\hyperlink{classdoris_1_1_ref_counted_data}{RefCountedData}}()\ \{\}}
\DoxyCodeLine{00165\ \};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \}\ \textcolor{comment}{//\ namespace\ doris}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \textcolor{comment}{//}}
\DoxyCodeLine{00170\ \textcolor{comment}{//\ A\ smart\ pointer\ class\ for\ reference\ counted\ objects.\ \ Use\ this\ class\ instead}}
\DoxyCodeLine{00171\ \textcolor{comment}{//\ of\ calling\ AddRef\ and\ Release\ manually\ on\ a\ reference\ counted\ object\ to}}
\DoxyCodeLine{00172\ \textcolor{comment}{//\ avoid\ common\ memory\ leaks\ caused\ by\ forgetting\ to\ Release\ an\ object}}
\DoxyCodeLine{00173\ \textcolor{comment}{//\ reference.\ \ Sample\ usage:}}
\DoxyCodeLine{00174\ \textcolor{comment}{//}}
\DoxyCodeLine{00175\ \textcolor{comment}{//\ \ \ class\ MyFoo\ :\ public\ RefCounted<MyFoo>\ \{}}
\DoxyCodeLine{00176\ \textcolor{comment}{//\ \ \ \ ...}}
\DoxyCodeLine{00177\ \textcolor{comment}{//\ \ \ \};}}
\DoxyCodeLine{00178\ \textcolor{comment}{//}}
\DoxyCodeLine{00179\ \textcolor{comment}{//\ \ \ void\ some\_function()\ \{}}
\DoxyCodeLine{00180\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ foo\ =\ new\ MyFoo();}}
\DoxyCodeLine{00181\ \textcolor{comment}{//\ \ \ \ \ foo-\/>Method(param);}}
\DoxyCodeLine{00182\ \textcolor{comment}{//\ \ \ \ \ //\ |foo|\ is\ released\ when\ this\ function\ returns}}
\DoxyCodeLine{00183\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00184\ \textcolor{comment}{//}}
\DoxyCodeLine{00185\ \textcolor{comment}{//\ \ \ void\ some\_other\_function()\ \{}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ foo\ =\ new\ MyFoo();}}
\DoxyCodeLine{00187\ \textcolor{comment}{//\ \ \ \ \ ...}}
\DoxyCodeLine{00188\ \textcolor{comment}{//\ \ \ \ \ foo\ =\ NULL;\ \ //\ explicitly\ releases\ |foo|}}
\DoxyCodeLine{00189\ \textcolor{comment}{//\ \ \ \ \ ...}}
\DoxyCodeLine{00190\ \textcolor{comment}{//\ \ \ \ \ if\ (foo)}}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ \ \ \ \ \ \ foo-\/>Method(param);}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00193\ \textcolor{comment}{//}}
\DoxyCodeLine{00194\ \textcolor{comment}{//\ The\ above\ examples\ show\ how\ scoped\_refptr<T>\ acts\ like\ a\ pointer\ to\ T.}}
\DoxyCodeLine{00195\ \textcolor{comment}{//\ Given\ two\ scoped\_refptr<T>\ classes,\ it\ is\ also\ possible\ to\ exchange}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ references\ between\ the\ two\ objects,\ like\ so:}}
\DoxyCodeLine{00197\ \textcolor{comment}{//}}
\DoxyCodeLine{00198\ \textcolor{comment}{//\ \ \ \{}}
\DoxyCodeLine{00199\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ a\ =\ new\ MyFoo();}}
\DoxyCodeLine{00200\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ b;}}
\DoxyCodeLine{00201\ \textcolor{comment}{//}}
\DoxyCodeLine{00202\ \textcolor{comment}{//\ \ \ \ \ b.swap(a);}}
\DoxyCodeLine{00203\ \textcolor{comment}{//\ \ \ \ \ //\ now,\ |b|\ references\ the\ MyFoo\ object,\ and\ |a|\ references\ NULL.}}
\DoxyCodeLine{00204\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00205\ \textcolor{comment}{//}}
\DoxyCodeLine{00206\ \textcolor{comment}{//\ To\ make\ both\ |a|\ and\ |b|\ in\ the\ above\ example\ reference\ the\ same\ MyFoo}}
\DoxyCodeLine{00207\ \textcolor{comment}{//\ object,\ simply\ use\ the\ assignment\ operator:}}
\DoxyCodeLine{00208\ \textcolor{comment}{//}}
\DoxyCodeLine{00209\ \textcolor{comment}{//\ \ \ \{}}
\DoxyCodeLine{00210\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ a\ =\ new\ MyFoo();}}
\DoxyCodeLine{00211\ \textcolor{comment}{//\ \ \ \ \ scoped\_refptr<MyFoo>\ b;}}
\DoxyCodeLine{00212\ \textcolor{comment}{//}}
\DoxyCodeLine{00213\ \textcolor{comment}{//\ \ \ \ \ b\ =\ a;}}
\DoxyCodeLine{00214\ \textcolor{comment}{//\ \ \ \ \ //\ now,\ |a|\ and\ |b|\ each\ own\ a\ reference\ to\ the\ same\ MyFoo\ object.}}
\DoxyCodeLine{00215\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00216\ \textcolor{comment}{//}}
\DoxyCodeLine{00217\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00218\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr}}\ \{}
\DoxyCodeLine{00219\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classscoped__refptr_ae37fb942067e67c711beb897e7b7b5de}{element\_type}};}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_aa1713bb648e486fab60a8aee160869b7}{scoped\_refptr}}()\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(NULL)\ \{\}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_a5a20b74b5da272f8b1c952b014d2e7c7}{scoped\_refptr}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ p)\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(p)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}})\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}-\/>AddRef();}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ Copy\ constructor.}}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_aa0e87c65020ecbe6d636ee35a3967e36}{scoped\_refptr}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ r)\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(r.\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}})\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}})\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}-\/>AddRef();}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ Copy\ conversion\ constructor.}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_ac8d751051e422fcb659228cdd1c2b6c6}{scoped\_refptr}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<U>}}\&\ r)\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(r.\mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}())\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}})\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}-\/>AddRef();}
\DoxyCodeLine{00237\ \ \ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{//\ Move\ constructor.\ This\ is\ required\ in\ addition\ to\ the\ conversion}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{comment}{//\ constructor\ below\ in\ order\ for\ clang\ to\ warn\ about\ pessimizing\ moves.}}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_acf1e2b71b455bac6c15668bcba1e7d8e}{scoped\_refptr}}(\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr}}\&\&\ r)\ noexcept\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(r.get())\ \{\ \textcolor{comment}{//\ NOLINT}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ r.ptr\_\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00243\ \ \ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ Move\ conversion\ constructor.}}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00247\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_ae101f97e29766d53345a7f704eed46b7}{scoped\_refptr}}(\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<U>}}\&\&\ r)\ noexcept\ :\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}(r.get())\ \{\ \textcolor{comment}{//\ NOLINT}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ r.ptr\_\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_a6c87b6be6c0b37dedb6904b8b498c297}{\string~scoped\_refptr}}()\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}})\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}-\/>Release();}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};\ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \textcolor{comment}{//\ The\ following\ is\ disabled\ in\ Kudu's\ version\ of\ this\ file\ since\ it's}}
\DoxyCodeLine{00258\ \textcolor{comment}{//\ relatively\ dangerous.\ Chromium\ is\ planning\ on\ doing\ the\ same\ in\ their}}
\DoxyCodeLine{00259\ \textcolor{comment}{//\ tree,\ but\ hasn't\ done\ so\ yet.\ See\ http://code.google.com/p/chromium/issues/detail?id=110610}}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#if\ SCOPED\_REFPTR\_ALLOW\_IMPLICIT\_CONVERSION\_TO\_PTR}}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ Allow\ scoped\_refptr<C>\ to\ be\ used\ in\ boolean\ expression}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ and\ comparison\ operations.}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keyword}{operator}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*()\ \textcolor{keyword}{const}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};\ \}}
\DoxyCodeLine{00264\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classscoped__refptr_ab83284a259cc677b501feef23a7a34cf}{scoped\_refptr}}::*\mbox{\hyperlink{classscoped__refptr_a0dbf2094ddc712d5a6a64013480fad6b}{Testable}};}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keyword}{operator}\ \mbox{\hyperlink{classscoped__refptr_a0dbf2094ddc712d5a6a64013480fad6b}{Testable}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}\ ?\ \&\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{scoped\_refptr::ptr\_}}\ :\ NULL;\ \}}
\DoxyCodeLine{00267\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classscoped__refptr_a84e9959608997de8fe4355def47ff45a}{operator-\/>}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}\ !=\ NULL);}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};}
\DoxyCodeLine{00272\ \ \ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ \mbox{\hyperlink{classscoped__refptr_a0fed75ce180373be4f1f10ade675920d}{operator=}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ p)\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ AddRef\ first\ so\ that\ self\ assignment\ should\ work}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (p)\ p-\/>AddRef();}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ old\_ptr\ =\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}\ =\ p;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (old\_ptr)\ old\_ptr-\/>Release();}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ \mbox{\hyperlink{classscoped__refptr_a7a3a3994a8138460c3ae15ee73ceb1fb}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ r)\ \{\ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this}\ =\ r.\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};\ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00286\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ \mbox{\hyperlink{classscoped__refptr_ac8de261ea1fce9fc921359710315d9db}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<U>}}\&\ r)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this}\ =\ r.\mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}();}
\DoxyCodeLine{00288\ \ \ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ \mbox{\hyperlink{classscoped__refptr_a31f0fdc4808da3e6be974f5ff28c7bd1}{operator=}}(\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\&\ r)\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}(std::move(r)).\mbox{\hyperlink{classscoped__refptr_ac8909be3b0fc6ec98da20f62aa0fc08e}{swap}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00296\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ \mbox{\hyperlink{classscoped__refptr_ae3d33f8311cc1ecf607df01d6f8c0652}{operator=}}(\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<U>}}\&\&\ r)\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}(std::move(r)).\mbox{\hyperlink{classscoped__refptr_ac8909be3b0fc6ec98da20f62aa0fc08e}{swap}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classscoped__refptr_ac8909be3b0fc6ec98da20f62aa0fc08e}{swap}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}**\ pp)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ p\ =\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}}\ =\ *pp;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ *pp\ =\ p;}
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classscoped__refptr_a9855884918c68277869a81f9df2de865}{swap}}(\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ r)\ \{\ \mbox{\hyperlink{classscoped__refptr_a9855884918c68277869a81f9df2de865}{swap}}(\&r.\mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}});\ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{comment}{//\ Like\ gscoped\_ptr::reset(),\ drops\ a\ reference\ on\ the\ currently\ held\ object}}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{comment}{//\ (if\ any),\ and\ adds\ a\ reference\ to\ the\ passed-\/in\ object\ (if\ not\ NULL).}}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classscoped__refptr_a6f757964907a3225b09ce2c9c4e014c8}{reset}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ p\ =\ NULL)\ \{\ *\textcolor{keyword}{this}\ =\ p;\ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00314\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classscoped__refptr_a7bbda28196d259c96c1ea7d5bf5b7a1d}{ptr\_}};}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classscoped__refptr}{scoped\_refptr}};}
\DoxyCodeLine{00319\ \};}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \textcolor{comment}{//\ Handy\ utility\ for\ creating\ a\ scoped\_refptr<T>\ out\ of\ a\ T*\ explicitly\ without}}
\DoxyCodeLine{00322\ \textcolor{comment}{//\ having\ to\ retype\ all\ the\ template\ arguments}}
\DoxyCodeLine{00323\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00324\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\ \mbox{\hyperlink{ref__counted_8h_a7864cd220c725dbef580b2b9dea1a4b4}{make\_scoped\_refptr}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ t)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}(t);}
\DoxyCodeLine{00326\ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \textcolor{comment}{//\ equal\_to\ and\ hash\ implementations\ for\ templated\ scoped\_refptrs\ suitable\ for}}
\DoxyCodeLine{00329\ \textcolor{comment}{//\ use\ with\ STL\ unordered\_*\ containers.}}
\DoxyCodeLine{00330\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00331\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_scoped_ref_ptr_equal_to_functor}{ScopedRefPtrEqualToFunctor}}\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_scoped_ref_ptr_equal_to_functor_ad9ce9c8b790aa2cf686817a97ecafa8c}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ x,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ y)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ x.\mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}()\ ==\ y.\mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}();}
\DoxyCodeLine{00334\ \ \ \ \ \}}
\DoxyCodeLine{00335\ \};}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00338\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_scoped_ref_ptr_hash_functor}{ScopedRefPtrHashFunctor}}\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{struct_scoped_ref_ptr_hash_functor_a5d1b5256bc3a993fa61753045a5e1ba4}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<T>}}\&\ p)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(p.\mbox{\hyperlink{classscoped__refptr_aed182ab5a4742a6fc2f9fe79773c12e1}{get}}());\ \}}
\DoxyCodeLine{00340\ \};}

\end{DoxyCode}
