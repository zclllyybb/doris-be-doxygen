\hypertarget{hash__table__key__holder_8h}{}\doxysection{/\+Users/dabowang/doris/be/src/vec/common/hash\+\_\+table/hash\+\_\+table\+\_\+key\+\_\+holder.h 文件参考}
\label{hash__table__key__holder_8h}\index{/Users/dabowang/doris/be/src/vec/common/hash\_table/hash\_table\_key\_holder.h@{/Users/dabowang/doris/be/src/vec/common/hash\_table/hash\_table\_key\_holder.h}}
{\ttfamily \#include \char`\"{}vec/common/arena.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}vec/common/string\+\_\+ref.\+h\char`\"{}}\newline
hash\+\_\+table\+\_\+key\+\_\+holder.\+h 的引用(Include)关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d1d/hash__table__key__holder_8h__incl}
\end{center}
\end{figure}
此图展示该文件直接或间接的被哪些文件引用了\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/d54/hash__table__key__holder_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{Arena\+Key\+Holder}}
\item 
struct \mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{Serialized\+Key\+Holder}}
\end{DoxyCompactItemize}
\doxysubsection*{命名空间}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacedoris}{doris}}
\begin{DoxyCompactList}\small\item\em Utilities for collecting timings. \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacedoris_1_1vectorized}{doris\+::vectorized}}
\begin{DoxyCompactList}\small\item\em Common helper methods for implementation of different columns. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{函数}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename Key $>$ }\\Key \& \mbox{\hyperlink{hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211}{key\+\_\+holder\+\_\+get\+\_\+key}} (Key \&\&key)
\item 
{\footnotesize template$<$typename Key $>$ }\\void \mbox{\hyperlink{hash__table__key__holder_8h_a8c4eff5012496de72ff70d70646351dc}{key\+\_\+holder\+\_\+persist\+\_\+key}} (Key \&\&)
\item 
{\footnotesize template$<$typename Key $>$ }\\void \mbox{\hyperlink{hash__table__key__holder_8h_a549e944b2f949795b0d32aa24793deee}{key\+\_\+holder\+\_\+discard\+\_\+key}} (Key \&\&)
\item 
\mbox{\hyperlink{structdoris_1_1_string_ref}{doris\+::\+String\+Ref}} \&\mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a17a4fbca3cc999ab3c0e36bf88bafb89}{key\+\_\+holder\+\_\+get\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&holder)
\item 
void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a3c08711adb56c1deb398d8a4d53d7706}{key\+\_\+holder\+\_\+persist\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&holder)
\item 
void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a3378d53b853645f9789699db63a271da}{key\+\_\+holder\+\_\+discard\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&)
\item 
\mbox{\hyperlink{structdoris_1_1_string_ref}{doris\+::\+String\+Ref}} \&\mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a28c31be5b3155cbb5ea96f8dc8a49acf}{key\+\_\+holder\+\_\+get\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&holder)
\item 
void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a3d60ef8f60c750af87197bbb5e00311c}{key\+\_\+holder\+\_\+persist\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&)
\item 
void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} \mbox{\hyperlink{hash__table__key__holder_8h_a732bac365c85f780e44c7bc3c745bcad}{key\+\_\+holder\+\_\+discard\+\_\+key}} (\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&holder)
\end{DoxyCompactItemize}


\doxysubsection{函数说明}
\mbox{\Hypertarget{hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211}\label{hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_get\_key@{key\_holder\_get\_key}}
\index{key\_holder\_get\_key@{key\_holder\_get\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_get\_key()}{key\_holder\_get\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily Key \& key\+\_\+holder\+\_\+get\+\_\+key (\begin{DoxyParamCaption}\item[{Key \&\&}]{key }\end{DoxyParamCaption})}

In some aggregation scenarios, when adding a key to the hash table, we start with a temporary key object, and if it turns out to be a new key, we must make it persistent (e.\+g. copy to an Arena) and use the resulting persistent object as hash table key. This happens only for String\+Ref keys, because other key types are stored by value, but String\+Ref is a pointer-\/like type\+: the actual data are stored elsewhere. Even for String\+Ref, we don\textquotesingle{}t make a persistent copy of the key in each of the following cases\+: 1) the aggregation method doesn\textquotesingle{}t use temporary keys, so they\textquotesingle{}re persistent from the start; 1) the key is already present in the hash table; 3) that particular key is stored by value, e.\+g. a short String\+Ref key in \mbox{\hyperlink{class_string_hash_map}{String\+Hash\+Map}}.

In the past, the caller was responsible for making the key persistent after in was inserted. emplace() returned whether the key is new or not, so the caller only stored new keys (this is case (2) from the above list). However, now we are adding a compound hash table for String\+Ref keys, so case (3) appears. The decision about persistence now depends on some properties of the key, and the logic of this decision is tied to the particular hash table implementation. This means that the hash table user now doesn\textquotesingle{}t have enough data and logic to make this decision by itself.

To support these new requirements, we now manage key persistence by passing a special key holder to emplace(), which has the functions to make the key persistent or to discard it. emplace() then calls these functions at the appropriate moments.

This approach has the following benefits\+:
\begin{DoxyItemize}
\item no extra runtime branches in the caller to make the key persistent.
\item no additional data is stored in the hash table itself, which is important when it\textquotesingle{}s used in aggregate function states.
\item no overhead when the key memory management isn\textquotesingle{}t needed\+: we just pass the bare key without any wrapper to emplace(), and the default callbacks do nothing.
\end{DoxyItemize}

This file defines the default key persistence functions, as well as two different key holders and corresponding functions for storing String\+Ref keys to Arena. Returns the key. Can return the temporary key initially. After the call to \mbox{\hyperlink{hash__table__key__holder_8h_a8c4eff5012496de72ff70d70646351dc}{key\+\_\+holder\+\_\+persist\+\_\+key()}}, must return the persistent key. 这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d36/hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{hash__table__key__holder_8h_a8c4eff5012496de72ff70d70646351dc}\label{hash__table__key__holder_8h_a8c4eff5012496de72ff70d70646351dc}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_persist\_key@{key\_holder\_persist\_key}}
\index{key\_holder\_persist\_key@{key\_holder\_persist\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_persist\_key()}{key\_holder\_persist\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily void key\+\_\+holder\+\_\+persist\+\_\+key (\begin{DoxyParamCaption}\item[{Key \&\&}]{ }\end{DoxyParamCaption})}

Make the key persistent. \mbox{\hyperlink{hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211}{key\+\_\+holder\+\_\+get\+\_\+key()}} must return the persistent key after this call. 这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d36/hash__table__key__holder_8h_a8c4eff5012496de72ff70d70646351dc_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{hash__table__key__holder_8h_a549e944b2f949795b0d32aa24793deee}\label{hash__table__key__holder_8h_a549e944b2f949795b0d32aa24793deee}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_discard\_key@{key\_holder\_discard\_key}}
\index{key\_holder\_discard\_key@{key\_holder\_discard\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_discard\_key()}{key\_holder\_discard\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily void key\+\_\+holder\+\_\+discard\+\_\+key (\begin{DoxyParamCaption}\item[{Key \&\&}]{ }\end{DoxyParamCaption})}

Discard the key. Calling \mbox{\hyperlink{hash__table__key__holder_8h_a928f207f55160e77313c49feb25fc211}{key\+\_\+holder\+\_\+get\+\_\+key()}} is ill-\/defined after this. 这是这个函数的调用关系图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d36/hash__table__key__holder_8h_a549e944b2f949795b0d32aa24793deee_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{hash__table__key__holder_8h_a17a4fbca3cc999ab3c0e36bf88bafb89}\label{hash__table__key__holder_8h_a17a4fbca3cc999ab3c0e36bf88bafb89}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_get\_key@{key\_holder\_get\_key}}
\index{key\_holder\_get\_key@{key\_holder\_get\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_get\_key()}{key\_holder\_get\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{structdoris_1_1_string_ref}{doris\+::\+String\+Ref}} \&\mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+get\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&}]{holder }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{hash__table__key__holder_8h_a3c08711adb56c1deb398d8a4d53d7706}\label{hash__table__key__holder_8h_a3c08711adb56c1deb398d8a4d53d7706}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_persist\_key@{key\_holder\_persist\_key}}
\index{key\_holder\_persist\_key@{key\_holder\_persist\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_persist\_key()}{key\_holder\_persist\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+persist\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&}]{holder }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

函数调用图\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d36/hash__table__key__holder_8h_a3c08711adb56c1deb398d8a4d53d7706_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{hash__table__key__holder_8h_a3378d53b853645f9789699db63a271da}\label{hash__table__key__holder_8h_a3378d53b853645f9789699db63a271da}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_discard\_key@{key\_holder\_discard\_key}}
\index{key\_holder\_discard\_key@{key\_holder\_discard\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_discard\_key()}{key\_holder\_discard\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+discard\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_arena_key_holder}{doris\+::vectorized\+::\+Arena\+Key\+Holder}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{hash__table__key__holder_8h_a28c31be5b3155cbb5ea96f8dc8a49acf}\label{hash__table__key__holder_8h_a28c31be5b3155cbb5ea96f8dc8a49acf}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_get\_key@{key\_holder\_get\_key}}
\index{key\_holder\_get\_key@{key\_holder\_get\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_get\_key()}{key\_holder\_get\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily \mbox{\hyperlink{structdoris_1_1_string_ref}{doris\+::\+String\+Ref}} \&\mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+get\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&}]{holder }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{hash__table__key__holder_8h_a3d60ef8f60c750af87197bbb5e00311c}\label{hash__table__key__holder_8h_a3d60ef8f60c750af87197bbb5e00311c}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_persist\_key@{key\_holder\_persist\_key}}
\index{key\_holder\_persist\_key@{key\_holder\_persist\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_persist\_key()}{key\_holder\_persist\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+persist\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

\mbox{\Hypertarget{hash__table__key__holder_8h_a732bac365c85f780e44c7bc3c745bcad}\label{hash__table__key__holder_8h_a732bac365c85f780e44c7bc3c745bcad}} 
\index{hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}!key\_holder\_discard\_key@{key\_holder\_discard\_key}}
\index{key\_holder\_discard\_key@{key\_holder\_discard\_key}!hash\_table\_key\_holder.h@{hash\_table\_key\_holder.h}}
\doxysubsubsection{\texorpdfstring{key\_holder\_discard\_key()}{key\_holder\_discard\_key()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily void \mbox{\hyperlink{compiler__util_8h_aa1dec568e79152c892dcf63f445cbd7a}{ALWAYS\+\_\+\+INLINE}} key\+\_\+holder\+\_\+discard\+\_\+key (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structdoris_1_1vectorized_1_1_serialized_key_holder}{doris\+::vectorized\+::\+Serialized\+Key\+Holder}} \&}]{holder }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

函数调用图\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d36/hash__table__key__holder_8h_a732bac365c85f780e44c7bc3c745bcad_cgraph}
\end{center}
\end{figure}
