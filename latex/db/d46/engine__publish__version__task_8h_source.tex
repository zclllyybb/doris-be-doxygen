\hypertarget{engine__publish__version__task_8h_source}{}\doxysection{engine\+\_\+publish\+\_\+version\+\_\+task.\+h}
\label{engine__publish__version__task_8h_source}\index{/Users/dabowang/doris/be/src/olap/task/engine\_publish\_version\_task.h@{/Users/dabowang/doris/be/src/olap/task/engine\_publish\_version\_task.h}}
\mbox{\hyperlink{engine__publish__version__task_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#ifndef\ DORIS\_BE\_SRC\_OLAP\_TASK\_ENGINE\_PUBLISH\_VERSION\_TASK\_H}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#define\ DORIS\_BE\_SRC\_OLAP\_TASK\_ENGINE\_PUBLISH\_VERSION\_TASK\_H}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/AgentService\_types.h"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__define_8h}{olap/olap\_define.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{engine__task_8h}{olap/task/engine\_task.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{class\ }EnginePublishVersionTask;}
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task}{TabletPublishTxnTask}}\ \{}
\DoxyCodeLine{00029\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task}{TabletPublishTxnTask}}(\mbox{\hyperlink{classdoris_1_1_engine_publish_version_task}{EnginePublishVersionTask}}*\ engine\_task,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ rowset,\ int64\_t\ partition\_id,\ int64\_t\ transaction\_id,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{file__header_8h_acd99bb05ca015e7d74448acb1deba7ca}{version}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_tablet_info}{TabletInfo}}\&\ tablet\_info,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::atomic<int64\_t>*\ total\_task\_num);}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_ac87900f49e9370eddae1b9ab95cce7c6}{\string~TabletPublishTxnTask}}()\ \{\}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a37c2d0658e498b1bf878f8a3d9a7c5b4}{handle}}();}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task}{EnginePublishVersionTask}}*\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a0813edfb701d168747d3f7025a6b4b1c}{\_engine\_publish\_version\_task}};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a98f28be525261e7ac6cde67ff645ab91}{\_tablet}};}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a7521965b3dd00f2740998d3638b7aae3}{\_rowset}};}
\DoxyCodeLine{00043\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_aa4033d7102999d00f610cabfc9eab73c}{\_partition\_id}};}
\DoxyCodeLine{00044\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_aa9ac7ddb2f509bccbd7d83c99fa732da}{\_transaction\_id}};}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a48a6a40e2301b8126fe4de7ba57807cd}{\_version}};}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_tablet_info}{TabletInfo}}\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_ae09be5798b9c8e352318b115d0b2df52}{\_tablet\_info}};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ std::atomic<int64\_t>*\ \mbox{\hyperlink{classdoris_1_1_tablet_publish_txn_task_a0704c9cf03b008c92906dd69f817ae72}{\_total\_task\_num}};}
\DoxyCodeLine{00049\ \};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_engine_publish_version_task}{EnginePublishVersionTask}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_engine_task}{EngineTask}}\ \{}
\DoxyCodeLine{00052\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task}{EnginePublishVersionTask}}(TPublishVersionRequest\&\ publish\_version\_req,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vector<TTabletId>*\ error\_tablet\_ids,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<TTabletId>*\ succ\_tablet\_ids\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a98c6dd56905bbb0697b356417fed6db0}{\string~EnginePublishVersionTask}}()\ \{\}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_ad040292e932cc1c1ff2043dfc48c864d}{finish}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a8dd291744412bbc491be20d907da7942}{add\_error\_tablet\_id}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_ab4fc5eec801379255238392b6028ed35}{add\_succ\_tablet\_id}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a7ff19734eb024bd6f3e2ad95647b1b27}{notify}}();}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_aa3b21853f890838c88d047d6c2786917}{wait}}();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{const}\ TPublishVersionRequest\&\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a373f3873553ad6cd5797a132bfffd10c}{\_publish\_version\_req}};}
\DoxyCodeLine{00068\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_adfebe8c37a1ad36a7b305f9cda02bb36}{\_tablet\_ids\_mutex}};}
\DoxyCodeLine{00069\ \ \ \ \ vector<TTabletId>*\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a7ceead856a2d2038bea48c9a5a00e08d}{\_error\_tablet\_ids}};}
\DoxyCodeLine{00070\ \ \ \ \ vector<TTabletId>*\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a445448b1b6378c189511d22cd0a566fa}{\_succ\_tablet\_ids}};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_a55b4e9d8f69126af7d3da4fc66a7f376}{\_tablet\_finish\_sleep\_mutex}};}
\DoxyCodeLine{00073\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1_engine_publish_version_task_adfe61e160df83f353ffc7d943bf73c51}{\_tablet\_finish\_sleep\_cond}};}
\DoxyCodeLine{00074\ \};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \}\ \textcolor{comment}{//\ namespace\ doris}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ DORIS\_BE\_SRC\_OLAP\_TASK\_ENGINE\_PUBLISH\_VERSION\_TASK\_H}}

\end{DoxyCode}
