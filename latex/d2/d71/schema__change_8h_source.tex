\hypertarget{schema__change_8h_source}{}\doxysection{schema\+\_\+change.\+h}
\label{schema__change_8h_source}\index{/Users/dabowang/doris/be/src/olap/schema\_change.h@{/Users/dabowang/doris/be/src/olap/schema\_change.h}}
\mbox{\hyperlink{schema__change_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/AgentService\_types.h"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column__mapping_8h}{olap/column\_mapping.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{delete__handler_8h}{olap/delete\_handler.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset_8h}{olap/rowset/rowset.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__writer_8h}{olap/rowset/rowset\_writer.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet_8h}{olap/tablet.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column_8h}{vec/columns/column.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{block_8h}{vec/core/block.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__data__convertor_8h}{vec/olap/olap\_data\_convertor.h}}"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{namespace\ }segment\_v2\ \{}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_inverted_index_column_writer}{InvertedIndexColumnWriter}};}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\ \{}
\DoxyCodeLine{00038\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}(\mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ tablet\_schema,\ \mbox{\hyperlink{classdoris_1_1_descriptor_tbl}{DescriptorTbl}}\ desc\_tbl);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_block_changer_a5f5d0479b67aecdddf54fa8051b1f7de}{\string~BlockChanger}}();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_column_mapping}{ColumnMapping}}*\ \mbox{\hyperlink{classdoris_1_1_block_changer_a544ffe0791fbe26c3c15438c8861723c}{get\_mutable\_column\_mapping}}(\textcolor{keywordtype}{size\_t}\ column\_index);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a99943c3764aab4692656dd9dff62d26e}{change\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ ref\_block,\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ new\_block)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_block_changer_ad3f7b7065d3f526d2f8e4a508a803525}{set\_where\_expr}}(\textcolor{keyword}{const}\ std::shared\_ptr<TExpr>\&\ where\_expr)\ \{\ \mbox{\hyperlink{classdoris_1_1_block_changer_a98d9733fe7895d8c1d4d7235f61e4643}{\_where\_expr}}\ =\ where\_expr;\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a2121d2af0e40b9c71aca84d1a9d07759}{set\_type}}(AlterTabletType\ type)\ \{\ \mbox{\hyperlink{classdoris_1_1_block_changer_adb38c0bd4bb383f7c0279f023a5d316e}{\_type}}\ =\ type;\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_block_changer_aa659918706668a555dd9c090bb091276}{has\_where}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a98d9733fe7895d8c1d4d7235f61e4643}{\_where\_expr}}\ !=\ \textcolor{keyword}{nullptr};\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a51e680638fd8d01231a2b394924147b0}{\_check\_cast\_valid}}(\mbox{\hyperlink{namespacedoris_1_1vectorized_aa1d7b67012985a9197efd18f7dd48e51}{vectorized::ColumnPtr}}\ ref\_column,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1vectorized_aa1d7b67012985a9197efd18f7dd48e51}{vectorized::ColumnPtr}}\ new\_column)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ @brief\ column-\/mapping\ specification\ of\ new\ schema}}
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{namespacedoris_ac6a70f89e3ffebb1e772cd5becd6acf8}{SchemaMapping}}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a3ce22e2d8b931e4c220e6e00012f33f2}{\_schema\_mapping}};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_descriptor_tbl}{DescriptorTbl}}\ \mbox{\hyperlink{classdoris_1_1_block_changer_a76aac2dc7938c66a9ab1ab49547c104e}{\_desc\_tbl}};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ std::shared\_ptr<TExpr>\ \mbox{\hyperlink{classdoris_1_1_block_changer_a98d9733fe7895d8c1d4d7235f61e4643}{\_where\_expr}};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ AlterTabletType\ \mbox{\hyperlink{classdoris_1_1_block_changer_adb38c0bd4bb383f7c0279f023a5d316e}{\_type}};}
\DoxyCodeLine{00065\ \};}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_schema_change}{SchemaChange}}\ \{}
\DoxyCodeLine{00068\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_a35785f0793b749f203a3248d0b2365a3}{SchemaChange}}()\ :\ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}}(0),\ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}}(0)\ \{\}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a7ab9489504ee3138e3563127bccb74ca}{\string~SchemaChange}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a78e3c3646a61f2617768b45127cce414}{process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ base\_tablet,}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rowset\_reader-\/>rowset()-\/>empty()\ ||\ rowset\_reader-\/>rowset()-\/>num\_rows()\ ==\ 0)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a7f122d03731fbafe5f83de473538c567}{RETURN\_WITH\_WARN\_IF\_ERROR}}(}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rowset\_writer-\/>\mbox{\hyperlink{classdoris_1_1_rowset_writer_aa5a8afca4a0eff41fea00af55ebf3f8e}{flush}}(),\ Status::Error<ErrorCode::INVALID\_ARGUMENT>(),}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fmt::format(\textcolor{stringliteral}{"{}create\ empty\ version\ for\ schema\ change\ failed.\ version=\ \{\}-\/\{\}"{}},}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rowset\_writer-\/>\mbox{\hyperlink{classdoris_1_1_rowset_writer_ab3e8becb73a53e2f3c6de22c4bb9bbe7}{version}}().\mbox{\hyperlink{structdoris_1_1_version_a60646cb67795d4643f463d6678081989}{first}},\ rowset\_writer-\/>\mbox{\hyperlink{classdoris_1_1_rowset_writer_ab3e8becb73a53e2f3c6de22c4bb9bbe7}{version}}().\mbox{\hyperlink{structdoris_1_1_version_ad199717fb108e23c8a6e7d2c52c4aea8}{second}}));}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}}\ =\ 0;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}}\ =\ 0;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_aea5b47411993669371db6080212b65c4}{\_inner\_process}}(rowset\_reader,\ rowset\_writer,\ new\_tablet,\ base\_tablet\_schema));}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_a0fab415de155ba98c49651c9790c9696}{\_add\_filtered\_rows}}(rowset\_reader-\/>filtered\_rows());}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ row\ num\ changes}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classdoris_1_1_schema_change_a7e78acd85fa93ea15a72c25607f723d3}{\_check\_row\_nums}}(rowset\_reader,\ *rowset\_writer))\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::Error<ErrorCode::ALTER\_STATUS\_ERR>();}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ LOG(INFO)\ <<\ \textcolor{stringliteral}{"{}all\ row\ nums.\ source\_rows="{}}\ <<\ rowset\_reader-\/>rowset()-\/>num\_rows()}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ merged\_rows="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_schema_change_a535f347c1fe73c2166df6e29a30d8a70}{merged\_rows}}()\ <<\ \textcolor{stringliteral}{"{},\ filtered\_rows="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_schema_change_a116c9cd3bf664580b3591c1561907801}{filtered\_rows}}()}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ new\_index\_rows="{}}\ <<\ rowset\_writer-\/>\mbox{\hyperlink{classdoris_1_1_rowset_writer_aa1e2558f988346fe1f3ff5cf91d1c80c}{num\_rows}}();}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a116c9cd3bf664580b3591c1561907801}{filtered\_rows}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}};\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a535f347c1fe73c2166df6e29a30d8a70}{merged\_rows}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}};\ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a0fab415de155ba98c49651c9790c9696}{\_add\_filtered\_rows}}(uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a116c9cd3bf664580b3591c1561907801}{filtered\_rows}})\ \{\ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}}\ +=\ \mbox{\hyperlink{classdoris_1_1_schema_change_a116c9cd3bf664580b3591c1561907801}{filtered\_rows}};\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a88eadb24e7d7dd02572ec2d4a51cbe77}{\_add\_merged\_rows}}(uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a535f347c1fe73c2166df6e29a30d8a70}{merged\_rows}})\ \{\ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}}\ +=\ \mbox{\hyperlink{classdoris_1_1_schema_change_a535f347c1fe73c2166df6e29a30d8a70}{merged\_rows}};\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_aea5b47411993669371db6080212b65c4}{\_inner\_process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}inner\ process\ unsupported."{}});}
\DoxyCodeLine{00114\ \ \ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_schema_change_a7e78acd85fa93ea15a72c25607f723d3}{\_check\_row\_nums}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ reader,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}\&\ writer)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reader-\/>rowset()-\/>num\_rows()\ !=\ writer.\mbox{\hyperlink{classdoris_1_1_rowset_writer_aa1e2558f988346fe1f3ff5cf91d1c80c}{num\_rows}}()\ +\ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}}\ +\ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}})\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ LOG(WARNING)\ <<\ \textcolor{stringliteral}{"{}fail\ to\ check\ row\ num!\ "{}}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}source\_rows="{}}\ <<\ reader-\/>rowset()-\/>num\_rows()}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ writer\ rows="{}}\ <<\ writer.\mbox{\hyperlink{classdoris_1_1_rowset_writer_aa1e2558f988346fe1f3ff5cf91d1c80c}{num\_rows}}()}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ merged\_rows="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_schema_change_a535f347c1fe73c2166df6e29a30d8a70}{merged\_rows}}()}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ filtered\_rows="{}}\ <<\ \mbox{\hyperlink{classdoris_1_1_schema_change_a116c9cd3bf664580b3591c1561907801}{filtered\_rows}}()}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ new\_index\_rows="{}}\ <<\ writer.\mbox{\hyperlink{classdoris_1_1_rowset_writer_aa1e2558f988346fe1f3ff5cf91d1c80c}{num\_rows}}();}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00130\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a435660ba2c88e4cc75c131a0465b959d}{\_filtered\_rows}};}
\DoxyCodeLine{00131\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_schema_change_a06b84d8f115f05c5d05aaa332fb6cf83}{\_merged\_rows}};}
\DoxyCodeLine{00132\ \};}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_linked_schema_change}{LinkedSchemaChange}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_schema_change}{SchemaChange}}\ \{}
\DoxyCodeLine{00135\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_ac8288414d69b35716fbd173f09efa5b3}{LinkedSchemaChange}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ changer)\ :\ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_a438466fc05dd723a93d1cedcc6b98385}{\_changer}}(changer)\ \{\}}
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_ab5c1993ece146ed330bb8123f633b799}{\string~LinkedSchemaChange}}()\ \textcolor{keyword}{override}\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_a3da2dd115c5ed49f4a1d58419406f566}{process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ base\_tablet,}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_a438466fc05dd723a93d1cedcc6b98385}{\_changer}};}
\DoxyCodeLine{00145\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_linked_schema_change_a4d461d310943e9d036be5324d06735c0}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_linked_schema_change}{LinkedSchemaChange}});}
\DoxyCodeLine{00146\ \};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_v_schema_change_directly}{VSchemaChangeDirectly}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_schema_change}{SchemaChange}}\ \{}
\DoxyCodeLine{00149\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_ae5e3a9ec5d9690c8f83b79aabe04f0e6}{VSchemaChangeDirectly}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ changer)\ :\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_a438466fc05dd723a93d1cedcc6b98385}{\_changer}}(changer)\ \{\}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_a0d8656af3adfb25b565ff4c3e0fe9fc5}{\_inner\_process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_afd56196a90d80e9d8610b67889256204}{\_check\_row\_nums}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ reader,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}\&\ writer)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_a438466fc05dd723a93d1cedcc6b98385}{\_changer}}.\mbox{\hyperlink{classdoris_1_1_block_changer_aa659918706668a555dd9c090bb091276}{has\_where}}()\ ||\ \mbox{\hyperlink{classdoris_1_1_schema_change_a7e78acd85fa93ea15a72c25607f723d3}{SchemaChange::\_check\_row\_nums}}(reader,\ writer);}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_directly_a438466fc05dd723a93d1cedcc6b98385}{\_changer}};}
\DoxyCodeLine{00161\ \};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{comment}{//\ @breif\ schema\ change\ with\ sorting}}
\DoxyCodeLine{00164\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting}{VSchemaChangeWithSorting}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_schema_change}{SchemaChange}}\ \{}
\DoxyCodeLine{00165\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting}{VSchemaChangeWithSorting}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ changer,\ \textcolor{keywordtype}{size\_t}\ memory\_limitation);}
\DoxyCodeLine{00167\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a9485465bda49bff417c30013c312c62b}{\string~VSchemaChangeWithSorting}}()\ \textcolor{keyword}{override}\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a0d8656af3adfb25b565ff4c3e0fe9fc5}{\_inner\_process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a76f157f111063116d30187815c64e127}{\_internal\_sorting}}(\textcolor{keyword}{const}\ std::vector<std::unique\_ptr<vectorized::Block>>\&\ blocks,}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\&\ temp\_delta\_versions,\ int64\_t\ newest\_write\_timestamp,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ RowsetTypePB\ new\_rowset\_type,}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SegmentsOverlapPB\ segments\_overlap,\ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}*\ rowset);}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a572b14f05da72b0ad62ba76ab3cef526}{\_external\_sorting}}(std::vector<RowsetSharedPtr>\&\ src\_rowsets,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_afd56196a90d80e9d8610b67889256204}{\_check\_row\_nums}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ reader,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}\&\ writer)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a438466fc05dd723a93d1cedcc6b98385}{\_changer}}.\mbox{\hyperlink{classdoris_1_1_block_changer_aa659918706668a555dd9c090bb091276}{has\_where}}()\ ||\ \mbox{\hyperlink{classdoris_1_1_schema_change_a7e78acd85fa93ea15a72c25607f723d3}{SchemaChange::\_check\_row\_nums}}(reader,\ writer);}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a438466fc05dd723a93d1cedcc6b98385}{\_changer}};}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a58931b22871f368c6628c67c064e1814}{\_memory\_limitation}};}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a6b651d17e3eca218ad4f42dcd79a77d5}{\_temp\_delta\_versions}};}
\DoxyCodeLine{00188\ \ \ \ \ std::unique\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_v_schema_change_with_sorting_a589c3f7fd9800e4fd09e03c9dd12d33f}{\_mem\_tracker}};}
\DoxyCodeLine{00189\ \};}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index}{SchemaChangeForInvertedIndex}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_schema_change}{SchemaChange}}\ \{}
\DoxyCodeLine{00192\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index}{SchemaChangeForInvertedIndex}}(\textcolor{keyword}{const}\ std::vector<TOlapTableIndex>\&\ alter\_inverted\_indexs,}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ tablet\_schema);}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a39079937d849d40d8b840de8630b2d27}{\string~SchemaChangeForInvertedIndex}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a3da2dd115c5ed49f4a1d58419406f566}{process}}(\mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ rowset\_reader,\ \mbox{\hyperlink{classdoris_1_1_rowset_writer}{RowsetWriter}}*\ rowset\_writer,}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ base\_tablet,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ base\_tablet\_schema)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00202\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_ade6ab727762ccc72e88288ea377551b9}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index}{SchemaChangeForInvertedIndex}});}
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_add005d62872a1bda0bfe55813c13f551}{\_write\_inverted\_index}}(int32\_t\ segment\_idx,\ \mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block);}
\DoxyCodeLine{00204\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a58f708d8a9fa8a7abc3f3dda13894060}{\_add\_data}}(\textcolor{keyword}{const}\ std::string\&\ column\_name,}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<int64\_t,\ int64\_t>\&\ index\_writer\_sign,\ \mbox{\hyperlink{classdoris_1_1_field}{Field}}*\ field,}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}\ num\_rows);}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_aba20e250f2e6319ffef189e5f7eb8e2b}{\_add\_nullable}}(\textcolor{keyword}{const}\ std::string\&\ column\_name,}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<int64\_t,\ int64\_t>\&\ index\_writer\_sign,\ \mbox{\hyperlink{classdoris_1_1_field}{Field}}*\ field,}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ null\_map,\ \textcolor{keyword}{const}\ uint8\_t**\ ptr,\ \textcolor{keywordtype}{size\_t}\ num\_rows);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ std::vector<TOlapTableIndex>\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a8cdac8e9ba41d492a56a486a08c7d399}{\_alter\_inverted\_indexs}};}
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a5f256212214e141eee2fe15b9b042e18}{\_tablet\_schema}};}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{comment}{//\ "{}<segment\_id,\ index\_id>"{}\ -\/>\ InvertedIndexColumnWriter}}
\DoxyCodeLine{00215\ \ \ \ \ std::unordered\_map<std::pair<int64\_t,\ int64\_t>,}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::unique\_ptr<segment\_v2::InvertedIndexColumnWriter>>}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a7e3c5b9034877a7c21414a8c19b7cde7}{\_inverted\_index\_builders}};}
\DoxyCodeLine{00218\ \ \ \ \ std::vector<std::unique\_ptr<TabletIndex>>\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a1221fa135fd51b07f58eb70920ae4212}{\_index\_metas}};}
\DoxyCodeLine{00219\ \ \ \ \ std::unique\_ptr<vectorized::OlapBlockDataConvertor>\ \mbox{\hyperlink{classdoris_1_1_schema_change_for_inverted_index_a0951687dd8e3433fcf2c4a4a6b488028}{\_olap\_data\_convertor}};}
\DoxyCodeLine{00220\ \};}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_schema_change_handler}{SchemaChangeHandler}}\ \{}
\DoxyCodeLine{00223\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ schema\ change\ v2,\ it\ will\ not\ set\ alter\ task\ in\ base\ tablet}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_aa7f160dfe971788c9421c686a6988d9f}{process\_alter\_tablet\_v2}}(\textcolor{keyword}{const}\ TAlterTabletReqV2\&\ request);}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a868772085686e8cc1881c2b0b5b18759}{process\_alter\_inverted\_index}}(\textcolor{keyword}{const}\ TAlterInvertedIndexReq\&\ request);}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keyword}{static}\ std::unique\_ptr<SchemaChange>\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a1e1814bbda003328fe514a8880146fc3}{get\_sc\_procedure}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}\&\ changer,}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ sc\_sorting,\ \textcolor{keywordtype}{bool}\ sc\_directly)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sc\_sorting)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_unique<VSchemaChangeWithSorting>(}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ changer,\ config::memory\_limitation\_per\_thread\_for\_schema\_change\_bytes);}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sc\_directly)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_unique<VSchemaChangeDirectly>(changer);}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_unique<LinkedSchemaChange>(changer);}
\DoxyCodeLine{00241\ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_aeab57dfc08a5dc6f39a4c73046fbe376}{tablet\_in\_converting}}(int64\_t\ tablet\_id);}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_ac1589d821c47b67cda59adcdf8ec8373}{\_get\_versions\_to\_be\_changed}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ base\_tablet,}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<Version>*\ versions\_to\_be\_changed,}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}*\ max\_rowset);}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_alter_materialized_view_param}{AlterMaterializedViewParam}}\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_alter_materialized_view_param_a418a457a1123a2f29218bc0f252fe0fc}{column\_name}};}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_alter_materialized_view_param_afcb80bff340c0dfbe7c52e549e8b1ca3}{origin\_column\_name}};}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ std::shared\_ptr<TExpr>\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_alter_materialized_view_param_ad29fa28c6c07599122083a0f818acac9}{expr}};}
\DoxyCodeLine{00254\ \ \ \ \ \};}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params}{SchemaChangeParams}}\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ AlterTabletType\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_ab00b9c36a7c90b5dfc1129f6f3240cb4}{alter\_tablet\_type}};}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a93fa663faf4c65fe6a165f60db5f95da}{base\_tablet}};}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a0fdfd239dc1c8ff04adf08046383cb5c}{new\_tablet}};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a0c96588bc21d209c5b630554586b3f1e}{base\_tablet\_schema}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ std::vector<RowsetReaderSharedPtr>\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_ae7b666da41962d0caf0d0eca44948d38}{ref\_rowset\_readers}};}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_delete_handler}{DeleteHandler}}*\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_ad0880837a6a439c3c8eb4f2d5d560a6d}{delete\_handler}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ std::unordered\_map<std::string,\ AlterMaterializedViewParam>\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a98f670d04bdcb1c402b3c58b50cb384b}{materialized\_params\_map}};}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_descriptor_tbl}{DescriptorTbl}}*\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a04df63d24aa09eed9d11065c314630d9}{desc\_tbl}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_object_pool}{ObjectPool}}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params_a3a5de7bd423fbc0afc4cf935c166ca6b}{pool}};}
\DoxyCodeLine{00266\ \ \ \ \ \};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a70eb38465eb761d944f32619f780a563}{\_do\_process\_alter\_tablet\_v2}}(\textcolor{keyword}{const}\ TAlterTabletReqV2\&\ request);}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a9689b941d610d5024cf79821a4556d5d}{\_validate\_alter\_result}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ new\_tablet,}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TAlterTabletReqV2\&\ request);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a4695eea517ee59a8ab9f7cf442c1ac24}{\_convert\_historical\_rowsets}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params}{SchemaChangeParams}}\&\ sc\_params);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a0f9d5ad0df6a902874604dcd0c2d23da}{\_parse\_request}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_schema_change_handler_1_1_schema_change_params}{SchemaChangeParams}}\&\ sc\_params,\ \mbox{\hyperlink{classdoris_1_1_block_changer}{BlockChanger}}*\ changer,}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}*\ sc\_sorting,\ \textcolor{keywordtype}{bool}*\ sc\_directly);}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a7def9064dc8bd250a10ec16286ad1f10}{\_do\_process\_alter\_inverted\_index}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TAlterInvertedIndexReq\&\ request);}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_ad543417e8cccb020486eeeaf825e4d56}{\_get\_rowset\_readers}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ tablet\_schema,}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TAlterInvertedIndexReq\&\ request,}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowsetReaderSharedPtr>*\ rs\_readers);}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_ae2b5a828af57b82bcf868b270a821e8f}{\_add\_inverted\_index}}(std::vector<RowsetReaderSharedPtr>\ rs\_readers,}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ tablet\_schema,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TAlterInvertedIndexReq\&\ request);}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a3a83c64c5012b09a405ec5854ed6d482}{\_drop\_inverted\_index}}(std::vector<RowsetReaderSharedPtr>\ rs\_readers,}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ tablet\_schema,}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ TAlterInvertedIndexReq\&\ request);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a5554b00598a6fc40d3a6dde20d0ba338}{\_rebuild\_inverted\_index}}(}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<RowsetReaderSharedPtr>\&\ rs\_readers,}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a9216ba4fd9b418b8808bfb91a407ea20}{TabletSchemaSPtr}}\&\ tablet\_schema,\ \mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TOlapTableIndex>\&\ alter\_inverted\_indexs);}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{comment}{//\ Initialization\ Settings\ for\ creating\ a\ default\ value}}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a00c1ce1a96d782c6015a63dc129a9afc}{\_init\_column\_mapping}}(\mbox{\hyperlink{structdoris_1_1_column_mapping}{ColumnMapping}}*\ column\_mapping,}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tablet_column}{TabletColumn}}\&\ column\_schema,\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}});}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a0829237c98eabf9ce37eeefa2226d65f}{\_mutex}};}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keyword}{static}\ std::unordered\_set<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a8a0c7f254aac884273e0ca784caf4d22}{\_tablet\_ids\_in\_converting}};}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keyword}{static}\ std::set<std::string>\ \mbox{\hyperlink{classdoris_1_1_schema_change_handler_a4857e033df0828549bd2f6fc95439d07}{\_supported\_functions}};}
\DoxyCodeLine{00304\ \};}
\DoxyCodeLine{00305\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
