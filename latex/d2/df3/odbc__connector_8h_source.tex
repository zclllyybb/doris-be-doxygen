\hypertarget{odbc__connector_8h_source}{}\doxysection{odbc\+\_\+connector.\+h}
\label{odbc__connector_8h_source}\index{/Users/dabowang/be\_all/exec/odbc\_connector.h@{/Users/dabowang/be\_all/exec/odbc\_connector.h}}
\mbox{\hyperlink{odbc__connector_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <sqltypes.h>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{table__connector_8h}{exec/table\_connector.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00025\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_o_d_b_c_connector_param}{ODBCConnectorParam}}\ \{}
\DoxyCodeLine{00026\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_o_d_b_c_connector_param_a1f5f62875730a94cea5ce94f769522a7}{connect\_string}};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{//\ only\ use\ in\ query}}
\DoxyCodeLine{00029\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_o_d_b_c_connector_param_af31f599799d8cf8f0bd5eea65f8747e2}{query\_string}};}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_tuple_descriptor}{TupleDescriptor}}*\ \mbox{\hyperlink{structdoris_1_1_o_d_b_c_connector_param_a9c7da9421e36d64c465c4b98386d8594}{tuple\_desc}};}
\DoxyCodeLine{00031\ \};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Because\ the\ DataBinding\ have\ the\ mem\ alloc,\ so}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ this\ class\ should\ not\ be\ copyable}}
\DoxyCodeLine{00035\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_data_binding}{DataBinding}}\ \{}
\DoxyCodeLine{00036\ \ \ \ \ SQLSMALLINT\ \mbox{\hyperlink{structdoris_1_1_data_binding_accee859246399f1e7a0f9848fe0ff6cf}{target\_type}};}
\DoxyCodeLine{00037\ \ \ \ \ SQLINTEGER\ \mbox{\hyperlink{structdoris_1_1_data_binding_aa805c57e25eb631e61b9cf2d05286fbf}{buffer\_length}};}
\DoxyCodeLine{00038\ \ \ \ \ SQLLEN\ \mbox{\hyperlink{structdoris_1_1_data_binding_aa77d18c2f142cfef3b1303b3cca37b99}{strlen\_or\_ind}};}
\DoxyCodeLine{00039\ \ \ \ \ SQLPOINTER\ \mbox{\hyperlink{structdoris_1_1_data_binding_a3279c6fbe3a3023e58be39d95e6614a5}{target\_value\_ptr}};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_binding_aa0b8456263702115bca48e668a601abc}{DataBinding}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_binding_a2c169c06c59ada4d7264a40609b9216a}{\string~DataBinding}}()\ \{\ \mbox{\hyperlink{jemalloc__hook_8cpp_a3c12ec6b8e8368e804827d604b2979d7}{free}}(\mbox{\hyperlink{structdoris_1_1_data_binding_a3279c6fbe3a3023e58be39d95e6614a5}{target\_value\_ptr}});\ \}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_binding_aeb7a9e8b41e7d13ccc1bae9e6ef065aa}{DataBinding}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_data_binding}{DataBinding}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_data_binding}{DataBinding}}\&\ \mbox{\hyperlink{structdoris_1_1_data_binding_a537e9f667639a08474a8f7144b913262}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_data_binding}{DataBinding}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00046\ \};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{comment}{//\ ODBC\ Connector\ for\ scan\ data\ from\ ODBC}}
\DoxyCodeLine{00049\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector}{ODBCConnector}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_table_connector}{TableConnector}}\ \{}
\DoxyCodeLine{00050\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector}{ODBCConnector}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_o_d_b_c_connector_param}{ODBCConnectorParam}}\&\ param);}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_af59b5aad8045354fb994c31f8719f436}{\string~ODBCConnector}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a7c95fc63709558037a878ca48917bf1b}{open}}(\mbox{\hyperlink{classdoris_1_1_runtime_state}{RuntimeState}}*\ state,\ \textcolor{keywordtype}{bool}\ read\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ query\ for\ ODBC\ table}}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a335684794369f805ebd935b84cd34011}{query}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a397115b1e1ca6b3aed6a23e479d88433}{get\_next\_row}}(\textcolor{keywordtype}{bool}*\ eos);}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a2e5a6cbb7092d5890822a4d2a32e29ba}{exec\_write\_sql}}(\textcolor{keyword}{const}\ std::u16string\&\ insert\_stmt,}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ fmt::memory\_buffer\&\ insert\_stmt\_buffer)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ use\ in\ ODBC\ transaction}}
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a1ccdf5606a96ed7ccfcc4b8a8309019f}{begin\_trans}}()\ \textcolor{keyword}{override};\ \textcolor{comment}{//\ should\ be\ call\ after\ connect\ and\ before\ query\ or\ init\_to\_write}}
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a34ac0d57793a8511528479f385bef0ce}{abort\_trans}}()\ \textcolor{keyword}{override};\ \textcolor{comment}{//\ should\ be\ call\ after\ transaction\ abort}}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a9961dec7209ee9967d0a427641e0c0f3}{finish\_trans}}()\ \textcolor{keyword}{override};\ \textcolor{comment}{//\ should\ be\ call\ after\ transaction\ commit}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_data_binding}{DataBinding}}\&\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a1b78d37c0e36cb5db0210ee4b2c20cff}{get\_column\_data}}(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ *\mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a0303b2c9f2332992c46df01c2e6556f8}{\_columns\_data}}.at(i).get();\ \}}
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a30dcc2f7e180affd7008115102c33064}{init\_to\_write}}(\mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ Now\ we\ only\ treat\ HLL,\ CHAR,\ VARCHAR\ as\ big\ column}}
\DoxyCodeLine{00072\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a7c215bb6b3a80bc2a842a80f7301f2af}{big\_column\_size\_buffer}}\ =\ config::big\_column\_size\_buffer;}
\DoxyCodeLine{00073\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a20d22ddd74e56d501b71317cc93ec41e}{small\_column\_size\_buffer}}\ =\ config::small\_column\_size\_buffer;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_aca06cc47b168441cb578c4fe189892d0}{error\_status}}(\textcolor{keyword}{const}\ std::string\&\ prefix,\ \textcolor{keyword}{const}\ std::string\&\ error\_msg);}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{static}\ std::string\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_ac7c1c985a4e46d11843b1c149a7982a9}{handle\_diagnostic\_record}}(SQLHANDLE\ hHandle,\ SQLSMALLINT\ hType,}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RETCODE\ RetCode);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_ad16447199c0fef444db3ce01b64004b4}{\_connect\_string}};}
\DoxyCodeLine{00082\ \ \ \ \ SQLSMALLINT\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_abe514a3f9d0249414604ef8d7c1b8e70}{\_field\_num}};}
\DoxyCodeLine{00083\ \ \ \ \ SQLHENV\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a83667f8f9455bccd31e27c35117c2e9e}{\_env}};}
\DoxyCodeLine{00084\ \ \ \ \ SQLHDBC\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_ad10eaf421f064d15cca98729dc33efb4}{\_dbc}};}
\DoxyCodeLine{00085\ \ \ \ \ SQLHSTMT\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a78b1583ec86d44c66d4b07ba7ff4aff2}{\_stmt}};}
\DoxyCodeLine{00086\ \ \ \ \ std::vector<std::unique\_ptr<DataBinding>>\ \mbox{\hyperlink{classdoris_1_1_o_d_b_c_connector_a0303b2c9f2332992c46df01c2e6556f8}{\_columns\_data}};}
\DoxyCodeLine{00087\ \};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
