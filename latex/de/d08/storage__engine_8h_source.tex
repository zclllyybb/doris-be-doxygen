\hypertarget{storage__engine_8h_source}{}\doxysection{storage\+\_\+engine.\+h}
\label{storage__engine_8h_source}\index{/Users/dabowang/doris/be/src/olap/storage\_engine.h@{/Users/dabowang/doris/be/src/olap/storage\_engine.h}}
\mbox{\hyperlink{storage__engine_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <pthread.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <rapidjson/document.h>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <ctime>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/AgentService\_types.h"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/BackendService\_types.h"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/MasterService\_types.h"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ref__counted_8h}{gutil/ref\_counted.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{compaction__permit__limiter_8h}{olap/compaction\_permit\_limiter.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap_2olap__common_8h}{olap/olap\_common.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__define_8h}{olap/olap\_define.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap__meta_8h}{olap/olap\_meta.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{options_8h}{olap/options.h}}"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__id__generator_8h}{olap/rowset/rowset\_id\_generator.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tablet__manager_8h}{olap/tablet\_manager.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{engine__task_8h}{olap/task/engine\_task.h}}"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{txn__manager_8h}{olap/txn\_manager.h}}"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{heartbeat__flags_8h}{runtime/heartbeat\_flags.h}}"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{stream__load__recorder_8h}{runtime/stream\_load/stream\_load\_recorder.h}}"{}}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{countdown__latch_8h}{util/countdown\_latch.h}}"{}}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread_8h}{util/thread.h}}"{}}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{threadpool_8h}{util/threadpool.h}}"{}}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{class\ }DataDir;}
\DoxyCodeLine{00056\ \textcolor{keyword}{class\ }EngineTask;}
\DoxyCodeLine{00057\ \textcolor{keyword}{class\ }BlockManager;}
\DoxyCodeLine{00058\ \textcolor{keyword}{class\ }MemTableFlushExecutor;}
\DoxyCodeLine{00059\ \textcolor{keyword}{class\ }Tablet;}
\DoxyCodeLine{00060\ \textcolor{keyword}{class\ }TaskWorkerPool;}
\DoxyCodeLine{00061\ \textcolor{keyword}{class\ }BetaRowsetWriter;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_a78d9bb2f3cac58b95b0b2fec6873ca87}{SegCompactionCandidates}}\ =\ std::vector<segment\_v2::SegmentSharedPtr>;}
\DoxyCodeLine{00064\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_a56ea6d7b7fdfea379db2328f8c6c8fb3}{SegCompactionCandidatesSharedPtr}}\ =\ std::shared\_ptr<SegCompactionCandidates>;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{comment}{//\ StorageEngine\ singleton\ to\ manage\ all\ Table\ pointers.}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ Providing\ add/drop/get\ operations.}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ StorageEngine\ instance\ doesn't\ own\ the\ Table\ resources,\ just\ hold\ the\ pointer,}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ allocation/deallocation\ must\ be\ done\ outside.}}
\DoxyCodeLine{00070\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}}\ \{}
\DoxyCodeLine{00071\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_engine_options}{EngineOptions}}\&\ options);}
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad2c26278ed7017b90965137181df06c3}{\string~StorageEngine}}();}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a67bf856a1714d1504666e80882278eda}{open}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_engine_options}{EngineOptions}}\&\ options,\ \mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}}**\ engine\_ptr);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a2a74d46f061869fa5465ac1269ef208f}{instance}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ade8c42a90e871d0a857fc0102347cb25}{\_s\_instance}};\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aaf84e9070be60e425085b2a0706588a6}{create\_tablet}}(\textcolor{keyword}{const}\ TCreateTabletReq\&\ request);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac31f20dae52f77eb818cdb9da8d5f08f}{clear\_transaction\_task}}(\textcolor{keyword}{const}\ TTransactionId\ transaction\_id);}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac31f20dae52f77eb818cdb9da8d5f08f}{clear\_transaction\_task}}(\textcolor{keyword}{const}\ TTransactionId\ transaction\_id,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<TPartitionId>\&\ partition\_ids);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ Note:\ 这里只能reload原先已经存在的root\ path，即re-\/load启动时就登记的root\ path}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ 是允许的，但re-\/load全新的path是不允许的，因为此处没有彻底更新ce调度器信息}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_add65f0025c6ffe1c2ec5da2972d1e7c6}{load\_data\_dirs}}(\textcolor{keyword}{const}\ std::vector<DataDir*>\&\ stores);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{bool}\ include\_unused\ =\ false>}
\DoxyCodeLine{00090\ \ \ \ \ std::vector<DataDir*>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac3020944510dcc372c21c5c8b8a0f1ea}{get\_stores}}();}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ @brief\ 获取所有root\_path信息}}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0e155053ace09e78ef4835b63e0a7641}{get\_all\_data\_dir\_info}}(std::vector<DataDirInfo>*\ data\_dir\_infos,\ \textcolor{keywordtype}{bool}\ need\_update);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a26306149d264c130dc95b913ec35fd34}{get\_file\_or\_directory\_size}}(\textcolor{keyword}{const}\ std::string\&\ file\_path);}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ get\ root\ path\ for\ creating\ tablet.\ The\ returned\ vector\ of\ root\ path\ should\ be\ random,}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ for\ avoiding\ that\ all\ the\ tablet\ would\ be\ deployed\ one\ disk.}}
\DoxyCodeLine{00099\ \ \ \ \ std::vector<DataDir*>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a1fb760cd006379b83efe7d17f031d630}{get\_stores\_for\_create\_tablet}}(TStorageMedium::type\ storage\_medium);}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_acf0481208bc869e6a62f1156e39a6075}{get\_store}}(\textcolor{keyword}{const}\ std::string\&\ path);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a09e265b76d327346fcd3ea0911771b3b}{available\_storage\_medium\_type\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aeead9d94192b999f138c746af886464b}{\_available\_storage\_medium\_type\_count}};}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a4b764e9b37637342e931eb7bd23f0a31}{set\_cluster\_id}}(int32\_t\ cluster\_id);}
\DoxyCodeLine{00107\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a69ef11a9f7ee9fa8a6820d3573e8dee2}{effective\_cluster\_id}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a4474be7cc390c349f5478a0af59ed429}{\_effective\_cluster\_id}};\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a241eac143d09c3515ed13eccae4ebae7}{start\_delete\_unused\_rowset}}();}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ae25de75a436e56c0d8ce7fc9aa519f8f}{add\_unused\_rowset}}(\mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ rowset);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ Obtain\ shard\ path\ for\ new\ tablet.}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//\ @param\ [out]\ shard\_path\ choose\ an\ available\ root\_path\ to\ clone\ new\ tablet}}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{comment}{//\ @return\ error\ code}}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_affd46a07dc80cb994f422f718b333c48}{obtain\_shard\_path}}(TStorageMedium::type\ storage\_medium,\ std::string*\ shared\_path,}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}**\ store);}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{comment}{//\ Load\ new\ tablet\ to\ make\ it\ effective.}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ @param\ [in]\ root\_path\ specify\ root\ path\ of\ new\ tablet}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ @param\ [in]\ request\ specify\ new\ tablet\ info}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ @param\ [in]\ restore\ whether\ we're\ restoring\ a\ tablet\ from\ trash}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ @return\ OK\ if\ load\ tablet\ success}}
\DoxyCodeLine{00125\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a90e699444b71f0b9803455068b77e8b0}{load\_header}}(\textcolor{keyword}{const}\ std::string\&\ shard\_path,\ \textcolor{keyword}{const}\ TCloneReq\&\ request,}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ restore\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_afc9fbbffb61a179078ddf9da1483aa47}{register\_report\_listener}}(\mbox{\hyperlink{classdoris_1_1_task_worker_pool}{TaskWorkerPool}}*\ listener);}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ab5647569de80e04654888983aa8abfde}{deregister\_report\_listener}}(\mbox{\hyperlink{classdoris_1_1_task_worker_pool}{TaskWorkerPool}}*\ listener);}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_abd73d34f0b82c562520fb19c138b54e5}{notify\_listeners}}();}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aa90647ce5a3aa8ae49b79d584fa6c6a1}{execute\_task}}(\mbox{\hyperlink{classdoris_1_1_engine_task}{EngineTask}}*\ task);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_tablet_manager}{TabletManager}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_adc0eb54af3511550e59e94eaa8bfc00a}{tablet\_manager}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aa854613799d995d074124873735f0ed1}{\_tablet\_manager}}.get();\ \}}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_txn_manager}{TxnManager}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a754421c7a0f3aab58b75c88171d5ac2f}{txn\_manager}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0c57060a0661bac75e5864cd8ac48752}{\_txn\_manager}}.get();\ \}}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_mem_table_flush_executor}{MemTableFlushExecutor}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ace76d001c50b8cbcd4658ce44ffb02e8}{memtable\_flush\_executor}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a125e130ce77205976aef791324d433dc}{\_memtable\_flush\_executor}}.get();\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a168e158eabde9164c9de4a6c1f700d85}{check\_rowset\_id\_in\_unused\_rowsets}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aec62eed38358da19acb012f8d5be79bf}{next\_rowset\_id}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac551c8ff295f6886da252596d9533a48}{\_rowset\_id\_generator}}-\/>next\_id();\ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0ec60625b00f541bbf4dcc9074fea9f3}{rowset\_id\_in\_use}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac551c8ff295f6886da252596d9533a48}{\_rowset\_id\_generator}}-\/>id\_in\_use(rowset\_id);}
\DoxyCodeLine{00144\ \ \ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a10a56fbbb9583bdd4768da09540200ca}{release\_rowset\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_rowset_id}{RowsetId}}\&\ rowset\_id)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac551c8ff295f6886da252596d9533a48}{\_rowset\_id\_generator}}-\/>release\_id(rowset\_id);}
\DoxyCodeLine{00148\ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ RowsetTypePB\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aeb8a4c7746ac4d738560e33e854214b3}{default\_rowset\_type}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_storage_engine_ad2dd6ff5f780ba503d776a4ad55b07a2}{\_heartbeat\_flags}}\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad2dd6ff5f780ba503d776a4ad55b07a2}{\_heartbeat\_flags}}-\/>\mbox{\hyperlink{classdoris_1_1_heartbeat_flags_a7d46e9ac26b507005d76045d49a4631a}{is\_set\_default\_rowset\_type\_to\_beta}}())\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ BETA\_ROWSET;}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a66efa23d01fa5c639b4631f60c7efaf4}{\_default\_rowset\_type}};}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac82f2d8c0cc8ee43831339176ef1996d}{set\_heartbeat\_flags}}(\mbox{\hyperlink{classdoris_1_1_heartbeat_flags}{HeartbeatFlags}}*\ heartbeat\_flags)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad2dd6ff5f780ba503d776a4ad55b07a2}{\_heartbeat\_flags}}\ =\ heartbeat\_flags;}
\DoxyCodeLine{00159\ \ \ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ start\ all\ background\ threads.\ This\ should\ be\ call\ after\ env\ is\ ready.}}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a293e850f63fbf6c5faff6e84c619a0a5}{start\_bg\_threads}}();}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ clear\ trash\ and\ snapshot\ file}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ option:\ update\ disk\ usage\ after\ sweep}}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a3906bef167c26fc4c75942c7d91b392f}{start\_trash\_sweep}}(\textcolor{keywordtype}{double}*\ usage,\ \textcolor{keywordtype}{bool}\ ignore\_guard\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a8c528baf37154d347366083f0f816846}{stop}}();}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_afb838c76b25059c7c45876f38b13c896}{create\_cumulative\_compaction}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ best\_tablet,}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<CumulativeCompaction>\&\ cumulative\_compaction);}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a6d3c3ed47bebddfa8c42421acb2f0234}{create\_base\_compaction}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ best\_tablet,}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::shared\_ptr<BaseCompaction>\&\ base\_compaction);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ std::shared\_ptr<StreamLoadRecorder>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ae65a1d770ea39d3d48bfb291572b72b7}{get\_stream\_load\_recorder}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_af2c525beeb8b5a0e946003e56677b0cc}{\_stream\_load\_recorder}};\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ab4c4ec866c9951f206bbadc735e0bad9}{get\_compaction\_status\_json}}(std::string*\ result);}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_af0c12a4b1beb09bb1b28e931dc44bfaf}{segment\_meta\_mem\_tracker}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a723b84d2a0b5e43fa7ce34ce85fdec6b}{\_segment\_meta\_mem\_tracker}};\ \}}
\DoxyCodeLine{00180\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a92cf2aeab8e7f747862f513b1da9794c}{segcompaction\_mem\_tracker}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad8488cc10b082a010f1dc196141ba45d}{\_segcompaction\_mem\_tracker}};\ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{comment}{//\ check\ cumulative\ compaction\ config}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad59393bdfd076a29c90b148ebdde52a3}{check\_cumulative\_compaction\_config}}();}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0c64b00a585a055f83ef024034dfdb5c}{submit\_compaction\_task}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,\ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a156410a96aa07f45bf9de052a3d86c50}{submit\_seg\_compaction\_task}}(\mbox{\hyperlink{classdoris_1_1_beta_rowset_writer}{BetaRowsetWriter}}*\ writer,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a56ea6d7b7fdfea379db2328f8c6c8fb3}{SegCompactionCandidatesSharedPtr}}\ segments);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ std::unique\_ptr<ThreadPool>\&\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a7e0b390fb0ac9719b40755aa8b01e167}{tablet\_publish\_txn\_thread\_pool}}()\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac35d73f96b33bd90546aa90a9e669a02}{\_tablet\_publish\_txn\_thread\_pool}};}
\DoxyCodeLine{00191\ \ \ \ \ \}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ae6e691fc02371cc28d66931ee54c5963}{stopped}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a6c3cac28822b98b8a0861af6ecf71230}{\_stopped}};\ \}}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_thread_pool}{ThreadPool}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac586a29dba9ff89227c74ff4b322e2e6}{get\_bg\_multiget\_threadpool}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a2ab80ad25da3f3abc2840abefc3a3cd5}{\_bg\_multi\_get\_thread\_pool}}.get();\ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ Instance\ should\ be\ inited\ from\ `static\ open()`}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ MUST\ NOT\ be\ called\ in\ other\ circumstances.}}
\DoxyCodeLine{00198\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a963e4c4f53318ab52b14e8035da814d6}{\_open}}();}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ Clear\ status(tables,\ ...)}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ada6768be8b067492c3f7e6e7861091e2}{\_clear}}();}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a9422a9c11198bf4e86002d10170b2a88}{\_init\_store\_map}}();}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a1213c515de9ab171a30d7dc9c1d78a5c}{\_update\_storage\_medium\_type\_count}}();}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ Some\ check\ methods}}
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac368abd1f529daa4badcbe4de303fecd}{\_check\_file\_descriptor\_number}}();}
\DoxyCodeLine{00209\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ae2137ac8a99b3819de9815f9e68fb084}{\_check\_all\_root\_path\_cluster\_id}}();}
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ab34a84694af1972c10d314cb25199945}{\_judge\_and\_update\_effective\_cluster\_id}}(int32\_t\ cluster\_id);}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a143b717cb59227106933004f2982003f}{\_delete\_tablets\_on\_unused\_root\_path}}();}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac4808ff9642003cbd822a760800b6aa1}{\_clean\_unused\_txns}}();}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_acace4e2ceabd460dcc1eed4c192d2392}{\_clean\_unused\_rowset\_metas}}();}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aa89b666a17663cd9f69723c59ab8b584}{\_do\_sweep}}(\textcolor{keyword}{const}\ std::string\&\ scan\_root,\ \textcolor{keyword}{const}\ time\_t\&\ local\_tm\_now,}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ int32\_t\ expire);}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ All\ these\ xxx\_callback()\ functions\ are\ for\ Background\ threads}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{comment}{//\ unused\ rowset\ monitor\ thread}}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a9ab7b6366151ddcbdc2c190b47a825cb}{\_unused\_rowset\_monitor\_thread\_callback}}();}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ garbage\ sweep\ thread\ process\ function.\ clear\ snapshot\ and\ trash\ folder}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ae8ce8140f34ec326f5c15f05f542a8b5}{\_garbage\_sweeper\_thread\_callback}}();}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ delete\ tablet\ with\ io\ error\ process\ function}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a29ee6c864bb8632319e3444005d352fb}{\_disk\_stat\_monitor\_thread\_callback}}();}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{comment}{//\ clean\ file\ descriptors\ cache}}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aee3b5f8e2e1ff0bc1dade95f0ebc982f}{\_fd\_cache\_clean\_callback}}();}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ path\ gc\ process\ function}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a65a19cd412bdc50df554d3ae59694ba6}{\_path\_gc\_thread\_callback}}(\mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}*\ data\_dir);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad7d6c62f143760b89111febc0eb837ea}{\_path\_scan\_thread\_callback}}(\mbox{\hyperlink{classdoris_1_1_data_dir}{DataDir}}*\ data\_dir);}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_afe90393f25e6b60cedd7255192fc64a0}{\_tablet\_checkpoint\_callback}}(\textcolor{keyword}{const}\ std::vector<DataDir*>\&\ data\_dirs);}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{comment}{//\ parse\ the\ default\ rowset\ type\ config\ to\ RowsetTypePB}}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a90e52b82bd5c45245a4c213f71d28ab4}{\_parse\_default\_rowset\_type}}();}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a31b591d6906a3673094546394a538f2d}{\_start\_clean\_cache}}();}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac23575d10e0ed5d3f41b2201b6dc6293}{\_start\_clean\_lookup\_cache}}();}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ Disk\ status\ monitoring.\ Monitoring\ unused\_flag\ Road\ King's\ new\ corresponding\ root\_path\ unused\ flag,}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ When\ the\ unused\ mark\ is\ detected,\ the\ corresponding\ table\ information\ is\ deleted\ from\ the\ memory,\ and\ the\ disk\ data\ does\ not\ move.}}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{comment}{//\ When\ the\ disk\ status\ is\ unusable,\ but\ the\ unused\ logo\ is\ not\ \_push\_tablet\_into\_submitted\_compactiondetected,\ you\ need\ to\ download\ it\ from\ root\_path}}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{comment}{//\ Reload\ the\ data.}}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a7e74210a83e105218226ef1e0d2aec4e}{\_start\_disk\_stat\_monitor}}();}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a4d0f9c45381794883748e8e5a02f580f}{\_compaction\_tasks\_producer\_callback}}();}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ std::vector<TabletSharedPtr>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a14bb4963d05584ace6ca16191d779be2}{\_generate\_compaction\_tasks}}(\mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type,}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<DataDir*>\&\ data\_dirs,}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ check\_score);}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a473e9bbd11d024f7b90d2f90692134a5}{\_update\_cumulative\_compaction\_policy}}();}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a536d38b95453885ee5eab57ab3b435ee}{\_push\_tablet\_into\_submitted\_compaction}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac3de8755d19962a330d6cafd27ca8d80}{\_pop\_tablet\_from\_submitted\_compaction}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a210f0f00d6de347c718beffdac9793c3}{\_init\_stream\_load\_recorder}}(\textcolor{keyword}{const}\ std::string\&\ stream\_load\_record\_path);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a5aaaf2ab2e6e636e3cc0c874b6f347e7}{\_submit\_compaction\_task}}(\mbox{\hyperlink{namespacedoris_ad3e800b72ff04da97e09ccc723b2f8cf}{TabletSharedPtr}}\ tablet,\ \mbox{\hyperlink{namespacedoris_a929a7e9658c24d0d1decc37e2955576c}{CompactionType}}\ compaction\_type);}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aeb5abb1bfcb55e602d9c364a9cadc16b}{\_adjust\_compaction\_thread\_num}}();}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a3a6a1b3f70d9c12a195493368ac36015}{\_cooldown\_tasks\_producer\_callback}}();}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_afe5f415f466c16b9bd61b2d617305e48}{\_remove\_unused\_remote\_files\_callback}}();}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac28485d9b17a5aaaef89308f2f095e69}{\_cold\_data\_compaction\_producer\_callback}}();}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a20b214871f91717c0608d85267527915}{\_cache\_file\_cleaner\_tasks\_producer\_callback}}();}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aa1e24139652d85ecf111df5cd3f6a120}{\_handle\_seg\_compaction}}(\mbox{\hyperlink{classdoris_1_1_beta_rowset_writer}{BetaRowsetWriter}}*\ writer,}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a56ea6d7b7fdfea379db2328f8c6c8fb3}{SegCompactionCandidatesSharedPtr}}\ segments);}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate}{CompactionCandidate}}\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_aa23df78905573e86ef8254c8c94a19cf}{CompactionCandidate}}(uint32\_t\ nicumulative\_compaction\_,\ int64\_t\ tablet\_id\_,\ uint32\_t\ index\_)}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_ad1ab876ee0b60b73ab9ab4e907b5ccac}{nice}}(nicumulative\_compaction\_),\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_a1507735acbeddbdf20663acb53ed7803}{tablet\_id}}(tablet\_id\_),\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_a788d86a8938324718c02fd9328fa5878}{disk\_index}}(index\_)\ \{\}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_ad1ab876ee0b60b73ab9ab4e907b5ccac}{nice}};\ \textcolor{comment}{//\ priority}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ int64\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_a1507735acbeddbdf20663acb53ed7803}{tablet\_id}};}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_a788d86a8938324718c02fd9328fa5878}{disk\_index}}\ =\ -\/1;}
\DoxyCodeLine{00288\ \ \ \ \ \};}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{comment}{//\ In\ descending\ order}}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_comparator}{CompactionCandidateComparator}}\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_comparator_afb54234c0ce05f56dc87f379a0119585}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate}{CompactionCandidate}}\&\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate}{CompactionCandidate}}\&\ b)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{memcpy__aarch64_8cpp_a20972992d1a551bcd609cfb231f91d8a}{a}}.nice\ >\ b.\mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_candidate_ad1ab876ee0b60b73ab9ab4e907b5ccac}{nice}};}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \ \ \};}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat}{CompactionDiskStat}}\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_a6f55b702112bdb2650c5916d2110edae}{CompactionDiskStat}}(std::string\ path,\ uint32\_t\ \mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}},\ \textcolor{keywordtype}{bool}\ used)}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_ad1e3397c8eb864f24e3c2d448be17415}{storage\_path}}(path),}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_a1e46b824b5bfbcc4c5088c10bdeca764}{disk\_index}}(\mbox{\hyperlink{column__vector_8cpp_a9d57133bec333a3eac9e3c1693a5ee38}{index}}),}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_af32bcd3d45abb0a82b3e09c8c747e54d}{task\_running}}(0),}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_a526d41313c9419559b5480f666fe73df}{task\_remaining}}(0),}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_acf2b5453263f7c71b27f5a4e3d00f079}{is\_used}}(used)\ \{\}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_ad1e3397c8eb864f24e3c2d448be17415}{storage\_path}};}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_a1e46b824b5bfbcc4c5088c10bdeca764}{disk\_index}};}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_af32bcd3d45abb0a82b3e09c8c747e54d}{task\_running}};}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ uint32\_t\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_a526d41313c9419559b5480f666fe73df}{task\_remaining}};}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_storage_engine_1_1_compaction_disk_stat_acf2b5453263f7c71b27f5a4e3d00f079}{is\_used}};}
\DoxyCodeLine{00309\ \ \ \ \ \};}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_engine_options}{EngineOptions}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a899c5113b02b2c878388c372b10edbd7}{\_options}};}
\DoxyCodeLine{00312\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a1ed8953daa31eabf1081e80df487f6d8}{\_store\_lock}};}
\DoxyCodeLine{00313\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a68791faddb30eb399d13620fa60eca94}{\_trash\_sweep\_lock}};}
\DoxyCodeLine{00314\ \ \ \ \ std::map<std::string,\ DataDir*>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ab3050314c1f9280e58dea20dc35bbfab}{\_store\_map}};}
\DoxyCodeLine{00315\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aeead9d94192b999f138c746af886464b}{\_available\_storage\_medium\_type\_count}};}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ int32\_t\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a4474be7cc390c349f5478a0af59ed429}{\_effective\_cluster\_id}};}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a42f8476d02f6808bde2b8e9bb2fa255f}{\_is\_all\_cluster\_id\_exist}};}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ade8c42a90e871d0a857fc0102347cb25}{\_s\_instance}};}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a6c3cac28822b98b8a0861af6ecf71230}{\_stopped}};}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a820253226757528cfca2f11db428f718}{\_gc\_mutex}};}
\DoxyCodeLine{00324\ \ \ \ \ \textcolor{comment}{//\ map<rowset\_id(str),\ RowsetSharedPtr>,\ if\ we\ use\ RowsetId\ as\ the\ key,\ we\ need\ custom\ hash\ func}}
\DoxyCodeLine{00325\ \ \ \ \ std::unordered\_map<std::string,\ RowsetSharedPtr>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a3bfa59564ca64c3d1359ea6d9831ee5e}{\_unused\_rowsets}};}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ Count\ the\ memory\ consumption\ of\ segment\ compaction\ tasks.}}
\DoxyCodeLine{00328\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad8488cc10b082a010f1dc196141ba45d}{\_segcompaction\_mem\_tracker}};}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ This\ mem\ tracker\ is\ only\ for\ tracking\ memory\ use\ by\ segment\ meta\ data\ such\ as\ footer\ or\ index\ page.}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{comment}{//\ The\ memory\ consumed\ by\ querying\ is\ tracked\ in\ segment\ iterator.}}
\DoxyCodeLine{00331\ \ \ \ \ std::shared\_ptr<MemTracker>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a723b84d2a0b5e43fa7ce34ce85fdec6b}{\_segment\_meta\_mem\_tracker}};}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_count_down_latch}{CountDownLatch}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a80fc65099569991d39f4b4962819519b}{\_stop\_background\_threads\_latch}};}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a2efae76967aff4fd518faf1bed7b0339}{\_unused\_rowset\_monitor\_thread}};}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ thread\ to\ monitor\ snapshot\ expiry}}
\DoxyCodeLine{00336\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a50139c39ab6c785fc9ac8cebc4b3672b}{\_garbage\_sweeper\_thread}};}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{comment}{//\ thread\ to\ monitor\ disk\ stat}}
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a1dcbaffdd8dd6461835d6947945b48db}{\_disk\_stat\_monitor\_thread}};}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{comment}{//\ thread\ to\ produce\ both\ base\ and\ cumulative\ compaction\ tasks}}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a769cc3355f92213f6761461f0a9d2dac}{\_compaction\_tasks\_producer\_thread}};}
\DoxyCodeLine{00341\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a19efc3dcabc2a880abe463cf06062c8f}{\_fd\_cache\_clean\_thread}};}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{comment}{//\ threads\ to\ clean\ all\ file\ descriptor\ not\ actively\ in\ use}}
\DoxyCodeLine{00343\ \ \ \ \ std::vector<scoped\_refptr<Thread>>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aecd990f8cdcc2180d5aa9284043e46b3}{\_path\_gc\_threads}};}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ threads\ to\ scan\ disk\ paths}}
\DoxyCodeLine{00345\ \ \ \ \ std::vector<scoped\_refptr<Thread>>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a163a7bf38279fd7c13ad2e62d24ea427}{\_path\_scan\_threads}};}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ thread\ to\ produce\ tablet\ checkpoint\ tasks}}
\DoxyCodeLine{00347\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0c224ca4ab7c56770d6212e238101708}{\_tablet\_checkpoint\_tasks\_producer\_thread}};}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{comment}{//\ thread\ to\ clean\ tablet\ lookup\ cache}}
\DoxyCodeLine{00349\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a7eea4a768377dd65cbb24982bdb91f35}{\_lookup\_cache\_clean\_thread}};}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{comment}{//\ For\ tablet\ and\ disk-\/stat\ report}}
\DoxyCodeLine{00352\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad40b75f3fa7a478aba56c328713431ef}{\_report\_mtx}};}
\DoxyCodeLine{00353\ \ \ \ \ std::set<TaskWorkerPool*>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a07eead1a6e0c547e098530d119c6390a}{\_report\_listeners}};}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a012231260adfae238a084f5824f3a697}{\_engine\_task\_mutex}};}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ std::unique\_ptr<TabletManager>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aa854613799d995d074124873735f0ed1}{\_tablet\_manager}};}
\DoxyCodeLine{00358\ \ \ \ \ std::unique\_ptr<TxnManager>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a0c57060a0661bac75e5864cd8ac48752}{\_txn\_manager}};}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ std::unique\_ptr<RowsetIdGenerator>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac551c8ff295f6886da252596d9533a48}{\_rowset\_id\_generator}};}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ std::unique\_ptr<MemTableFlushExecutor>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a125e130ce77205976aef791324d433dc}{\_memtable\_flush\_executor}};}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ Used\ to\ control\ the\ migration\ from\ segment\_v1\ to\ segment\_v2,\ can\ be\ deleted\ in\ futrue.}}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ Type\ of\ new\ loaded\ data}}
\DoxyCodeLine{00366\ \ \ \ \ RowsetTypePB\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a66efa23d01fa5c639b4631f60c7efaf4}{\_default\_rowset\_type}};}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_heartbeat_flags}{HeartbeatFlags}}*\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ad2dd6ff5f780ba503d776a4ad55b07a2}{\_heartbeat\_flags}};}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac4d9b438da0151aac611e3b7598961ed}{\_base\_compaction\_thread\_pool}};}
\DoxyCodeLine{00371\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a874a98780859b34350d7193c4749f70a}{\_cumu\_compaction\_thread\_pool}};}
\DoxyCodeLine{00372\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac7d1a0559bba12737bb9734d3d7a7214}{\_seg\_compaction\_thread\_pool}};}
\DoxyCodeLine{00373\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_adb6ae9d035d8cbc1a7fdc0e6ecb79472}{\_cold\_data\_compaction\_thread\_pool}};}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ac35d73f96b33bd90546aa90a9e669a02}{\_tablet\_publish\_txn\_thread\_pool}};}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aff76b62831823f15e40a74762fa20ff3}{\_tablet\_meta\_checkpoint\_thread\_pool}};}
\DoxyCodeLine{00378\ \ \ \ \ std::unique\_ptr<ThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a2ab80ad25da3f3abc2840abefc3a3cd5}{\_bg\_multi\_get\_thread\_pool}};}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_compaction_permit_limiter}{CompactionPermitLimiter}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_af11a5830368084081ca8aeda679ce9fa}{\_permit\_limiter}};}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a9487ac2c1ae8fce81ee16521b80176df}{\_tablet\_submitted\_compaction\_mutex}};}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{comment}{//\ a\ tablet\ can\ do\ base\ and\ cumulative\ compaction\ at\ same\ time}}
\DoxyCodeLine{00384\ \ \ \ \ std::map<DataDir*,\ std::unordered\_set<TTabletId>>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a831a816d8ae1ec867acf16f969dfdb07}{\_tablet\_submitted\_cumu\_compaction}};}
\DoxyCodeLine{00385\ \ \ \ \ std::map<DataDir*,\ std::unordered\_set<TTabletId>>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_adeec9bf2d758348c3117ae7598354507}{\_tablet\_submitted\_base\_compaction}};}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \ \ std::atomic<int32\_t>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a96853162015371e2fd5605a5e21ca112}{\_wakeup\_producer\_flag}}\ \{0\};}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a9236d12b082aed146867816f5afcfbf6}{\_compaction\_producer\_sleep\_mutex}};}
\DoxyCodeLine{00390\ \ \ \ \ std::condition\_variable\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a62893c3a479f2254b7abdbf161313394}{\_compaction\_producer\_sleep\_cv}};}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ std::shared\_ptr<StreamLoadRecorder>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_af2c525beeb8b5a0e946003e56677b0cc}{\_stream\_load\_recorder}};}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ std::shared\_ptr<CumulativeCompactionPolicy>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a5f7049fba2a8f6b729da830935edab20}{\_cumulative\_compaction\_policy}};}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ab76fa3498e2aaa8cf7f3c818c7859253}{\_cooldown\_tasks\_producer\_thread}};}
\DoxyCodeLine{00397\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a5b6427b52b563c6977c4a59ffc15bea8}{\_remove\_unused\_remote\_files\_thread}};}
\DoxyCodeLine{00398\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_aef8d050328aaa7f4b7953d4740d0c4ef}{\_cold\_data\_compaction\_producer\_thread}};}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \mbox{\hyperlink{classscoped__refptr}{scoped\_refptr<Thread>}}\ \mbox{\hyperlink{classdoris_1_1_storage_engine_ace8f270358c2c03d0af5ef2bde2d48ee}{\_cache\_file\_cleaner\_tasks\_producer\_thread}};}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ std::unique\_ptr<PriorityThreadPool>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a58b86a415f30c7a5feb16eba5c236541}{\_cooldown\_thread\_pool}};}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a3aa68c6886aac5f0089cdc78d9edcaab}{\_running\_cooldown\_mutex}};}
\DoxyCodeLine{00405\ \ \ \ \ std::unordered\_set<int64\_t>\ \mbox{\hyperlink{classdoris_1_1_storage_engine_a95ae08028b0bfa3be9582f486e10609c}{\_running\_cooldown\_tablets}};}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_storage_engine_a599f0ed23cd0f6976312c9af9cb7570b}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_storage_engine}{StorageEngine}});}
\DoxyCodeLine{00408\ \};}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
