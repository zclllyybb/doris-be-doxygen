\hypertarget{beta__rowset__reader_8h_source}{}\doxysection{beta\+\_\+rowset\+\_\+reader.\+h}
\label{beta__rowset__reader_8h_source}\index{/Users/dabowang/doris/be/src/olap/rowset/beta\_rowset\_reader.h@{/Users/dabowang/doris/be/src/olap/rowset/beta\_rowset\_reader.h}}
\mbox{\hyperlink{beta__rowset__reader_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{iterators_8h}{olap/iterators.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{row__cursor_8h}{olap/row\_cursor.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{beta__rowset_8h}{olap/rowset/beta\_rowset.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rowset__reader_8h}{olap/rowset/rowset\_reader.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{segment__loader_8h}{olap/segment\_loader.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_beta_rowset_reader}{BetaRowsetReader}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_rowset_reader}{RowsetReader}}\ \{}
\DoxyCodeLine{00029\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader}{BetaRowsetReader}}(\mbox{\hyperlink{namespacedoris_a63bc857fa165fd56f92c831a5e9cccc9}{BetaRowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ac44ce0a6a87867b082686ba693aa7f5c}{rowset}});}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a2bc0c9d75b0ae33fa2c9930278061f8d}{\string~BetaRowsetReader}}()\textcolor{keyword}{\ override\ }\{\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}}-\/>release();\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ab6ac050acaddf06bb0d54cf71bdc5c89}{init}}(\mbox{\hyperlink{structdoris_1_1_rowset_reader_context}{RowsetReaderContext}}*\ read\_context,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<int,\ int>\&\ segment\_offset)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a775afcdfbd4347fbc99ce7610a764d7f}{get\_segment\_iterators}}(\mbox{\hyperlink{structdoris_1_1_rowset_reader_context}{RowsetReaderContext}}*\ read\_context,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<RowwiseIteratorUPtr>*\ out\_iters,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::pair<int,\ int>\&\ segment\_offset,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ use\_cache\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf1e932b3f1e29b02ae4e62054d27f63}{reset\_read\_options}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ae92fd3d4cc58175fa8798d3ab89bc963}{next\_block}}(\mbox{\hyperlink{classdoris_1_1vectorized_1_1_block}{vectorized::Block}}*\ block)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_af7bf0e8e94bcdb74a2009e444b3577c7}{next\_block\_view}}(\mbox{\hyperlink{namespacedoris_1_1vectorized_a569e06d56f24549c06999c8088cad239}{vectorized::BlockView}}*\ block\_view)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a445e48a7119358b26df842130d857ee5}{support\_return\_data\_by\_ref}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a1420da29b89bc0b958721f2a77134791}{\_iterator}}-\/>support\_return\_data\_by\_ref();\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a5f10043b6947d4d94b09c05cb880ac22}{delete\_flag}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}}-\/>delete\_flag();\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_version}{Version}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ad4e53d205365a6c7ffc53aa066b48deb}{version}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}}-\/>version();\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a196b484e07aec0e3e4debaadf593cc36}{newest\_write\_timestamp}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}}-\/>newest\_write\_timestamp();\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a45a11d2c52e9b86e26ff0bb6d9c667d2}{RowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ac44ce0a6a87867b082686ba693aa7f5c}{rowset}}()\textcolor{keyword}{\ override\ }\{\ \textcolor{keywordflow}{return}\ std::dynamic\_pointer\_cast<Rowset>(\mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}});\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ total\ number\ of\ filtered\ rows,\ will\ be\ used\ for\ validation\ of\ schema\ change}}
\DoxyCodeLine{00055\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a49e407943de84815fc8b4b48ed57541b}{filtered\_rows}}()\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_a75739f26b3e7994ad5283a02533b2bac}{rows\_del\_filtered}}\ +\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_ab9f5696864aa78369984e36ed6a22ec2}{rows\_del\_by\_bitmap}}\ +}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_a5777dc1aad42ffc6ff62bb141b426033}{rows\_conditions\_filtered}}\ +\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_a212cc16054257e7ee7fc9b2a67cf9cb1}{rows\_vec\_del\_cond\_filtered}}\ +}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_a743c94c430e70242db898e9dca614469}{rows\_vec\_cond\_filtered}}\ +\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}}-\/>\mbox{\hyperlink{structdoris_1_1_olap_reader_statistics_ad0d96b56984fb1b42024ad403c9cf612}{rows\_short\_circuit\_cond\_filtered}};}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ RowsetTypePB\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_abd7a95f06e0daa31383f158500362cc5}{type}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ RowsetTypePB::BETA\_ROWSET;\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a4da4ec7c9a80e73d75120121f9cbd88b}{current\_block\_row\_locations}}(std::vector<RowLocation>*\ locations)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a1420da29b89bc0b958721f2a77134791}{\_iterator}}-\/>current\_block\_row\_locations(locations);}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_afa485e7a8f7343eb684c5be75f1b90a6}{get\_segment\_num\_rows}}(std::vector<uint32\_t>*\ segment\_num\_rows)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ab3e413b100fc461a38662739219b0456}{update\_profile}}(\mbox{\hyperlink{classdoris_1_1_runtime_profile}{RuntimeProfile}}*\ profile)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a4991717acc636b63fb85afa5cd3e02a1}{RowsetReaderSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a7d9550bb5b83cf6f2dd241e2ee03f41a}{clone}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ac52a247b3ae3b461acab11bc10c3c557}{\_should\_push\_down\_value\_predicates}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ std::shared\_ptr<Schema>\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_af54dbc720c35d44be6216dc06961559b}{\_input\_schema}};}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_rowset_reader_context}{RowsetReaderContext}}*\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a7e9e80a68bcce03509bfa65094d0bf33}{\_context}};}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a63bc857fa165fd56f92c831a5e9cccc9}{BetaRowsetSharedPtr}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_acf5cd9510f75e2a02805478d68a51beb}{\_rowset}};}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_olap_reader_statistics}{OlapReaderStatistics}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a820d4634deb1ed9d2aae8aa339732483}{\_owned\_stats}};}
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_olap_reader_statistics}{OlapReaderStatistics}}*\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a9fc4bc32aa7f51c4195e18728653828a}{\_stats}};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ std::unique\_ptr<RowwiseIterator>\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a1420da29b89bc0b958721f2a77134791}{\_iterator}};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ make\ sure\ this\ handle\ is\ initialized\ and\ valid\ before}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ reading\ data.}}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_segment_cache_handle}{SegmentCacheHandle}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ad6dc4023487fa6276cbc14d151855632}{\_segment\_cache\_handle}};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_storage_read_options}{StorageReadOptions}}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_a86a7b3d5e376571e191b3d7d688ddba2}{\_read\_options}};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_beta_rowset_reader_ac22951acafa3d2fe5984fed2dd2ff28f}{\_empty}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00092\ \};}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
