\hypertarget{jni-util_8h_source}{}\doxysection{jni-\/util.h}
\label{jni-util_8h_source}\index{/Users/dabowang/doris/be/src/util/jni-\/util.h@{/Users/dabowang/doris/be/src/util/jni-\/util.h}}
\mbox{\hyperlink{jni-util_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <jni.h>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macros_8h}{gutil/macros.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thrift__util_8h}{util/thrift\_util.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#ifdef\ USE\_HADOOP\_HDFS}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ defined\ in\ hadoop\_hdfs/hdfs.h}}
\DoxyCodeLine{00028\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ JNIEnv*\ getJNIEnv(\textcolor{keywordtype}{void});}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#define\ RETURN\_ERROR\_IF\_EXC(env)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\ \ \ \ do\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ jthrowable\ exc\ =\ (env)-\/>ExceptionOccurred();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ if\ (exc\ !=\ nullptr)\ return\ JniUtil::GetJniExceptionMsg(env);\ \(\backslash\)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \ \ \}\ while\ (false)}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_jni_util}{JniUtil}}\ \{}
\DoxyCodeLine{00040\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_aefec535b0fa4a536f8d9c37ba96cb93c}{Init}}()\ \mbox{\hyperlink{status_8h_a4e0e2d9e1ee0f401844b5b6ff8338f82}{WARN\_UNUSED\_RESULT}};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_aa13e4c7ba0ca0ce00bab7780bc0ea8a7}{throwable\_to\_string\_id}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a34f3491fbd2b375fb8f2c317865036e9}{throwable\_to\_string\_id\_}};\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a9f2cecbb5b92b693bdb7e301667cccdc}{GetJNIEnv}}(JNIEnv**\ env)\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_jni_util_aaf2e485b9225bf186b12f942f0ba1fa9}{tls\_env\_}})\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ *env\ =\ \mbox{\hyperlink{classdoris_1_1_jni_util_aaf2e485b9225bf186b12f942f0ba1fa9}{tls\_env\_}};}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a7d10544063cd71e5f7c52e86de22d7a4}{GetJNIEnvSlowPath}}(env);}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a50cd342ac54e266a057893f5ce483fe5}{GetGlobalClassRef}}(JNIEnv*\ env,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ class\_str,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ jclass*\ class\_ref)\ \mbox{\hyperlink{status_8h_a4e0e2d9e1ee0f401844b5b6ff8338f82}{WARN\_UNUSED\_RESULT}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a17765fc7cb077fd411b8caaa4288e907}{LocalToGlobalRef}}(JNIEnv*\ env,\ jobject\ local\_ref,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ jobject*\ global\_ref)\ \mbox{\hyperlink{status_8h_a4e0e2d9e1ee0f401844b5b6ff8338f82}{WARN\_UNUSED\_RESULT}};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a254caf3b763087407e1f6565b4343781}{GetJniExceptionMsg}}(JNIEnv*\ env,\ \textcolor{keywordtype}{bool}\ log\_stack\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ prefix\ =\ \textcolor{stringliteral}{"{}"{}})\ \mbox{\hyperlink{status_8h_a4e0e2d9e1ee0f401844b5b6ff8338f82}{WARN\_UNUSED\_RESULT}};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ static\ jclass\ \mbox{\hyperlink{classdoris_1_1_jni_util_a3f681c9e2dd8daf414c0f1d6419171bd}{jni\_util\_class}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_util_aab1167a9d65e48e1fb4f9bbda0c661d9}{jni\_util\_cl\_}};\ \}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_ab9202ad7b14c78bd216a48a7be8abe52}{throwable\_to\_stack\_trace\_id}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_util_afc6a2d76a0d040927abfaee6a0214af4}{throwable\_to\_stack\_trace\_id\_}};\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_jni_util_a91f573da4455566af1216e42a43bd911}{INITIAL\_RESERVED\_BUFFER\_SIZE}}\ =\ 1024;}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ TODO:\ we\ need\ a\ heuristic\ strategy\ to\ increase\ buffer\ size\ for\ variable-\/size\ output.}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1_jni_util_a269aa7ffbeb05cd7a51361643d23c1ed}{IncreaseReservedBufferSize}}(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a91f573da4455566af1216e42a43bd911}{INITIAL\_RESERVED\_BUFFER\_SIZE}}\ <<\ n;}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a7d10544063cd71e5f7c52e86de22d7a4}{GetJNIEnvSlowPath}}(JNIEnv**\ env);}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_jni_util_a627a8c9e757e08f3e25ba2d4392d2d63}{jvm\_inited\_}};}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{static}\ jclass\ \mbox{\hyperlink{classdoris_1_1_jni_util_a10400afb58bc5b8bd3cea1f64ec8e6c2}{internal\_exc\_cl\_}};}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{static}\ jclass\ \mbox{\hyperlink{classdoris_1_1_jni_util_ad17dcc497cede6df5e3f991b4cc0d75b}{jni\_native\_method\_exc\_cl\_}};}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{static}\ jclass\ \mbox{\hyperlink{classdoris_1_1_jni_util_aab1167a9d65e48e1fb4f9bbda0c661d9}{jni\_util\_cl\_}};}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_a34f3491fbd2b375fb8f2c317865036e9}{throwable\_to\_string\_id\_}};}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_afc6a2d76a0d040927abfaee6a0214af4}{throwable\_to\_stack\_trace\_id\_}};}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_a819dc5e369cfcf6730163e1ee551dab7}{get\_jvm\_metrics\_id\_}};}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_a743643ad9a10c7f40ef15580299a7a67}{get\_jvm\_threads\_id\_}};}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{static}\ jmethodID\ \mbox{\hyperlink{classdoris_1_1_jni_util_ae4502d1e8aaf3ab3451cb1417f39f443}{get\_jmx\_json\_}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ Thread-\/local\ cache\ of\ the\ JNIEnv\ for\ this\ thread.}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{static}\ \_\_thread\ JNIEnv*\ \mbox{\hyperlink{classdoris_1_1_jni_util_aaf2e485b9225bf186b12f942f0ba1fa9}{tls\_env\_}};}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00090\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard}{JniUtfCharGuard}}\ \{}
\DoxyCodeLine{00091\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_aae23289c82db9d822c064832658325aa}{JniUtfCharGuard}}()\ :\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a04d3eea44c45c031f8df07c8f283bd82}{utf\_chars}}(nullptr)\ \{\}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_ad99f2126c1cf41a8e1a5b4853095f23f}{\string~JniUtfCharGuard}}()\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a04d3eea44c45c031f8df07c8f283bd82}{utf\_chars}}\ !=\ \textcolor{keyword}{nullptr})\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_ae6f0d0cd46e56b7e299b489cb60dd27e}{env}}-\/>ReleaseStringUTFChars(\mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a2885f5df25a14e06d0e445bf9d72fccc}{jstr}},\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a04d3eea44c45c031f8df07c8f283bd82}{utf\_chars}});}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_ab82f21eb451ba79b648261426291c471}{create}}(JNIEnv*\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_ae6f0d0cd46e56b7e299b489cb60dd27e}{env}},\ jstring\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a2885f5df25a14e06d0e445bf9d72fccc}{jstr}},\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard}{JniUtfCharGuard}}*\ out);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a5601aaadfb98dc18126719b38d532638}{get}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a04d3eea44c45c031f8df07c8f283bd82}{utf\_chars}};\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00109\ \ \ \ \ JNIEnv*\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_ae6f0d0cd46e56b7e299b489cb60dd27e}{env}};}
\DoxyCodeLine{00110\ \ \ \ \ jstring\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a2885f5df25a14e06d0e445bf9d72fccc}{jstr}};}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a04d3eea44c45c031f8df07c8f283bd82}{utf\_chars}};}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard_a3b3cb1aa6aaa033ee17d39a5db86732f}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_jni_utf_char_guard}{JniUtfCharGuard}});}
\DoxyCodeLine{00113\ \};}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_jni_local_frame}{JniLocalFrame}}\ \{}
\DoxyCodeLine{00116\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00117\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_acdce6fa4c6a2322c8f115f860453088c}{JniLocalFrame}}()\ :\ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a68ede1944f021f41443d50a85514c6b1}{env\_}}(nullptr)\ \{\}}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a6e9a8f71587069dc610a5f02ae6f0b70}{\string~JniLocalFrame}}()\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classdoris_1_1_jni_local_frame_a68ede1944f021f41443d50a85514c6b1}{env\_}}\ !=\ \textcolor{keyword}{nullptr})\ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a68ede1944f021f41443d50a85514c6b1}{env\_}}-\/>PopLocalFrame(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00120\ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a65e0c2902b4cd9902c8e86aef145ea5b}{JniLocalFrame}}(\mbox{\hyperlink{classdoris_1_1_jni_local_frame}{JniLocalFrame}}\&\&\ other)\ noexcept\ :\ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a68ede1944f021f41443d50a85514c6b1}{env\_}}(other.env\_)\ \{\ other.env\_\ =\ \textcolor{keyword}{nullptr};\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_afce443a9367ec2b44f3ae03a8086ffb0}{push}}(JNIEnv*\ env,\ \textcolor{keywordtype}{int}\ max\_local\_ref\ =\ 10)\ \mbox{\hyperlink{status_8h_a4e0e2d9e1ee0f401844b5b6ff8338f82}{WARN\_UNUSED\_RESULT}};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ private:}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{olap__define_8h_ab0717f0a6d579698f614c7cb05366ea9}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1_jni_local_frame}{JniLocalFrame}});}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ JNIEnv*\ \mbox{\hyperlink{classdoris_1_1_jni_local_frame_a68ede1944f021f41443d50a85514c6b1}{env\_}};}
\DoxyCodeLine{00134\ \};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ template\ <class\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{00137\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{namespacedoris_af86bd44407dda0b28484b88eec776ca7}{SerializeThriftMsg}}(JNIEnv*\ env,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ msg,\ jbyteArray*\ serialized\_msg)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{int}\ buffer\_size\ =\ 100\ *\ 1024;\ \textcolor{comment}{//\ start\ out\ with\ 100KB}}
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_thrift_serializer}{ThriftSerializer}}\ serializer(\textcolor{keyword}{false},\ buffer\_size);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ uint8\_t*\ buffer\ =\ NULL;}
\DoxyCodeLine{00142\ \ \ \ \ uint32\_t\ size\ =\ 0;}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{status_8h_a85f7d0e774e15eb35b74f53264305e16}{RETURN\_IF\_ERROR}}(serializer.\mbox{\hyperlink{classdoris_1_1_thrift_serializer_aad936bd8648f11e75143c7643f04f3a1}{serialize}}(msg,\ \&size,\ \&buffer));}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ that\ 'size'\ is\ within\ the\ limit\ of\ INT\_MAX\ as\ the\ use\ of}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ 'size'\ below\ takes\ int.}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ >\ INT\_MAX)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::InternalError(}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ length\ of\ the\ serialization\ buffer\ (\{\}\ bytes)\ exceeds\ the\ limit\ of\ \{\}\ bytes"{}},}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ size,\ INT\_MAX);}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00154\ \ \ \ \ *serialized\_msg\ =\ env-\/>NewByteArray(size);}
\DoxyCodeLine{00155\ \ \ \ \ \mbox{\hyperlink{jni-util_8h_a2070c5a22a08170e919312a008ce0ce7}{RETURN\_ERROR\_IF\_EXC}}(env);}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{if}\ (*serialized\_msg\ ==\ NULL)\ \textcolor{keywordflow}{return}\ Status::InternalError(\textcolor{stringliteral}{"{}couldn't\ construct\ jbyteArray"{}});}
\DoxyCodeLine{00157\ \ \ \ \ env-\/>SetByteArrayRegion(*serialized\_msg,\ 0,\ size,\ \textcolor{keyword}{reinterpret\_cast<}jbyte*\textcolor{keyword}{>}(buffer));}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{jni-util_8h_a2070c5a22a08170e919312a008ce0ce7}{RETURN\_ERROR\_IF\_EXC}}(env);}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_status_a6ec1a217f203269ab53d2290d602db24}{Status::OK}}();}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
