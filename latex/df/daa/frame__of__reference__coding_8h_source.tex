\hypertarget{frame__of__reference__coding_8h_source}{}\doxysection{frame\+\_\+of\+\_\+reference\+\_\+coding.\+h}
\label{frame__of__reference__coding_8h_source}\index{/Users/dabowang/doris/be/src/util/frame\_of\_reference\_coding.h@{/Users/dabowang/doris/be/src/util/frame\_of\_reference\_coding.h}}
\mbox{\hyperlink{frame__of__reference__coding_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <cstdlib>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{olap_2olap__common_8h}{olap/olap\_common.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uint24_8h}{olap/uint24.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bit__stream__utils_8h}{util/bit\_stream\_utils.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bit__stream__utils_8inline_8h}{util/bit\_stream\_utils.inline.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{faststring_8h}{util/faststring.h}}"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{inline}\ uint8\_t\ \mbox{\hyperlink{namespacedoris_aa10a93abce1cf9d70aeebfc57efaa194}{bits\_less\_than\_64}}(\textcolor{keyword}{const}\ uint64\_t\ v)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordflow}{return}\ v\ ==\ 0\ ?\ 0\ :\ 64\ -\/\ \_\_builtin\_clzll(v);}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{comment}{//\ See\ https://stackoverflow.com/questions/28423405/counting-\/the-\/number-\/of-\/leading-\/zeros-\/in-\/a-\/128-\/bit-\/integer}}
\DoxyCodeLine{00037\ \textcolor{keyword}{inline}\ uint8\_t\ \mbox{\hyperlink{namespacedoris_acd523f26c54bd05d8ae039eb53575e19}{bits\_may\_more\_than\_64}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_aee92dadb31cc06d09b0932b066333595}{uint128\_t}}\ v)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ uint64\_t\ hi\ =\ v\ >>\ 64;}
\DoxyCodeLine{00039\ \ \ \ \ uint64\_t\ lo\ =\ v;}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{int}\ z[3]\ =\ \{\_\_builtin\_clzll(hi),\ \_\_builtin\_clzll(lo)\ +\ 64,\ 128\};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{rowset__tree_8cpp_ae40354a1051342eb5a9db005715dcfa9}{idx}}\ =\ !hi\ +\ ((!lo)\ \&\ (!hi));}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{return}\ 128\ -\/\ z[\mbox{\hyperlink{rowset__tree_8cpp_ae40354a1051342eb5a9db005715dcfa9}{idx}}];}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00046\ uint8\_t\ \mbox{\hyperlink{namespacedoris_a8c21556d9c9324b18cf16b48e5d463ac}{bits}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ v)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{sizeof}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}})\ <=\ 8)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacedoris_aa10a93abce1cf9d70aeebfc57efaa194}{bits\_less\_than\_64}}(v);}
\DoxyCodeLine{00049\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacedoris_acd523f26c54bd05d8ae039eb53575e19}{bits\_may\_more\_than\_64}}(v);}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{comment}{//\ The\ implementation\ for\ frame-\/of-\/reference\ coding}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ The\ detail\ of\ frame-\/of-\/reference\ coding,\ please\ refer\ to}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ https://lemire.me/blog/2012/02/08/effective-\/compression-\/using-\/frame-\/of-\/reference-\/and-\/delta-\/coding/}}
\DoxyCodeLine{00057\ \textcolor{comment}{//\ and\ https://www.elastic.co/cn/blog/frame-\/of-\/reference-\/and-\/roaring-\/bitmaps}}
\DoxyCodeLine{00058\ \textcolor{comment}{//}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ The\ encoded\ data\ format\ is\ as\ follows:}}
\DoxyCodeLine{00060\ \textcolor{comment}{//}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ 1.\ Body:}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ \ \ \ \ \ BitPackingFrame\ *\ FrameCount}}
\DoxyCodeLine{00063\ \textcolor{comment}{//\ 2.\ Footer:}}
\DoxyCodeLine{00064\ \textcolor{comment}{//}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ \ \ \ \ \ (8\ bit\ StorageFormat\ +\ 8\ bit\ BitWidth)\ *\ FrameCount}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ \ \ \ \ \ \ 8\ bit\ FrameValueNum}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ \ \ \ \ \ 32\ bit\ ValuesNum}}
\DoxyCodeLine{00068\ \textcolor{comment}{//}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ There\ are\ currently\ three\ storage\ formats}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ (1)\ if\ the\ StorageFormat\ ==\ 0:\ When\ input\ data\ order\ is\ not\ ascending\ and\ the\ BitPackingFrame\ format\ is:}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ MinValue,\ (Value[i]\ -\/\ MinVale)\ *\ FrameValueNum}}
\DoxyCodeLine{00072\ \textcolor{comment}{//}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ (2)\ if\ the\ StorageFormat\ ==\ 1:\ When\ input\ data\ order\ is\ ascending\ and\ the\ BitPackingFrame\ format\ is:}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ \ \ \ \ \ MinValue,\ (Value[i]\ -\/\ Value[i\ -\/\ 1])\ *\ FrameValueNum}}
\DoxyCodeLine{00075\ \textcolor{comment}{//}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ (3)\ if\ the\ StorageFormat\ ==\ 2:\ \ When\ overflow\ occurs\ when\ using\ (1)\ or\ (2)\ and\ save\ original\ values:}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ \ \ \ \ \ MinValue,\ (Value[i])\ *\ FrameValueNum}}
\DoxyCodeLine{00078\ \textcolor{comment}{//}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ len(MinValue)\ can\ be\ 32(uint32\_t),\ 64(uint64\_t),\ 128(uint128\_t)}}
\DoxyCodeLine{00080\ \textcolor{comment}{//}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ The\ OrderFlag\ is\ 1\ represents\ ascending\ order,\ 0\ represents\ \ not\ ascending\ order}}
\DoxyCodeLine{00082\ \textcolor{comment}{//\ The\ last\ frame\ value\ num\ maybe\ less\ than\ 128}}
\DoxyCodeLine{00083\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00084\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_for_encoder}{ForEncoder}}\ \{}
\DoxyCodeLine{00085\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a0059ff172d4eba4dc6d40f7ffb63be9a}{ForEncoder}}(\mbox{\hyperlink{classdoris_1_1faststring}{faststring}}*\ buffer)\ :\ \mbox{\hyperlink{classdoris_1_1_for_encoder_aec90a62071a76784797192d99a0bb687}{\_buffer}}(buffer)\ \{\}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a65c5020faaff34945414f897cdc7e2c2}{put}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_aacfcf78ab00f1f52e0f538ee83a7299f}{put\_batch}}(\&\mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}},\ 1);\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_aacfcf78ab00f1f52e0f538ee83a7299f}{put\_batch}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}},\ \textcolor{keywordtype}{size\_t}\ count);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ Flushes\ any\ pending\ values\ to\ the\ underlying\ buffer.}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ Returns\ the\ total\ number\ of\ bytes\ written}}
\DoxyCodeLine{00094\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_encoder_acf96a1e8512aee05d4bafb0795a3f4a0}{flush}}();}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{comment}{//\ underlying\ buffer\ size\ +\ footer\ meta\ size.}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ Note:\ should\ call\ this\ method\ before\ flush.}}
\DoxyCodeLine{00098\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_encoder_afa92d3b8548668baf2fe4319db21f4b7}{len}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_aec90a62071a76784797192d99a0bb687}{\_buffer}}-\/>\mbox{\hyperlink{classdoris_1_1faststring_a259cb5a711406a8c3e5d937eb9350cca}{size}}()\ +\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a0e3ad55d7198f1f76b37a62c03e3e87a}{\_storage\_formats}}.size()\ +\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a93abb8dcbbc5b1200692470e1f0b720e}{\_bit\_widths}}.size()\ +\ 5;\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ Resets\ all\ the\ state\ in\ the\ encoder.}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_ac8bb3912a3ce86b15842e79d0b421204}{clear}}()\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_for_encoder_a2b982ba13b5d37a72b1aa2e07cb72bac}{\_values\_num}}\ =\ 0;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_for_encoder_a78dfbc51aee20efaefb0bf91b52d286b}{\_buffered\_values\_num}}\ =\ 0;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_for_encoder_aec90a62071a76784797192d99a0bb687}{\_buffer}}-\/>\mbox{\hyperlink{classdoris_1_1faststring_ac8bb3912a3ce86b15842e79d0b421204}{clear}}();}
\DoxyCodeLine{00105\ \ \ \ \ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a98052429d3059ed79438dd36e4da76ff}{bit\_pack}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ input,\ uint8\_t\ in\_num,\ \textcolor{keywordtype}{int}\ bit\_width,\ uint8\_t*\ output);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a3d12e067f9b6ba83abe0d0662f6299d0}{bit\_packing\_one\_frame\_value}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ input);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a67fbd20ae60e3e654b7e6fc92fc97348}{copy\_value}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ val,\ \textcolor{keywordtype}{size\_t}\ count);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a8e40442c1fa89f4481f4a7109b2408ad}{numeric\_limits\_max}}();}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a2b982ba13b5d37a72b1aa2e07cb72bac}{\_values\_num}}\ =\ 0;}
\DoxyCodeLine{00117\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a78dfbc51aee20efaefb0bf91b52d286b}{\_buffered\_values\_num}}\ =\ 0;}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ uint8\_t\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a4d3efb2c9fd1ef574b48d6f92ee941b6}{FRAME\_VALUE\_NUM}}\ =\ 128;}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a111faba33f505c67f37e9fb4a6cc0dc4}{\_buffered\_values}}[\mbox{\hyperlink{classdoris_1_1_for_encoder_a4d3efb2c9fd1ef574b48d6f92ee941b6}{FRAME\_VALUE\_NUM}}];}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1faststring}{faststring}}*\ \mbox{\hyperlink{classdoris_1_1_for_encoder_aec90a62071a76784797192d99a0bb687}{\_buffer}};}
\DoxyCodeLine{00122\ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a0e3ad55d7198f1f76b37a62c03e3e87a}{\_storage\_formats}};}
\DoxyCodeLine{00123\ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{classdoris_1_1_for_encoder_a93abb8dcbbc5b1200692470e1f0b720e}{\_bit\_widths}};}
\DoxyCodeLine{00124\ \};}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00127\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_for_decoder}{ForDecoder}}\ \{}
\DoxyCodeLine{00128\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_abf1721842b3d87e99d887d4b2e34ffec}{ForDecoder}}(\textcolor{keyword}{const}\ uint8\_t*\ in\_buffer,\ \textcolor{keywordtype}{size\_t}\ buffer\_len)}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a16d167163eba2e86bd54d6e2b5408f42}{\_buffer}}(in\_buffer),\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a9821467c034cf46f1f9e8b96b3887513}{\_buffer\_len}}(buffer\_len),\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a3138d883795a00f556d19da078f528d0}{\_parsed}}(false)\ \{\}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ read\ footer\ metadata}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_aee8048628ff2b5c026c9e15acdcaacb8}{init}}();}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_ae2ecc3b3006807c61895867e6f7cfb95}{get}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ val)\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a40573cdc2ffe73085d7e62b9e0205164}{get\_batch}}(val,\ 1);\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Gets\ the\ next\ batch\ value.\ \ Returns\ false\ if\ there\ are\ no\ more.}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a40573cdc2ffe73085d7e62b9e0205164}{get\_batch}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ val,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a221a86778d8ac4f438cd9fae872615ae}{count}});}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ The\ skip\_num\ is\ positive\ means\ move\ forwards}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ The\ skip\_num\ is\ negative\ means\ move\ backwards}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a22d3ec5476114766afb7882bc8a67c69}{skip}}(int32\_t\ skip\_num);}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_acfd5ce11df0e348960bfb9530313dc9f}{seek\_at\_or\_after\_value}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}},\ \textcolor{keywordtype}{bool}*\ exact\_match);}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a80c6c80ad4c845697dcd7b678bb9e4d1}{current\_index}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a1b50683aee1533ffc4a4805761849f1b}{\_current\_index}};\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a221a86778d8ac4f438cd9fae872615ae}{count}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a2b982ba13b5d37a72b1aa2e07cb72bac}{\_values\_num}};\ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a50feb1a035b8e08850e1f826ae6ada53}{bit\_unpack}}(\textcolor{keyword}{const}\ uint8\_t*\ input,\ uint8\_t\ in\_num,\ \textcolor{keywordtype}{int}\ bit\_width,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ output);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_af51684fb4b41d5eeccf33347fdf77150}{frame\_size}}(uint32\_t\ frame\_index)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (frame\_index\ ==\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a432d1b39e31280d1fd41f6d87a39ad81}{\_frame\_count}}\ -\/\ 1)\ ?\ \mbox{\hyperlink{classdoris_1_1_for_decoder_ac970ef76a073219458b02f966571cc78}{\_last\_frame\_size}}\ :\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a037d7e11400125bd284ca47d5a7645e3}{\_max\_frame\_size}};}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_af53c70ca8c27bbedffffd608d50df5b8}{decode\_current\_frame}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ output);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a616e267186b4fd443827b3ad49e5df71}{decode\_frame\_min\_value}}(uint32\_t\ frame\_index);}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ Return\ index\ of\ the\ last\ frame\ which\ contains\ value\ <\ target.}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ Return\ `\_frame\_count\ -\/\ 1`\ when\ all\ frames\ are\ <\ target.}}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ Return\ `\_frame\_count`\ when\ not\ found\ (all\ frames\ are\ >=\ target).}}
\DoxyCodeLine{00164\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a2bfb770ca8c92c88364cd8178611811d}{seek\_last\_frame\_before\_value}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ target);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ Seek\ to\ the\ first\ value\ in\ frame\ that\ >=\ target.}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ Return\ true\ when\ found\ and\ update\ exact\_match.}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ Return\ false\ otherwise.}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_af9eff18144f68315fcb4a2a6d1b3a565}{seek\_lower\_bound\_inside\_frame}}(uint32\_t\ frame\_index,\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ target,\ \textcolor{keywordtype}{bool}*\ exact\_match);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a9258c8ef7b0e0dab2d0ddbdba4cc37fe}{copy\_value}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ val,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a221a86778d8ac4f438cd9fae872615ae}{count}});}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t*\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a16d167163eba2e86bd54d6e2b5408f42}{\_buffer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a9821467c034cf46f1f9e8b96b3887513}{\_buffer\_len}}\ =\ 0;}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a3138d883795a00f556d19da078f528d0}{\_parsed}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a037d7e11400125bd284ca47d5a7645e3}{\_max\_frame\_size}}\ =\ 0;}
\DoxyCodeLine{00178\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_ac970ef76a073219458b02f966571cc78}{\_last\_frame\_size}}\ =\ 0;}
\DoxyCodeLine{00179\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a2b982ba13b5d37a72b1aa2e07cb72bac}{\_values\_num}}\ =\ 0;}
\DoxyCodeLine{00180\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a432d1b39e31280d1fd41f6d87a39ad81}{\_frame\_count}}\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \ \ std::vector<uint32\_t>\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a921b13b7ee6fc382642a1d8d845e3886}{\_frame\_offsets}};}
\DoxyCodeLine{00182\ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a93abb8dcbbc5b1200692470e1f0b720e}{\_bit\_widths}};}
\DoxyCodeLine{00183\ \ \ \ \ std::vector<uint8\_t>\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a0e3ad55d7198f1f76b37a62c03e3e87a}{\_storage\_formats}};}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_a1b50683aee1533ffc4a4805761849f1b}{\_current\_index}}\ =\ 0;}
\DoxyCodeLine{00186\ \ \ \ \ uint32\_t\ \mbox{\hyperlink{classdoris_1_1_for_decoder_ae61d5ab6423a34824a76bf12cfac6880}{\_current\_decoded\_frame}}\ =\ -\/1;}
\DoxyCodeLine{00187\ \ \ \ \ std::vector<T>\ \mbox{\hyperlink{classdoris_1_1_for_decoder_ad65f8596b78d93eadab0ef1e1368edf9}{\_out\_buffer}};\ \textcolor{comment}{//\ store\ values\ of\ decoded\ frame}}
\DoxyCodeLine{00188\ \};}
\DoxyCodeLine{00189\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
