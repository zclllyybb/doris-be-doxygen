\hypertarget{metrics_8h_source}{}\doxysection{metrics.\+h}
\label{metrics_8h_source}\index{/Users/dabowang/be\_all/util/metrics.h@{/Users/dabowang/be\_all/util/metrics.h}}
\mbox{\hyperlink{metrics_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <rapidjson/document.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <rapidjson/rapidjson.h>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <iomanip>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <ostream>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <set>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{common_2config_8h}{common/config.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{core__local_8h}{util/core\_local.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{histogram_8h}{util/histogram.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{spinlock_8h}{util/spinlock.h}}"{}}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{namespace\ }rj\ =\ RAPIDJSON\_NAMESPACE;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keyword}{class\ }MetricRegistry;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{enum\ class}\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219}{MetricType}}\ \{\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219a125e831262b4dbbd68c6878c5d3759f6}{COUNTER}},\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219a6a91e159ac40f39402ef860163318744}{GAUGE}},\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219a7f33aef6b28f7abec2f5d804ab1343c8}{HISTOGRAM}},\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219a36cbecb886c3fb994669cd10cdbd9f5f}{SUMMARY}},\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219af3445fff58939abbb44a1f8df20a219d}{UNTYPED}}\ \};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{enum\ class}\ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3}{MetricUnit}}\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a5b3b43ddfdecac6712fd1dbc20798e6b}{NANOSECONDS}},}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a98a5b3971201a65b35d420793d7148ea}{MICROSECONDS}},}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3ab4fd5e5c06e72437a57379576df36936}{MILLISECONDS}},}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3aa9126caa6ef3db9cf3c35ac627ad22b5}{SECONDS}},}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a9f1908a641ea399fd2e76f0905c88fcf}{BYTES}},}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3ace4aae3bd64ecf94981ad98294919a63}{ROWS}},}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a6865d19576ae60f95fd4e61333404352}{PERCENT}},}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a25b6f3023ec4ee261bbf92444c7263dc}{REQUESTS}},}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a8381fcacb5d3660664e60f8c139d37d3}{OPERATIONS}},}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a6d133e41aa2591449366e2c277069d50}{BLOCKS}},}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a95d899b2819e6f4deafe314ee31a24bb}{ROWSETS}},}
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a6e505850508af62ec519a2188363274d}{CONNECTIONS}},}
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3aeed0a66a273b71c1e16f14f577b51923}{PACKETS}},}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3aa0a9b23c5666bcd8731940859a369008}{NOUNIT}},}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3a8c4bad9563596861cd35a1829152b866}{FILESYSTEM}}}
\DoxyCodeLine{00062\ \};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ std::ostream\&\ operator<<(std::ostream\&\ os,\ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219}{MetricType}}\ type);}
\DoxyCodeLine{00065\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{namespacedoris_a9cb0490d8ea850253c345a52dcaa4a4c}{unit\_name}}(\mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3}{MetricUnit}}\ unit);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\ =\ std::unordered\_map<std::string,\ std::string>;}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_metric}{Metric}}\ \{}
\DoxyCodeLine{00070\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_ae5a952e1a9465b7e17cb699405d3ff5e}{Metric}}()\ \{\}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_metric_ae615a7fdc939966bf60622482fc75c9f}{\string~Metric}}()\ \{\}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{virtual}\ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_a630c29d66f94446c4292172285d61492}{to\_string}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{virtual}\ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_ae8fef37c0694a8b9b32c36f42102b118}{to\_prometheus}}(\textcolor{keyword}{const}\ std::string\&\ display\_name,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ entity\_labels,}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ metric\_labels)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{virtual}\ rj::Value\ \mbox{\hyperlink{classdoris_1_1_metric_ac9b2edb9b963c14596c2e6f7fe1fb17f}{to\_json\_value}}(rj::Document::AllocatorType\&\ allocator)\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_metric_registry}{MetricRegistry}};}
\DoxyCodeLine{00080\ \};}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{comment}{//\ Metric\ that\ only\ can\ increment}}
\DoxyCodeLine{00083\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00084\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_atomic_metric}{AtomicMetric}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}\ \{}
\DoxyCodeLine{00085\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_metric_adec0b566bad386386d3d337f509b8664}{AtomicMetric}}()\ :\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_ac1d3943636440a3d541416cc7787aa9e}{\_value}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}())\ \{\}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_adb32cb12f4bc58bb7396036dec968e42}{\string~AtomicMetric}}()\ \{\}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_a6ecf47ffd83a4d4f542b276c9aba3b28}{to\_string}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ std::to\_string(\mbox{\hyperlink{classdoris_1_1_atomic_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}());\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.load();\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_a6c7e8662093760ffbf15dfa08ef03eb2}{increment}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ delta)\ \{\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.fetch\_add(delta);\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_aaec56faa8dfb1f0834da74de68cfbeed}{set\_value}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}})\ \{\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_ac1d3943636440a3d541416cc7787aa9e}{\_value}}.store(\mbox{\hyperlink{classdoris_1_1_atomic_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}});\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ rj::Value\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_a8534047da572280c05afd897534d1f8a}{to\_json\_value}}(rj::Document::AllocatorType\&\ allocator)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rj::Value(\mbox{\hyperlink{classdoris_1_1_atomic_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}());}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00102\ \ \ \ \ std::atomic<T>\ \mbox{\hyperlink{classdoris_1_1_atomic_metric_ac1d3943636440a3d541416cc7787aa9e}{\_value}};}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00106\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_lock_simple_metric}{LockSimpleMetric}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}\ \{}
\DoxyCodeLine{00107\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_ad6047aff5af809d3a6eac032b8e93828}{LockSimpleMetric}}()\ :\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_addbff7dde6f134d617689a3e0097e635}{\_value}}(\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}())\ \{\}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_afe05377401dc523662d1c2f93b2ff4c2}{\string~LockSimpleMetric}}()\ \{\}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_a6ecf47ffd83a4d4f542b276c9aba3b28}{to\_string}}()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ std::to\_string(\mbox{\hyperlink{classdoris_1_1_lock_simple_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}());\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ std::lock\_guard<SpinLock>\ l(\mbox{\hyperlink{classdoris_1_1_lock_simple_metric_aaeda4b6262d10eb73734e61e27d42052}{\_lock}});}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_addbff7dde6f134d617689a3e0097e635}{\_value}};}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_a6c7e8662093760ffbf15dfa08ef03eb2}{increment}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ delta)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ std::lock\_guard<SpinLock>\ l(this-\/>\mbox{\hyperlink{classdoris_1_1_lock_simple_metric_aaeda4b6262d10eb73734e61e27d42052}{\_lock}});}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_addbff7dde6f134d617689a3e0097e635}{\_value}}\ +=\ delta;}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_aaec56faa8dfb1f0834da74de68cfbeed}{set\_value}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}})\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ std::lock\_guard<SpinLock>\ l(this-\/>\mbox{\hyperlink{classdoris_1_1_lock_simple_metric_aaeda4b6262d10eb73734e61e27d42052}{\_lock}});}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_addbff7dde6f134d617689a3e0097e635}{\_value}}\ =\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}};}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ rj::Value\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_a8534047da572280c05afd897534d1f8a}{to\_json\_value}}(rj::Document::AllocatorType\&\ allocator)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rj::Value(\mbox{\hyperlink{classdoris_1_1_lock_simple_metric_abcb6b42a914ed14eff8c75f623ca692a}{value}}());}
\DoxyCodeLine{00130\ \ \ \ \ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ We\ use\ spinlock\ instead\ of\ std::atomic\ is\ because\ atomic\ don't\ support}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ double's\ fetch\_add}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ TODO(zc):\ If\ this\ is\ atomic\ is\ bottleneck,\ we\ change\ to\ thread\ local.}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ performance:\ on\ Intel(R)\ Xeon(R)\ CPU\ E5-\/2450\ int64\_t}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ \ original\ type:\ 2ns/op}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ \ single\ thread\ spinlock:\ 26ns/op}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ \ multiple\ thread(8)\ spinlock:\ 2500ns/op}}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classdoris_1_1_spin_lock}{SpinLock}}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_aaeda4b6262d10eb73734e61e27d42052}{\_lock}};}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric_addbff7dde6f134d617689a3e0097e635}{\_value}};}
\DoxyCodeLine{00142\ \};}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00145\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_core_local_counter}{CoreLocalCounter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}\ \{}
\DoxyCodeLine{00146\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_core_local_counter_a08f33a8e7ff85d62611c0bbaee718ce6}{CoreLocalCounter}}()\ \{\}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_ab1f045832864f3c18cc02c37f2ea544d}{\string~CoreLocalCounter}}()\ \{\}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_a6ecf47ffd83a4d4f542b276c9aba3b28}{to\_string}}()\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ std::stringstream\ ss;}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ ss\ <<\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_abcb6b42a914ed14eff8c75f623ca692a}{value}}();}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ss.str();}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_abcb6b42a914ed14eff8c75f623ca692a}{value}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\ sum\ =\ 0;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_ac0277b9bcf2d0a67cad43e4d2311a56b}{\_value}}.size();\ ++i)\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ sum\ +=\ *\mbox{\hyperlink{classdoris_1_1_core_local_counter_ac0277b9bcf2d0a67cad43e4d2311a56b}{\_value}}.access\_at\_core(i);}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sum;}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_a6c7e8662093760ffbf15dfa08ef03eb2}{increment}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ delta)\ \{\ \_\_sync\_fetch\_and\_add(\mbox{\hyperlink{classdoris_1_1_core_local_counter_ac0277b9bcf2d0a67cad43e4d2311a56b}{\_value}}.access(),\ delta);\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_ad20897c5c8bd47f5d4005989bead0e55}{reset}}()\ \{\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_ac0277b9bcf2d0a67cad43e4d2311a56b}{\_value}}.reset();\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ rj::Value\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_a8534047da572280c05afd897534d1f8a}{to\_json\_value}}(rj::Document::AllocatorType\&\ allocator)\textcolor{keyword}{\ const\ override\ }\{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rj::Value(\mbox{\hyperlink{classdoris_1_1_core_local_counter_abcb6b42a914ed14eff8c75f623ca692a}{value}}());}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_core_local_value}{CoreLocalValue<T>}}\ \mbox{\hyperlink{classdoris_1_1_core_local_counter_ac0277b9bcf2d0a67cad43e4d2311a56b}{\_value}};}
\DoxyCodeLine{00174\ \};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_histogram_metric}{HistogramMetric}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}\ \{}
\DoxyCodeLine{00177\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_histogram_metric_aec732c5fbd1f677c7c5d0bf0fc72fab9}{HistogramMetric}}()\ \{\}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a944a844b0e8a43caa987d454af399792}{\string~HistogramMetric}}()\ \{\}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_histogram_metric_ad60fa9d88c0541c63c9a759cbf58ff8c}{HistogramMetric}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric}{HistogramMetric}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_histogram_metric}{HistogramMetric}}\&\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_acab1eb86f529f8502506723dce172434}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric}{HistogramMetric}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_ac8bb3912a3ce86b15842e79d0b421204}{clear}}();}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5a2b7a58dc85678d08752945ff655362}{is\_empty}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_abec6b3fb4583b6ded872b07dcc17b17c}{add}}(\textcolor{keyword}{const}\ uint64\_t\&\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}});}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_ac66ae1874525f2424eac35acf4ba517c}{merge}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric}{HistogramMetric}}\&\ other);}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_ab316e66c0c8c855a722c830299470672}{set\_histogram}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_histogram_stat}{HistogramStat}}\&\ stats);}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a1ec54e2f56ddd0a6ec295d9b73cb3056}{min}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5156f42c4d6a4d753cdfbe8bf8adf487}{\_stats}}.\mbox{\hyperlink{structdoris_1_1_histogram_stat_a1ec54e2f56ddd0a6ec295d9b73cb3056}{min}}();\ \}}
\DoxyCodeLine{00191\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5af017a55ccf5d58951be6316583bc17}{max}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5156f42c4d6a4d753cdfbe8bf8adf487}{\_stats}}.\mbox{\hyperlink{structdoris_1_1_histogram_stat_a5af017a55ccf5d58951be6316583bc17}{max}}();\ \}}
\DoxyCodeLine{00192\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_aaef4cc3b8ed068cd9ab2b65395a13ef6}{num}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5156f42c4d6a4d753cdfbe8bf8adf487}{\_stats}}.\mbox{\hyperlink{structdoris_1_1_histogram_stat_aaef4cc3b8ed068cd9ab2b65395a13ef6}{num}}();\ \}}
\DoxyCodeLine{00193\ \ \ \ \ uint64\_t\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_ab0ab056b6809e881ae933f26701e4cd3}{sum}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5156f42c4d6a4d753cdfbe8bf8adf487}{\_stats}}.\mbox{\hyperlink{structdoris_1_1_histogram_stat_ab0ab056b6809e881ae933f26701e4cd3}{sum}}();\ \}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a9e977d0b6e4c5d3b36051b9e59d34baa}{median}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a8195dc5b60bb3ed25f962cb5ba82510b}{percentile}}(\textcolor{keywordtype}{double}\ p)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a03896a49e2e6908588ffb81e4f2629e0}{average}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a2f7f5fce2a2ffe91be19eb67bb53d57c}{standard\_deviation}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00198\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a6ecf47ffd83a4d4f542b276c9aba3b28}{to\_string}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00199\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a93c857ac117785df1d19c73f44534124}{to\_prometheus}}(\textcolor{keyword}{const}\ std::string\&\ display\_name,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ entity\_labels,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ metric\_labels)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00201\ \ \ \ \ rj::Value\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a8534047da572280c05afd897534d1f8a}{to\_json\_value}}(rj::Document::AllocatorType\&\ allocator)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keyword}{static}\ std::map<std::string,\ double>\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_aabba5941122177e009274244d2805025}{\_s\_output\_percentiles}};}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classdoris_1_1_spin_lock}{SpinLock}}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_aaeda4b6262d10eb73734e61e27d42052}{\_lock}};}
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_histogram_stat}{HistogramStat}}\ \mbox{\hyperlink{classdoris_1_1_histogram_metric_a5156f42c4d6a4d753cdfbe8bf8adf487}{\_stats}};}
\DoxyCodeLine{00207\ \};}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00210\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_atomic_counter}{AtomicCounter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric}{AtomicMetric}}<T>\ \{}
\DoxyCodeLine{00211\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_counter_a96139be65b6910be39084d5bc1a30615}{AtomicCounter}}()\ \{\}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_atomic_counter_afa5bc4c7db6e420fb655703a7762dc15}{\string~AtomicCounter}}()\ \{\}}
\DoxyCodeLine{00214\ \};}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00217\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_atomic_gauge}{AtomicGauge}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_atomic_metric}{AtomicMetric}}<T>\ \{}
\DoxyCodeLine{00218\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00219\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_atomic_gauge_ad7b35fb29e23cac19d7fb9bd8b910dc1}{AtomicGauge}}()\ :\ \mbox{\hyperlink{classdoris_1_1_atomic_metric}{AtomicMetric}}<\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>()\ \{\}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_atomic_gauge_a61cd2902cb138e075e84d498e706d043}{\string~AtomicGauge}}()\ \{\}}
\DoxyCodeLine{00221\ \};}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00224\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_lock_counter}{LockCounter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric}{LockSimpleMetric}}<T>\ \{}
\DoxyCodeLine{00225\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_lock_counter_afca4617c82b45a89ab516048b1582904}{LockCounter}}()\ :\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric}{LockSimpleMetric}}<\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>()\ \{\}}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_lock_counter_ab9f6472ed43aa00f8add3e9f9636d6e8}{\string~LockCounter}}()\ \{\}}
\DoxyCodeLine{00228\ \};}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{comment}{//\ This\ can\ only\ used\ for\ trival\ type}}
\DoxyCodeLine{00231\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00232\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_lock_gauge}{LockGauge}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric}{LockSimpleMetric}}<T>\ \{}
\DoxyCodeLine{00233\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_lock_gauge_aa00c928a68b786a0c4b264236fa7282c}{LockGauge}}()\ :\ \mbox{\hyperlink{classdoris_1_1_lock_simple_metric}{LockSimpleMetric}}<\mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}>()\ \{\}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_lock_gauge_a45edc58738fe957a0119ea52260b5cb5}{\string~LockGauge}}()\ \{\}}
\DoxyCodeLine{00236\ \};}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_core_local_counter}{IntCounter}}\ =\ \mbox{\hyperlink{classdoris_1_1_core_local_counter}{CoreLocalCounter<int64\_t>}};}
\DoxyCodeLine{00239\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_atomic_counter}{IntAtomicCounter}}\ =\ \mbox{\hyperlink{classdoris_1_1_atomic_counter}{AtomicCounter<int64\_t>}};}
\DoxyCodeLine{00240\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_core_local_counter}{UIntCounter}}\ =\ \mbox{\hyperlink{classdoris_1_1_core_local_counter}{CoreLocalCounter<uint64\_t>}};}
\DoxyCodeLine{00241\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_lock_counter}{DoubleCounter}}\ =\ \mbox{\hyperlink{classdoris_1_1_lock_counter}{LockCounter<double>}};}
\DoxyCodeLine{00242\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_atomic_gauge}{IntGauge}}\ =\ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{AtomicGauge<int64\_t>}};}
\DoxyCodeLine{00243\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_atomic_gauge}{UIntGauge}}\ =\ \mbox{\hyperlink{classdoris_1_1_atomic_gauge}{AtomicGauge<uint64\_t>}};}
\DoxyCodeLine{00244\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classdoris_1_1_lock_gauge}{DoubleGauge}}\ =\ \mbox{\hyperlink{classdoris_1_1_lock_gauge}{LockGauge<double>}};}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\ =\ std::unordered\_map<std::string,\ std::string>;}
\DoxyCodeLine{00247\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}\ \{}
\DoxyCodeLine{00248\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a96c6d7613abc00e12e6c5c1383ae47e2}{MetricPrototype}}(\mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219}{MetricType}}\ type\_,\ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3}{MetricUnit}}\ unit\_,\ std::string\ name\_,}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ description\_\ =\ \textcolor{stringliteral}{"{}"{}},\ std::string\ group\_name\_\ =\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\ labels\_\ =\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}(),\ \textcolor{keywordtype}{bool}\ is\_core\_metric\_\ =\ \textcolor{keyword}{false})}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_ad65e4671e7b32316ad9f3a044f26d139}{is\_core\_metric}}(is\_core\_metric\_),}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_aaa82748ba917bac9859ba8499c6fcb52}{type}}(type\_),}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a81017f644a9bb21dbba864c2ba3e5e16}{unit}}(unit\_),}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a9b45b3e13bd9167aab02e17e08916231}{name}}(std::move(name\_)),}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a2e1454f6988673f814408646edaeb320}{description}}(std::move(description\_)),}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}}(std::move(group\_name\_)),}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_af673a43ff01927c755b1815c6cc6ebb1}{labels}}(std::move(labels\_))\ \{\}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a1de9e619d27c68a39235466c2079d209}{simple\_name}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00261\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a0293c3055f1890db72280d2dafd24786}{combine\_name}}(\textcolor{keyword}{const}\ std::string\&\ registry\_name)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00262\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a4b1d5ad04f0f4f9b48ceb5d40510beeb}{to\_prometheus}}(\textcolor{keyword}{const}\ std::string\&\ registry\_name)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_ad65e4671e7b32316ad9f3a044f26d139}{is\_core\_metric}};}
\DoxyCodeLine{00265\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a5a73aada416b5b8e3f549fb0caf28219}{MetricType}}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_aaa82748ba917bac9859ba8499c6fcb52}{type}};}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adc4ead501e401e40d5a4d1fa5cc647f3}{MetricUnit}}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a81017f644a9bb21dbba864c2ba3e5e16}{unit}};}
\DoxyCodeLine{00267\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{00268\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a2e1454f6988673f814408646edaeb320}{description}};}
\DoxyCodeLine{00269\ \ \ \ \ std::string\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}};}
\DoxyCodeLine{00270\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_af673a43ff01927c755b1815c6cc6ebb1}{labels}};}
\DoxyCodeLine{00271\ \};}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \textcolor{preprocessor}{\#define\ DEFINE\_METRIC\_PROTOTYPE(name,\ type,\ unit,\ desc,\ group,\ labels,\ core)\ \(\backslash\)}}
\DoxyCodeLine{00274\ \textcolor{preprocessor}{\ \ \ \ ::doris::MetricPrototype\ METRIC\_\#\#name(type,\ unit,\ \#name,\ desc,\ group,\ labels,\ core)}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \textcolor{preprocessor}{\#define\ DEFINE\_COUNTER\_METRIC\_PROTOTYPE\_2ARG(name,\ unit)\ \(\backslash\)}}
\DoxyCodeLine{00277\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::COUNTER,\ unit,\ "{}"{}},\ "{}"{},\ Labels(),\ false)}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \textcolor{preprocessor}{\#define\ DEFINE\_COUNTER\_METRIC\_PROTOTYPE\_3ARG(name,\ unit,\ desc)\ \(\backslash\)}}
\DoxyCodeLine{00280\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::COUNTER,\ unit,\ desc,\ "{}"{}},\ Labels(),\ false)}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \textcolor{preprocessor}{\#define\ DEFINE\_COUNTER\_METRIC\_PROTOTYPE\_5ARG(name,\ unit,\ desc,\ group,\ labels)\ \(\backslash\)}}
\DoxyCodeLine{00283\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::COUNTER,\ unit,\ desc,\ \#group,\ labels,\ false)}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \textcolor{preprocessor}{\#define\ DEFINE\_GAUGE\_METRIC\_PROTOTYPE\_2ARG(name,\ unit)\ \(\backslash\)}}
\DoxyCodeLine{00286\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::GAUGE,\ unit,\ "{}"{}},\ "{}"{},\ Labels(),\ false)}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \textcolor{preprocessor}{\#define\ DEFINE\_GAUGE\_CORE\_METRIC\_PROTOTYPE\_2ARG(name,\ unit)\ \(\backslash\)}}
\DoxyCodeLine{00289\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::GAUGE,\ unit,\ "{}"{}},\ "{}"{},\ Labels(),\ true)}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \textcolor{preprocessor}{\#define\ DEFINE\_GAUGE\_METRIC\_PROTOTYPE\_3ARG(name,\ unit,\ desc)\ \(\backslash\)}}
\DoxyCodeLine{00292\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::GAUGE,\ unit,\ desc,\ "{}"{}},\ Labels(),\ false)}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \textcolor{preprocessor}{\#define\ DEFINE\_GAUGE\_METRIC\_PROTOTYPE\_5ARG(name,\ unit,\ desc,\ group,\ labels)\ \(\backslash\)}}
\DoxyCodeLine{00295\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::GAUGE,\ unit,\ desc,\ \#group,\ labels,\ false)}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\#define\ DEFINE\_HISTOGRAM\_METRIC\_PROTOTYPE\_2ARG(name,\ unit)\ \(\backslash\)}}
\DoxyCodeLine{00298\ \textcolor{preprocessor}{\ \ \ \ DEFINE\_METRIC\_PROTOTYPE(name,\ MetricType::HISTOGRAM,\ unit,\ "{}"{}},\ "{}"{},\ Labels(),\ false)}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \textcolor{preprocessor}{\#define\ INT\_COUNTER\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (IntCounter*)(entity-\/>register\_metric<IntCounter>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \textcolor{preprocessor}{\#define\ INT\_GAUGE\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (IntGauge*)(entity-\/>register\_metric<IntGauge>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \textcolor{preprocessor}{\#define\ INT\_DOUBLE\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00307\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (DoubleGauge*)(entity-\/>register\_metric<DoubleGauge>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \textcolor{preprocessor}{\#define\ INT\_UGAUGE\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00310\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (UIntGauge*)(entity-\/>register\_metric<UIntGauge>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \textcolor{preprocessor}{\#define\ INT\_ATOMIC\_COUNTER\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (IntAtomicCounter*)(entity-\/>register\_metric<IntAtomicCounter>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \textcolor{preprocessor}{\#define\ HISTOGRAM\_METRIC\_REGISTER(entity,\ metric)\ \(\backslash\)}}
\DoxyCodeLine{00316\ \textcolor{preprocessor}{\ \ \ \ metric\ =\ (HistogramMetric*)(entity-\/>register\_metric<HistogramMetric>(\&METRIC\_\#\#metric))}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \textcolor{preprocessor}{\#define\ METRIC\_DEREGISTER(entity,\ metric)\ entity-\/>deregister\_metric(\&METRIC\_\#\#metric)}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \textcolor{comment}{//\ For\ 'metrics'\ in\ MetricEntity.}}
\DoxyCodeLine{00321\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_prototype_hash}{MetricPrototypeHash}}\ \{}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_hash_a79bd11acc587ea97eea7341061c90b63}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*\ metric\_prototype)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::hash<std::string>()(metric\_prototype-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}}.empty()}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ?\ metric\_prototype-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a9b45b3e13bd9167aab02e17e08916231}{name}}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ metric\_prototype-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}});}
\DoxyCodeLine{00326\ \ \ \ \ \}}
\DoxyCodeLine{00327\ \};}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_prototype_equal_to}{MetricPrototypeEqualTo}}\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_equal_to_a4a6b8f864bd7bd407f2562573dc0078e}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*\ first,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*\ second)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ first-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}}\ ==\ second-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a71ab2bbca5b93038f8ddbc950605b096}{group\_name}}\ \&\&\ first-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a9b45b3e13bd9167aab02e17e08916231}{name}}\ ==\ second-\/>\mbox{\hyperlink{structdoris_1_1_metric_prototype_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{00332\ \ \ \ \ \}}
\DoxyCodeLine{00333\ \};}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_adbe4198199974239a6213924d2862aae}{MetricMap}}\ =\ std::unordered\_map<\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*,\ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}*,\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_hash}{MetricPrototypeHash}},}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_equal_to}{MetricPrototypeEqualTo}}>;}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \textcolor{keyword}{enum\ class}\ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5}{MetricEntityType}}\ \{\ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5a715c76514601e8aea81451c7edb84c8e}{kServer}},\ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5a969241bd4bc4248b44d8818b96a42db2}{kTablet}}\ \};}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_metric_entity}{MetricEntity}}\ \{}
\DoxyCodeLine{00341\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00342\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_entity_a5ade3c3c1eb18ae308fce89830f60e14}{MetricEntity}}(\mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5}{MetricEntityType}}\ type,\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ labels)}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a82a035668eafeb76ca0d3bd0bf6281bc}{\_type}}(type),\ \mbox{\hyperlink{classdoris_1_1_metric_entity_aaf2ed934b37cbbd236fdd1b01a5f5005}{\_name}}(\mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}}),\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a9c60ed3f37f51f02ff8822fd2d6c4cf2}{\_labels}}(labels)\ \{\}}
\DoxyCodeLine{00344\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_entity_ae723baf196835c8de5379f97599f1348}{\string~MetricEntity}}()\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ metric\ :\ \mbox{\hyperlink{classdoris_1_1_metric_entity_adf6f22d4fe14931ff12abe40740c0173}{\_metrics}})\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ metric.second;}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_aaf2ed934b37cbbd236fdd1b01a5f5005}{\_name}};\ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00353\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}*\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a87544fdb2af791a027581c2c136114ed}{register\_metric}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*\ metric\_type)\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ std::lock\_guard<SpinLock>\ l(\mbox{\hyperlink{classdoris_1_1_metric_entity_aaeda4b6262d10eb73734e61e27d42052}{\_lock}});}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ inserted\_metric\ =\ \mbox{\hyperlink{classdoris_1_1_metric_entity_adf6f22d4fe14931ff12abe40740c0173}{\_metrics}}.insert(std::make\_pair(metric\_type,\ \textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inserted\_metric.second)\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ not\ exist,\ make\ a\ new\ metric\ pointer}}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ inserted\_metric.first-\/>second\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{exp_8c_a0acb682b8260ab1c60b918599864e2e5}{T}}();}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ inserted\_metric.first-\/>second;}
\DoxyCodeLine{00361\ \ \ \ \ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_aa4aaf33d3f8610a9d7fa2ee2ec9e9f9c}{deregister\_metric}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structdoris_1_1_metric_prototype}{MetricPrototype}}*\ metric\_type);}
\DoxyCodeLine{00364\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric}{Metric}}*\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a255f0782fcea49171a46fecd7d83f435}{get\_metric}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}},\ \textcolor{keyword}{const}\ std::string\&\ group\_name\ =\ \textcolor{stringliteral}{"{}"{}})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{comment}{//\ Register\ a\ hook,\ this\ hook\ will\ called\ before\ get\_metric\ is\ called}}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a41f9c981e4a5c5e72c5f136ae6c6cd2b}{register\_hook}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}},\ \textcolor{keyword}{const}\ std::function<\textcolor{keywordtype}{void}()>\&\ hook);}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_ab1e6b42740606bdb55bf2ed57185afdd}{deregister\_hook}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a24dcbf29c0d6cd766009a182a6484e3b}{name}});}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a34b42c59652e4548b808bf883b9bda5d}{trigger\_hook\_unlocked}}(\textcolor{keywordtype}{bool}\ force)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_metric_registry}{MetricRegistry}};}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_entity_hash}{MetricEntityHash}};}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_entity_equal_to}{MetricEntityEqualTo}};}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5}{MetricEntityType}}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a82a035668eafeb76ca0d3bd0bf6281bc}{\_type}};}
\DoxyCodeLine{00377\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_entity_aaf2ed934b37cbbd236fdd1b01a5f5005}{\_name}};}
\DoxyCodeLine{00378\ \ \ \ \ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a9c60ed3f37f51f02ff8822fd2d6c4cf2}{\_labels}};}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classdoris_1_1_spin_lock}{SpinLock}}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_aaeda4b6262d10eb73734e61e27d42052}{\_lock}};}
\DoxyCodeLine{00381\ \ \ \ \ \mbox{\hyperlink{namespacedoris_adbe4198199974239a6213924d2862aae}{MetricMap}}\ \mbox{\hyperlink{classdoris_1_1_metric_entity_adf6f22d4fe14931ff12abe40740c0173}{\_metrics}};}
\DoxyCodeLine{00382\ \ \ \ \ std::map<std::string,\ std::function<void()>>\ \mbox{\hyperlink{classdoris_1_1_metric_entity_a392b739b5239312321843aceee169849}{\_hooks}};}
\DoxyCodeLine{00383\ \};}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_entity_hash}{MetricEntityHash}}\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structdoris_1_1_metric_entity_hash_a05fa24cde545fbcbabcaf4850faedc82}{operator()}}(\textcolor{keyword}{const}\ std::shared\_ptr<MetricEntity>\ metric\_entity)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::hash<std::string>()(metric\_entity-\/>name());}
\DoxyCodeLine{00388\ \ \ \ \ \}}
\DoxyCodeLine{00389\ \};}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structdoris_1_1_metric_entity_equal_to}{MetricEntityEqualTo}}\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structdoris_1_1_metric_entity_equal_to_af1fbbc3eb5bae6184c8e54a82f554ff5}{operator()}}(\textcolor{keyword}{const}\ std::shared\_ptr<MetricEntity>\ first,}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::shared\_ptr<MetricEntity>\ second)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ first-\/>\_type\ ==\ second-\/>\_type\ \&\&\ first-\/>\_name\ ==\ second-\/>\_name\ \&\&}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first-\/>\_labels\ ==\ second-\/>\_labels;}
\DoxyCodeLine{00396\ \ \ \ \ \}}
\DoxyCodeLine{00397\ \};}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacedoris_a1bbf0f49ee9d5a038a5ef97088428431}{EntityMetricsByType}}\ =}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ std::unordered\_map<const\ MetricPrototype*,\ std::vector<std::pair<MetricEntity*,\ Metric*>>,}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_prototype_hash}{MetricPrototypeHash}},\ \mbox{\hyperlink{structdoris_1_1_metric_prototype_equal_to}{MetricPrototypeEqualTo}}>;}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_metric_registry}{MetricRegistry}}\ \{}
\DoxyCodeLine{00404\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00405\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_registry_ac8eab0478fb9e7a6d0c88e04ff4247a0}{MetricRegistry}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{namespacedoris_a8ccf841cb59e451791bcb2e1ac4f1edc}{name}})\ :\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a1b003dc5cfce1a4d8f9a0c4b9b589045}{\_name}}(\mbox{\hyperlink{namespacedoris_a8ccf841cb59e451791bcb2e1ac4f1edc}{name}})\ \{\}}
\DoxyCodeLine{00406\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_registry_a3f601e1750613d5871f9edfb4c1bac04}{\string~MetricRegistry}}();}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ std::shared\_ptr<MetricEntity>\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a84422b81e94a09645aa9a6ce2b45dedb}{register\_entity}}(}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{namespacedoris_a8ccf841cb59e451791bcb2e1ac4f1edc}{name}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ labels\ =\ \{\},}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5}{MetricEntityType}}\ type\ =\ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5a715c76514601e8aea81451c7edb84c8e}{MetricEntityType::kServer}});}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_registry_aea814151e21597b5a31316959adb11d7}{deregister\_entity}}(\textcolor{keyword}{const}\ std::shared\_ptr<MetricEntity>\&\ entity);}
\DoxyCodeLine{00412\ \ \ \ \ std::shared\_ptr<MetricEntity>\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a8a955e951cf1ed3b14e92fb2fd17743b}{get\_entity}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{namespacedoris_a8ccf841cb59e451791bcb2e1ac4f1edc}{name}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_a1c986529df26f73b9cbac620938c7eb3}{Labels}}\&\ labels\ =\ \{\},}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5}{MetricEntityType}}\ type\ =\ \mbox{\hyperlink{namespacedoris_ac1275a00a8c74d3c44cea7b9d77e77b5a715c76514601e8aea81451c7edb84c8e}{MetricEntityType::kServer}});}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a1346142fa5fea74641e7c89b948035c1}{trigger\_all\_hooks}}(\textcolor{keywordtype}{bool}\ force)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_registry_ad9a2e965a29171190142036009777d3f}{to\_prometheus}}(\textcolor{keywordtype}{bool}\ with\_tablet\_metrics\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00418\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a59f889ed851fffb8d0a7f789c1ad248f}{to\_json}}(\textcolor{keywordtype}{bool}\ with\_tablet\_metrics\ =\ \textcolor{keyword}{false})\ \textcolor{keyword}{const};}
\DoxyCodeLine{00419\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_registry_acbd3a6e0cf8c19db98dff97a3b517e22}{to\_core\_string}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00422\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{classdoris_1_1_metric_registry_a1b003dc5cfce1a4d8f9a0c4b9b589045}{\_name}};}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classdoris_1_1_spin_lock}{SpinLock}}\ \mbox{\hyperlink{classdoris_1_1_metric_registry_aaeda4b6262d10eb73734e61e27d42052}{\_lock}};}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{comment}{//\ MetricEntity\ -\/>\ register\ count}}
\DoxyCodeLine{00426\ \ \ \ \ std::unordered\_map<std::shared\_ptr<MetricEntity>,\ int32\_t,\ \mbox{\hyperlink{structdoris_1_1_metric_entity_hash}{MetricEntityHash}},}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structdoris_1_1_metric_entity_equal_to}{MetricEntityEqualTo}}>}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_metric_registry_a3f87fb939cc71fba38e063e113e71e9d}{\_entities}};}
\DoxyCodeLine{00429\ \};}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
