\hypertarget{page__decoder_8h_source}{}\doxysection{page\+\_\+decoder.\+h}
\label{page__decoder_8h_source}\index{/Users/dabowang/doris/be/src/olap/rowset/segment\_v2/page\_decoder.h@{/Users/dabowang/doris/be/src/olap/rowset/segment\_v2/page\_decoder.h}}
\mbox{\hyperlink{page__decoder_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}\ \textcolor{comment}{//\ for\ Status}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{column_8h}{vec/columns/column.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }segment\_v2\ \{}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{comment}{//\ PageDecoder\ is\ used\ to\ decode\ page.}}
\DoxyCodeLine{00027\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder}{PageDecoder}}\ \{}
\DoxyCodeLine{00028\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00029\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a4eae89b23aca18e993e7b67773f6aca9}{PageDecoder}}()\ \{\}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a7729c5a5734a8ded7507845f85b1a8a9}{\string~PageDecoder}}()\ \{\}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ Call\ this\ to\ do\ some\ preparation\ for\ decoder.}}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ eg:\ parse\ data\ page\ header}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ab2f77770a6c9c118512d8969992c6add}{init}}()\ =\ 0;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ Seek\ the\ decoder\ to\ the\ given\ positional\ index\ of\ the\ page.}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ For\ example,\ seek\_to\_position\_in\_page(0)\ seeks\ to\ the\ first}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ stored\ entry.}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ It\ is\ an\ error\ to\ call\ this\ with\ a\ value\ larger\ than\ Count().}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//\ Doing\ so\ has\ undefined\ results.}}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a5ec5785e4ae9c9a4e174ca85539de58b}{seek\_to\_position\_in\_page}}(\textcolor{keywordtype}{size\_t}\ pos)\ =\ 0;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ Seek\ the\ decoder\ to\ the\ given\ value\ in\ the\ page,\ or\ the}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{//\ lowest\ value\ which\ is\ greater\ than\ the\ given\ value.}}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ If\ the\ decoder\ was\ able\ to\ locate\ an\ exact\ match,\ then}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ sets\ *exact\_match\ to\ true.\ Otherwise\ sets\ *exact\_match\ to}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ false,\ to\ indicate\ that\ the\ seeked\ value\ is\ \_after\_\ the}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ requested\ value.}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ If\ the\ given\ value\ is\ less\ than\ the\ lowest\ value\ in\ the\ page,}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ seeks\ to\ the\ start\ of\ the\ page.\ If\ it\ is\ higher\ than\ the\ highest}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ value\ in\ the\ page,\ then\ returns\ Status::NotFound}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ This\ will\ only\ return\ valid\ results\ when\ the\ data\ page}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ consists\ of\ values\ in\ sorted\ order.}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a8a01c69d4de51b4acbc8d304dcb871da}{seek\_at\_or\_after\_value}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{util_2types_8h_adae7202c63102b0934c3ac5be41b0dae}{value}},\ \textcolor{keywordtype}{bool}*\ exact\_match)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}seek\_at\_or\_after\_value"{}});\ \textcolor{comment}{//\ FIXME}}
\DoxyCodeLine{00061\ \ \ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ Seek\ the\ decoder\ forward\ by\ a\ given\ number\ of\ rows,\ or\ to\ the\ end}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ of\ the\ page.\ This\ is\ primarily\ used\ to\ skip\ over\ data.}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ step\ skipped.}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a84a9ff9858eda8f191335c7ff50f142d}{seek\_forward}}(\textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ step\ =\ std::min(n,\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_abc6b43e3711a9c350b8c730a4403f6d7}{count}}()\ -\/\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ae9e9dde596715504f156029fea3404f8}{current\_index}}());}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ DCHECK\_GE(step,\ 0);}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a5ec5785e4ae9c9a4e174ca85539de58b}{seek\_to\_position\_in\_page}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ae9e9dde596715504f156029fea3404f8}{current\_index}}()\ +\ step);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ step;}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a5ddebe5c34cf93afdc03777b86fe934f}{next\_batch}}(\textcolor{keywordtype}{size\_t}*\ n,\ \mbox{\hyperlink{namespacedoris_1_1vectorized_ac01d3bf9792b1f5f19e8acb2a08553a3}{vectorized::MutableColumnPtr}}\&\ dst)\ =\ 0;}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a93a0e78eb936c9f302cf1563dee56e20}{read\_by\_rowids}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedoris_1_1segment__v2_ab2f57641d7ff60f0cdd275edc29f9dc2}{rowid\_t}}*\ rowids,\ \mbox{\hyperlink{namespacedoris_1_1segment__v2_a6304ee7c492e3553f47385124238bf8e}{ordinal\_t}}\ page\_first\_ordinal,\ \textcolor{keywordtype}{size\_t}*\ n,}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedoris_1_1vectorized_ac01d3bf9792b1f5f19e8acb2a08553a3}{vectorized::MutableColumnPtr}}\&\ dst)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}not\ implement\ vec\ op\ now"{}});}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ Same\ as\ `next\_batch`\ except\ for\ not\ moving\ forward\ the\ cursor.}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ When\ read\ array's\ ordinals\ in\ `ArrayFileColumnIterator`,\ we\ want\ to\ read\ one\ extra\ ordinal}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ but\ do\ not\ want\ to\ move\ forward\ the\ cursor.}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_a478a7394f945bb245920226aecd7a7da}{peek\_next\_batch}}(\textcolor{keywordtype}{size\_t}*\ n,\ \mbox{\hyperlink{namespacedoris_1_1vectorized_ac01d3bf9792b1f5f19e8acb2a08553a3}{vectorized::MutableColumnPtr}}\&\ dst)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Status::NotSupported(\textcolor{stringliteral}{"{}not\ implement\ vec\ op\ now"{}});}
\DoxyCodeLine{00086\ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ number\ of\ elements\ in\ this\ page.}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_abc6b43e3711a9c350b8c730a4403f6d7}{count}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{comment}{//\ Return\ the\ position\ within\ the\ page\ of\ the\ currently\ seeked}}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ entry\ (ie\ the\ entry\ that\ will\ next\ be\ returned\ by\ next\_vector())}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ae9e9dde596715504f156029fea3404f8}{current\_index}}()\ \textcolor{keyword}{const}\ =\ 0;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ac8faf4863ba60553d7d1d151d8b0bfef}{has\_remaining}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_ae9e9dde596715504f156029fea3404f8}{current\_index}}()\ <\ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_abc6b43e3711a9c350b8c730a4403f6d7}{count}}();\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder_aa722762e25e2da7a25758fb87255a535}{DISALLOW\_COPY\_AND\_ASSIGN}}(\mbox{\hyperlink{classdoris_1_1segment__v2_1_1_page_decoder}{PageDecoder}});}
\DoxyCodeLine{00099\ \};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \}\ \textcolor{comment}{//\ namespace\ segment\_v2}}
\DoxyCodeLine{00102\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
