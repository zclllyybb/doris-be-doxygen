\hypertarget{es__scan__reader_8h_source}{}\doxysection{es\+\_\+scan\+\_\+reader.\+h}
\label{es__scan__reader_8h_source}\index{/Users/dabowang/doris/be/src/exec/es/es\_scan\_reader.h@{/Users/dabowang/doris/be/src/exec/es/es\_scan\_reader.h}}
\mbox{\hyperlink{es__scan__reader_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{es__scroll__parser_8h}{exec/es/es\_scroll\_parser.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{http__client_8h}{http/http\_client.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris}{doris}}\ \{}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }Status;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1_e_s_scan_reader}{ESScanReader}}\ \{}
\DoxyCodeLine{00032\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a5254bfb10b822a5f1bd2fd1969997b2a}{KEY\_USER\_NAME}}\ =\ \textcolor{stringliteral}{"{}user"{}};}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a429f7abad04af4c96e09a65e9b64ebc3}{KEY\_PASS\_WORD}}\ =\ \textcolor{stringliteral}{"{}password"{}};}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a695e128157ae9e44c3855f5f833d1161}{KEY\_HOST\_PORT}}\ =\ \textcolor{stringliteral}{"{}host\_port"{}};}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a5e033155f0a4cc8ca4427c7bd3c5428a}{KEY\_INDEX}}\ =\ \textcolor{stringliteral}{"{}index"{}};}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a6be41afb0e637e66a289c20ebcbe68c4}{KEY\_TYPE}}\ =\ \textcolor{stringliteral}{"{}type"{}};}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_af7dc038c806a6ebf198bc4417e270746}{KEY\_SHARD}}\ =\ \textcolor{stringliteral}{"{}shard\_id"{}};}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a9f8d2229e31ab4c563680dadf706823a}{KEY\_QUERY}}\ =\ \textcolor{stringliteral}{"{}query"{}};}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a2e1712962ee9cdc03b2fc4c4d81194ac}{KEY\_BATCH\_SIZE}}\ =\ \textcolor{stringliteral}{"{}batch\_size"{}};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a6d650e6d6ca7ab965e4e769db0f934c6}{KEY\_TERMINATE\_AFTER}}\ =\ \textcolor{stringliteral}{"{}limit"{}};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a4ae5db4e96849acc24c6fa9bce070feb}{KEY\_DOC\_VALUES\_MODE}}\ =\ \textcolor{stringliteral}{"{}doc\_values\_mode"{}};}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_afc56477c1a9e50dbe020b497a3e42519}{KEY\_HTTP\_SSL\_ENABLED}}\ =\ \textcolor{stringliteral}{"{}http\_ssl\_enabled"{}};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a6ffe17e3750d1c435e0ba8d041041ffa}{KEY\_QUERY\_DSL}}\ =\ \textcolor{stringliteral}{"{}query\_dsl"{}};}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader}{ESScanReader}}(\textcolor{keyword}{const}\ std::string\&\ target,\ \textcolor{keyword}{const}\ std::map<std::string,\ std::string>\&\ props,}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ doc\_value\_mode);}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a0e5783b1fe7bb05768de7f664956ec6a}{\string~ESScanReader}}();}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ launch\ the\ first\ scroll\ request,\ this\ method\ will\ cache\ the\ first\ scroll\ response,\ and\ return\ the\ this\ cached\ response\ when\ invoke\ get\_next}}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_afbfe7ce3274db0eff63382a83d559439}{open}}();}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ invoke\ get\_next\ to\ get\ next\ batch\ documents\ from\ elasticsearch}}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a3ae9fc2841e130d9ff71a86467bc537c}{get\_next}}(\textcolor{keywordtype}{bool}*\ eos,\ std::unique\_ptr<ScrollParser>\&\ parser);}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ clear\ scroll\ context\ from\ elasticsearch}}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_aee1c6f7d85af14d039dec07dc31ae862}{close}}();}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00057\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a8195d2dd69a17e3d4037fdd75d0005cc}{\_target}};}
\DoxyCodeLine{00058\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a7e417eb546c0ec7ee2bb75c14ba82e0b}{\_user\_name}};}
\DoxyCodeLine{00059\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a9f3504854cbfeb185f8424c00ea2e5d4}{\_passwd}};}
\DoxyCodeLine{00060\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a00af25fcbed83e82690c878d8dfdaac6}{\_scroll\_id}};}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_http_client}{HttpClient}}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a57032d2123635493e60f7bcc457c37ba}{\_network\_client}};}
\DoxyCodeLine{00062\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_ac7c90071eb2989c3841b9e5fbba70b3f}{\_index}};}
\DoxyCodeLine{00063\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a4c686aa2e688932eb399b2ca0a9b39bb}{\_type}};}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ push\ down\ filter}}
\DoxyCodeLine{00065\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a1bcc5a517c37e385e81a45fc9461e8d4}{\_query}};}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Elasticsearch\ shards\ to\ fetch\ document}}
\DoxyCodeLine{00067\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_afb1e7bbda49855a389dee4ae6532e8ba}{\_shards}};}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ whether\ use\ ssl\ client}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a567ce26decc278dd61dff5e44d0503c5}{\_use\_ssl\_client}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ distinguish\ the\ first\ scroll\ phase\ and\ the\ following\ scroll}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_aa5fa5c49385384950ba7fbf33272d73e}{\_is\_first}};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ `\_init\_scroll\_url`\ and\ `\_next\_scroll\_url`\ used\ for\ scrolling\ result\ from\ Elasticsearch}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//In\ order\ to\ use\ scrolling,\ the\ initial\ search\ request\ should\ specify\ the\ scroll\ parameter\ in\ the\ query\ string,}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ which\ tells\ Elasticsearch\ how\ long\ it\ should\ keep\ the\ “search\ context”\ alive:}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ \{index\}/\{type\}/\_search?scroll=5m}}
\DoxyCodeLine{00077\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a6e9c03f02d7204dccf236560ae920077}{\_init\_scroll\_url}};}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ The\ result\ from\ the\ above\ request\ includes\ a\ \_scroll\_id,\ which\ should\ be\ passed\ to\ the\ scroll\ API\ in\ order\ to\ retrieve\ the\ next\ batch\ of\ results}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ \_next\_scroll\_url\ for\ the\ subsequent\ scroll\ request,\ like\ /\_search/scroll}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ POST\ /\_search/scroll}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ \{}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ \ \ \ "{}scroll"{}\ :\ "{}1m"{},}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ \ \ \ "{}scroll\_id"{}\ :\ "{}DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="{}}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ Each\ call\ to\ the\ scroll\ API\ returns\ the\ next\ batch\ of\ results\ until\ there\ are\ no\ more\ results\ left\ to\ return}}
\DoxyCodeLine{00086\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a5cf2f388981f981d383bcf8faf55c01d}{\_next\_scroll\_url}};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ \_search\_url\ used\ to\ execute\ just\ only\ one\ search\ request\ to\ Elasticsearch}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ \_search\_url\ would\ go\ into\ effect\ when\ `limit`\ specified:}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//\ select\ *\ from\ es\_table\ limit\ 10\ -\/>\ /es\_table/doc/\_search?terminate\_after=10}}
\DoxyCodeLine{00091\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_ab5139a1c84c38746be1a4759eba247c4}{\_search\_url}};}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a59e729bde2d28f3c28241aa2f6d36167}{\_eos}};}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_aecf50290bc1f9bfa666a389de9ba117f}{\_batch\_size}};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a8bc817a9ef35b24b75eab78154681ce0}{\_cached\_response}};}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{comment}{//\ keep-\/alive\ for\ es\ scroll}}
\DoxyCodeLine{00097\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a1b4fb36c894726b9941772d83193dc6d}{\_scroll\_keep\_alive}};}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ timeout\ for\ es\ http\ connection}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a611808ba790cb9b460997c050793ac67}{\_http\_timeout\_ms}};}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a7c3e226bb4370aa63d19cfa8aacbe821}{\_exactly\_once}};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1_e_s_scan_reader_a3bfcd6d2180df372da7ae02eb3592a4a}{\_doc\_value\_mode}};}
\DoxyCodeLine{00104\ \};}
\DoxyCodeLine{00105\ \}\ \textcolor{comment}{//\ namespace\ doris}}

\end{DoxyCode}
