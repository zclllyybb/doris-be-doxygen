\hypertarget{tracing_8h_source}{}\doxysection{tracing.\+h}
\label{tracing_8h_source}\index{/Users/dabowang/be\_all/util/debug/tracing.h@{/Users/dabowang/be\_all/util/debug/tracing.h}}
\mbox{\hyperlink{tracing_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Licensed\ to\ the\ Apache\ Software\ Foundation\ (ASF)\ under\ one}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ or\ more\ contributor\ license\ agreements.\ \ See\ the\ NOTICE\ file}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ distributed\ with\ this\ work\ for\ additional\ information}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ regarding\ copyright\ ownership.\ \ The\ ASF\ licenses\ this\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ to\ you\ under\ the\ Apache\ License,\ Version\ 2.0\ (the}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ "{}License"{});\ you\ may\ not\ use\ this\ file\ except\ in\ compliance}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ with\ the\ License.\ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00010\ \textcolor{comment}{//}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ software\ distributed\ under\ the\ License\ is\ distributed\ on\ an}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ "{}AS\ IS"{}\ BASIS,\ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ KIND,\ either\ express\ or\ implied.\ \ See\ the\ License\ for\ the}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ specific\ language\ governing\ permissions\ and\ limitations}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ under\ the\ License.}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <deque>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <list>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <shared\_mutex>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <unordered\_set>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{status_8h}{common/status.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}gen\_cpp/Types\_types.h"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pipeline__task_8h}{pipeline/pipeline\_task.h}}"{}}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ ENABLE\_QUERY\_DEBUG\_TRACE}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{comment}{//\ The\ whole\ function\ is\ control\ by\ marco\ in\ building.\ if\ the\ function\ is\ turned\ off,\ no\ entity\ will\ be\ construct.}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ In\ another\ word,\ it's\ zero-\/overhead.}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedoris_1_1debug}{doris::debug}}\ \{}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{class\ }QueryTraceContext;}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event}{QueryTraceEvent}}\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a9b45b3e13bd9167aab02e17e08916231}{name}};}
\DoxyCodeLine{00047\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ad153dc5a1af8457498a6cecf0dba0b62}{category}};}
\DoxyCodeLine{00048\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ab1aed7fa271dc86295d16cc730100306}{id}};\ \textcolor{comment}{//\ used\ for\ async\ event}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a2ee079546fcae6e5bbb7d9e2bee3a91c}{phase}};\ \textcolor{comment}{//\ type\ of\ event}}
\DoxyCodeLine{00050\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_aff091f79e1f4daabe108ee1262892f9f}{start\_time}};}
\DoxyCodeLine{00051\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a1f342e4e3615abc9314684ce6b4819c0}{duration}}\ =\ -\/1;\ \textcolor{comment}{//\ used\ only\ in\ compelete\ event}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keyword}{decltype}(TUniqueId::lo)\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ae512a49108c8878e8713e6fe22c502c3}{instance\_id}};}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_pipeline_task}{pipeline::PipelineTaskRawPtr}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a34202169701a1e519c18e951490511bf}{task}};\ \textcolor{comment}{//\ task\ pointer}}
\DoxyCodeLine{00054\ \ \ \ \ std::thread::id\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a106b37295dae902beea9f10f7f14ee55}{thread\_id}};}
\DoxyCodeLine{00055\ \ \ \ \ std::vector<std::pair<std::string,\ std::string>>\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a8525243c345162e42eade7439015f1ac}{args}};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_aa454ec5a80b6918ee2a68181f2d14476}{to\_string}}();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event}{QueryTraceEvent}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ad1a80ea210286387eba374cce91fac4b}{create}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a9b45b3e13bd9167aab02e17e08916231}{name}},\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ad153dc5a1af8457498a6cecf0dba0b62}{category}},\ int64\_t\ \textcolor{keywordtype}{id},\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a2ee079546fcae6e5bbb7d9e2bee3a91c}{phase}},}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ timestamp,\ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a1f342e4e3615abc9314684ce6b4819c0}{duration}},\ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ae512a49108c8878e8713e6fe22c502c3}{instance\_id}},\ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_pipeline_task}{pipeline::PipelineTaskRawPtr}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a34202169701a1e519c18e951490511bf}{task}},}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<std::string,\ std::string>>\&\&\ \mbox{\hyperlink{structargs}{args}});}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event}{QueryTraceEvent}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_adfd507d043c265f20787355c1ecae439}{create\_with\_ctx}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a9b45b3e13bd9167aab02e17e08916231}{name}},\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ad153dc5a1af8457498a6cecf0dba0b62}{category}},\ int64\_t\ \textcolor{keywordtype}{id},\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a2ee079546fcae6e5bbb7d9e2bee3a91c}{phase}},}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context}{QueryTraceContext}}\&\ ctx);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event}{QueryTraceEvent}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_adfd507d043c265f20787355c1ecae439}{create\_with\_ctx}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a9b45b3e13bd9167aab02e17e08916231}{name}},\ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ad153dc5a1af8457498a6cecf0dba0b62}{category}},\ int64\_t\ \textcolor{keywordtype}{id},\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a2ee079546fcae6e5bbb7d9e2bee3a91c}{phase}},}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ int64\_t\ start\_ts,\ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_a1f342e4e3615abc9314684ce6b4819c0}{duration}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context}{QueryTraceContext}}\&\ ctx);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00070\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event_ac7f4a07ed75fd0122664655b5984afb7}{args\_to\_string}}();}
\DoxyCodeLine{00071\ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00075\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer}{EventBuffer}}\ \{}
\DoxyCodeLine{00076\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer_a6bef7647650cf8a1257d4856ca14af33}{EventBuffer}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer_afaeca05eabdd7068523f316804f3c052}{\string~EventBuffer}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer_a3a8cef1e316054ea1e0de85745035897}{add}}(\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_event}{QueryTraceEvent}}\&\&\ event);}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace}{QueryTrace}};}
\DoxyCodeLine{00084\ \ \ \ \ std::mutex\ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer_a3f0b4c278cb19f9c2b2dbdb065f51e14}{\_mutex}};}
\DoxyCodeLine{00085\ \ \ \ \ std::deque<QueryTraceEvent>\ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer_a810cdd7e703230d04dc16453229d2665}{\_buffer}};}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace}{QueryTrace}}\ \{}
\DoxyCodeLine{00089\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace}{QueryTrace}}(\textcolor{keyword}{const}\ TUniqueId\&\ query\_id,\ \textcolor{keywordtype}{bool}\ is\_enable);}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_acb6ac613f980740226fae5b40a99d10e}{\string~QueryTrace}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ init\ event\ buffer\ for\ all\ tasks\ in\ a\ single\ fragment\ instance}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a32e1787b17dcca6ddf25b384324763e0}{register\_tasks}}(\textcolor{keyword}{const}\ TUniqueId\&\ fragment\_instance\_id,\ \mbox{\hyperlink{namespacedoris_1_1pipeline_a3f8aa214376682c0e9b8880db095d0f2}{pipeline::PipelineTasks}}\&\ tasks);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1_status}{Status}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a294d09a0a4d21eba79c68cccd72e773f}{dump}}();}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a85cff90a6497da9cddcef63a3a487a8c}{set\_tls\_trace\_context}}(\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace}{QueryTrace}}*\ query\_trace,\ \textcolor{keyword}{const}\ TUniqueId\&\ fragment\_instance\_id,}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_pipeline_task}{pipeline::PipelineTaskRawPtr}}\ task);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#ifdef\ ENABLE\_QUERY\_DEBUG\_TRACE}}
\DoxyCodeLine{00103\ \ \ \ \ TUniqueId\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_ac2bc236893fc726dd0f12dcd7cafab3c}{\_query\_id}};}
\DoxyCodeLine{00104\ \ \ \ \ [[maybe\_unused]]\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a1839fe5cf285851b88f0fe34960c0d3a}{\_is\_enable}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00105\ \ \ \ \ [[maybe\_unused]]\ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a6e8cd7b6dad2e7bf45616c0e1d69f935}{\_start\_ts}}\ =\ -\/1;}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ std::shared\_mutex\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a0829237c98eabf9ce37eeefa2226d65f}{\_mutex}};}
\DoxyCodeLine{00108\ \ \ \ \ std::unordered\_map<pipeline::PipelineTaskRawPtr,\ std::unique\_ptr<EventBuffer>>\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a1bf9a80c17291f966c11fc040443f474}{\_buffers}};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ fragment\_instance\_id\ =>\ task\ list,\ it\ will\ be\ used\ to\ generate\ meta\ event}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ instance\_id\ is\ in\ PipelineFragmentContext}}
\DoxyCodeLine{00112\ \ \ \ \ std::unordered\_map<TUniqueId,\ std::shared\_ptr<std::unordered\_set<pipeline::PipelineTaskRawPtr>>>\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_a51d1b29e9ae9b0700040f7e3d31d14d2}{\_fragment\_tasks}};}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00114\ \};}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer}{ScopedTracer}}\ \{}
\DoxyCodeLine{00117\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer}{ScopedTracer}}(std::string\ \mbox{\hyperlink{namespacedoris_a8ccf841cb59e451791bcb2e1ac4f1edc}{name}},\ std::string\ category);}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer_a43da8b24d84bac93837c445fa98b0b03}{\string~ScopedTracer}}()\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00122\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer_aaf2ed934b37cbbd236fdd1b01a5f5005}{\_name}};}
\DoxyCodeLine{00123\ \ \ \ \ std::string\ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer_adc96d6d757b38d2694e4e2d19e8aedb9}{\_category}};}
\DoxyCodeLine{00124\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer_a6e8cd7b6dad2e7bf45616c0e1d69f935}{\_start\_ts}};}
\DoxyCodeLine{00125\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_scoped_tracer_ae8c4095f96fd7f52e5640de918d03385}{\_duration}}\ =\ -\/1;}
\DoxyCodeLine{00126\ \};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \textcolor{comment}{//\ the\ real\ object\ is\ saved\ in\ bthread\_context,\ a\ thread\_local\ ThreadContext\ object.}}
\DoxyCodeLine{00129\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context}{QueryTraceContext}}\ \{}
\DoxyCodeLine{00130\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a1dd4343e16600980ef3803f4ed025ac5}{DEFAULT\_EVENT\_ID}}\ =\ 0;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a3ae092ec92d3d6c66015db7636e422df}{start\_ts}}\ =\ -\/1;}
\DoxyCodeLine{00134\ \ \ \ \ int64\_t\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a6c3b412b54d77e58f3b0c3f740572078}{fragment\_instance\_id}}\ =\ -\/1;}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1pipeline_1_1_pipeline_task}{pipeline::PipelineTaskRawPtr}}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a34202169701a1e519c18e951490511bf}{task}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00136\ \ \ \ \ int64\_t\ \textcolor{keywordtype}{id}\ =\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a1dd4343e16600980ef3803f4ed025ac5}{DEFAULT\_EVENT\_ID}};\ \textcolor{comment}{//\ used\ for\ async\ event.}}
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_event_buffer}{EventBuffer}}*\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_ac8d92f8b21236594fd3abab680060a2b}{event\_buffer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_ad20897c5c8bd47f5d4005989bead0e55}{reset}}()\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a3ae092ec92d3d6c66015db7636e422df}{start\_ts}}\ =\ -\/1;}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a6c3b412b54d77e58f3b0c3f740572078}{fragment\_instance\_id}}\ =\ -\/1;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a34202169701a1e519c18e951490511bf}{task}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_a1dd4343e16600980ef3803f4ed025ac5}{DEFAULT\_EVENT\_ID}};}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classdoris_1_1debug_1_1_query_trace_context_ac8d92f8b21236594fd3abab680060a2b}{event\_buffer}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ \};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{comment}{//\ //\ any\ time\ we\ need\ the\ trace\ context\ of\ current\ query/fragment/task...,\ tls\_trace\_ctx\ is\ it.}}
\DoxyCodeLine{00149\ \textcolor{comment}{//\ inline\ thread\_local\ QueryTraceContext\ tls\_trace\_ctx;}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \textcolor{preprocessor}{\#define\ INTERNAL\_CREATE\_EVENT\_WITH\_CTX(name,\ category,\ phase,\ ctx)\ \(\backslash\)}}
\DoxyCodeLine{00152\ \textcolor{preprocessor}{\ \ \ \ doris::debug::QueryTraceEvent::create\_with\_ctx(name,\ category,\ ctx.DEFAULT\_EVENT\_ID,\ phase,\ ctx)}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\#define\ INTERNAL\_CREATE\_ASYNC\_EVENT\_WITH\_CTX(name,\ category,\ id,\ phase,\ ctx)\ \(\backslash\)}}
\DoxyCodeLine{00155\ \textcolor{preprocessor}{\ \ \ \ doris::debug::QueryTraceEvent::create\_with\_ctx(name,\ category,\ id,\ phase,\ ctx)}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \textcolor{preprocessor}{\#define\ INTERNAL\_ADD\_EVENT\_INTO\_THREAD\_LOCAL\_BUFFER(event)\ \(\backslash\)}}
\DoxyCodeLine{00158\ \textcolor{preprocessor}{\ \ \ \ INTERNAL\_ADD\_EVENT\_INFO\_BUFFER(doris::debug::tls\_trace\_ctx.event\_buffer,\ event)}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#define\ INTERNAL\_ADD\_EVENT\_INFO\_BUFFER(buffer,\ event)\ \(\backslash\)}}
\DoxyCodeLine{00161\ \textcolor{preprocessor}{\ \ \ \ do\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00162\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ if\ (buffer)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ buffer-\/>add(event);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\ \ \ \ \}\ while\ (0);}}
\DoxyCodeLine{00166\ \}\ \textcolor{comment}{//\ namespace\ doris::debug}}

\end{DoxyCode}
