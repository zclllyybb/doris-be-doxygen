\hypertarget{aarch64_2atomic__arch_8h_source}{}\doxysection{atomic\+\_\+arch.\+h}
\label{aarch64_2atomic__arch_8h_source}\index{/Users/dabowang/doris/be/src/glibc-\/compatibility/musl/aarch64/atomic\_arch.h@{/Users/dabowang/doris/be/src/glibc-\/compatibility/musl/aarch64/atomic\_arch.h}}
\mbox{\hyperlink{aarch64_2atomic__arch_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#define\ a\_ll\ a\_ll}}
\DoxyCodeLine{00002\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a9f1999547c26097a3218c81c38ec1239}{a\_ll}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{int}\ *p)}
\DoxyCodeLine{00003\ \{}
\DoxyCodeLine{00004\ \ \ \ \ \textcolor{keywordtype}{int}\ v;}
\DoxyCodeLine{00005\ \ \ \ \ \_\_asm\_\_\ \_\_volatile\_\_\ (\textcolor{stringliteral}{"{}ldaxr\ \%w0,\%1"{}}\ :\ \textcolor{stringliteral}{"{}=r"{}}(v)\ :\ \textcolor{stringliteral}{"{}Q"{}}(*p));}
\DoxyCodeLine{00006\ \ \ \ \ \textcolor{keywordflow}{return}\ v;}
\DoxyCodeLine{00007\ \}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ a\_sc\ a\_sc}}
\DoxyCodeLine{00010\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a371f30d8f477d92bd3bdd520a23b56d5}{a\_sc}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{int}\ *p,\ \textcolor{keywordtype}{int}\ v)}
\DoxyCodeLine{00011\ \{}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keywordtype}{int}\ r;}
\DoxyCodeLine{00013\ \ \ \ \ \_\_asm\_\_\ \_\_volatile\_\_\ (\textcolor{stringliteral}{"{}stlxr\ \%w0,\%w2,\%1"{}}\ :\ \textcolor{stringliteral}{"{}=\&r"{}}(r),\ \textcolor{stringliteral}{"{}=Q"{}}(*p)\ :\ \textcolor{stringliteral}{"{}r"{}}(v)\ :\ \textcolor{stringliteral}{"{}memory"{}});}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keywordflow}{return}\ !r;}
\DoxyCodeLine{00015\ \}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ a\_barrier\ a\_barrier}}
\DoxyCodeLine{00018\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_aedd5a35eb0b91dee83f7d424034476ea}{a\_barrier}}()}
\DoxyCodeLine{00019\ \{}
\DoxyCodeLine{00020\ \ \ \ \ \_\_asm\_\_\ \_\_volatile\_\_\ (\textcolor{stringliteral}{"{}dmb\ ish"{}}\ :\ :\ :\ \textcolor{stringliteral}{"{}memory"{}});}
\DoxyCodeLine{00021\ \}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ a\_cas\ a\_cas}}
\DoxyCodeLine{00024\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_acf94b42b060ee536fc750a448ccd2928}{a\_cas}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{int}\ *p,\ \textcolor{keywordtype}{int}\ t,\ \textcolor{keywordtype}{int}\ s)}
\DoxyCodeLine{00025\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{int}\ old;}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ old\ =\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a9f1999547c26097a3218c81c38ec1239}{a\_ll}}(p);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (old\ !=\ t)\ \{}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{aarch64_2atomic__arch_8h_aedd5a35eb0b91dee83f7d424034476ea}{a\_barrier}}();}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00033\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{aarch64_2atomic__arch_8h_a371f30d8f477d92bd3bdd520a23b56d5}{a\_sc}}(p,\ s));}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{return}\ old;}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#define\ a\_ll\_p\ a\_ll\_p}}
\DoxyCodeLine{00038\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{aarch64_2atomic__arch_8h_a8a858fa95a912cd925e0d1bc65bc0428}{a\_ll\_p}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{void}\ *p)}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{void}\ *v;}
\DoxyCodeLine{00041\ \ \ \ \ \_\_asm\_\_\ \_\_volatile\_\_\ (\textcolor{stringliteral}{"{}ldaxr\ \%0,\ \%1"{}}\ :\ \textcolor{stringliteral}{"{}=r"{}}(v)\ :\ \textcolor{stringliteral}{"{}Q"{}}(*(\textcolor{keywordtype}{void}\ *\textcolor{keyword}{volatile}\ *)p));}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{return}\ v;}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#define\ a\_sc\_p\ a\_sc\_p}}
\DoxyCodeLine{00046\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_aa1679d62b0e75dd11b289a5aafead599}{a\_sc\_p}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{int}\ *p,\ \textcolor{keywordtype}{void}\ *v)}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{int}\ r;}
\DoxyCodeLine{00049\ \ \ \ \ \_\_asm\_\_\ \_\_volatile\_\_\ (\textcolor{stringliteral}{"{}stlxr\ \%w0,\%2,\%1"{}}\ :\ \textcolor{stringliteral}{"{}=\&r"{}}(r),\ \textcolor{stringliteral}{"{}=Q"{}}(*(\textcolor{keywordtype}{void}\ *\textcolor{keyword}{volatile}\ *)p)\ :\ \textcolor{stringliteral}{"{}r"{}}(v)\ :\ \textcolor{stringliteral}{"{}memory"{}});}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{return}\ !r;}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#define\ a\_cas\_p\ a\_cas\_p}}
\DoxyCodeLine{00054\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{x86__64_2atomic__arch_8h_a43b10eeb733c403acf76835ad4fa97b6}{a\_cas\_p}}(\textcolor{keyword}{volatile}\ \textcolor{keywordtype}{void}\ *p,\ \textcolor{keywordtype}{void}\ *t,\ \textcolor{keywordtype}{void}\ *s)}
\DoxyCodeLine{00055\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ *old;}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ old\ =\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a8a858fa95a912cd925e0d1bc65bc0428}{a\_ll\_p}}(p);}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (old\ !=\ t)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{aarch64_2atomic__arch_8h_aedd5a35eb0b91dee83f7d424034476ea}{a\_barrier}}();}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{aarch64_2atomic__arch_8h_aa1679d62b0e75dd11b289a5aafead599}{a\_sc\_p}}(p,\ s));}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{return}\ old;}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#define\ a\_ctz\_64\ a\_ctz\_64}}
\DoxyCodeLine{00068\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a5716219aa524bb98fa88c66d4be3c6cd}{a\_ctz\_64}}(uint64\_t\ x)}
\DoxyCodeLine{00069\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \_\_asm\_\_(}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ rbit\ \%0,\ \%1\(\backslash\)n"{}}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ clz\ \%0,\ \%0\(\backslash\)n"{}}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}=r"{}}(x)\ :\ \textcolor{stringliteral}{"{}r"{}}(x));}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{return}\ x;}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#define\ a\_clz\_64\ a\_clz\_64}}
\DoxyCodeLine{00078\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{aarch64_2atomic__arch_8h_a8a2a5e91020e5af1d61501075668523d}{a\_clz\_64}}(uint64\_t\ x)}
\DoxyCodeLine{00079\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \_\_asm\_\_(\textcolor{stringliteral}{"{}clz\ \%0,\ \%1"{}}\ :\ \textcolor{stringliteral}{"{}=r"{}}(x)\ :\ \textcolor{stringliteral}{"{}r"{}}(x));}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{return}\ x;}
\DoxyCodeLine{00082\ \}}

\end{DoxyCode}
